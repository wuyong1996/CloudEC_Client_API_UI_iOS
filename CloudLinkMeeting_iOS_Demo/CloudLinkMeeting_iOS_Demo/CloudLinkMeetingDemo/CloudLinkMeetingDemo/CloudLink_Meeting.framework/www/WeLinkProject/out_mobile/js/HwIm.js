webpackJsonp([8],{100:function(e,t,r){e.exports={default:r(126),__esModule:!0}},103:function(e,t,r){e.exports=r(0)(51)},104:function(e,t,r){e.exports=r(0)(424)},106:function(e,t,r){"use strict";t.__esModule=!0;var n=r(133),a=function(e){return e&&e.__esModule?e:{default:e}}(n);t.default=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return(0,a.default)(e)}},110:function(e,t,r){e.exports={default:r(162),__esModule:!0}},111:function(e,t,r){e.exports=r(0)(156)},112:function(e,t,r){e.exports={default:r(160),__esModule:!0}},1145:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.dealRecentByAddGroup=t.dealRecentByDeleteGroup=t.deleteRecent=void 0;var o=r(1),i=a(o),s=r(2),u=a(s),c=r(571),l=n(c),d=r(801),f=n(d),p=window.Logger("logic")("recent/list/deleteRecent");t.deleteRecent=function(){var e=(0,u.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,p.info("userClick  recent delete group recent"),e.next=4,f.getLocalRecent({owner:t});case 4:r=e.sent,isNullOrEmpty(r)||window.confirm(language.CONFIRM_TO_DELETE_RECENT).then(function(){var e=(0,u.default)(i.default.mark(function e(t){var n,a,o,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ret){e.next=2;break}return e.abrupt("return");case 2:return n=r.owner,a=r.chat_type,o={is_del_all:0,conversation_id:n,type:a},e.next=6,new coreTup.HWTupIM;case 6:return s=e.sent,s.delRecentConversation(o),r.is_delete=constant.IS_DELETE.YES,e.next=11,coreDb.saveRecent(r);case 11:$dispatch(coreUi.deleteRecent(n));case 12:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),p.error("deleteRecent",e.t0.toString());case 11:case"end":return e.stop()}},e,void 0,[[0,8]])}));return function(t){return e.apply(this,arguments)}}(),t.dealRecentByDeleteGroup=function(){var e=(0,u.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,p.info("dealRecentByDeleteGroup 删除群组后处理对话"),e.next=4,f.getLocalRecent({owner:t});case 4:if(r=e.sent,isNullOrEmpty(r)){e.next=11;break}return r.is_disable=!0,r.group_name=r.group.name,e.next=10,coreDb.saveRecent(r);case 10:l.refreshRecentList(r);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),p.error("dealRecentByDeleteGroup",e.t0.toString());case 16:case"end":return e.stop()}},e,void 0,[[0,13]])}));return function(t){return e.apply(this,arguments)}}(),t.dealRecentByAddGroup=function(){var e=(0,u.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,p.info("dealRecentByDeleteGroup 删除群组后处理对话"),e.next=4,f.getLocalRecent({owner:t});case 4:r=e.sent,isNullOrEmpty(r)||(r.is_disable=!1,coreDb.saveRecent(r),l.refreshRecentList(r)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),p.error("dealRecentByDeleteGroup",e.t0.toString());case 11:case"end":return e.stop()}},e,void 0,[[0,8]])}));return function(t){return e.apply(this,arguments)}}()},1146:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getRecentConversation=void 0;var a=r(1),o=n(a),i=r(2),s=n(i),u=window.Logger("logic")("recent/list");t.getRecentConversation=function(){var e=(0,s.default)(o.default.mark(function e(){var t,r,n,a,i,s,c,l;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u.info("getRecentConversation"),e.next=4,coreDb.queryUserConfig({key:"recentIncrementTime"});case 4:return t=e.sent,r=t.value,isNullOrEmpty(r)?r=0:(r=parseInt(r),isNaN(r)&&(r=0)),e.next=9,new coreTup.HWTupIM;case 9:return n=e.sent,e.next=12,n.getRecentConversation({time_stamp:r,count:200});case 12:if(!(a=e.sent)){e.next=19;break}if(i=a.param,(s=a.result)!==constant.ERROR_CODE.Success){e.next=19;break}return c=i.recent_conversation_list,l=i.time_stamp,0!==r&&l!==r&&coreDb.saveUserConfig({key:"recentIncrementTime",value:l.toString()}),e.abrupt("return",c);case 19:return e.abrupt("return",[]);case 22:return e.prev=22,e.t0=e.catch(0),u.error("getRecentConversation",e.t0.toString()),e.abrupt("return",[]);case 26:case"end":return e.stop()}},e,void 0,[[0,22]])}));return function(){return e.apply(this,arguments)}}()},1147:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(110),o=n(a),i=r(103),s=n(i),u=r(106),c=n(u),l=r(984),d=n(l),f=r(869),p=n(f);t.default=function(){var e=!1,t={},r=!0,n=0,a=new p.default,i=new p.default,u=new d.default,l=new d.default,f=[],g=!1,_=function(){};return _.prototype={initReceiveMessageQueue:function(){f=[],g=!1,window.Logger("model")("IMService").info("initReceiveMessageQueue _receiveMessageQueue.length="+f.length)},setReceiveMessageQueue:function(e){f.push(e),window.Logger("model")("IMService").info("setReceiveMessageQueue _receiveMessageQueue.length="+f.length)},setReceiveMessageQueueList:function(e){var t;(t=f).push.apply(t,(0,c.default)(e)),window.Logger("model")("IMService").info("setReceiveMessageQueueList _receiveMessageQueue.length="+f.length)},getFirstReceiveMessageQueue:function(){return window.Logger("model")("IMService").info("getFirstReceiveMessageQueue _receiveMessageQueue.length="+f.length),f.shift()},setIsReceiveMessageQueueDealing:function(e){g=e},getIsReceiveMessageQueueDealing:function(){return g},initUnReadFileMessageList:function(){l.init()},setUnReadFileMessage:function(e){l.set(["server_chat_id_str"],(0,s.default)({},e))},getUnReadFileMessage:function(e){return l.get(e)},getUnReadFileMessageList:function(e){return l.getList(e)},getAllUnReadFileMessageList:function(){return l.getAll()},deleteUnReadFileMessage:function(e){l.delete({server_chat_id_str:e.server_chat_id_str})},deleteUnReadFileMessageList:function(e){e.forEach(function(e){l.delete({server_chat_id_str:e.server_chat_id_str})})},initUnReadMessageList:function(){u.init()},setUnReadMessage:function(e){u.set(["server_chat_id_str"],(0,s.default)({},e))},getAllUnReadMessageList:function(){return u.getAll()},initUnDealMessageList:function(){t={},window.Logger("model")("IMService").info("initUnDealMessageList _unDealMessageMap.length="+(0,o.default)(t).length)},setUnDealMessage:function(e){var r=e[0];t[r.server_chat_id_str]=e,window.Logger("model")("IMService").info("setUnDealMessage _unDealMessageMap.length="+(0,o.default)(t).length)},getUnDealMessageList:function(){var e=(0,o.default)(t),r=[];return e.forEach(function(e){r.push(t[e])}),window.Logger("model")("IMService").info("getUnDealMessageList list.length="+r.length),r},setRecentListReady:function(t){var r=window.Logger("model")("IMService/message");!0===t?(r.info("setRecentListReady 本地会话已准备好"),e=t):!1===t&&(r.info("setRecentListReady 本地会话尚未准备好"),e=t)},getRecentListReady:function(){return e},getPosition:function(){return n},setPosition:function(e){n=e},initSendingMessageMap:function(){a.init()},setSendingMessage:function(e,t){a.set(e,(0,s.default)({},t))},getSendingMessage:function(e){var t=a.get(e)||{};return(0,s.default)({},t)},deleteSendingMessage:function(e){a.delete(e)},getSendingMessageMap:function(){return a.getAll()},querySendingMessageMap:function(e){return a.getAll(e)},initReceivingMessageMap:function(){i.init()},setReceivingMessage:function(e,t){i.set(e,(0,s.default)({},t))},getReceivingMessage:function(e){var t=i.get(e)||{};return(0,s.default)({},t)},deleteReceivingMessage:function(e){i.delete(e)},getReceivingMessageMap:function(e){return i.getAll(e)},queryReceivingMessageMap:function(e){return i.getAll(e)},setUmServerFlag:function(e){r=e},getUmServerFlag:function(){return r},initUmServerFlag:function(){r=!0}},new _}()},1148:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(103),o=n(a),i=r(869),s=n(i),u=new s.default,c=new s.default;t.default={initFileHandleMap:function(){u.init()},setFileByHandle:function(e,t){u.set(e,(0,o.default)({},t))},getFileByHandle:function(e){var t=u.get(e)||{};return(0,o.default)({},t)},getFileHandleMap:function(){return u.getAll()},deleteFileByHandle:function(e){u.delete(e)},deleteFileByHandleList:function(e){e.forEach(function(e){u.delete(e)})},initGroupFileHandleMap:function(){c.init()},setGroupFileByHandle:function(e,t){c.set(e,(0,o.default)({},t))},getGroupFileByHandle:function(e){var t=c.get(e)||{};return(0,o.default)({},t)},deleteGroupFileByHandle:function(e){c.delete(e)}}},1149:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(103),o=n(a),i=r(869),s=n(i),u=new s.default;t.default={initUnDownloadedPhotoMap:function(){u.init()},setUnDownloadedPhoto:function(e,t){u.set(e,(0,o.default)({},t))},getUnDownloadedPhoto:function(e){var t=u.get(e)||{};return(0,o.default)({},t)},getUnDownloadedPhotoMap:function(){return u.getAll()},deleteUnDownloadedPhoto:function(e){u.delete(e)}}},1150:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(870),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=new a.default;t.default={addUploadScreenShotFunc:function(e){o.addQueueFunc(e),o.runQueueFunc()}}},1151:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(870),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=new a.default;t.default={addDownloadScreenShotFunc:function(e){o.addQueueFunc(e),o.runQueueFunc()}}},1152:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){l=!0;var t=d.getMessageWithdrawServerIdList();if(0===t.length)return void(l=!1);var r=Date.now();t.forEach(function(t){r-t.time>6e4&&d.deleteMessageWithdrawServerId({key:t[e]})}),setTimeout(function(){return a(e)},3e5)}Object.defineProperty(t,"__esModule",{value:!0});var o=r(103),i=n(o),s=r(984),u=n(s),c=new u.default,l=!1,d={initMessageWithdrawServerIdList:function(){c.init()},setMessageWithdrawServerId:function(e,t){t.time=Date.now(),c.set([e],(0,i.default)({},t)),l||a(e)},getMessageWithdrawServerId:function(e){var t=c.get(e)||{};return(0,i.default)({},t)},getMessageWithdrawServerIdList:function(){return c.getAll()},deleteMessageWithdrawServerId:function(e){c.delete(e)}};t.default=d},1153:function(e,t,r){"use strict";function n(){var e=!1,t={};this.__proto__={initOfflineFileConfig:function(){e=!1,t={}},setOfflineFileConfig:function(r,n){r&&(e=!0,t=n)},getOfflineFileConfig:function(){return e?t:e}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=new n},1154:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="";t.default=function(){var e=function(){};return e.prototype={initSendPhotoType:function(){n=""},setSendPhotoType:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";n=e},getSendPhotoType:function(){return n}},new e}()},1155:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.setMessageNotifyClose=t.initNewConversationUI=t.changeHintsShow=t.openRecentConversation=t.toggleRecent=void 0;var o=r(3),i=a(o),s=r(1),u=a(s),c=r(2),l=a(c),d=r(801),f=n(d),p=r(571),g=n(p),_=r(135),h=n(_),v=r(573),m=(r(867),window.Logger("logic")("recent/list")),M=(t.toggleRecent=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];m.info("userClick  toggleRecent",handlePhoneNumber(e.owner),t),coreContact.toggleSliderDetailShow(!1),coreUi.setShowGroupSlider(!1);var r=$getState(),n=r.recent.currentRecentInfo;if(t&&(h.isGroup(e.chat_type)?coreConf.setUnreadNumber({account:"",group_id:e.owner},0):coreConf.setUnreadNumber({account:e.owner,group_id:""},0)),!window.CLIENTCONFIG.ISMOBILE&&e.owner===n.owner)return Object.type(delegate.UmFocus)===Object.type.FUNCTION&&delegate.UmFocus(),void m.info("toggleRecent","点击相同recent，不重复打开");M(e)},t.openRecentConversation=function(e){try{m.info("openRecentConversation","打开会话"),e.is_disable?y(e):w(e),coreContact.updateSignatureByRecent(e)}catch(e){m.error("openRecentConversation",e.toString())}}),y=function(e){try{m.info("openDisableRecent","打开禁用会话"),S(e).then(function(e){$dispatch(coreUi.setHistoryMessageNotLoading()),(0,v.loadHistoryMessageList)(),I(e.owner)}).catch(function(e){m.error("openDisableRecent 异常抛出",e)})}catch(e){m.error("openDisableRecent",e.toString())}},E=t.changeHintsShow=function(e){$dispatch(coreUi.changeHintsShowState(e))},w=function(){var e=(0,l.default)(u.default.mark(function e(t){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,m.info("openRecent 打开会话"),r=void 0,!h.isGroup(t.chat_type)){e.next=7;break}return e.next=6,coreDb.queryUserConfig({key:""+t.group.group_id});case 6:r=e.sent;case 7:S(t).then(function(e){if(h.isGroup(e.chat_type))e.group.team_notify_is_read=parseInt(r.value);else{var t=e.contact,n=t.account||e.account;coreUi.getContactAvatar(n),window.CLIENTCONFIG.ISMOBILE?(0,v.subscribeUserStatusByAccount)(n,!0):(0,v.subscribeUserStatusByAccount)(n)}return coreCommon.setMessageNotifyRead(e),$dispatch(coreUi.setHistoryMessageNotLoading()),window.CLIENTCONFIG.ISMOBILE||Object.type(delegate.UmFocus)!==Object.type.FUNCTION||delegate.UmFocus(),(0,v.loadHistoryMessageList)(),I(e.owner),f.getImExtendInfo(e)}).then(function(e){coreUi.freshImExtMemberList(e)}).catch(function(e){m.error("openRecent 异常抛出",e)}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),m.error("openRecent",e.t0.toString());case 13:case"end":return e.stop()}},e,void 0,[[0,10]])}));return function(t){return e.apply(this,arguments)}}(),S=t.initNewConversationUI=function(e){try{m.info("initNewConversationUI"),$dispatch(coreUi.loadMessageList([])),coreUi.freshImExtMemberList([]),g.selectRecentItem(e),(0,v.setUnreadNewMessageNum)(0);var t=($getState().call.callId,window.getRoute());return window.CLIENTCONFIG.ISMOBILE?("callMain"!==t&&"mConfMemberPage"!==t&&window.goRoute("conversation"),window.webView&&window.webView.cancelAllMessageNotify()):($dispatch(coreUi.showEditor()),coreUi.clickToolbar("",!1),coreUi.showRecentIntoView(e.owner),E(!0)),e.is_delete=constant.IS_DELETE.NO,new i.default(function(t){setTimeout(function(){return t(e)},70)})}catch(t){return m.info("initNewConversationUI",t),new i.default(function(t){setTimeout(function(){return t(e)},70)})}},I=t.setMessageNotifyClose=function(e){var t=$getState(),r=t.notify.messageNotifyIsShow,n=t.notify.messageNotify,a=n.account||n.group_id;r&&a===e&&coreCommon.closeMessageNotifyLogic()}},1156:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r,n){var a=E.getGroupFileByHandle(e.group_id+t.file_real_save_path),o=a.pre_file_id;if(o)return C.info("dealPreUploadResult 预上传完成确认"),E.deleteGroupFileByHandle(e.group_id+t.file_real_save_path),I.groupFileReportUploadResult({prefile_id:o,group_id:e.group_id,upload_user_account:e.origin,file_name:t.file_name,file_size:t.file_size,file_url:r,result:n})}function i(e){return e.split('onload="delegate.onImageLoad(this)"').join('onload="delegate.onImageLoad(this)" ondblclick="ShowImage(this)" ')}function s(e,t){var r=e?"photoDownloadSuccess":"photoDownloadError",n=new Event(r);n.data={screenShot:t},C.info("sendImgDownloadEvent 图片下载发送事件;",r),window.dispatchEvent(n)}Object.defineProperty(t,"__esModule",{value:!0}),t.dealOffLineRspNotify=t.dealOffLineProgressNotify=void 0;var u=r(103),c=a(u),l=r(112),d=a(l),f=r(100),p=a(f),g=r(1),_=a(g),h=r(2),v=a(h),m=function(){var e=(0,v.default)(_.default.mark(function e(t,r){var n,a,i,s,u,l,f,g,h,v,m,M,y,w,S;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:C.info("dealUploadRspNotify 处理上传文件传输结果"),n=t.param,a=n.file_handle,i=b.checkOffLineRspNotify(t),s={},e.prev=5,u=0;case 7:if(!(u<5)){e.next=19;break}if(s=E.getSendingMessage(r.message_server_chat_id_str),!isNullOrEmpty(s)){e.next=15;break}return C.info("dealUploadRspNotify i:"+u),e.next=13,sleep(300);case 13:e.next=16;break;case 15:return e.abrupt("break",19);case 16:u++,e.next=7;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(5),C.error("dealUploadRspNotify",e.t0.toString());case 24:if(l=n.filersp,f=l.url,g=l.plain_access_code,o(s,r,(0,p.default)({downloadUrl:f,fileAccessCode:g}),1),s.media_type!==constant.MEDIA_TYPE.PHOTO_TEXT){e.next=55;break}if(i){e.next=52;break}for(E.deleteSendingMessage(r.message_server_chat_id_str),h=s.file_list,v=!0,m=!1,M=void 0,e.prev=34,y=(0,d.default)(h);!(v=(w=y.next()).done);v=!0)S=w.value,o(s,S,"",0);e.next=42;break;case 38:e.prev=38,e.t1=e.catch(34),m=!0,M=e.t1;case 42:e.prev=42,e.prev=43,!v&&y.return&&y.return();case 45:if(e.prev=45,!m){e.next=48;break}throw M;case 48:return e.finish(45);case 49:return e.finish(42);case 50:return(0,A.dealScreenShotSendFailed)(s),e.abrupt("return");case 52:return C.info("dealOffLineRspNotify 截图",r.file_real_save_name),E.addUploadScreenShotFunc(function(){return P((0,c.default)({},r),n,s)}),e.abrupt("return");case 55:if(s.media_type!==constant.MEDIA_TYPE.VIDEO){e.next=62;break}if(i){e.next=60;break}return o(s,r,"",0),(0,A.dealVideoSendFailed)(s,r),e.abrupt("return");case 60:return E.addUploadScreenShotFunc(function(){return D((0,c.default)({},r),n,s)}),e.abrupt("return");case 62:if(C.info("dealOffLineRspNotify 文件"),E.deleteSendingMessage(r.message_server_chat_id_str),i){e.next=68;break}return o(s,r,"",0),(0,A.dealFileSendFailed)((0,c.default)({},r),s),e.abrupt("return");case 68:return e.abrupt("return",F((0,c.default)({},r),n,s));case 69:case"end":return e.stop()}},e,this,[[5,21],[34,38,42,50],[43,,45,49]])}));return function(t,r){return e.apply(this,arguments)}}(),M=function(){var e=(0,v.default)(_.default.mark(function e(t,r){var n,a,o,i;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return C.info("dealDownloadRspNotify 处理下载文件传输结果"),n=t.param,a=n.file_handle,o=b.checkOffLineRspNotify(t),e.next=6,coreDb.queryMessage({server_chat_id_str:r.message_server_chat_id_str});case 6:if(i=e.sent,E.deleteFileByHandleList([a,i.client_chat_id]),i.media_type!==constant.MEDIA_TYPE.PHOTO_TEXT){e.next=17;break}if(o){e.next=13;break}return C.debug("dealOffLineRspNotify 失败 截图"),s(!1,(0,c.default)({},r)),e.abrupt("return",(0,A.dealDownloadScreenShotFailed)((0,c.default)({},r),i));case 13:C.info("dealOffLineRspNotify 截图",r.file_real_save_name),E.addDownloadScreenShotFunc(function(){return U((0,c.default)({},r),a,i)}),e.next=33;break;case 17:if(i.media_type!==constant.MEDIA_TYPE.PHOTO){e.next=25;break}if(o){e.next=21;break}return s(!1,(0,c.default)({},r)),e.abrupt("return",(0,A.dealDownloadScreenShotFailed)((0,c.default)({},r),i));case 21:return C.info("dealOffLineRspNotify 图片",r.file_real_save_name),e.abrupt("return",k((0,c.default)({},r),a,i));case 25:if(o){e.next=29;break}return C.debug("dealOffLineRspNotify 失败"),(0,A.dealDownloadFileFailed)((0,c.default)({},r),i),e.abrupt("return");case 29:if(i.media_type!==constant.MEDIA_TYPE.VIDEO){e.next=31;break}return e.abrupt("return",x((0,c.default)({},r),i));case 31:return C.info("dealOffLineRspNotify 文件"),e.abrupt("return",G((0,c.default)({},r),i));case 33:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),y=r(159),E=n(y),w=r(574),S=r(213),I=n(S),T=r(873),b=n(T),L=r(156),O=n(L),R=r(135),N=n(R),A=r(486),C=(r(987),window.Logger("logic")("IM/offlineFileNotify")),x=(t.dealOffLineProgressNotify=function(){var e=(0,v.default)(_.default.mark(function e(t){var r,n,a;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{r=t.param,n=r.file_handle,a=Math.round(100*r.now/r.total),O.updateProgressMap(n,a)}catch(e){C.error("dealOffLineProgressNotify",e.toString())}case 1:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.dealOffLineRspNotify=function(){var e=(0,v.default)(_.default.mark(function e(t){var r,n,a;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,C.info("dealOffLineRspNotify 处理离线文件传输结果"),r=t.param,n=r.file_handle,a=E.getFileByHandle(n),isNullOrEmpty(a)&&C.error("dealOffLineRspNotify:","file is null or empty"),(0,A.clearFileHandle)(a),a.file_deal_type!==constant.FILE_DEAL_TYPE.UPLOAD){e.next=9;break}return e.abrupt("return",m(t,a));case 9:return E.deleteReceivingMessage(a.um_url),e.abrupt("return",M(t,a));case 13:e.prev=13,e.t0=e.catch(0),C.error("dealOffLineRspNotify",e.t0.toString());case 16:case"end":return e.stop()}},e,void 0,[[0,13]])}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,v.default)(_.default.mark(function e(t,r){var n,a;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,C.info("dealDownloadFileRspNotify"),t.is_downloaded=constant.IS_DOWNLOADED.YES,n=[],a=r.file_list,N.isQuoteFile(t)&&n.push(t),!/\.png$/.test(t.file_real_save_name.toLocaleLowerCase())){e.next=12;break}return e.next=8,coreDb.saveScreenShot((0,c.default)({},t));case 8:a[1]=t,(0,A.dealDownloadVideoImageSuccess)(r,a,n),e.next=16;break;case 12:return e.next=14,coreDb.saveFile((0,c.default)({},t));case 14:a[0]=t,(0,A.dealDownloadSuccess)(r,a,n);case 16:H(t,r),B(r),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),C.error("dealDownloadFileRspNotify",e.t0.toString());case 23:case"end":return e.stop()}},e,void 0,[[0,20]])}));return function(t,r){return e.apply(this,arguments)}}()),P=function(){var e=(0,v.default)(_.default.mark(function e(t,r,n){var a,o,s,u,l,d;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,C.info("dealUploadScreenShotRspNotify"),a=r.filersp,o=a.url,s=a.plain_access_code,t.is_uploaded=constant.IS_UPLOADED.YES,t.um_url=o,t.um_plain_access_code=s,e.next=9,coreDb.saveScreenShot((0,c.default)({},t));case 9:return e.next=11,coreDb.queryScreenShotList({message_server_chat_id_str:t.message_server_chat_id_str});case 11:if(u=e.sent,!isNullOrEmpty(u)){e.next=15;break}return C.error("dealUploadScreenShotRspNotify db没有查询到截图信息，终止处理"),e.abrupt("return");case 15:l=0;case 16:if(!(l<u.length)){e.next=23;break}if(u[l].is_uploaded!==constant.IS_UPLOADED.NO){e.next=20;break}return C.info("dealUploadScreenShotRspNotify 尚未上传完成"),e.abrupt("return");case 20:l++,e.next=16;break;case 23:return E.deleteSendingMessage(n.client_chat_id),n.content=(0,w.createPhotoTextMessageContent)(n,u),n.show_html=i(n.show_html),isNullOrEmpty(n.quote)||(n.content=(0,w.createQuotePhotoTextMessageContent)(n,u,n.quote)),n.display_name=getContactNameByMessage(n),d=(0,A.dealUploadSuccess)(n,u),e.abrupt("return",I.sendImMessage((0,c.default)({},d)));case 32:e.prev=32,e.t0=e.catch(0),C.error("dealUploadScreenShotRspNotify",e.t0.toString());case 35:case"end":return e.stop()}},e,void 0,[[0,32]])}));return function(t,r,n){return e.apply(this,arguments)}}(),D=function(){var e=(0,v.default)(_.default.mark(function e(t,r,n){var a,o,i,s,u,l,d,f;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,C.info("dealUploadScreenShotRspNotify"),a=r.filersp,o=a.url,i=a.plain_access_code,t.is_uploaded=constant.IS_UPLOADED.YES,t.um_url=o,t.um_plain_access_code=i,!t.isVideoImage){e.next=11;break}coreDb.saveScreenShot((0,c.default)({},t)),e.next=13;break;case 11:return e.next=13,coreDb.saveFile((0,c.default)({},t));case 13:return e.next=15,coreDb.queryFileList({message_server_chat_id_str:t.message_server_chat_id_str});case 15:return s=e.sent,e.next=18,coreDb.queryScreenShotList({message_server_chat_id_str:t.message_server_chat_id_str});case 18:if(u=e.sent,l=s.concat(u),!isNullOrEmpty(l)){e.next=23;break}return C.error("dealUploadScreenShotRspNotify db没有查询到视频信息，终止处理"),e.abrupt("return");case 23:d=0;case 24:if(!(d<l.length)){e.next=31;break}if(l[d].is_uploaded!==constant.IS_UPLOADED.NO){e.next=28;break}return C.info("dealUploadScreenShotRspNotify 尚未上传完成"),e.abrupt("return");case 28:d++,e.next=24;break;case 31:return E.deleteSendingMessage(n.client_chat_id),isNullOrEmpty(n.quote)||(n.content=(0,w.createVideoMessageContent)(n,l,n.quote)),n.content=(0,w.createVideoMessageContent)(n,l),n.display_name=getContactNameByMessage(n),f=(0,A.dealUploadSuccess)(n,l),e.abrupt("return",I.sendImMessage((0,c.default)({},f)));case 39:e.prev=39,e.t0=e.catch(0),C.error("dealUploadScreenShotRspNotify",e.t0.toString());case 42:case"end":return e.stop()}},e,void 0,[[0,39]])}));return function(t,r,n){return e.apply(this,arguments)}}(),F=function(){var e=(0,v.default)(_.default.mark(function e(t,r,n){var a,o,i,s;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,C.info("dealUploadFileRspNotify"),a=r.filersp,o=a.url,i=a.plain_access_code,t.is_uploaded=constant.IS_UPLOADED.YES,t.um_url=o,t.um_plain_access_code=i,n.media_type!==constant.MEDIA_TYPE.PHOTO){e.next=12;break}return e.next=10,coreDb.saveScreenShot((0,c.default)({},t));case 10:e.next=14;break;case 12:return e.next=14,coreDb.saveFile((0,c.default)({},t));case 14:return n.content=(0,w.createFileMessageContent)(t),n.display_name=getContactName(n),s=(0,A.dealUploadSuccess)(n,[t]),e.abrupt("return",I.sendImMessage((0,c.default)({},s)));case 20:e.prev=20,e.t0=e.catch(0),C.error("dealUploadFileRspNotify",e.t0.toString());case 23:case"end":return e.stop()}},e,void 0,[[0,20]])}));return function(t,r,n){return e.apply(this,arguments)}}(),U=function(){var e=(0,v.default)(_.default.mark(function e(t){var r,n,a,o,i=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments[2]);return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s(!0,t),t.is_downloaded=constant.IS_DOWNLOADED.YES,isNullOrEmpty(t.type)||"origin"!==t.type){e.next=6;break}return O.setCurrentImg(t),e.abrupt("return");case 6:return e.next=8,coreDb.saveScreenShot((0,c.default)({},t));case 8:return e.next=10,coreDb.queryScreenShotList({message_server_chat_id_str:t.message_server_chat_id_str});case 10:for(r=e.sent,n=[],a=[],o=0;o<r.length;o++)r[o].is_downloaded===constant.IS_DOWNLOADED.YES&&(N.isQuoteFile(r[o])?n.push(r[o]):a.push(r[o]));(0,A.dealDownloadSuccess)(i,a,n),H(t,i),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),C.error("dealDownloadScreenShotRspNotify",e.t0.toString());case 20:case"end":return e.stop()}},e,void 0,[[0,17]])}));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=(0,v.default)(_.default.mark(function e(t){var r,n,a=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments[2]);return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s(!0,t),t.is_downloaded=constant.IS_DOWNLOADED.YES,isNullOrEmpty(t.type)||"origin"!==t.type){e.next=6;break}return O.setCurrentImg(t),e.abrupt("return");case 6:return e.next=8,coreDb.saveScreenShot((0,c.default)({},t));case 8:r=[],n=[],t.is_downloaded===constant.IS_DOWNLOADED.YES&&(N.isQuoteFile(t)?r.push(t):n.push(t)),(0,A.dealDownloadSuccess)(a,n,r),H(t,a),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),C.error("dealDownloadScreenShotRspNotify",e.t0.toString());case 17:case"end":return e.stop()}},e,void 0,[[0,14]])}));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=(0,v.default)(_.default.mark(function e(t,r){var n,a;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,C.info("dealDownloadFileRspNotify"),t.is_downloaded=constant.IS_DOWNLOADED.YES,e.next=5,coreDb.saveFile((0,c.default)({},t));case 5:n=[],a=[],t.is_downloaded===constant.IS_DOWNLOADED.YES&&(N.isQuoteFile(t)?n.push(t):a.push(t)),(0,A.dealDownloadSuccess)(r,a,n),H(t,r),B(r),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),C.error("dealDownloadFileRspNotify",e.t0.toString());case 15:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t,r){return e.apply(this,arguments)}}(),H=function(e,t){C.info("dealSaveAsDownload 另存下载的处理");var r=$getState().recent.saveAsFileMessageMap;isNullOrEmpty(r[t.server_chat_id_str])||appService.saveAs(e.file_real_save_path,r[t.server_chat_id_str]).then(function(){O.deleteSaveAsFileMessageMap(t.server_chat_id_str),window.alert(language.SAVE_SUCCESS+"！")})},B=function(e){C.info("dealOpenFileOrFolderDownload 下载后自动打开");var t=$getState().recent.openFileMessageMap;isNullOrEmpty(t[e.server_chat_id_str])||(appService.openFileOrFolder(t[e.server_chat_id_str]),O.deleteOpenFileMessageMap(e.server_chat_id_str))}},1157:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.reSendScreenShots=t.sendScreenShots=t.sendMobileTextMessage=t.sendNormalMessage=void 0;var a=r(1158),o=n(a),i=r(1163),s=n(i);t.sendNormalMessage=o.sendNormalMessage,t.sendMobileTextMessage=o.sendMobileTextMessage,t.sendScreenShots=s.sendScreenShots,t.reSendScreenShots=s.reSendScreenShots},1158:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.sendMobileTextMessage=t.sendNormalMessage=void 0;var a=r(103),o=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(484),s=n(i),u=r(213),c=n(u),l=r(156),d=n(l),f=window.Logger("logic")("IM/messageSend");window.tup=c;t.sendNormalMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return f.info("sendNormalMessage"),coreUi.clearDoc().then(function(){coreCommon.isIos()&&delegate.$getUmEditor&&delegate.$getUmEditor().focus()}),s.createNormalMessage(e,t).then(function(t){return d.initLoadMore(),d.addNewMessage(t),1===e.sub_msg_type&&(t.sub_msg_type=e.sub_msg_type),c.sendImMessage((0,o.default)({},t))})}catch(e){f.error("sendNormalMessage",e.toString())}},t.sendMobileTextMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return f.info("sendMobileTextMessage"),s.createMobileTextMessage(e,t).then(function(e){return d.initLoadMore(),d.addNewMessage(e),c.sendImMessage((0,o.default)({},e))})}catch(e){f.error("sendNormalMessage",e.toString())}}},1159:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=v.formatImgUrl(e.getAttribute("src"));if(!1===t)return!1;if(-1===t.indexOf(window.EMOTION_PATH)){var r=getFileName(t);e.src=constant.SERVER_PUBLIC_PATH.IMAGE_PATH+r,e.setAttribute("onmouseup","ShowImageMenu(this)"),e.setAttribute("ondblclick","ShowImage(this)"),e.setAttribute("id",r.substring(0,r.lastIndexOf("."))),e.removeAttribute("onload")}return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.createCallRecordMessage=t.createGroupMemberChgMessage=t.createGroupNotifyMessage=t.formatSendImgInfo=t.createFileMessageContent=t.createQuotePhotoTextMessageContent=t.createVideoMessageContent=t.createPhotoTextMessageContent=t.createMobileLikeMessage=t.createLikeMessage=t.createFileMessage=t.createPhotoTextMessage=t.createMobileTextMessage=t.createNormalMessage=void 0;var i=r(103),s=a(i),u=r(106),c=a(u),l=r(1),d=a(l),f=r(2),p=a(f),g=r(985),_=n(g),h=r(135),v=n(h),m=r(982),M=n(m),y=r(572),E=window.Logger("logic")("IM/message/transform"),w=(t.createNormalMessage=function(){var e=(0,p.default)(d.default.mark(function e(t){var r,n,a,o,i,s,u,c,l,f,p,g,_,h,m,S,T,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=$getState(),n=r.recent,a=r.myInfo,o=n.recentList,i=n.currentRecentInfo,i=t.mediaType===constant.MEDIA_TYPE.AUTO_REPLY?o.query({owner:L}):i,E.info("createNormalMessage"),s=w(t),isNullOrEmpty(b)||(E.info("createNormalMessage 有引用, 创建引用消息"),s=I(t,b)),u=$getState().common,c=u.userFontFamily,l=u.userFontSize,f=u.userFontColor,p=u.userFontStatus,g=$getState().IM.imSetFontEnable,_=p.bold?"bold":"normal",h=p.italic?"italic":"normal",m=p.underline?"underline":"none",l=4*l/3,S=t.html,T={at_user_list:window.at_list||[],chat_type:t.chatType||i.chat_type,origin:a.account,target:L||"",group_id:"",display_name:getContactName(a),content:s,recent_id:L?1:i.id,recent_owner:L||M.getRecentOwner(i),media_type:t.mediaType,show_html:S,show_text:t.text,client_chat_id:getClientId(),time_stamp:y.localTimeService.getLocalTime(),name:a.name,native_name:a.native_name,is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,quote:b,is_delete:constant.IS_DELETE.NO},T.server_chat_id_str=T.client_chat_id.toString(),T.utc_stamp=T.time_stamp,v.isGroup(i.chat_type)?(T.group_id=i.group.group_id,T.group_name=i.group.name):T.target=T.target?T.target:i.contact.account||i.account,e.abrupt("return",T);case 21:e.prev=21,e.t0=e.catch(0),E.error("createNormalMessage",e.t0.toString());case 24:case"end":return e.stop()}},e,void 0,[[0,21]])}));return function(t){return e.apply(this,arguments)}}(),t.createMobileTextMessage=function(){var e=(0,p.default)(d.default.mark(function e(t){var r,n,a,o,i,s,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=$getState(),n=r.recent,a=r.myInfo,o=n.currentRecentInfo,E.info("createMobileTextMessage"),i=S(t),isNullOrEmpty(u)||(E.info("createMobileTextMessage 有引用, 创建引用消息"),i=T(t,u)),s={at_user_list:window.at_list||[],chat_type:t.chatType||o.chat_type,origin:a.account,target:"",group_id:"",display_name:getContactName(a),content:i,recent_id:o.id,recent_owner:M.getRecentOwner(o),media_type:t.mediaType,show_text:t.text,client_chat_id:getClientId(),time_stamp:y.localTimeService.getLocalTime(),name:a.name,native_name:a.native_name,is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,quote:u,is_delete:constant.IS_DELETE.NO},s.server_chat_id_str=s.client_chat_id.toString(),s.utc_stamp=s.time_stamp,v.isGroup(o.chat_type)?(s.group_id=o.group.group_id,s.group_name=o.group.name):s.target=o.contact.account||o.account,e.abrupt("return",s);case 13:e.prev=13,e.t0=e.catch(0),E.error("createNormalMessage",e.t0.toString());case 16:case"end":return e.stop()}},e,void 0,[[0,13]])}));return function(t){return e.apply(this,arguments)}}(),t.createPhotoTextMessage=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{var n=e.recent,a=e.myInfo,o=n.currentRecentInfo;E.info("createPhotoTextMessage");var i=t.html,s=t.text,u=t.mediaType,c=$getState().common,l=(c.userFontFamily,c.userFontSize),d=(c.userFontColor,c.userFontStatus);$getState().IM.imSetFontEnable,d.bold,d.italic,d.underline;l=4*l/3;var f={at_user_list:window.at_list||[],chat_type:o.chat_type,content_type:constant.CONTENT_TYPE.TEXT,group_id:"",media_type:u,display_name:getContactName(a),name:a.name,native_name:a.native_name,origin:a.account,source_flag:0,target:"",time_stamp:y.localTimeService.getLocalTime(),recent_id:o.id,recent_owner:M.getRecentOwner(o),show_text:s,client_chat_id:getClientId(),is_read:1,is_delete:constant.IS_DELETE.NO,quote:r,show_html:i};return f.utc_stamp=f.time_stamp,f.server_chat_id_str=f.client_chat_id.toString(),v.isGroup(o.chat_type)?(f.group_id=o.group.group_id,f.group_name=o.group.name):f.target=o.contact.account||o.account,f}catch(e){E.error("createPhotoTextMessage",e.toString())}},t.createFileMessage=function(e,t){E.info("createFileMessage");var r=e.myInfo,n=e.recent,a=n.currentRecentInfo,o={chat_type:a.chat_type,content_type:constant.CONTENT_TYPE.TEXT,target:"",group_id:"",display_name:getContactName(e.myInfo),native_name:r.native_name,name:r.name,origin:r.account,source_flag:0,time_stamp:y.localTimeService.getLocalTime(),client_chat_id:getClientId(),media_type:v.getMediaType(t),recent_id:a.id,recent_owner:M.getRecentOwner(a),is_read:1,is_delete:constant.IS_DELETE.NO,status:constant.MEDIA_STATUS.SENDING,show_text:t};return o.server_chat_id_str=o.client_chat_id.toString(),o.utc_stamp=o.time_stamp,v.isGroup(a.chat_type)?(o.group_id=a.owner,o.group_name=a.group.name):o.target=a.owner,o},t.createLikeMessage=function(){var e=(0,p.default)(d.default.mark(function e(t){var r,n,a,o,i,s;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=$getState(),n=r.recent,a=r.myInfo,o=n.currentRecentInfo,E.info("createMobileLikeMessage"),i=S(t),s={chat_type:o.chat_type,origin:a.account,target:"",group_id:"",display_name:getContactName(a),content:i,recent_id:o.id,recent_owner:M.getRecentOwner(o),media_type:t.mediaType,show_html:t.html,show_text:t.text,client_chat_id:getClientId(),time_stamp:y.localTimeService.getLocalTime(),name:a.name,native_name:a.native_name,is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,is_delete:constant.IS_DELETE.NO},s.server_chat_id_str=s.client_chat_id.toString(),s.utc_stamp=s.time_stamp,v.isGroup(o.chat_type)?(s.group_id=o.group.group_id,s.group_name=o.group.name):s.target=o.contact.account||o.account,e.abrupt("return",s);case 12:e.prev=12,e.t0=e.catch(0),E.error("createLikeMessage",e.t0.toString());case 15:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t){return e.apply(this,arguments)}}(),t.createMobileLikeMessage=function(){var e=(0,p.default)(d.default.mark(function e(t){var r,n,a,o,i,s;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=$getState(),n=r.recent,a=r.myInfo,o=n.currentRecentInfo,E.info("createMobileLikeMessage"),i=S(t),s={chat_type:o.chat_type,origin:a.account,target:"",group_id:"",display_name:getContactName(a),content:i,recent_id:o.id,recent_owner:M.getRecentOwner(o),media_type:t.mediaType,show_text:t.text,client_chat_id:getClientId(),time_stamp:y.localTimeService.getLocalTime(),name:a.name,native_name:a.native_name,is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,is_delete:constant.IS_DELETE.NO},s.server_chat_id_str=s.client_chat_id.toString(),s.utc_stamp=s.time_stamp,v.isGroup(o.chat_type)?(s.group_id=o.group.group_id,s.group_name=o.group.name):s.target=o.contact.account||o.account,e.abrupt("return",s);case 12:e.prev=12,e.t0=e.catch(0),E.error("createMobileLikeMessage",e.t0.toString());case 15:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t){return e.apply(this,arguments)}}(),function(e){try{E.info("createNormalMessageContent");var t=e.html,r=e.text,n=$getState().common,a=(n.userFontFamily,n.userFontSize),o=(n.userFontColor,n.userFontStatus);$getState().IM.imSetFontEnable,o.bold,o.italic,o.underline;a=4*a/3,t=_.transformMessageContentEmotion(t);var i={isGZip:1,imageList:[],html:t,content:r};return _.createRootElem(i)}catch(e){E.error("createNormalMessageContent",e.toString())}}),S=function(e){try{E.info("createMobileTextMessageContent");var t=e.text,r={isGZip:1,content:t};return _.createMobileRootElem(r)}catch(e){E.error("createMobileTextMessageContent",e.toString())}},I=function(e,t){try{E.info("createQuoteNormalMessageContent");var r=e.html,n=e.text;r=_.transformMessageContentEmotion(r);var a={isGZip:1,imageList:[],html:r,content:n,quote:t};return _.createQuoteRootElem(a)}catch(e){E.error("createQuoteNormalMessageContent",e.toString())}},T=function(e,t){try{E.info("createMobileQuoteTextMessageContent");var r=e.text,n={isGZip:1,content:r,quote:t};return _.createMobileQuoteRootElem(n)}catch(e){E.error("createMobileQuoteTextMessageContent",e.toString())}},b=(t.createPhotoTextMessageContent=function(e,t){try{E.info("createPhotoTextMessageContent");var r=e.show_html,n=(e.show_text,e.origin,e.media_type),a=b(r);a=_.transformMessageContentEmotion(a);var o={isGZip:1,imageList:[].concat((0,c.default)(t)),html:a,content:_.createPhotoTextContentText(n,t,r)};return _.createRootElem(o)}catch(e){E.error("createPhotoTextMessageContent",e.toString())}},t.createVideoMessageContent=function(e,t){try{E.info("createPhotoTextMessageContent");var r=(e.media_type,{isGZip:1,content:_.createVideoContentText(t[0])}),n=t[1];return n&&(r.imageList=[(0,s.default)({},n)]),_.createRootElem(r)}catch(e){E.error("createPhotoTextMessageContent",e.toString())}},t.createQuotePhotoTextMessageContent=function(e,t,r){try{E.info("createQuotePhotoTextMessageContent");var n=e.show_html,a=(e.show_text,e.origin,b(n));a=_.transformMessageContentEmotion(a);var o={isGZip:1,imageList:[].concat((0,c.default)(t)),html:a,content:_.createPhotoTextContentText(t,n),quote:r};return _.createQuoteRootElem(o)}catch(e){E.error("createQuotePhotoTextMessageContent",e.toString())}},t.createFileMessageContent=function(e){try{return E.info("createFileMessageContent"),_.createFileRootElem(e)}catch(e){E.error("createFileMessageContent",e.toString())}},t.formatSendImgInfo=function(e){var t=coreCommon.String2HTML(e);if("text"===Object.type(t))return e;if("P"===t.tagName&&1===t.childNodes.length&&(t=t.childNodes[0]),"IMG"===t.tagName)o(t);else{t.querySelectorAll("img").forEach(function(e){o(e)})}return coreCommon.XML2String(t)});t.createGroupNotifyMessage=function(e){try{E.info("createGroupNotifyMessage");var t=$getState();if(isNullOrEmpty(e)||isNullOrEmpty(e.group))return void E.error("createGroupNotifyMessage 空群信息，不处理");var r=e.group,n=e.chat_type,a=e.id,o=e.owner,i=r.manifesto,s=t.myInfo,u={chat_type:n,origin:s.account,target:"",group_id:o,display_name:getContactName(s),content:"",recent_id:a,recent_owner:M.getRecentOwner(e),media_type:constant.MEDIA_TYPE.GROUP_NOTIFY,show_html:"",show_text:i,client_chat_id:getClientId(),time_stamp:y.localTimeService.getLocalTime(),name:s.name,native_name:s.native_name,is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,quote:{},is_delete:constant.IS_DELETE.NO,utc_stamp:y.localTimeService.getLocalTime()};return u.utc_stamp=u.time_stamp,u.server_chat_id_str=u.client_chat_id.toString(),u}catch(e){E.error("createGroupNotifyMessage",e.toString())}},t.createGroupMemberChgMessage=function(e,t,r){try{E.info("createGroupMemberChgMessage");var n=$getState(),a=n.myInfo,o={chat_type:M.getChatTypeByGroup(e),origin:a.account,target:"",group_id:e.group_id,group_name:e.name,display_name:getContactName(a),content:"",recent_owner:e.group_id,media_type:r,show_html:"",show_text:t,client_chat_id:getClientId(),time_stamp:y.localTimeService.getLocalTime(),name:a.name,native_name:a.native_name,is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,quote:{},is_delete:constant.IS_DELETE.NO,utc_stamp:y.localTimeService.getLocalTime(),is_dealed_apply:1};return o.utc_stamp=o.time_stamp,o.server_chat_id_str=o.client_chat_id.toString(),r===constant.MEDIA_TYPE.APPLY_JOIN_FIXED_GROUP_NOTIFY&&(o.is_dealed_apply=0),o}catch(e){E.error("createGroupMemberChgMessage",e.toString())}},t.createCallRecordMessage=function(e,t){try{E.info("createCallRecordMessage");var r=$getState();if(isNullOrEmpty(e)||!isNullOrEmpty(e.group))return void E.error("createCallRecordMessage 空信息，不处理");var n=(e.group,e.chat_type),a=e.id,o=(e.owner,e.contact),i=r.myInfo,s={chat_type:n,origin:i.account,target:"",group_id:"",display_name:getContactName(i),content:"",recent_id:a,recent_owner:M.getRecentOwner(e),media_type:constant.MEDIA_TYPE.CALL_RECORD_NOTIFY,show_html:"",show_text:t,client_chat_id:getClientId(),time_stamp:y.localTimeService.getLocalTime(),name:i.name,native_name:i.native_name,is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,quote:{},is_delete:constant.IS_DELETE.NO,utc_stamp:y.localTimeService.getLocalTime()};return s.utc_stamp=s.time_stamp,s.server_chat_id_str=s.client_chat_id.toString(),v.isGroup(e.chat_type)?(s.group_id=e.group.group_id,s.group_name=e.group.name):s.target=o.account||e.account,s}catch(e){E.error("createCallRecordMessage",e.toString())}}},116:function(e,t,r){"use strict";(function(e){function n(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(n()<t)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=o.prototype):(null===e&&(e=new o(t)),e.length=t),e}function o(e,t,r){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(this,e)}return i(this,e,t,r)}function i(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?f(e,t,r,n):"string"==typeof t?l(e,t,r):p(e,t)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t,r,n){return s(t),t<=0?a(e,t):void 0!==r?"string"==typeof n?a(e,t).fill(r,n):a(e,t).fill(r):a(e,t)}function c(e,t){if(s(t),e=a(e,t<0?0:0|g(t)),!o.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function l(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!o.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|h(t,r);e=a(e,n);var i=e.write(t,r);return i!==n&&(e=e.slice(0,i)),e}function d(e,t){var r=t.length<0?0:0|g(t.length);e=a(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),o.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=o.prototype):e=d(e,t),e}function p(e,t){if(o.isBuffer(t)){var r=0|g(t.length);return e=a(e,r),0===e.length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||z(t.length)?a(e,0):d(e,t);if("Buffer"===t.type&&Z(t.data))return d(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function g(e){if(e>=n())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n().toString(16)+" bytes");return 0|e}function _(e){return+e!=e&&(e=0),o.alloc(+e)}function h(e,t){if(o.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return $(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return W(e).length;default:if(n)return $(e).length;t=(""+t).toLowerCase(),n=!0}}function v(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,t>>>=0,r<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,r);case"utf8":case"utf-8":return O(this,t,r);case"ascii":return N(this,t,r);case"latin1":case"binary":return A(this,t,r);case"base64":return L(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function M(e,t,r,n,a){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=a?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(a)return-1;r=e.length-1}else if(r<0){if(!a)return-1;r=0}if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,a);if("number"==typeof t)return t&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):y(e,[t],r,n,a);throw new TypeError("val must be string, number or Buffer")}function y(e,t,r,n,a){function o(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}var i=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;i=2,s/=2,u/=2,r/=2}var c;if(a){var l=-1;for(c=r;c<s;c++)if(o(e,c)===o(t,-1===l?0:c-l)){if(-1===l&&(l=c),c-l+1===u)return l*i}else-1!==l&&(c-=c-l),l=-1}else for(r+u>s&&(r=s-u),c=r;c>=0;c--){for(var d=!0,f=0;f<u;f++)if(o(e,c+f)!==o(t,f)){d=!1;break}if(d)return c}return-1}function E(e,t,r,n){r=Number(r)||0;var a=e.length-r;n?(n=Number(n))>a&&(n=a):n=a;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var i=0;i<n;++i){var s=parseInt(t.substr(2*i,2),16);if(isNaN(s))return i;e[r+i]=s}return i}function w(e,t,r,n){return Q($(t,e.length-r),e,r,n)}function S(e,t,r,n){return Q(V(t),e,r,n)}function I(e,t,r,n){return S(e,t,r,n)}function T(e,t,r,n){return Q(W(t),e,r,n)}function b(e,t,r,n){return Q(q(t,e.length-r),e,r,n)}function L(e,t,r){return 0===t&&r===e.length?X.fromByteArray(e):X.fromByteArray(e.slice(t,r))}function O(e,t,r){r=Math.min(e.length,r);for(var n=[],a=t;a<r;){var o=e[a],i=null,s=o>239?4:o>223?3:o>191?2:1;if(a+s<=r){var u,c,l,d;switch(s){case 1:o<128&&(i=o);break;case 2:u=e[a+1],128==(192&u)&&(d=(31&o)<<6|63&u)>127&&(i=d);break;case 3:u=e[a+1],c=e[a+2],128==(192&u)&&128==(192&c)&&(d=(15&o)<<12|(63&u)<<6|63&c)>2047&&(d<55296||d>57343)&&(i=d);break;case 4:u=e[a+1],c=e[a+2],l=e[a+3],128==(192&u)&&128==(192&c)&&128==(192&l)&&(d=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&l)>65535&&d<1114112&&(i=d)}}null===i?(i=65533,s=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),a+=s}return R(n)}function R(e){var t=e.length;if(t<=J)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=J));return r}function N(e,t,r){var n="";r=Math.min(e.length,r);for(var a=t;a<r;++a)n+=String.fromCharCode(127&e[a]);return n}function A(e,t,r){var n="";r=Math.min(e.length,r);for(var a=t;a<r;++a)n+=String.fromCharCode(e[a]);return n}function C(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var a="",o=t;o<r;++o)a+=j(e[o]);return a}function x(e,t,r){for(var n=e.slice(t,r),a="",o=0;o<n.length;o+=2)a+=String.fromCharCode(n[o]+256*n[o+1]);return a}function P(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,r,n,a,i){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function F(e,t,r,n){t<0&&(t=65535+t+1);for(var a=0,o=Math.min(e.length-r,2);a<o;++a)e[r+a]=(t&255<<8*(n?a:1-a))>>>8*(n?a:1-a)}function U(e,t,r,n){t<0&&(t=4294967295+t+1);for(var a=0,o=Math.min(e.length-r,4);a<o;++a)e[r+a]=t>>>8*(n?a:3-a)&255}function k(e,t,r,n,a,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function G(e,t,r,n,a){return a||k(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),K.write(e,t,r,n,23,4),r+4}function H(e,t,r,n,a){return a||k(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),K.write(e,t,r,n,52,8),r+8}function B(e){if(e=Y(e).replace(ee,""),e.length<2)return"";for(;e.length%4!=0;)e+="=";return e}function Y(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function j(e){return e<16?"0"+e.toString(16):e.toString(16)}function $(e,t){t=t||1/0;for(var r,n=e.length,a=null,o=[],i=0;i<n;++i){if((r=e.charCodeAt(i))>55295&&r<57344){if(!a){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(i+1===n){(t-=3)>-1&&o.push(239,191,189);continue}a=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),a=r;continue}r=65536+(a-55296<<10|r-56320)}else a&&(t-=3)>-1&&o.push(239,191,189);if(a=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function V(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function q(e,t){for(var r,n,a,o=[],i=0;i<e.length&&!((t-=2)<0);++i)r=e.charCodeAt(i),n=r>>8,a=r%256,o.push(a),o.push(n);return o}function W(e){return X.toByteArray(B(e))}function Q(e,t,r,n){for(var a=0;a<n&&!(a+r>=t.length||a>=e.length);++a)t[a+r]=e[a];return a}function z(e){return e!==e}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var X=r(215),K=r(216),Z=r(197);t.Buffer=o,t.SlowBuffer=_,t.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=n(),o.poolSize=8192,o._augment=function(e){return e.__proto__=o.prototype,e},o.from=function(e,t,r){return i(null,e,t,r)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(e,t,r){return u(null,e,t,r)},o.allocUnsafe=function(e){return c(null,e)},o.allocUnsafeSlow=function(e){return c(null,e)},o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,a=0,i=Math.min(r,n);a<i;++a)if(e[a]!==t[a]){r=e[a],n=t[a];break}return r<n?-1:n<r?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Z(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=o.allocUnsafe(t),a=0;for(r=0;r<e.length;++r){var i=e[r];if(!o.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,a),a+=i.length}return n},o.byteLength=h,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?O(this,0,e):v.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e,t,r,n,a){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===a&&(a=this.length),t<0||r>e.length||n<0||a>this.length)throw new RangeError("out of range index");if(n>=a&&t>=r)return 0;if(n>=a)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,a>>>=0,this===e)return 0;for(var i=a-n,s=r-t,u=Math.min(i,s),c=this.slice(n,a),l=e.slice(t,r),d=0;d<u;++d)if(c[d]!==l[d]){i=c[d],s=l[d];break}return i<s?-1:s<i?1:0},o.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return M(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return M(this,e,t,r,!1)},o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var a=this.length-t;if((void 0===r||r>a)&&(r=a),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return E(this,e,t,r);case"utf8":case"utf-8":return w(this,e,t,r);case"ascii":return S(this,e,t,r);case"latin1":case"binary":return I(this,e,t,r);case"base64":return T(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var J=4096;o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n;if(o.TYPED_ARRAY_SUPPORT)n=this.subarray(e,t),n.__proto__=o.prototype;else{var a=t-e;n=new o(a,void 0);for(var i=0;i<a;++i)n[i]=this[i+e]}return n},o.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||P(e,t,this.length);for(var n=this[e],a=1,o=0;++o<t&&(a*=256);)n+=this[e+o]*a;return n},o.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||P(e,t,this.length);for(var n=this[e+--t],a=1;t>0&&(a*=256);)n+=this[e+--t]*a;return n},o.prototype.readUInt8=function(e,t){return t||P(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||P(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||P(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||P(e,t,this.length);for(var n=this[e],a=1,o=0;++o<t&&(a*=256);)n+=this[e+o]*a;return a*=128,n>=a&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||P(e,t,this.length);for(var n=t,a=1,o=this[e+--n];n>0&&(a*=256);)o+=this[e+--n]*a;return a*=128,o>=a&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){t||P(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(e,t){t||P(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(e,t){return t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||P(e,4,this.length),K.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||P(e,4,this.length),K.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||P(e,8,this.length),K.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||P(e,8,this.length),K.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t|=0,r|=0,!n){D(this,e,t,r,Math.pow(2,8*r)-1,0)}var a=1,o=0;for(this[t]=255&e;++o<r&&(a*=256);)this[t+o]=e/a&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t|=0,r|=0,!n){D(this,e,t,r,Math.pow(2,8*r)-1,0)}var a=r-1,o=1;for(this[t+a]=255&e;--a>=0&&(o*=256);)this[t+a]=e/o&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):F(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):F(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):U(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var a=Math.pow(2,8*r-1);D(this,e,t,r,a-1,-a)}var o=0,i=1,s=0;for(this[t]=255&e;++o<r&&(i*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/i>>0)-s&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var a=Math.pow(2,8*r-1);D(this,e,t,r,a-1,-a)}var o=r-1,i=1,s=0;for(this[t+o]=255&e;--o>=0&&(i*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/i>>0)-s&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):F(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):F(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):U(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,r){return G(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return G(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return H(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return H(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var a,i=n-r;if(this===e&&r<t&&t<n)for(a=i-1;a>=0;--a)e[a+t]=this[a+r];else if(i<1e3||!o.TYPED_ARRAY_SUPPORT)for(a=0;a<i;++a)e[a+t]=this[a+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+i),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0);var i;if("number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var s=o.isBuffer(e)?e:$(new o(e,n).toString()),u=s.length;for(i=0;i<r-t;++i)this[i+t]=s[i%u]}return this};var ee=/[^+\/0-9A-Za-z-_]/g}).call(t,r(16))},1160:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadHistoryMessageList=void 0;var o=r(1),i=a(o),s=r(2),u=a(s),c=r(213),l=n(c),d=r(802),f=n(d),p=r(135),g=n(p),_=r(872),h=n(_),v=r(156),m=n(v),M=r(986),y=window.Logger("logic")("IM/historyMessageDeal"),E=(t.loadHistoryMessageList=function(){var e=(0,u.default)(i.default.mark(function e(){var t,r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{y.info("loadHistoryMessageList 首次加载漫游消息"),t=$getState(),r=t.recent.currentRecentInfo,n=r.owner,f.checkOnlyLoadLocalMessage(r)?(y.info("loadHistoryMessageList 只加载本地消息"),E(n)):(y.info("loadHistoryMessageList 同步服务器消息"),w(n))}catch(e){y.error("loadHistoryMessageList",e.toString())}case 1:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),function(){var e=(0,u.default)(i.default.mark(function e(t){var r,n,a,o,s,u;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,y.info("onlyLoadLocalHistoryMessageList 只加载本地消息"),n=$getState(),!(a=n.recent.isHistoryMessageLoading)){e.next=7;break}return y.info("onlyLoadLocalHistoryMessageList 正在加载本地消息"),e.abrupt("return");case 7:return o=[{recent_owner:t,utc_stamp:9999999999999},!0],f.initLoadHistoryMessage(),y.info("onlyLoadLocalHistoryMessageList 初始化加载本地列表"),e.next=12,(r=coreDb).limitMessageList.apply(r,o);case 12:if(s=e.sent,u=$getState().recent.currentRecentInfo,u.owner===t){e.next=17;break}return y.info("onlyLoadLocalHistoryMessageList 不在当前会话"),e.abrupt("return");case 17:(0,M.modifyMessageListStatus)(s),isNullOrEmpty(s)?$dispatch(coreUi.haveNoMoreMessage()):(y.info("onlyLoadLocalHistoryMessageList  加载本地消息"),m.loadHistoryMessage(s)),f.updateMessageQueryInfo(),$dispatch(coreUi.setHistoryMessageNotLoading()),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),y.error("onlyLoadLocalHistoryMessageList",e.t0.toString()),$dispatch(coreUi.setHistoryMessageNotLoading());case 27:case"end":return e.stop()}},e,void 0,[[0,23]])}));return function(t){return e.apply(this,arguments)}}()),w=function(){var e=(0,u.default)(i.default.mark(function e(t){var r,n,a,o,s,u,c,d,p,_;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,y.info("loadLocalAndServerHistoryMessageList 同步服务器消息"),n=$getState(),a=n.recent.currentRecentInfo,!(o=n.recent.isHistoryMessageLoading)){e.next=8;break}return y.info("loadLocalAndServerHistoryMessageList 正在加载漫游消息"),e.abrupt("return");case 8:return s=[{recent_owner:t,utc_stamp:9999999999999},!0],f.initLoadHistoryMessage(),u=!1,y.info("loadLocalAndServerHistoryMessageList 初始化加载本地列表"),e.next=14,(r=coreDb).limitMessageList.apply(r,s);case 14:if(c=e.sent,d=$getState().recent.currentRecentInfo,d.owner===t){e.next=19;break}return y.info("loadLocalAndServerHistoryMessageList 不在当前会话"),e.abrupt("return");case 19:if(isNullOrEmpty(c)){e.next=24;break}return u=!0,y.info("loadLocalAndServerHistoryMessageList  加载初始化本地消息"),e.next=24,f.loadDbMessage(t,c,!1);case 24:return y.info("loadLocalAndServerHistoryMessageList 查询服务器漫游消息"),e.next=27,l.queryHistoryMessage({sender:t,operation_type:constant.QUERY_OPERATION_TYPE.FIRST,message_type:g.isGroup(a.chat_type)?1:0});case 27:if(p=e.sent,!isNullOrEmpty(p)){e.next=33;break}return y.info("loadLocalAndServerHistoryMessageList（处理服务器消息）","没有更多漫游消息"),$dispatch(coreUi.haveNoMoreServerMessage()),$dispatch(coreUi.setHistoryMessageNotLoading()),e.abrupt("return");case 33:if(d=$getState().recent.currentRecentInfo,d.owner===t){e.next=37;break}return y.info("loadLocalAndServerHistoryMessageList 不在当前会话"),e.abrupt("return");case 37:if(_={queryTime:p[0].utc_stamp,bigTime:p[0].utc_stamp,smallTime:p[p.length-1].utc_stamp},!h.isLocalHas(_,a)){e.next=48;break}if(!u){e.next=43;break}y.info("loadLocalAndServerHistoryMessageList 已经加载本地消息"),e.next=46;break;case 43:return y.info("loadLocalAndServerHistoryMessageList 没有本地消息"),$dispatch(coreUi.haveNoMoreLocalMessage()),e.abrupt("return");case 46:e.next=53;break;case 48:return y.info("loadLocalAndServerHistoryMessageList 更新记录信息"),h.dealMessageSign(_,a),y.info("loadLocalAndServerHistoryMessageList 处理服务器消息"),e.next=53,f.loadServerMessage.apply(f,[p].concat(s));case 53:$dispatch(coreUi.setHistoryMessageNotLoading()),e.next=60;break;case 56:e.prev=56,e.t0=e.catch(0),y.error("loadLocalAndServerHistoryMessageList",e.t0.toString()),$dispatch(coreUi.setHistoryMessageNotLoading());case 60:case"end":return e.stop()}},e,void 0,[[0,56]])}));return function(t){return e.apply(this,arguments)}}()},1161:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.forwardQueryMessage=void 0;var o=r(1),i=a(o),s=r(2),u=a(s),c=r(213),l=n(c),d=r(802),f=n(d),p=r(135),g=n(p),_=r(872),h=n(_),v=window.Logger("logic")("IM/historyMessageDeal"),m=(t.forwardQueryMessage=function(){var e=(0,u.default)(i.default.mark(function e(){var t,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{v.info("forwardQueryMessage"),t=$getState(),r=t.recent.currentRecentInfo,f.checkOnlyLoadLocalMessage(r,!0)?(v.info("forwardQueryMessage 只加载本地消息"),m(r)):(v.info("forwardQueryMessage 同步服务器消息"),M(r))}catch(e){v.error("forwardQueryMessage",e.toString()),$dispatch(coreUi.setHistoryMessageNotLoading())}case 1:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),function(){var e=(0,u.default)(i.default.mark(function e(t){var r,n,a,o,s,u,c,l,d;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=$getState(),a=n.recent,o=a.isHistoryMessageLoading,s=a.smallQueryMessageUtcStamp,u=a.moreLocalMessage,!o){e.next=5;break}return e.abrupt("return");case 5:if(u){e.next=8;break}return v.info("onlyForwardLocalMessage","没有更多消息"),e.abrupt("return");case 8:if(f.initAddMoreHistoryMessage(),c=$getState().recent.currentRecentInfo,c.owner===t.owner){e.next=14;break}return v.info("onlyForwardLocalMessage 不在当前会话"),$dispatch(coreUi.setHistoryMessageNotLoading()),e.abrupt("return");case 14:return l=[{recent_owner:t.owner,utc_stamp:s},!0],v.debug("onlyForwardLocalMessage 加载本地消息"),e.next=18,(r=coreDb).limitMessageList.apply(r,l);case 18:if(d=e.sent,!isNullOrEmpty(d)){e.next=24;break}v.info("onlyForwardLocalMessage 没有本地消息"),$dispatch(coreUi.haveNoMoreMessage()),e.next=26;break;case 24:return e.next=26,f.loadDbMessage(t.owner,d,!0);case 26:$dispatch(coreUi.setHistoryMessageNotLoading()),e.next=33;break;case 29:e.prev=29,e.t0=e.catch(0),v.error("onlyForwardLocalMessage",e.t0.toString()),$dispatch(coreUi.setHistoryMessageNotLoading());case 33:case"end":return e.stop()}},e,void 0,[[0,29]])}));return function(t){return e.apply(this,arguments)}}()),M=function(){var e=(0,u.default)(i.default.mark(function e(t){var r,n,a,o,s,u,c,d,p,_,m,M,y,E;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=$getState(),n=r.recent,a=n.isHistoryMessageLoading,o=n.smallQueryMessageServerId,s=n.smallQueryMessageUtcStamp,u=n.moreSeverMessage,!a){e.next=6;break}return v.info("forwardLocalAndServerMessage","正在加载漫游消息"),e.abrupt("return");case 6:if(u){e.next=9;break}return v.info("forwardLocalAndServerMessage","没有更多漫游消息"),e.abrupt("return");case 9:return f.initAddMoreHistoryMessage(),v.debug("forwardLocalAndServerMessage 查询服务器漫游消息"),c=[{recent_owner:t.owner,utc_stamp:s},!0],e.next=14,l.queryHistoryMessage({sender:t.owner,operation_type:constant.QUERY_OPERATION_TYPE.NORMAL,server_chat_id_str:o,message_type:g.isGroup(t.chat_type)?1:0});case 14:if(d=e.sent,!isNullOrEmpty(d)){e.next=30;break}return v.info("forwardLocalAndServerMessage（处理服务器消息）","没有更多漫游消息"),e.next=19,(p=coreDb).limitMessageList.apply(p,c);case 19:if(_=e.sent,!isNullOrEmpty(_)){e.next=25;break}return v.info("forwardLocalAndServerMessage(处理服务器消息) 没有本地消息"),$dispatch(coreUi.haveNoMoreMessage()),$dispatch(coreUi.setHistoryMessageNotLoading()),e.abrupt("return");case 25:return $dispatch(coreUi.haveNoMoreServerMessage()),e.next=28,f.loadDbMessage(t.owner,_,!0);case 28:return $dispatch(coreUi.setHistoryMessageNotLoading()),e.abrupt("return");case 30:if(m=$getState().recent.currentRecentInfo,m.owner===t.owner){e.next=35;break}return v.info("forwardLocalAndServerMessage 不在当前会话"),$dispatch(coreUi.setHistoryMessageNotLoading()),e.abrupt("return");case 35:if(s=0===s?d[d.length-1].utc_stamp:s,M={queryTime:s,bigTime:d[0].utc_stamp,smallTime:d[d.length-1].utc_stamp},!h.isLocalHas(M,t)){e.next=51;break}return v.info("forwardLocalAndServerMessage 直接加载本地消息"),e.next=41,(y=coreDb).limitMessageList.apply(y,c);case 41:if(E=e.sent,!isNullOrEmpty(E)){e.next=47;break}return v.info("forwardLocalAndServerMessage(处理服务器消息) 没有本地消息"),$dispatch(coreUi.haveNoMoreLocalMessage()),$dispatch(coreUi.setHistoryMessageNotLoading()),e.abrupt("return");case 47:return e.next=49,f.loadDbMessage(t.owner,E,!0);case 49:e.next=56;break;case 51:return v.debug("forwardLocalAndServerMessage 更新记录信息"),h.dealMessageSign(M,t),v.debug("forwardLocalAndServerMessage 处理服务器消息"),e.next=56,f.loadServerMessage.apply(f,[d].concat(c));case 56:$dispatch(coreUi.setHistoryMessageNotLoading()),e.next=63;break;case 59:e.prev=59,e.t0=e.catch(0),v.error("forwardLocalAndServerMessage",e.t0.toString()),$dispatch(coreUi.setHistoryMessageNotLoading());case 63:case"end":return e.stop()}},e,void 0,[[0,59]])}));return function(t){return e.apply(this,arguments)}}()},1162:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.backwardQueryMessage=void 0;var o=r(1),i=a(o),s=r(2),u=a(s),c=r(802),l=n(c),d=r(485),f=n(d),p=r(156),g=n(p),_=window.Logger("logic")("IM/historyMessageDeal/addMoreBackwardMessage");t.backwardQueryMessage=function(){var e=(0,u.default)(i.default.mark(function e(){var t,r,n,a,o,s,u,c,d;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,_.debug("backwardQueryMessage"),t=$getState(),r=t.recent,n=r.isHistoryMessageLoading,a=r.bigQueryMessageUtcStamp,o=r.isBackwardLoadMessage,s=r.isLoadMore,o){e.next=6;break}return e.abrupt("return");case 6:if(!n){e.next=9;break}return _.info("backwardQueryMessage","正在加载漫游消息"),e.abrupt("return");case 9:return u=t.recent.currentRecentInfo,l.initAddMoreHistoryMessage(),e.next=13,coreDb.limitMessageList({recent_owner:u.owner,utc_stamp:a},!1);case 13:if(c=e.sent,d=$getState().recent.currentRecentInfo,d.owner===u.owner){e.next=18;break}return _.info("backwardQueryMessage 不在当前会话"),e.abrupt("return");case 18:if(f.setUnreadNewMessageNum(0),!isNullOrEmpty(c)){e.next=26;break}return _.info("backwardQueryMessage(处理服务器消息) 没有本地消息"),$dispatch(coreUi.haveNoMoreLocalMessage()),$dispatch(coreUi.setHistoryMessageNotLoading()),$dispatch(coreUi.initBackwardLoadMessage()),s&&g.initLoadMore(),e.abrupt("return");case 26:return e.next=28,l.loadDbMessage(u.owner,c,!0,!0);case 28:$dispatch(coreUi.setHistoryMessageNotLoading()),e.next=35;break;case 31:e.prev=31,e.t0=e.catch(0),_.error("backwardQueryMessage",e.t0.toString()),$dispatch(coreUi.setHistoryMessageNotLoading());case 35:case"end":return e.stop()}},e,void 0,[[0,31]])}));return function(){return e.apply(this,arguments)}}()},1163:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.reSendScreenShots=t.sendScreenShots=void 0;var o=r(1),i=a(o),s=r(2),u=a(s),c=r(484),l=n(c),d=r(417),f=n(d),p=r(135),g=n(p),_=r(486),h=r(159),v=n(h),m=r(156),M=n(m),y=r(187),E=r(513),w=window.Logger("logic")("IM/messageSend"),S=(t.sendScreenShots=function(){var e=(0,u.default)(i.default.mark(function e(t,r){var n,a,o,s,u,c,d,f,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,_=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,w.info("sendScreenShots"),isNullOrEmpty(p)&&(p=$getState()),coreUi.clearDoc().then(function(){coreCommon.isIos()&&delegate.$getUmEditor&&delegate.$getUmEditor().focus()}),I(t)){e.next=7;break}return window.alert(language.CHECK_PHOTO_MAX_SIZE),e.abrupt("return");case 7:n=l.createPhotoTextMessage(p,r,_),a=[],o=!0,s=0;case 11:if(!(s<t.length)){e.next=28;break}return u=t[s],c={file_name:u.name,file_real_save_path:u.path,file_size:u.size,width:u.width,height:u.height,message_id:n.id,message_server_chat_id_str:n.server_chat_id_str,recent_id:n.recent_id,recent_owner:n.recent_owner,file_handle:"",is_uploaded:constant.IS_UPLOADED.NO,file_deal_type:constant.FILE_DEAL_TYPE.UPLOAD,time_stamp:n.time_stamp},d=$getState().myInfo.account,c.file_path=appService.getOriginFilesPath(d)+u.name,c.file_real_save_name=c.file_name,e.next=19,S(c,n);case 19:return f=e.sent,f||(o=!1),e.next=23,coreDb.saveScreenShot(c);case 23:c=e.sent,a.push(c);case 25:s++,e.next=11;break;case 28:return n.file_list=a,o||(0,E.dealScreenShotSendFailed)(n),n.status=constant.MEDIA_STATUS.SEND_ERROR,n.send_status=constant.SEND_STATUS.error,e.next=34,coreDb.saveMessage(n);case 34:n=e.sent,delete n.send_status,n.status=constant.MEDIA_STATUS.SENDING,v.setSendingMessage(n.client_chat_id,n),(0,y.updateMessageToRecent)(n),w.info("sendScreenShots has been completed"),g.isBelongToCurrentRecent(n)&&(M.initLoadMore(),M.addNewMessage(n)),e.next=46;break;case 43:e.prev=43,e.t0=e.catch(0),w.error("sendScreenShots",e.t0.toJSON());case 46:case"end":return e.stop()}},e,void 0,[[0,43]])}));return function(t,r){return e.apply(this,arguments)}}(),t.reSendScreenShots=function(){var e=(0,u.default)(i.default.mark(function e(t){var r,n,a,o,s,u;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=t.file_list,n=[],a=!0,o=0;case 5:if(!(o<r.length)){e.next=18;break}return s=r[o],e.next=9,S(s,t);case 9:return u=e.sent,u||(a=!1),e.next=13,coreDb.saveScreenShot(s);case 13:s=e.sent,n.push(s);case 15:o++,e.next=5;break;case 18:if(t.file_list=n,a){e.next=21;break}return e.abrupt("return",(0,E.dealScreenShotSendFailed)(t));case 21:return t.status=constant.MEDIA_STATUS.SEND_ERROR,t.send_status=constant.SEND_STATUS.error,e.next=25,coreDb.saveMessage(t);case 25:t=e.sent,t.status=constant.MEDIA_STATUS.SENDING,t.send_status=constant.SEND_STATUS.resend,v.setSendingMessage(t.client_chat_id,t),(0,y.updateMessageToRecent)(t),w.info("sendScreenShots has been completed"),g.isBelongToCurrentRecent(t)&&M.updateMessageList(t),e.next=37;break;case 34:e.prev=34,e.t0=e.catch(0),w.error("reSendFile",e.t0.toString());case 37:case"end":return e.stop()}},e,void 0,[[0,34]])}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,u.default)(i.default.mark(function e(t,r){var n,a,o,s,u,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(w.info("sendScreenShot"),n=$getState(),a=n.recent,o=a.currentRecentInfo,s={file_name:t.file_name,file_path:t.file_real_save_path},!g.isGroup(o.chat_type)||!v.getUmServerFlag()){e.next=13;break}return s.group_id=o.group.group_id,s.file_type=constant.UPLOAD_FILE_TYPE.GROUP,e.next=9,(0,_.groupFilePreUpload)(t,r);case 9:if(""!==(u=e.sent)){e.next=12;break}return e.abrupt("return",!1);case 12:s.operation_token=u;case 13:return e.next=15,f.uploadFile(s);case 15:if(!1!==(c=e.sent)){e.next=18;break}return e.abrupt("return",!1);case 18:return t.file_handle=c.param.pfile_handle.toString(),v.setFileByHandle(t.file_handle,t),e.abrupt("return",!0);case 21:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}()),I=function(e){for(var t=0;t<e.length;t++)if(e[t].size>1024*parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.limitpic"]))return!1;return!0}},1164:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=getSuffix(e);return window.CLIENTCONFIG["Device.ComCfg.IM.forbidFileExt"].replace(/\./g,"").split(";").indexOf(t)>-1&&t}function i(e){return window.fs.lstatSync(e).isDirectory()}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return isNullOrEmpty(t)&&(t=$getState()),c(t)>e.size}function u(e){return 0!==e.size}function c(e){var t=e.recent.currentRecentInfo,r=A.isGroup(t.chat_type),n=l();if(r){var a=d(t.group.single_file_space);return a<=n&&n?a:n}return n||1024*constant.AppConfig.UM.fileMaxSize*1024}function l(){if(!isNullOrEmpty(window.CLIENTCONFIG["Device.ComCfg.IM.fileTransferSize"]))return 1024*parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.fileTransferSize"])*1024}function d(e){var t=1024*parseInt(window.CLIENTCONFIG.GROUP_MAX_FILE_SIZE)*1024;return e=e||t,U.info("getGroupFileSize:",e),e}Object.defineProperty(t,"__esModule",{value:!0}),t.sendVideo=t.sendMobileVideo=t.sendAudio=t.sendImage=t.sendNormalFile=t.sendMobileVideos=t.sendMobilePhoto=t.sendMyVoice=t.sendFiles=void 0;var f=r(103),p=a(f),g=r(112),_=a(g),h=r(1),v=a(h),m=r(2),M=a(m),y=r(110),E=a(y),w=r(574),S=n(w),I=r(156),T=n(I),b=r(874),L=n(b),O=r(417),R=n(O),N=r(135),A=n(N),C=r(513),x=r(187),P=r(159),D=n(P),F=r(572),U=(r(573),window.Logger("logic")("IM/fileSend")),k=(t.sendFiles=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(window.isOffline)return void Toast(language.CURRENTLY_OFFLINE_UNABLE_TO_SEND_MESSAGE);isNullOrEmpty(t)&&(t=$getState()),U.info("sendFiles");var r=0,n={},a={},l={},d={};!function f(){var p=e[r];if(r++,U.info("sendFiles 自执行顺次执行Promise",r),r-1===e.length){var g="",_=(0,E.default)(n);if(_.length>0&&(_.length===e.length?g+=language.ALL_FILESEND_BAN_FILE_TYPE.format(_.map(function(e){return" "+e+" "}).join(","))+"\n":g+=language.FILESEND_BAN_FILE_TYPE.format(_.map(function(e){return" "+e+" "}).join(","))+"\n"),(0,E.default)(a).length>0){var h=(0,E.default)(a).join(", "),v=formatFileSize(c(t));g+=language.FILESEND_BAN_FILE_SIZE.format(h,v)+"\n"}if((0,E.default)(l).length>0){var m=(0,E.default)(l).join(", ");g+=language.FILE_SEND_BAN_FILE_MIN_SIZE.format(m)+"\n"}return void(""!==g&&alert(g))}if(isNullOrEmpty(p))return f();if(i(p.path))return d[p.name]=!0,f();var M=o(p.name);return M?(n[M]=!0,f()):s(p,t)?u(p)?(U.info("sendFiles 执行sendFile Promise",r),G(p,t).then(f)):(l[p.name]=!0,f()):(a[p.name]=!0,f())}()}catch(e){U.error("sendFiles",e.toString())}},t.sendMyVoice=function(){var e=(0,M.default)(v.default.mark(function e(t){var r,n;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,U.info("sendMyVoice"),r=void 0,e.next=5,appService.getFileInfo(t);case 5:return n=e.sent,r={name:getFileName(t),path:t,size:n.size,file_type:constant.FILE_TYPE.VOICE},e.abrupt("return",Y(r,$getState()));case 10:e.prev=10,e.t0=e.catch(0),U.error("sendMyVoice",e.t0.toString());case 13:case"end":return e.stop()}},e,void 0,[[0,10]])}));return function(t){return e.apply(this,arguments)}}(),function(e){var t=e.lastIndexOf("."),r=-1===t?"":e.substr(t+1);return constant.MESSAGE_VIDEO_SUFFIX.includes(r.toLocaleLowerCase())}),G=function(e,t){try{U.info("sendFile");var r=S.createFileMessage(t,e.name),n=e.type,a=e.size,o=n.startsWith("image");if(o&&a>1024*parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.limitscreenshot"]))return r.media_type=constant.MEDIA_TYPE.FILE,H(e,t,r);if(o)return B(e,t,r);if(n.startsWith("audio"))return Y(e,t,r);n.startsWith("video");return k(e.path)?V(e,t,r):H(e,t,r)}catch(e){U.error("sendFile",e.toString())}},H=(t.sendMobilePhoto=function(){var e=(0,M.default)(v.default.mark(function e(t){var r,n,a,o,i,s,u;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.media,U.info("sendMobilePhoto 发送"+r.length+"张图片"),n=$getState(),e.prev=3,a=0;case 5:if(!(a<r.length)){e.next=18;break}return o=r[a].filepath,o=o.startsWith("file://")?o.substr(7,o.length):o,e.next=10,appService.getFileInfo(o);case 10:return i=e.sent,s={name:getFileName(o),path:o,size:i.size},u=S.createFileMessage(n,s.name),e.next=15,B(s,n,u);case 15:a++,e.next=5;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),U.error("sendMobilePhoto",e.t0.toString());case 23:case"end":return e.stop()}},e,void 0,[[3,20]])}));return function(t){return e.apply(this,arguments)}}(),t.sendMobileVideos=function(){var e=(0,M.default)(v.default.mark(function e(t){var r,n,a,o,i,s,u;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.media,U.info("sendMobileVideos send"+r.length),n=$getState(),e.prev=3,a=0;case 5:if(!(a<r.length)){e.next=18;break}return o=r[a].filepath,o=o.startsWith("file://")?o.substr(7,o.length):o,e.next=10,appService.getFileInfo(o);case 10:return i=e.sent,s={name:getFileName(o),path:o,size:i.size},u=S.createFileMessage(n,s.name),e.next=15,$(s,n,u);case 15:a++,e.next=5;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),U.error("sendMobileVideos",e.t0.toString());case 23:case"end":return e.stop()}},e,void 0,[[3,20]])}));return function(t){return e.apply(this,arguments)}}(),t.sendNormalFile=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$getState(),r=arguments[2];try{U.info("sendNormalFile");var n={file_size:e.size,file_name:e.name,message_id:r.id,message_server_chat_id_str:r.server_chat_id_str,recent_id:r.recent_id,recent_owner:r.recent_owner,file_real_save_path:e.path,time_stamp:F.localTimeService.getLocalTime(),file_type:e.file_type?e.file_type:null};return q(r,[n],t)}catch(e){U.error("sendNormalFile",e.toString())}}),B=t.sendImage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$getState(),r=arguments[2];try{return U.info("sendImage"),A.getImageInfo(e.path).then(function(n){var a={file_size:e.size,width:n.width,height:n.height,file_name:e.name,message_id:r.id,message_server_chat_id_str:r.server_chat_id_str,recent_id:r.recent_id,recent_owner:r.recent_owner,file_real_save_path:e.path,file_path:e.path,time_stamp:F.localTimeService.getLocalTime()};return q(r,[a],t)})}catch(e){U.error("sendImage",e.toString())}},Y=t.sendAudio=function(e,t,r){try{return U.info("sendAudio"),r||(r=S.createFileMessage(t,e.name)),A.getAudioInfo(e.path).then(function(n){var a={file_size:e.size,duration:n.duration,file_name:e.name,message_id:r.id,message_server_chat_id_str:r.server_chat_id_str,recent_id:r.recent_id,recent_owner:r.recent_owner,file_real_save_path:e.path,time_stamp:F.localTimeService.getLocalTime()};return q(r,[a],t)})}catch(e){U.error("sendAudio",e.toString())}},j=function(e){var t=document.createElement("video"),r=PromiseObject();return t.onloadeddata=function(){var n=document.createElement("canvas"),a=1;(t.videoWidth>constant.MESSAGE_VIDEO.MAX_WIDTH||t.videoHeight>constant.MESSAGE_VIDEO.MAX_HEIGHT)&&(a=t.videoWidth>t.videoHeight?constant.MESSAGE_VIDEO.MAX_WIDTH/t.videoWidth:constant.MESSAGE_VIDEO.MAX_HEIGHT/t.videoHeight),n.width=t.videoWidth*a,n.height=t.videoHeight*a,n.getContext("2d").drawImage(t,0,0,n.width,n.height);var o=n.toDataURL("image/png"),i=$getState().login.account,s=e.split(/\/|\\/).pop(),u=s.replace(/\.\w+$/,"")+".png",c=appService.getScreenShotPath(i)+u;appService.saveBase64Img(o,c).then(function(a){r.resolve({duration:Math.ceil(t.duration),videoPath:e,videoName:s,videoWidth:t.videoWidth,videoHeight:t.videoHeight,imgWidth:n.width,imgHeight:n.height,imgName:u,imgPath:c})})},t.onerror=function(){},t.src=e,r},$=t.sendMobileVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$getState(),r=arguments[2];try{return U.info("sendMobileVideo"),A.getVideoInfo(e.path).then(function(n){var a={file_size:e.size,width:n.width,height:n.height,file_name:e.name,message_id:r.id,message_server_chat_id_str:r.server_chat_id_str,recent_id:r.recent_id,recent_owner:r.recent_owner,file_real_save_path:e.path,file_path:e.path,time_stamp:F.localTimeService.getLocalTime()};return q(r,[a],t)})}catch(e){U.error("sendMobileVideo",e.toString())}},V=t.sendVideo=function(){var e=(0,M.default)(v.default.mark(function e(t,r,n){var a,o,i;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,U.info("sendVideo"),e.next=4,j(t.path);case 4:return a=e.sent,o=F.localTimeService.getLocalTime(),i=[{file_name:a.videoName,file_real_save_path:a.videoPath,width:a.videoWidth,height:a.videoHeight,duration:a.duration,message_id:n.id,message_server_chat_id_str:n.server_chat_id_str,recent_id:n.recent_id,recent_owner:n.recent_owner,time_stamp:o},{file_name:a.imgName,file_real_save_path:a.imgPath,width:a.imgWidth,height:a.imgHeight,message_id:n.id,message_server_chat_id_str:n.server_chat_id_str,recent_id:n.recent_id,recent_owner:n.recent_owner,time_stamp:o,isVideoImage:!0}],e.abrupt("return",q(n,i,r));case 10:e.prev=10,e.t0=e.catch(0),U.error("sendVideo",e.t0.toString());case 13:case"end":return e.stop()}},e,void 0,[[0,10]])}));return function(t,r,n){return e.apply(this,arguments)}}(),q=function(){var e=(0,M.default)(v.default.mark(function e(t,r,n){var a,o,i,s,u,c,l,d,f,g,h,m,M,y;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,U.info("sendUmFile"),a=n.recent,o=a.isLoadMore,i=a.currentRecentInfo,t.status=constant.MEDIA_STATUS.SENDING,s=[],u=!0,c=!1,l=void 0,e.prev=10,d=(0,_.default)(r);case 12:if(u=(f=d.next()).done){e.next=49;break}if(g=f.value,g.is_uploaded=constant.IS_UPLOADED.NO,g.file_deal_type=constant.FILE_DEAL_TYPE.UPLOAD,h={file_name:g.file_name,file_path:g.file_real_save_path},g.file_real_save_name=g.file_name,!A.isGroup(i.chat_type)||!D.getUmServerFlag()){e.next=27;break}return h.group_id=i.group.group_id,h.file_type=constant.UPLOAD_FILE_TYPE.GROUP,e.next=23,L.groupFilePreUpload(g,t);case 23:if(""!==(m=e.sent)){e.next=26;break}return e.abrupt("return",(0,C.dealFileSendFailed)(g,t));case 26:h.operation_token=m;case 27:return e.next=29,R.uploadFile(h);case 29:if(!1!==(M=e.sent)){e.next=33;break}return A.isBelongToCurrentRecent(t)&&(o&&T.initLoadMore(),t.file_list=[g],T.addNewMessage(t)),e.abrupt("return",(0,C.dealFileSendFailed)(g,t));case 33:if(g.file_handle=M.param.pfile_handle.toString(),D.setFileByHandle(g.file_handle,g),!g.isVideoImage&&t.media_type!==constant.MEDIA_TYPE.PHOTO){e.next=41;break}return e.next=38,coreDb.saveScreenShot((0,p.default)({},g));case 38:e.t0=e.sent,e.next=44;break;case 41:return e.next=43,coreDb.saveFile((0,p.default)({},g));case 43:e.t0=e.sent;case 44:y=e.t0,s.push(y);case 46:u=!0,e.next=12;break;case 49:e.next=55;break;case 51:e.prev=51,e.t1=e.catch(10),c=!0,l=e.t1;case 55:e.prev=55,e.prev=56,!u&&d.return&&d.return();case 58:if(e.prev=58,!c){e.next=61;break}throw l;case 61:return e.finish(58);case 62:return e.finish(55);case 63:return t.file_list=s,t.send_status=constant.SEND_STATUS.error,t.status=constant.MEDIA_STATUS.SEND_ERROR,e.next=68,coreDb.saveMessage(t);case 68:t=e.sent,delete t.send_status,t.status=constant.MEDIA_STATUS.SENDING,D.setSendingMessage(t.client_chat_id,t),(0,x.updateMessageToRecent)(t),A.isBelongToCurrentRecent(t)&&(o&&T.initLoadMore(),T.addNewMessage(t),s.forEach(function(e){T.updateProgressMap(e.file_handle,0)})),e.next=79;break;case 76:e.prev=76,e.t2=e.catch(0),U.error("sendUmFile",e.t2.toString());case 79:case"end":return e.stop()}},e,void 0,[[0,76],[10,51,55,63],[56,,58,62]])}));return function(t,r,n){return e.apply(this,arguments)}}()},1165:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.reSendFile=void 0;var o=r(1),i=a(o),s=r(103),u=a(s),c=r(112),l=a(c),d=r(2),f=a(d),p=r(159),g=n(p),_=r(417),h=n(_),v=r(135),m=n(v),M=r(213),y=(n(M),r(874)),E=n(y),w=r(513),S=r(187),I=r(156),T=n(I),b=window.Logger("logic")("IM/fileReSend");t.reSendFile=function(){var e=(0,f.default)(i.default.mark(function e(t){var r,n,a,o,s,c,d,f,p,_,v,M,y;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,b.info("reSendFile 重新发送文件"),r=$getState(),n=r.recent,a=n.currentRecentInfo,o=[],s=!0,c=!1,d=void 0,e.prev=8,f=(0,l.default)(t.file_list);case 10:if(s=(p=f.next()).done){e.next=47;break}if(_=p.value,v={file_name:_.file_name,file_path:_.file_real_save_path},!m.isGroup(a.chat_type)||!g.getUmServerFlag()){e.next=22;break}return v.group_id=a.group.group_id,v.file_type=constant.UPLOAD_FILE_TYPE.GROUP,e.next=18,E.groupFilePreUpload(_,t);case 18:if(""!==(M=e.sent)){e.next=21;break}return e.abrupt("return",(0,w.dealFileSendFailed)(_,t));case 21:v.operation_token=M;case 22:return _.is_uploaded=constant.IS_UPLOADED.NO,_.file_deal_type=constant.FILE_DEAL_TYPE.UPLOAD,e.next=26,h.uploadFile(v);case 26:if(!1!==(y=e.sent)){e.next=30;break}return(0,w.dealFileSendFailed)(_,t),e.abrupt("return");case 30:if(_.file_real_save_name=_.file_name,_.file_handle=y.param.pfile_handle.toString(),g.setFileByHandle(_.file_handle,_),!_.isVideoImage&&t.media_type!==constant.MEDIA_TYPE.PHOTO){e.next=39;break}return e.next=36,coreDb.saveScreenShot((0,u.default)({},_));case 36:e.t0=e.sent,e.next=42;break;case 39:return e.next=41,coreDb.saveFile((0,u.default)({},_));case 41:e.t0=e.sent;case 42:_=e.t0,o.push(_);case 44:s=!0,e.next=10;break;case 47:e.next=53;break;case 49:e.prev=49,e.t1=e.catch(8),c=!0,d=e.t1;case 53:e.prev=53,e.prev=54,!s&&f.return&&f.return();case 56:if(e.prev=56,!c){e.next=59;break}throw d;case 59:return e.finish(56);case 60:return e.finish(53);case 61:return t.file_list=o,t.status=constant.MEDIA_STATUS.SEND_ERROR,t.send_status=constant.SEND_STATUS.error,e.next=66,coreDb.saveMessage(t);case 66:t=e.sent,t.send_status=constant.SEND_STATUS.resend,t.status=constant.MEDIA_STATUS.SENDING,g.setSendingMessage(t.client_chat_id,t),(0,S.updateMessageToRecent)(t),m.isBelongToCurrentRecent(t)&&(T.updateMessageList(t),T.updateProgressMap(file.file_handle,0)),e.next=77;break;case 74:e.prev=74,e.t2=e.catch(0),b.error("reSendFile",e.t2.toString());case 77:case"end":return e.stop()}},e,void 0,[[0,74],[8,49,53,61],[54,,56,60]])}));return function(t){return e.apply(this,arguments)}}()},1166:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.cancelSendFile=void 0;var o=r(1),i=a(o),s=r(2),u=a(s),c=r(159),l=n(c),d=r(417),f=n(d),p=r(187),g=window.Logger("logic")("IM/fileSend");t.cancelSendFile=function(){var e=(0,u.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,g.info("cancelSendFile 取消发送文件"),r=t.file_list[0],t.status=constant.MEDIA_STATUS.CANCEL_SEND,t.send_status=constant.SEND_STATUS.error,r.file_deal_type!==constant.FILE_DEAL_TYPE.UPLOAD){e.next=8;break}return e.next=8,f.releaseFile({file_handle:parseInt(r.file_handle)});case 8:return $dispatch(coreUi.deleteProgressMap(r.file_handle)),l.deleteSendingMessage(r.message_server_chat_id_str),l.deleteFileByHandleList([r.file_handle,t.client_chat_id]),delete r.file_handle,e.next=14,coreDb.saveFile(r);case 14:r=e.sent,t.file_list[0]=r,(0,p.updateMessageToRecent)(t),$dispatch(coreUi.updateMessageList(t)),coreDb.saveMessage(t),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(0),g.error("cancelSendFile",e.t0.toString());case 24:case"end":return e.stop()}},e,void 0,[[0,21]])}));return function(t){return e.apply(this,arguments)}}()},1167:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openFolder=t.openFile=void 0;var n=r(994),a=window.Logger("logic")("IM/fileOpen");t.openFile=function(e,t){try{a.info("userClick openFile  open file");var r=t?e.quote:e,o=r.file_list,i=r.server_chat_id_str,s=o[0],u=s.file_real_save_path;s.is_downloaded===constant.IS_DOWNLOADED.NO?($dispatch(coreUi.updateOpenFileMessageMap(i,u)),(0,n.receiveFile)(e,t)):appService.openFileOrFolder(u)}catch(e){a.error("openFile",e.toString())}},t.openFolder=function(e,t){try{a.info("userCLick openFolder  open file dir");var r=t?e.quote:e,n=r.file_list,o=n[0].file_real_save_path;appService.openFolder(o)}catch(e){a.error("openFolder",e.toString())}}},1168:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chooseUploadFile=void 0;var n=r(3),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=r(1164),i=r(135),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(i),u=window.Logger("logic")("IM/file/upload");t.chooseUploadFile=function(){u.info("uploadFile 选择附件上传");var e={},t=$getState();e.properties=["openFile","multiSelections"];try{$dispatch(coreUi.setShowOpenDialog(!0)),window.electron.remote.dialog.showOpenDialog(win,e,function(e){if($dispatch(coreUi.setShowOpenDialog(!1)),coreUi.clickToolbar("",!1),!isNullOrEmpty(e)){for(var r=[],n=0;n<e.length;n++)!function(t){var n=e[t],o=PromiseObject(),i=void 0,u=void 0;appService.getFileInfo(n).then(function(e){return u=e.size,s.getMediaType(n)===constant.MEDIA_TYPE.PHOTO?s.getImageInfo(n):a.default.resolve(!1)}).then(function(e){i={path:n,name:getFileName(n),size:u,type:"file"},!1!==e&&(i.type="image",i.width=e.width,i.height=e.height),o.resolve(i)}),r.push(o)}(n);a.default.all(r).then(function(e){return(0,o.sendFiles)(e,t)})}})}catch(e){u.error("uploadFile",e.toString())}}},1169:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.downloadPhotoError=t.downloadPhotoSuccess=t.downloadPhoto=void 0;var a=r(3),o=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(159),s=n(i),u=r(417),c=n(u),l=r(486),d=n(l),f=window.Logger("logic")("IM/downloadPhoto");f.debug("downloadPhoto");t.downloadPhoto=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(isNullOrEmpty(e))return void f.error("downloadPhoto 文件信息不存在",t.client_chat_id);var n=e.file_real_save_path,a=e.file_path,i=r?n:a,u=s.getUnDownloadedPhoto(i);isNullOrEmpty(u)||f.error("该图片已在下载列表中,path:",i);var l={access_code:e.um_plain_access_code,url:e.um_url,path:i,isThumbnail:r};c.downloadFile(l).then(function(n){return!1===n?(d.dealDownloadScreenShotFailed(e,t),o.default.resolve()):(f.debug("downloadPhoto downloadFile 下载成功 "),t.status=constant.MEDIA_STATUS.RECEIVING,e.file_handle=n.param.pcfile_handle.toString(),e.isThumbnail=r,s.setReceivingMessage(e.um_url,t),s.setFileByHandle(e.file_handle,e),o.default.resolve())}).catch(function(t){s.deleteUnDownloadedPhoto(i,e),f.error("downloadPhotos",t.toString())})},t.downloadPhotoSuccess=function(e){if(isNullOrEmpty(e))return void f.error("onPhotoDownloadSuccess 文件信息不存在");var t=e.file_real_save_path,r=e.file_path,n=e.isThumbnail?t:r;s.deleteUnDownloadedPhoto(n,e)},t.downloadPhotoError=function(e){if(isNullOrEmpty(e))return void f.error("onPhotoDownloadError 文件信息不存在");var t=e.file_real_save_path,r=e.file_path,n=e.isThumbnail?t:r;s.deleteUnDownloadedPhoto(n,e)}},1170:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageShowHtml=t.getMessageShowText=t.dealRecentLastMessageList=t.dealHistoryMessageList=t.dealReceiveMessage=void 0;var a=r(1171),o=n(a),i=r(1172),s=n(i),u=r(1173),c=n(u),l=r(805),d=n(l);t.dealReceiveMessage=o.dealReceiveMessage,t.dealHistoryMessageList=s.dealHistoryMessageList,t.dealRecentLastMessageList=c.dealRecentLastMessageList,t.getMessageShowText=d.getMessageShowText,t.getMessageShowHtml=d.getMessageShowHtml},1171:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.dealReceiveMessage=void 0;var a=r(1),o=n(a),i=r(2),s=n(i),u=r(187),c=r(805),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(c),d=window.Logger("logic")("IM/message/receive"),f=(t.dealReceiveMessage=function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d.info("dealReceiveMessage"),e.next=4,coreContact.getContactByAccount(t.origin);case 4:if(r=e.sent,!isNullOrEmpty(r)){e.next=8;break}return d.error("[dealReceiveMessage] Message contact was not exist, and stop continuing analysis. Message chat id was ",t.server_chat_id_str),e.abrupt("return",null);case 8:return e.next=10,(0,u.createOrGetRecentByMessage)(t,r,a);case 10:return n=e.sent,d.info("[dealReceiveMessage] Deal the message contact."),t.sub_msg_type===constant.MSGSUBFLAG.ANNOUNCEMENT&&coreGroup.dealFixedGroupAnnouncementChange(t),e.next=15,f(t,n,r);case 15:if(t=e.sent,!isNullOrEmpty(t.media_type)){e.next=19;break}return d.error("[dealReceiveMessage] Message type was not exist, and stop continuing analysis. Message chat id was ",t.server_chat_id_str),e.abrupt("return",null);case 19:if(!isNullOrEmpty(t.show_text)){e.next=22;break}return d.error("[dealReceiveMessage] Failed to analysis the message contact. The message was invalid. Message chat id was ",t.server_chat_id_str),e.abrupt("return",null);case 22:return n=(0,u.dealRecentLastMessageInfo)(n,t),e.next=25,coreDb.saveRecent(n);case 25:return n=e.sent,e.abrupt("return",{message:t,recent:n});case 29:return e.prev=29,e.t0=e.catch(0),d.error("dealReceiveMessage",e.t0.toString()),e.abrupt("return",null);case 33:case"end":return e.stop()}},e,void 0,[[0,29]])}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,s.default)(o.default.mark(function e(t,r,n){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d.debug("[dealMessage] Deal message contact"),e.next=4,l.dealPcMessageInfo(t,r,n);case 4:if(t=e.sent,!isNullOrEmpty(t)){e.next=8;break}return d.error("[dealMessage] Deal message failed, The message is null or empty"),e.abrupt("return",t);case 8:return l.saveMessageListInfo([t]),e.abrupt("return",t);case 12:return e.prev=12,e.t0=e.catch(0),d.error("[dealMessage] Deal message failed.",e.t0.toString()),e.abrupt("return",t);case 16:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t,r,n){return e.apply(this,arguments)}}())},1172:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.dealHistoryMessageList=void 0;var a=r(1),o=n(a),i=r(2),s=n(i),u=r(805),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(u),l=window.Logger("logic")("IM/message/receive");t.dealHistoryMessageList=function(){var e=(0,s.default)(o.default.mark(function e(t,r){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l.info("dealHistoryMessageList start dealing messageList"),e.next=4,c.dealPcMessageList(t,r);case 4:return n=e.sent,e.next=7,c.saveMessageListInfo(n);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),l.error("dealHistoryMessageList 处理失败",e.t0.toString());case 12:case"end":return e.stop()}},e,void 0,[[0,9]])}));return function(t,r){return e.apply(this,arguments)}}()},1173:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.dealRecentLastMessageList=void 0;var a=r(1),o=n(a),i=r(3),s=n(i),u=r(103),c=n(u),l=r(2),d=n(l),f=r(805),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(f),g=window.Logger("logic")("IM/message/receive");t.dealRecentLastMessageList=function(){var e=(0,d.default)(o.default.mark(function e(t){var r,n,a,i,u,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,g.info("dealRecentLastMessageList 处理最后一条消息特有逻辑"),e.next=4,p.dealPcRecentListLastMessageInfo(t,l);case 4:for(r=e.sent,n=r.messageList,a=r.recentList,i=0;i<n.length;i++)u=(0,c.default)({},n[i]),a[i].last_message=(0,c.default)({},u),a[i].time_stamp=u.utc_stamp;return a=l.update(["owner"],a),e.next=11,s.default.all([coreDb.bulkPutRecent(a),coreDb.bulkPutMessage(n)]);case 11:return g.debug("dealRecentLastMessageList"),e.abrupt("return",a);case 15:return e.prev=15,e.t0=e.catch(0),g.error("dealRecentLastMessageList 处理失败",e.t0.toString()),e.abrupt("return",l);case 19:case"end":return e.stop()}},e,void 0,[[0,15]])}));return function(t){return e.apply(this,arguments)}}()},1174:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.reSendMessage=void 0;var a=r(1),o=n(a),i=r(103),s=n(i),u=r(2),c=n(u),l=r(213),d=window.Logger("logic")("IM/messageReSend");t.reSendMessage=function(){var e=(0,c.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d.info("reSendMessage"),t.send_status=constant.SEND_STATUS.resend,e.next=5,coreDb.saveMessage(t);case 5:$dispatch(coreUi.updateMessageList(t)),(0,l.sendImMessage)((0,s.default)({},t)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),d.error("sendNormalMessage",e.t0.toString());case 12:case"end":return e.stop()}},e,void 0,[[0,9]])}));return function(t){return e.apply(this,arguments)}}()},1175:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.relayMessage=void 0;var a=r(103),o=n(a),i=r(106),s=n(i),u=r(213),c=r(135),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(c),d=r(572),f=window.Logger("logic")("IM/messageRelay"),p=(t.relayMessage=function(e){try{f.info("relayMessage 转发消息");var t=p(e);if(isNullOrEmpty(t.file_list))return(0,u.sendImMessage)((0,o.default)({},t));l.hasScreenShot(t.media_type)?coreDb.bulkPutScreenShot([].concat((0,s.default)(t.file_list))).then(function(){return(0,u.sendImMessage)((0,o.default)({},t))}):coreDb.bulkPutFile([].concat((0,s.default)(t.file_list))).then(function(){return(0,u.sendImMessage)((0,o.default)({},t))})}catch(e){f.error("relayMessage",e.toString())}},function(e){try{f.info("dealRelayParams");var t=$getState(),r=t.myInfo,n=e.message,a=e.recent;return l.isGroup(a.chat_type)?n.group_id=a.owner:n.target=a.owner,n.name=r.name,n.native_name=r.native_name,n.display_name=getContactName(r),n.origin=r.account,n.chat_type=a.chat_type,n.recent_id=a.id,n.recent_owner=a.owner,n.client_chat_id=getClientId(),n.time_stamp=d.localTimeService.getLocalTime(),n.server_chat_id_str=n.client_chat_id.toString(),n.at_user_list=[],isNullOrEmpty(n.file_list)||n.file_list.map(function(e){return e.recent_id=n.recent_id,e.recent_owner=n.recent_owner,e.message_server_chat_id_str=n.server_chat_id_str,delete e.id,e}),delete n.id,n}catch(e){return f.error("dealRelayParams",e.toString()),{}}})},1176:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.teamNotifyReadMessage=t.deleteMessage=void 0;var a=r(1),o=n(a),i=r(2),s=n(i),u=r(135),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(u),l=r(187),d=window.Logger("logic")("IM/messageDelete");t.deleteMessage=function(){var e=(0,s.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{d.info("deleteMessage"),window.confirm(language.CONFIRM_TO_DELETE_MESSAGE).then(function(){var e=(0,s.default)(o.default.mark(function e(r){var n,a,i,s,u,d,f,p,g,_,h,v,m;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.ret){e.next=2;break}return e.abrupt("return");case 2:return n=t.chat_type,a=t.server_chat_id_str,i=t.group_id,s=t.target,u=$getState().recent,d=u.currentRecentInfo,f=u.messageList,p={msg_type:constant.IM_MSG_TYPE.SINGLE,opt_type:0,msgid_list:[a],sender:s},g=c.isGroup(n),g&&(p.msg_type=constant.IM_MSG_TYPE.GROUP,p.sender=i),e.next=9,new coreTup.HWTupIM;case 9:return _=e.sent,e.next=12,_.deleteHistoryMessage(p);case 12:if(!(h=e.sent)||h.result!==constant.ERROR_CODE.Success){e.next=18;break}return t.is_delete=constant.IS_DELETE.YES,d.last_message_server_chat_id_str===t.server_chat_id_str&&(v=f[f.length-2],m=(0,l.dealRecentLastMessageInfo)(d,v),coreDb.saveRecent(m),(0,l.refreshRecentList)(m)),coreDb.saveMessage(t),e.abrupt("return",$dispatch(coreUi.deleteSelectMessage(t)));case 18:window.Toast(language.DELETE_MESSAGE_ERROR);case 19:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}())}catch(e){d.error("deleteMessage",e.toString())}case 1:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.teamNotifyReadMessage=function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d.info("teamNotifyReadMessage"),t.team_notify_is_read=constant.IS_READ.YES,e.next=5,coreDb.saveMessage(t);case 5:return r=$getState().recent,n=r.currentRecentInfo,a=r.messageList,a.map(function(e,n){e.server_chat_id_str===t.server_chat_id_str&&(r.messageList[n]=t)}),r.currentRecentInfo.group.team_notify_is_read=constant.IS_READ.YES,e.next=11,coreGroup.saveGroupInfo(r.currentRecentInfo.group);case 11:return e.next=13,coreDb.saveUserConfig({key:""+r.currentRecentInfo.group.group_id,value:""+constant.IS_READ.YES});case 13:return e.next=15,coreDb.saveRecent(r);case 15:return e.next=17,$dispatch(coreUi.updateRecent(r));case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),d.error("teamNotifyReadMessage",e.t0.toString());case 22:case"end":return e.stop()}},e,void 0,[[0,19]])}));return function(t){return e.apply(this,arguments)}}()},1177:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.goToConversationMessage=t.goToMessage=void 0;var o=r(1),i=a(o),s=r(2),u=a(s),c=r(156),l=n(c),d=r(187),f=n(d),p=r(485),g=n(p),_=r(871),h=r(867),v=r(986),m=window.Logger("logic")("IM/message/positionFix"),M=t.goToMessage=function(){var e=(0,u.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,m.info("goToMessage 搜索结果跳转"),f.onTabClick("conversation"),e.next=5,coreUi.clickToolbar("",!1);case 5:return l.setLoadMore(),l.setHistoryMessageLoading(),g.setUnreadNewMessageNum(0),(0,h.messageSearchClose)(),f.changeHintsShow(!0),e.next=12,coreDb.limitMessageList({recent_owner:t.recent_owner,utc_stamp:t.utc_stamp},!1);case 12:r=e.sent,r.unshift(t),(0,v.modifyMessageListStatus)(r),l.loadHistoryMessage(r),l.setHistoryMessageNotLoading(),l.haveMoreLocalMessage(),l.haveMoreServerMessage(),l.setBackwardLoadMessage(),(0,_.updateMessageQueryInfo)(),delegate.setScrollIntoViewRef(t,function(){delegate.showMessage(!0)}),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),m.error("goToMessage 搜索结果跳转",e.t0.toString());case 27:case"end":return e.stop()}},e,void 0,[[0,24]])}));return function(t){return e.apply(this,arguments)}}();t.goToConversationMessage=function(){var e=(0,u.default)(i.default.mark(function e(t){var r,n,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,m.info("goToConversationMessage 打开搜索到的消息所在的会话"),e.next=4,f.getLocalRecent({owner:t.recent_owner});case 4:if(r=e.sent,n=$getState().recent.currentRecentInfo,r.owner===n.owner){e.next=20;break}return e.next=9,f.initNewConversationUI(r);case 9:return r=e.sent,coreUi.showRecentIntoView(r.owner),e.next=13,coreCommon.setMessageNotifyRead(r);case 13:return f.setMessageNotifyClose(r.owner),e.next=16,f.getImExtendInfo(r);case 16:a=e.sent,coreUi.freshImExtMemberList(a),e.next=21;break;case 20:m.info("goToConversationMessage","点击相同recent，不重复打开");case 21:return e.next=23,M(t);case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(0),m.error("goToConversationMessage 搜索结果跳转",e.t0.toString());case 28:case"end":return e.stop()}},e,void 0,[[0,25]])}));return function(t){return e.apply(this,arguments)}}()},1178:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(y.info("dealWithdrawMessageInfo"),m.isGroup(t.chat_type)){var r=$getState().recent.atMessageList,n=[],a=0;r.map(function(t){t.server_chat_id_str!==e.server_chat_id_str&&n.push(t)}),n.map(function(e){e.recent_owner===t.owner&&a++}),$dispatch(coreUi.setAtMessageList(n)),a||(t.is_at=!1),e.at_user_list=null}e.media_type=constant.MEDIA_TYPE.WITHDRAW_NOTIFY,e.content="",e.show_html="",e.is_read=constant.IS_READ.YES,(0,d.updateMessageList)(e),coreDb.saveMessage(e),t=(0,f.dealRecentLastMessageInfo)(t,e),coreDb.saveRecent(t),(0,f.refreshRecentList)(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.dealWithdrawMessageNotify=t.dealWithdrawMessageAck=t.withdrawMessage=void 0;var i=r(1),s=a(i),u=r(2),c=a(u),l=r(213),d=r(156),f=r(187),p=r(159),g=n(p),_=r(187),h=n(_),v=r(135),m=n(v),M=r(485),y=window.Logger("logic")("IM/withdraw");t.withdrawMessage=function(e){var t=e.origin,r=e.target,n=e.server_chat_id_str,a=e.group_name,o=e.chat_type,i=e.group_id,s=$getState().recent.currentRecentInfo,u=s.last_message_server_chat_id_str,c=m.isGroup(o);c&&isNullOrEmpty(a)&&s.group&&(y.info("withdrawMessage message's group_name is empty now,, use recent's group_name"),a=s.group.name);var d={origin:t,origin_name:getContactNameByMessage(e),group_name:a,target:c?i:r,msg_type:c?constant.IM_MSG_TYPE.GROUP:constant.IM_MSG_TYPE.SINGLE,is_lastmsg:n===u?constant.IS_LASTMSG.YES:constant.IS_LASTMSG.NO,message_list:[{str_msgid:n}]};(0,l.withdrawIm)(d)},t.dealWithdrawMessageAck=function(e){var t=e.param,r=t.result,n=t.msg_list,a="";if(r===constant.ERROR_WITHDRAW_CODE.SUCCESS){y.info("dealWithdrawMessageAck 消息撤回成功");var i=n[0].str_msgid,s=$getState().recent,u=s.messageList,c=s.currentRecentInfo,l=u.query({server_chat_id_str:i});return g.setMessageWithdrawServerId(i,{server_chat_id_str:i}),l.show_text=language.WITHDRAW_MY_NOTIFY,void o(l,c)}a=r===constant.ERROR_WITHDRAW_CODE.OPRMSG_TIMEOUT?language.WITHDRAW_OPRMSG_TIMEOUT:language.WITHDRAW_ERROR,window.CLIENTCONFIG.ISMOBILE?window.Toast(a,2,!1):window.Toast(a,2,!1,"WhiteWarning")},t.dealWithdrawMessageNotify=function(){var e=(0,c.default)(s.default.mark(function e(t){var r,n,a,i,u,c,l,d,f,p,_,v,m,E,w,S,I;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.param,n=r.msg_list,a=r.origin,i=r.target,u=r.msgtype,c=$getState().myInfo.account,l=n[0].str_msgid,d=$getState(),f=d.recent,p=f.messageList,_=f.currentRecentInfo,v=d.IM.unReadNewMessageNum,m=c!==a,E=u===constant.IM_MSG_TYPE.SINGLE&&m?a:i,e.next=9,h.getLocalRecent({owner:E});case 9:if(w=e.sent,S=void 0,y.info("dealWithdrawMessageNotify 消息撤回通知",l),g.setMessageWithdrawServerId("server_chat_id_str",{server_chat_id_str:l}),isNullOrEmpty(w)){e.next=38;break}if(_.owner!==w.owner){e.next=24;break}if(y.info("dealWithdrawMessageNotify 在当前会话"),S=p.query({server_chat_id_str:l})){e.next=22;break}return e.next=20,coreDb.queryMessage({server_chat_id_str:l});case 20:S=e.sent,(0,M.setUnreadNewMessageNum)(v<=0?v:v-1);case 22:e.next=28;break;case 24:return y.info("dealWithdrawMessageNotify 不在当前会话"),e.next=27,coreDb.queryMessage({server_chat_id_str:l});case 27:S=e.sent;case 28:if(!isNullOrEmpty(S)){e.next=31;break}return y.error("dealWithdrawMessageNotify 没有查到消息"),e.abrupt("return");case 31:return e.next=33,coreCommon.setWithdrawNotifyRead(l,w);case 33:w=e.sent,I=getContactNameByMessage(S),S.show_text=language.WITHDRAW_MY_NOTIFY,m&&(S.show_text=language.WITHDRAW_NOTIFY.format(I)),o(S,w);case 38:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()},1179:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){R.info("dealMobileNotify");var t=($getState().recent.currentRecentInfo,window.getRoute()),r=window.isAppInBackground;try{var n=0,a=e.unread_num,o=e.owner,i=$getState().IM.androidNotifyNewMessageNum,s="",u="";e.group&&(u=e.group.name),e.contact&&(u=e.contact.name),"android"===window.CLIENTCONFIG.PLATFORM?"conversation"===t&&!r||"main/recent"===t&&!r?("conversation"===t&&!r||"main/recent"===t&&!r)&&window.webView.cancelNotification(o):(n=!isNullOrEmpty(e.chat_type)&&b.isGroup(e.chat_type)?1:2,!isNullOrEmpty(a)&&a>1?(s=language.NOTIFICATION_BAR_UNREAD.format(a),e.is_at&&(s+=language.SOMEONE_AT_ME)):!isNullOrEmpty(i)&&i>1&&(s=language.NOTIFICATION_BAR_UNREAD.format(i),e.is_at&&(s+=language.SOMEONE_AT_ME)),isNullOrEmpty(e.last_message)||isNullOrEmpty(e.last_message.show_text)||(s=e.last_message.media_type===constant.MEDIA_TYPE.LIKE?""+s+language.EDITOR_TOOLS_TITLE_LIKE:s+(e.is_at?language.SOMEONE_AT_ME:"")+e.last_message.show_text.substring(0,50)),appService.showNotification(n,o,u,s)):(n=1,isNullOrEmpty(e.last_message)||isNullOrEmpty(e.last_message.show_text)||(e.last_message.media_type===constant.MEDIA_TYPE.LIKE?s=""+s+language.EDITOR_TOOLS_TITLE_LIKE:(s+=e.last_message.show_text.substring(0,50),e.is_at&&(s=language.SOMEONE_AT_ME+s)),appService.showNotification(n,o,u,s)))}catch(e){R.error("window.webView.showNotification",e.toString())}}function i(e){var t=$getState(),r=t.recent,n=t.IM,a=r.currentRecentInfo,o=r.messageList,i=n.unReadNewMessageNum;e.recent_owner===a.owner&&(R.info("dealMessageToRecent 新消息属于当前会话"),e.media_type===constant.MEDIA_TYPE.TEXT||e.media_type===constant.MEDIA_TYPE.PHOTO_TEXT||e.media_type===constant.MEDIA_TYPE.PHOTO||e.media_type===constant.MEDIA_TYPE.SCREEN_SHOT?(0!==i&&S.clearNewMessageFromMessageList(),-1===o.findIndex(function(t){return t.client_chat_id===e.client_chat_id})?(R.info("dealMessageToRecent 添加新消息"),E.addNewMessage(e)):(R.info("dealMessageToRecent 更新消息列表"),E.updateMessageListByClientId(e))):-1===o.findIndex(function(t){return t.client_chat_id===e.client_chat_id})?E.addNewMessage(e):(R.info("dealMessageToRecent 更新消息列表"),E.updateMessageListByClientId(e)))}Object.defineProperty(t,"__esModule",{value:!0}),t.sendJoinFixedGroupNotiyMessage=t.clickTrayUnReadFlash=t.removeUnReadMessageFlash=t.dealGroupNotify=t.dealMsgRead=t.dealChatList=t.dealCodeChat=t.dealUnDealMessageList=t.dealSendMessageAck=void 0;var s=r(1),u=a(s),c=r(2),l=a(c),d=function(){var e=(0,l.default)(u.default.mark(function e(t){var r,n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.CLIENTCONFIG.ISMOBILE){e.next=2;break}return e.abrupt("return");case 2:r=void 0,n=void 0,a=A.findIndex(function(e){return e.owner===t.owner}),a>-1?(n=A.splice(a,1)[0],A.push(n)):(n={owner:t.owner,recent:t},A.push(n)),r=(b.isGroup(n.recent.chat_type),r?window.remote.nativeImage.createFromDataURL(r):void 0),r&&(n.image=r.resize({width:16,height:16})),window.flashTray(n.image,C);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),f=r(187),p=n(f),g=r(159),_=n(g),h=r(981),v=n(h),m=r(574),M=n(m),y=r(156),E=n(y),w=r(485),S=n(w),I=r(868),T=(n(I),r(135)),b=n(T),L=r(573),O=r(1180),R=window.Logger("logic")("IM/imNotify"),N=(t.dealSendMessageAck=function(){var e=(0,l.default)(u.default.mark(function e(t){var r,n,a,o,s;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,R.info("dealSendMessageAck 消息发送成功"),r=t.param,n=r.chat_id,a=r.server_chat_id_str,o=r.utc_stamp,s=_.getSendingMessage(n),_.deleteSendingMessage(n),!isNullOrEmpty(s)){e.next=9;break}return R.error("dealSendMessageAck message is null or empty"),e.abrupt("return");case 9:return s.utc_stamp=o,s.send_status=constant.SEND_STATUS.success,e.next=13,x(s,a);case 13:s=e.sent,i(s),(0,f.updateMessageToRecent)(s),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),R.error("dealSendMessageAck",e.t0.toString());case 21:case"end":return e.stop()}},e,void 0,[[0,18]])}));return function(t){return e.apply(this,arguments)}}(),t.dealUnDealMessageList=function(){try{R.info("dealUnDealMessageList 处理待处理列表"),_.setRecentListReady(!0);var e=_.getUnDealMessageList(),t=$getState().recent.currentRecentInfo;if(isNullOrEmpty(t)||p.openRecentConversation(t),isNullOrEmpty(e))return void R.info("dealUnDealMessageList 无待处理列表");_.setReceiveMessageQueueList(e),_.getIsReceiveMessageQueueDealing()||N()}catch(e){R.error("dealUnDealMessageList",e.toString())}},t.dealCodeChat=function(e){try{_.getRecentListReady()?(R.info("dealCodeChat 直接处理，不放入待处理列表"),_.setReceiveMessageQueue([e.param]),R.info("dealCodeChat",_.getIsReceiveMessageQueueDealing()),_.getIsReceiveMessageQueueDealing()||N()):(R.info("dealCodeChat 放入待处理列表"),_.setUnDealMessage([e.param]))}catch(e){R.error("dealCodeChat",e.toString())}},t.dealChatList=function(e){try{var t=$getState();R.info("dealChatList 处理未读消息数");var r=t.recent,n=r.isLoadMore,a=r.currentRecentInfo;n&&E.initLoadMore();var o=e.param.chat_list,i=e.param.total;if(o&&o.length){var s=b.getRecentOwnerByMessage(o[0]);a.owner!==s&&(p.updateUnReadNumMap(s,i),1===e.param.is_at&&p.updateAtMap(s,!0)),_.getRecentListReady()?(R.info("dealChatList 直接处理，不放入待处理列表"),_.setReceiveMessageQueue([o[0],i]),R.info("dealChatList",_.getIsReceiveMessageQueueDealing()),_.getIsReceiveMessageQueueDealing()||N()):(R.info("dealChatList 放入待处理列表"),_.setUnDealMessage([o[0],i]))}}catch(e){R.error("dealChatList",e.toString())}},t.dealMsgRead=function(){var e=(0,l.default)(u.default.mark(function e(t){var r,n,a,o,i;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,R.info("dealMsgRead 聊天消息已读通知"),r=t.param,n=r.from,a=r.msg_type,o=r.target,i=void 0,e.next=7,(0,f.getLocalRecent)({owner:n});case 7:return i=e.sent,e.next=10,coreCommon.setMessageNotifyRead(i,{noTup:!0});case 10:i=e.sent,(0,f.refreshRecentList)(i),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),R.error("dealMsgRead",e.t0.toString());case 17:case"end":return e.stop()}},e,void 0,[[0,14]])}));return function(t){return e.apply(this,arguments)}}(),t.dealGroupNotify=function(){var e=(0,l.default)(u.default.mark(function e(t,r,n){var a,o,s,c,l;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=$getState().recent.currentRecentInfo,e.next=4,p.getLocalRecent({owner:t});case 4:return o=e.sent,e.next=7,coreCommon.getGroupNotifyMemberList(r,n);case 7:if(s=e.sent,c=void 0,isNullOrEmpty(o)){e.next=24;break}if(c=M.createGroupMemberChgMessage(o.group,s,n),a.owner===o.owner?(R.info("dealGroupNotify 在当前会话"),E.addNewMessage(c)):R.info("dealGroupNotify 不在当前会话"),c.media_type!==constant.MEDIA_TYPE.APPLY_JOIN_FIXED_GROUP_NOTIFY){e.next=15;break}return e.next=15,coreCommon.addUnReadApplyGroupNotifyNum(c);case 15:o.unread_group_notify_num=v.getUnReadApplyGroupNotifyNumMap()[c.group_id]||0,coreDb.saveMessage(c),o=(0,f.dealRecentLastMessageInfo)(o,c),R.info("dealGroupNotify 更新recent"),coreDb.saveRecent(o),i(c),(0,f.refreshRecentList)(o),e.next=38;break;case 24:return e.next=26,coreGroup.getGroupById(t);case 26:return l=e.sent,c=M.createGroupMemberChgMessage(l,s,n),e.next=30,p.createOrGetRecentByMessage(c);case 30:if(o=e.sent,c.media_type!==constant.MEDIA_TYPE.APPLY_JOIN_FIXED_GROUP_NOTIFY){e.next=34;break}return e.next=34,coreCommon.addUnReadApplyGroupNotifyNum(c);case 34:o.unread_group_notify_num=v.getUnReadApplyGroupNotifyNumMap()[c.group_id]||0,coreDb.saveRecent(o),(0,f.refreshRecentList)(o),coreDb.saveMessage(c);case 38:e.next=43;break;case 40:e.prev=40,e.t0=e.catch(0),R.error("dealGroupNotify",e.t0.toString());case 43:case"end":return e.stop()}},e,void 0,[[0,40]])}));return function(t,r,n){return e.apply(this,arguments)}}(),function(){var e=(0,l.default)(u.default.mark(function e(){var t,r,n,a,i,s,c,l,p;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,R.info("dealReceiveMessageQueue"),_.setIsReceiveMessageQueueDealing(!0),t=_.getFirstReceiveMessageQueue(),r=$getState().myInfo.account;case 5:if(!t){e.next=36;break}n=1;case 7:if(!(n<31&&window.isOffline)){e.next=18;break}return R.info("dealReceiveMessageQueue 接收消息队列处理 离线，等待"+n+"s继续处理"),e.next=11,sleep(1e3);case 11:if(n++,r===$getState().myInfo.account){e.next=16;break}return R.info("dealReceiveMessageQueue 不是当前登录用户的消息"),_.setIsReceiveMessageQueueDealing(!1),e.abrupt("return");case 16:e.next=7;break;case 18:if(!window.isOffline){e.next=22;break}return _.setIsReceiveMessageQueueDealing(!1),R.info("dealReceiveMessageQueue 接收消息队列处理 离线，不再继续处理消息"),e.abrupt("return");case 22:if(2!==t.length){e.next=28;break}return e.next=25,M.dealReceiveMessage(t[0],t[1]);case 25:e.t0=e.sent,e.next=31;break;case 28:return e.next=30,M.dealReceiveMessage(t[0]);case 30:e.t0=e.sent;case 31:a=e.t0,a&&(i=$getState(),s=i.recent.currentRecentInfo,c=a.recent,l=a.message,R.info("dealReceiveMessageQueue 返回值类型 recent:"+Object.type(c)+" message:"+Object.type(l)),coreConf.setUnreadNumber({account:c&&c.contact?c.contact.account:"",group_id:c&&c.group?c.group.group_id:""},1),window.CLIENTCONFIG.ISMOBILE||coreCommon.isShowMessageNotify(s,c),(0,f.refreshRecentList)(c),(0,L.subscribeRecentList)([c]),b.isNewFileMessage(l)&&_.setUnReadFileMessage(l),i.recent.currentRecentInfo.owner===l.recent_owner?(S.addNewMessageIntoMessageList(l),_.setUnReadMessage(l),coreCommon.setImMessageListRead(l.server_chat_id_str)):d(c),window.CLIENTCONFIG.ISMOBILE&&!coreCommon.isSelfAccount(l.origin)&&o(c),!1===l.is_auto_reply&&(p=$getState().myInfo.isAutoResponseConf,R.info("自动回复是否开启",p),p&&(0,O.sendAutoReply)(l))),t=_.getFirstReceiveMessageQueue(),e.next=5;break;case 36:_.setIsReceiveMessageQueueDealing(!1),_.initUnDealMessageList(),e.next=45;break;case 40:e.prev=40,e.t1=e.catch(0),R.error("dealReceiveMessageQueue",e.t1.toString()),_.setIsReceiveMessageQueueDealing(!1),_.initUnDealMessageList();case 45:case"end":return e.stop()}},e,void 0,[[0,40]])}));return function(){return e.apply(this,arguments)}}()),A=[];t.removeUnReadMessageFlash=function(e){var t=A.findIndex(function(t){return t.owner===e.owner});-1!==t&&(A.splice(t,1)[0],A.length>0?window.flashTray(A[A.length-1].image,C):window.endFlashTray())};window.clearUnReadMessageFlashList=function(){A=[],window.endFlashTray()};var C=t.clickTrayUnReadFlash=function(){var e=A[A.length-1];if(e&&e.recent){var t=e.recent;appService.showMainWindow(!0),p.openRecentConversation(t)}else window.clearUnReadMessageFlashList()},x=function(){var e=(0,l.default)(u.default.mark(function e(t,r){var n,a,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,R.info("updateMessageServerId 更新消息相关文件、截图的message id"),n=[],a=[],o=[],e.t0=t.media_type,e.next=e.t0===constant.MEDIA_TYPE.PHOTO_TEXT?6:e.t0===constant.MEDIA_TYPE.PHOTO?12:e.t0===constant.MEDIA_TYPE.SCREEN_SHOT?12:e.t0===constant.MEDIA_TYPE.FILE?26:e.t0===constant.MEDIA_TYPE.AUDIO?26:e.t0===constant.MEDIA_TYPE.VIDEO?32:44;break;case 6:return e.next=8,coreDb.queryScreenShotList({message_server_chat_id_str:t.server_chat_id_str});case 8:return n=e.sent,n.map(function(e){return e.message_server_chat_id_str=r,e}),coreDb.bulkPutScreenShot(n),e.abrupt("break",45);case 12:return e.next=14,coreDb.queryFileList({message_server_chat_id_str:t.server_chat_id_str});case 14:if(n=e.sent,!isNullOrEmpty(n)){e.next=23;break}return e.next=18,coreDb.queryScreenShotList({message_server_chat_id_str:t.server_chat_id_str});case 18:n=e.sent,n.map(function(e){return e.message_server_chat_id_str=r,e}),coreDb.bulkPutScreenShot(n),e.next=25;break;case 23:n.map(function(e){return e.message_server_chat_id_str=r,e}),coreDb.bulkPutFile(n);case 25:return e.abrupt("break",45);case 26:return e.next=28,coreDb.queryFileList({message_server_chat_id_str:t.server_chat_id_str});case 28:return n=e.sent,n.map(function(e){return e.message_server_chat_id_str=r,e}),coreDb.bulkPutFile(n),e.abrupt("break",45);case 32:return e.next=34,coreDb.queryFileList({message_server_chat_id_str:t.server_chat_id_str});case 34:return o=e.sent,o.map(function(e){return e.message_server_chat_id_str=r,e}),e.next=38,coreDb.queryScreenShotList({message_server_chat_id_str:t.server_chat_id_str});case 38:return a=e.sent,a.map(function(e){return e.message_server_chat_id_str=r,e}),coreDb.bulkPutFile(o),coreDb.bulkPutScreenShot(a),n=o.concat(a),e.abrupt("break",45);case 44:return e.abrupt("break",45);case 45:return t.file_list=n,t.server_chat_id_str=r,coreDb.saveMessage(t),e.abrupt("return",t);case 51:return e.prev=51,e.t1=e.catch(0),R.error("updateMessageServerId",e.t1.toString()),e.abrupt("return",t);case 55:case"end":return e.stop()}},e,void 0,[[0,51]])}));return function(t,r){return e.apply(this,arguments)}}();t.sendJoinFixedGroupNotiyMessage=function(){var e=(0,l.default)(u.default.mark(function e(t,r){var n,a,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreGroup.getGroupById(t);case 2:return n=e.sent,a=M.createGroupMemberChgMessage(n,r),e.next=6,p.getLocalRecent({owner:t});case 6:o=e.sent,isNullOrEmpty(o)||(coreDb.saveRecent(o),(0,f.refreshRecentList)(o),coreDb.saveMessage(a));case 8:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}()},1180:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.sendAutoReply=void 0;var a=r(156),o=(n(a),r(484)),i=(n(o),r(213)),s=(n(i),r(135)),u=n(s),c=r(1181),l=window.Logger("logic")("IM/sendAutoReply");t.sendAutoReply=function(e){var t=u.getImType(e),r=$getState().myInfo.account,n=$getState().contactGroups.contact_status_map[r],a=n&&n.status;if(t===constant.IM_TYPE.SINGLE&&a===constant.ONLINE_STATUS.LEAVE)try{var o=$getState().setting.setResponsePre;o="default"===o.responseType?language[o.defaultResponseId]:o.name;var i={html:language.AUTO_REPLY+o,mediaType:constant.MEDIA_TYPE.TEXT,chatType:constant.CHAT_TYPE.AUTO_REPLY,text:language.AUTO_REPLY+o};if(l.info("user sendAutoReply",o),isNullOrEmpty(o))return;(0,c.sendQuickReply)(i,null,e.origin)}catch(e){l.error("sendAutoReply",e.toString())}}},1181:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.sendMobileQuickReply=t.sendQuickReply=void 0;var a=r(103),o=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(156),s=n(i),u=r(484),c=n(u),l=r(213),d=n(l),f=(r(485),window.Logger("logic")("IM/sendQuickReply"));t.sendQuickReply=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{return f.info("user click sendQuickReply"),window.isOffline?void window.Toast(language.CURRENTLY_OFFLINE_UNABLE_TO_SEND_MESSAGE):c.createNormalMessage(e,t,r).then(function(e){return r||(s.initLoadMore(),s.addNewMessage(e)),d.sendImMessage((0,o.default)({},e))})}catch(e){f.error("sendQuickReply",e.toString())}},t.sendMobileQuickReply=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return f.info("user click sendQuickReply"),window.isOffline?void window.Toast(language.CURRENTLY_OFFLINE_UNABLE_TO_SEND_MESSAGE):c.createMobileTextMessage(e,t).then(function(e){return s.initLoadMore(),s.addNewMessage(e),d.sendImMessage((0,o.default)({},e))})}catch(e){f.error("sendMobileQuickReply",e.toString())}}},1182:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getIndex=t.changeIndexOpt=t.downLoadOrginImageLogic=t.previewOption=void 0;var a=r(1),o=n(a),i=r(2),s=n(i),u=r(995),c=r(156);window.Logger("logic")("IM/preview"),t.previewOption=function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=!1===coreIm.getOfflineFileConfig()?t.file_path:t.file_real_save_path,e.next=3,appService.isFileExist(r);case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,(0,u.isExistOfOriginImage)(t);case 8:t.type="origin",(0,c.setCurrentImg)(t),window.goRoute("preview");case 11:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.downLoadOrginImageLogic=function(){var e=(0,s.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.downloadUMOriginPicture)(t);case 2:$dispatch(coreUi.setCurrentImg(t));case 3:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.changeIndexOpt=function(e){$dispatch(coreUi.setCurrentImgIndex(e))},t.getIndex=function(e,t){var r=void 0;return t.map(function(t,n){if(t.file_real_save_name===e)return void(r=n)}),-1!==r?r:0}},1183:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.searchHistoryMessage=void 0;var a=r(1),o=n(a),i=r(2),s=n(i),u=r(867),c=window.Logger("history")("chatHistory");t.searchHistoryMessage=function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n,a,i,s,l,d,f,p;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=$getState().recent,n=r.currentRecentInfo,a=r.selectedTagList,i=constant.SEARCH_MESSAGE_TYPE.SEARCH_TEXT,s=[],l=function(e,t){return e.utc_stamp-t.utc_stamp},e.prev=4,d=void 0,f=void 0,p=[],e.t0=i,e.next=e.t0===constant.SEARCH_MESSAGE_TYPE.SEARCH_TEXT?9:e.t0===constant.SEARCH_MESSAGE_TYPE.SEARCH_FILE?18:e.t0===constant.SEARCH_MESSAGE_TYPE.SEARCH_PICTURE?30:e.t0===constant.SEARCH_MESSAGE_TYPE.SEARCH_FILE_PICTURE?42:54;break;case 9:return e.next=11,coreDb.queryMessageList({searchtext:t,recent_id:n.id});case 11:return d=e.sent,e.next=14,(0,u.getSearchPureTextResult)(d);case 14:return s=e.sent,$dispatch(coreUi.loadHistoryMessageList(s,t)),c.info("searchHistoryMessage 查找纯文本 数量",s.length),e.abrupt("break",55);case 18:return e.next=20,coreDb.queryFileList({recent_id:n.id,searchtext:t,utc_stamp:9999999999999,limitcount:window.CLIENTCONFIG.ISMOBILE?window.CLIENTCONFIG.MOBILE_MESSAGE_LIST_PAGE_SIZE:window.CLIENTCONFIG.MESSAGE_LIST_PAGE_SIZE});case 20:return f=e.sent,f.forEach(function(e){isNullOrEmpty(p.query({message_server_chat_id_str:e.message_server_chat_id_str}))&&p.push(e)}),e.next=24,(0,u.getSearchFilesResult)(p,1);case 24:return s=e.sent,s.sort(l),$dispatch(coreUi.loadHistoryMessageList(s,t)),isNullOrEmpty(s)||$dispatch(coreUi.setHistoryMessageSearchInfo(s[0].utc_stamp)),c.info("查找文件+关键字 数量",s.length),e.abrupt("break",55);case 30:return e.next=32,coreDb.queryFileList({recent_id:n.id,searchtext:t,utc_stamp:9999999999999,limitcount:1e4});case 32:return f=e.sent,f.forEach(function(e){isNullOrEmpty(p.query({message_server_chat_id_str:e.message_server_chat_id_str}))&&p.push(e)}),e.next=36,(0,u.getSearchFilesResult)(p,2);case 36:return s=e.sent,s.sort(l),$dispatch(coreUi.loadHistoryMessageList(s,t)),isNullOrEmpty(s)||$dispatch(coreUi.setHistoryMessageSearchInfo(s[0].utc_stamp)),c.info("查找图片+关键字 数量",s.length),e.abrupt("break",55);case 42:return e.next=44,coreDb.queryFileList({recent_id:n.id,searchtext:t,utc_stamp:9999999999999,limitcount:1e4});case 44:return f=e.sent,f.forEach(function(e){isNullOrEmpty(p.query({message_server_chat_id_str:e.message_server_chat_id_str}))&&p.push(e)}),e.next=48,(0,u.getSearchFilesResult)(p,3);case 48:return s=e.sent,s.sort(l),$dispatch(coreUi.loadHistoryMessageList(s,t)),isNullOrEmpty(s)||$dispatch(coreUi.setHistoryMessageSearchInfo(s[0].utc_stamp)),c.info("查找图文+关键字 数量",s.length),e.abrupt("break",55);case 54:return e.abrupt("break",55);case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(4),c.error("精确消息查找fail",t,e.t1.toString());case 60:case"end":return e.stop()}},e,void 0,[[4,57]])}));return function(t){return e.apply(this,arguments)}}()},1184:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tipLiten=void 0;var n=r(1788),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n);t.tipLiten=a.tipLiten},1185:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){if(!window.isOffline){var t=e.data,r=t.message,n=t.img;p.debug("onImgSuccessLoad 图片加载成功");var a=n.getAttribute("data-img-id");if(n.src.hasOneOf([constant.AppConfig.IM.myLoadingImgSrc.replaceAll("../",""),constant.AppConfig.IM.otherLoadingImgSrc.replaceAll("../",""),constant.MobileAppConfig.IM.iosLoadingImgSrc.replaceAll("./",""),constant.MobileAppConfig.IM.androidLoadingImgSrc.replaceAll("../","")])){p.debug("onImgSuccessLoad 默认图加载完成");var i=r.file_list,s=i.query({file_real_save_name:a});isNullOrEmpty(s)?p.error("onImgSuccessLoad 图片信息不存在"):(p.debug("onImgSuccessLoad 加载默认图成功，没有下载原图，执行加载失败逻辑"),o(e,!1))}else c.deleteUnDownloadedPhoto(a),p.debug("onImgSuccessLoad 移除事件listener")}}function o(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(window.isOffline)return void p.error("onImgErrorLoad 离线，不处理",i,s);var r=e.data,n=r.message,a=(r.isMine,r.img),o=n.file_list,i=void 0===o?[]:o,s=a.getAttribute("data-img-id"),u=i.query({file_real_save_name:s});if(window.CLIENTCONFIG.ISMOBILE?!1===coreIm.getOfflineFileConfig()?(0,f.downloadPhoto)(u,n,!1):(0,f.downloadPhoto)(u,n,!0):(!1!==coreIm.getOfflineFileConfig()&&(0,f.downloadPhoto)(u,n,!0),(0,f.downloadPhoto)(u,n,!1)),t)if(a.src.hasOneOf([constant.AppConfig.IM.myLoadingImgSrc.replaceAll("../",""),constant.AppConfig.IM.otherLoadingImgSrc.replaceAll("../",""),constant.MobileAppConfig.IM.iosLoadingImgSrc.replaceAll("./",""),constant.MobileAppConfig.IM.androidLoadingImgSrc.replaceAll("../","")]))p.debug("onImgErrorLoad 默认图加载失败,不处理");else if(window.CLIENTCONFIG.ISMOBILE)u&&!isNullOrEmpty(u.width)&&0!==u.width||u&&!isNullOrEmpty(u.height)&&0!==u.height?(a.style.width=u.width+"px",a.style.height=u.height+"px"):a.className="default",a.style.backgroundColor="#ECEEF2","ios"===window.CLIENTCONFIG.PLATFORM?(a.src=constant.MobileAppConfig.IM.iosTransparentImgSrc,a.style.backgroundImage="url('"+constant.MobileAppConfig.IM.iosLoadingImgSrc+"')"):(a.src=constant.MobileAppConfig.IM.androidTransparentImgSrc,a.style.backgroundImage="url('"+constant.MobileAppConfig.IM.androidLoadingImgSrc+"')"),a.style.backgroundRepeat="no-repeat",a.style.borderRadius="0.04rem",a.style.backgroundPosition="center center",a.style.backgroundSize="0.56rem 0.56rem";else{if(u&&!isNullOrEmpty(u.width)&&0!==u.width||u&&!isNullOrEmpty(u.height)&&0!==u.height){var c=Math.max(u.width,u.height),l=c<=260?u.width:u.width/c*260,d=c<=260?u.height:u.height/c*260;a.style.width=l+"px",a.style.height=d+"px"}else a.className="default";a.src=constant.AppConfig.IM.transparentImgSrc,a.style.backgroundColor="#ECEEF2",a.style.backgroundImage="url('"+constant.AppConfig.IM.myLoadingImgSrc+"')",a.style.backgroundRepeat="no-repeat",a.style.backgroundPosition="center center",a.style.backgroundSize="24px,18px"}else p.debug("onImgErrorLoad 加载默认图成功触发，不进行后续判断")}function i(e){var t=e.data.screenShot;p.debug("onPhotoDownloadSuccess 图片下载成功"),document.querySelectorAll('[data-img-id ="'+t.file_real_save_name+'"]').forEach(function(e){var r=!1===coreIm.getOfflineFileConfig()?t.file_path:t.file_real_save_path;"ios"===window.CLIENTCONFIG.PLATFORM?e.src="/local-filesystem"+r:e.src=r,e.className="",e.style.width="",e.style.height="",e.style.backgroundColor="",e.style.backgroundImage="",e.style.backgroundRepeat="",e.style.backgroundPosition="",e.style.backgroundSize=""}),(0,f.downloadPhotoSuccess)(t)}function s(e){var t=e.data.screenShot;p.debug("onPhotoDownloadError 图片下载失败"),(0,f.downloadPhotoError)(t)}var u=r(159),c=n(u),l=r(417),d=(n(l),r(486)),f=(n(d),r(1169)),p=window.Logger("logic")("IM/listenEvent");p.debug("listenEvent"),window.removeEventListener("imgSuccessLoad",a),window.removeEventListener("imgErrorLoad",o),window.removeEventListener("photoDownloadSuccess",i),window.removeEventListener("photoDownloadError",s),window.addEventListener("imgSuccessLoad",a),window.addEventListener("imgErrorLoad",o),window.addEventListener("photoDownloadSuccess",i),window.addEventListener("photoDownloadError",s),delegate(function(e){if(!window.isOffline){p.debug("onImageError 图文混排中图片加载失败");var t=e.getAttribute("data-query-id");e.setAttribute("data-img-id",getFileName(e.src)),coreDb.queryMessage({server_chat_id_str:t}).then(function(t){var r=t.origin===$getState().myInfo.account,n=new Event("imgErrorLoad");n.data={message:t,isMine:r,img:e},window.dispatchEvent(n)})}},"onImageError")},1186:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.dealCopy=t.sendMobileVideoClick=t.sendPhotoClick=t.getCurrentStatus=t.createVideo=t.setTipPosition=void 0;var a=r(1789),o=n(a),i=r(1187),s=n(i);t.setTipPosition=s.setTipPosition,t.createVideo=s.createVideo,t.getCurrentStatus=s.getCurrentStatus,t.sendPhotoClick=s.sendPhotoClick,t.sendMobileVideoClick=s.sendMobileVideoClick,t.dealCopy=o.dealCopy},1187:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendMobileVideoClick=t.sendPhotoClick=t.createVideo=t.getCurrentStatus=t.setTipPosition=void 0;var n=r(573),a=r(135),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a),i=window.Logger("LOGIC")("mobile/uiController");t.setTipPosition=function(e){var t=e.showTips,r=e.obj,n=e.message,a=e.havCopy,o=void 0===a||a,i=e.havWithdraw,s=void 0===i||i;$dispatch(coreUi.setTipPosition({showTips:t,obj:r,message:n,havCopy:o,havWithdraw:s}))},t.getCurrentStatus=function(e){var t=e&&e.status,r=e&&e.desc,a=e&&e.client_type,o=void 0;return r?(r=(0,n.correctStatusDesc)(t,r),t===constant.ONLINE_STATUS.BUSY?o=language.BUSY+" - "+r:t===constant.ONLINE_STATUS.LEAVE&&(o=language.AWAY+" - "+r)):o=t===constant.ONLINE_STATUS.OFFLINE?language.OFFLINE:t===constant.ONLINE_STATUS.ONLINE?a===constant.CLIENT_TYPE.MOBILE||a===constant.CLIENT_TYPE.PAD?language.MOBILE_ONLINE:language.ONLINE:t===constant.ONLINE_STATUS.BUSY?language.BUSY:t===constant.ONLINE_STATUS.LEAVE?language.AWAY:"",o?"("+o+")":o},t.createVideo=function(){var e=$getState(),t=e.recent.currentRecentInfo.chat_type;if(o.isGroup(t))i.info("userClick  Create Video Conf"),coreConf.actionCreateConfByRecent(constant.CONF_MEDIATYPE.CONF_MEDIATYPE_FLAG_VOICE|constant.CONF_MEDIATYPE.CONF_MEDIATYPE_FLAG_HDVIDEO);else{var r=e.recent.currentRecentInfo.contact,n=r.bind_no;n?coreCall.CallOut(n,r,!0):alert(language.NOT_CALL_VIDEO)}},t.sendPhotoClick=function(){i.info("sendPhotoClick","user click picture button,try to access to the system gallery"),coreUi.sendMyPictureClick(constant.MOBILE_SEND_PHOTO_TYPE.IM_SEND)},t.sendMobileVideoClick=function(){i.info("sendMobileVideoClick","user click video button,try to access to the system gallery"),coreUi.sendMyVideoClick(constant.MOBILE_SEND_PHOTO_TYPE.IM_SEND_VIDEO)}},1188:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomLikeImg=t.sendLike=t.sendMobileLike=void 0;var n=r(1189),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n);t.sendMobileLike=a.sendMobileLike,t.sendLike=a.sendLike,t.randomLikeImg=a.randomLikeImg},1189:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.randomLikeImg=t.sendLike=t.sendMobileLike=void 0;var a=r(103),o=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(156),s=n(i),u=r(484),c=n(u),l=r(213),d=n(l),f=window.Logger("logic")("IM/sendLike"),p=(t.sendMobileLike=function(e,t){try{f.info("userClick  sendMobileLike");var r={text:t+"_"+e,mediaType:constant.MEDIA_TYPE.LIKE};return c.createMobileLikeMessage(r).then(function(e){return s.initLoadMore(),s.addNewMessage(e),d.sendImMessage((0,o.default)({},e))})}catch(e){f.error("sendLike",e.toString())}},t.sendLike=function(){try{if(f.info("sendLike"),window.isOffline)return void Toast(language.CURRENTLY_OFFLINE_UNABLE_TO_SEND_MESSAGE);var e=p(),t='<img src="'+window.LIKE_PATH+e+'"height="100%" alt="'+language.EDITOR_TOOLS_TITLE_LIKE+'">',r={text:e+"_large",mediaType:constant.MEDIA_TYPE.LIKE,html:t};return c.createLikeMessage(r).then(function(e){return s.initLoadMore(),s.addNewMessage(e),d.sendImMessage((0,o.default)({},e))})}catch(e){f.error("sendLike",e.toString())}},t.randomLikeImg=function(){return"like-"+Math.ceil(3*Math.random())+".svg"})},1190:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.correctStatusDesc=t.subscribeRecentList=t.subscribeUserStatusByAccounts=t.subscribeUserStatusByAccount=void 0;var a=r(112),o=n(a),i=r(106),s=n(i),u=r(1),c=n(u),l=r(2),d=n(l),f=(t.subscribeUserStatusByAccount=function(){var e=(0,d.default)(c.default.mark(function e(t,r){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:f([t],r);case 1:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}(),t.subscribeUserStatusByAccounts=function(){var e=(0,d.default)(c.default.mark(function e(t){var r,n,a,i,u,l,d,f,p,g,_=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(_||!window.CLIENTCONFIG.ISMOBILE&&!window.isOffline){e.next=2;break}return e.abrupt("return");case 2:if(Array.isArray(t)&&!(t.length<=0)){e.next=4;break}return e.abrupt("return");case 4:for(r=$getState().contactGroups.subAccountList,n=[],a=!0,i=!1,u=void 0,e.prev=9,l=(0,o.default)(t);!(a=(d=l.next()).done);a=!0)f=d.value,r.includes(f)||n.push({account:f});e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),i=!0,u=e.t0;case 17:e.prev=17,e.prev=18,!a&&l.return&&l.return();case 20:if(e.prev=20,!i){e.next=23;break}throw u;case 23:return e.finish(20);case 24:return e.finish(17);case 25:if(!(n.length<=0)){e.next=27;break}return e.abrupt("return");case 27:return e.next=29,new coreTup.HWTupIM;case 29:return p=e.sent,e.next=32,p.subscribeuserstatus({account_list:n});case 32:g=e.sent,g&&0===g.result&&(r.push.apply(r,(0,s.default)(t)),$dispatch(coreUi.subscriptionAccountList(r)));case 34:case"end":return e.stop()}},e,void 0,[[9,13,17,25],[18,,20,24]])}));return function(t){return e.apply(this,arguments)}}());t.subscribeRecentList=function(){var e=(0,d.default)(c.default.mark(function e(t){var r,n,a,i,s,u,l;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.CLIENTCONFIG.ISMOBILE&&window.isEserverOnline){e.next=2;break}return e.abrupt("return");case 2:for(t=t||$getState().recent.recentList,r=[],n=!0,a=!1,i=void 0,e.prev=7,s=(0,o.default)(t);!(n=(u=s.next()).done);n=!0)l=u.value,l.chat_type===constant.CHAT_TYPE.SINGLE_CHAT&&(r.includes(l.owner)||r.push(l.owner));e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),a=!0,i=e.t0;case 15:e.prev=15,e.prev=16,!n&&s.return&&s.return();case 18:if(e.prev=18,!a){e.next=21;break}throw i;case 21:return e.finish(18);case 22:return e.finish(15);case 23:f(r);case 24:case"end":return e.stop()}},e,void 0,[[7,11,15,23],[16,,18,22]])}));return function(t){return e.apply(this,arguments)}}(),t.correctStatusDesc=function(e,t){return e===constant.ONLINE_STATUS.BUSY&&"Calling"===t?t=language.STATUS_IN_CALLING:e===constant.ONLINE_STATUS.BUSY&&"In meeting"===t&&(t=language.STATUS_IN_CONFERENCE),t}},1191:function(e,t,r){"use strict";function n(e){try{if(window.CLIENTCONFIG.ISMOBILE&&("/main/recent"===e.route||"main/recent"===e.route)){i.info("onRouteChange 跳转到会话列表，清空当前会话");var t=$getState().recent.currentRecentInfo;isNullOrEmpty(t)||setTimeout(function(){o.selectRecentItem({})},0)}}catch(e){i.error("onRouteChange",e.toString())}}var a=r(571),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a),i=window.Logger("logic")("recent/listenEvent");i.debug("listenEvent"),window.removeEventListener("routechange",n),window.addEventListener("routechange",n)},1192:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.hasContactFixedToTop=t.hasGroupFixedToTop=t.hasRecentFixedToTop=t.fixContactToTop=t.fixGroupToTop=t.fixRecentToTop=void 0;var a=r(1),o=n(a),i=r(2),s=n(i),u=t.fixRecentToTop=function(){var e=(0,s.default)(o.default.mark(function e(t,r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("recent data is necesary!");case 2:return e.prev=2,void 0===r&&(r=t.stick_on_top?0:Date.now()/1e3|0),r?p.info("userClick  会话置顶"):p.info("userClick  取消会话置顶"),t.stick_on_top=r,(0,l.refreshRecentList)(t),e.next=9,coreDb.saveRecent(t);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),p.error("setRecentFixToTop",e.t0.toString());case 14:case"end":return e.stop()}},e,this,[[2,11]])}));return function(t,r){return e.apply(this,arguments)}}(),c=(t.fixGroupToTop=function(){var e=(0,s.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:f.getLocalRecent({owner:t.group_id}).then(function(e){return u(e)});case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.fixContactToTop=function(){var e=(0,s.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.account,!isNullOrEmpty(r)){e.next=3;break}return e.abrupt("return",alert(language.CONTACT_HAS_NO_USERNAME));case 3:f.getLocalRecent({owner:r}).then(function(e){return u(e)});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.hasRecentFixedToTop=function(){var e=(0,s.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.getLocalRecent(t);case 2:return r=e.sent,e.abrupt("return",!(!r||!r.stick_on_top));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),l=(t.hasGroupFixedToTop=function(){var e=(0,s.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c({owner:t.group_id}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.hasContactFixedToTop=function(){var e=(0,s.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c({owner:t.account}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r(800)),d=r(801),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(d),p=window.Logger("logic")("recent/list/fixToTop")},1193:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.markRecentAsRead=void 0;var a=r(1),o=n(a),i=r(2),s=n(i),u=(t.markRecentAsRead=function(){var e=(0,s.default)(o.default.mark(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{0!==r?((0,u.updateUnReadNumMap)(t.owner,r),t.set_unread_num=0,coreDb.saveRecent(t)):0!==t.unread_num&&coreCommon.setMessageNotifyRead(t),(0,u.refreshRecentList)(t)}catch(e){c.error("markRecentAsRead",e.toString())}case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r(800)),c=window.Logger("logic")("recent/list/markread")},1194:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setIsTwoToThree=t.openCloudSpace=t.openGroupSpace=t.showCurrentRecentDetail=void 0;var n=r(1195),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n);t.showCurrentRecentDetail=a.showCurrentRecentDetail,t.openGroupSpace=a.openGroupSpace,t.openCloudSpace=a.openCloudSpace,t.setIsTwoToThree=function(e){return $dispatch(coreUi.setIsTwoToThree(e))}},1195:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){m.info("showCurrentRecentDetail",e);var t=$getState().recent.currentRecentInfo,r={};return _.isGroup(t.chat_type)?(r={group_id:t.owner},coreSetting.dispatchSliderIsMuteNotify(t.owner)):r=(0,d.default)({},t.contact),coreContact.loadSliderDetailInfo(r)}Object.defineProperty(t,"__esModule",{value:!0}),t.openTeamSpace=t.openCloudSpace=void 0;var i=r(1),s=a(i),u=r(2),c=a(u),l=r(103),d=a(l),f=(t.openCloudSpace=function(){var e=(0,c.default)(s.default.mark(function e(){var t,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:t=e.sent;try{r=t.param.webUrl,m.info("openCloudSpace openUrl. url"),appService.openUrl(r)}catch(e){m.error("openCloudSpace error. ",t)}case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),function(){var e=(0,c.default)(s.default.mark(function e(){var t,r,n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=coreAccount.getLoginModel(),r=t.user_ticket,e.next=4,v.getCloudSpaceUrl(r);case 4:return n=e.sent,e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()),p=(t.openTeamSpace=function(){var e=(0,c.default)(s.default.mark(function e(t){var r,n,a,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new coreTup.HWTupIM;case 2:return r=e.sent,m.info("openGroupSpace group_id :",t.group_id),e.next=6,r.opengroupspace({id:t.group_id,group_type:t.group_type,group_space_name:t.name+" cloudLink",owner:t.owner});case 6:if(n=e.sent,m.info("openGroupSpace res.result :",n.result),!n||0!==n.result){e.next=15;break}return e.next=11,p(t.group_id,n.param.group_space_id);case 11:a=e.sent;try{o=a.param.webUrl,m.info("openGroupSpace openUrl. url"),appService.openUrl(o)}catch(e){m.error("openGroupSpace error. ",a)}e.next=16;break;case 15:m.error("openGroupSpace error.. ",n);case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,c.default)(s.default.mark(function e(t,r){var n,a,o,i,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=coreAccount.getLoginModel(),a=n.user_ticket,o=parseInt(t),i=parseInt(r),e.next=6,v.getGroupSpaceUrl(a,i,o);case 6:return u=e.sent,e.abrupt("return",u);case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}());t.showCurrentRecentDetail=o;var g=r(135),_=n(g),h=r(417),v=n(h),m=window.Logger("logic")("detail/uiEvent")},1196:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(159),a=new n.queueDealFuncClass;t.default={addAvatarDownloadFunc:function(e){a.addQueueFunc(e),a.runQueueFunc()}}},1197:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(159),a=new n.queueDealFuncClass;t.default={addAvatarDownloadAckFunc:function(e){a.addQueueFunc(e),a.runQueueFunc()}}},1198:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=Noop,t=function(){};return t.prototype.setModalFocusFunc=function(t){e=t},t.prototype.getModalFocusFunc=function(){return e},t.prototype.clearModalFocusFunc=function(){e=Noop},new t}()},1199:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reLoginToeServer=t.loginToeServer=t.eserverLogout=t.registerEvent=void 0;var n=r(1792),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n);t.registerEvent=a.registerEvent,t.eserverLogout=a.eserverLogout,t.loginToeServer=a.loginToeServer,t.reLoginToeServer=a.reLoginToeServer},120:function(e,t,r){var n=r(10),a=r(8),o=r(121);e.exports=function(e,t){var r=(a.Object||{})[e]||Object[e],i={};i[e]=t(r),n(n.S+n.F*o(function(){r(1)}),"Object",i)}},1200:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.umserverLogout=t.umserverLogin=void 0;var n=r(1793),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n);t.umserverLogin=a.umserverLogin,t.umserverLogout=a.umserverLogout},1201:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stopRecord=t.startRecord=void 0;var n=r(1797);t.startRecord=n.startRecord,t.stopRecord=n.stopRecord},121:function(e,t,r){e.exports=r(0)(53)},126:function(e,t,r){var n=r(8),a=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},127:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var a=r(193),o=n(a),i=r(112),s=n(i);t.default=function(){function e(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=(0,s.default)(e);!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if((0,o.default)(Object(t)))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},133:function(e,t,r){e.exports={default:r(149),__esModule:!0}},134:function(e,t,r){var n=r(15);e.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},135:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return!isNullOrEmpty(e.quote)}function o(e){return e===constant.CARD_TYPE.ESpaceSharingTypeCloudText||e===constant.CARD_TYPE.ESpaceSharingTypeCloudImage||e===constant.CARD_TYPE.ESpaceSharingTypeCloudAudio||e===constant.CARD_TYPE.ESpaceSharingTypeCloudVideo||e===constant.CARD_TYPE.ESpaceSharingTypeCloudWord||e===constant.CARD_TYPE.ESpaceSharingTypeCloudExcel||e===constant.CARD_TYPE.ESpaceSharingTypeCloudPPT||e===constant.CARD_TYPE.ESpaceSharingTypeCloudPDF||e===constant.CARD_TYPE.ESpaceSharingTypeCloudOther||e===constant.CARD_TYPE.ESpaceSharingTypeCloudFolder?constant.BUBBLE_TYPE.SHARE_FILE:e===constant.CARD_TYPE.ESpaceSharingTypeText||e===constant.CARD_TYPE.ESpaceSharingTypeImgAndText||e===constant.CARD_TYPE.ESpaceSharingTypeAudioAndVideo?constant.BUBBLE_TYPE.SHARE_KNOWLEDGE:e===constant.CARD_TYPE.ESpaceSharingTypeCard||e===constant.CARD_TYPE.ESpaceSharingTypeTeamCard||e===constant.CARD_TYPE.ESpaceSharingTypeNew||e===constant.CARD_TYPE.ESpaceSharingTypeNewCard||e===constant.CARD_TYPE.ESpaceSharingTypeCombineTransmit||e===constant.CARD_TYPE.ESpaceSharingTypePosition?constant.BUBBLE_TYPE.CARD:constant.BUBBLE_TYPE.UNDEFINED}function i(e){try{var t=e.media_type;return e.chat_type===constant.CHAT_TYPE.FILE_TRANSFER_NOTIFICATION||t===constant.MEDIA_TYPE.FILE||t===constant.MEDIA_TYPE.AUDIO||t===constant.MEDIA_TYPE.VIDEO||t===constant.MEDIA_TYPE.PHOTO||t===constant.MEDIA_TYPE.SCREEN_SHOT}catch(e){return b.error("isNewFileMessage",e.toString()),!1}}function s(e){var t=(0,S.default)(e);return t=function(e){return M(e)&&(e=e.replace(p(),function(t){var r=arguments[arguments.length-2];if(v(e,r))return t;var n=/(https|http):\/\//gi,a=t;return n.test(t)||(a="http://"+t),'<a href="'+a+'" >'+t+"</a>"})),e}(t),t=function(e){return m(e)&&(e=e.replace(h(),function(t){var r=arguments[arguments.length-2];if(v(e,r))return t;var n=/mailto:/gi,a=t;return n.test(t)||(a="mailto:"+t.toLocaleLowerCase()),'<a href="'+a+'" >'+t+"</a>"})),e}(t),-1!==t.indexOf("\n")&&(t=t.replaceAll("\n","<br/>")),t}function u(e){return b.info("getImageInfo"),new E.default(function(t,r){var n=new Image;"ios"===window.CLIENTCONFIG.PLATFORM?n.setAttribute("src","/local-filesystem"+e):n.setAttribute("src",e),n.complete?(b.info("getImageInfo","width",n.width,"height",n.height),t({width:n.width,height:n.height})):(n.onload=function(){b.info("getImageInfo","width",n.width,"height",n.height),t({width:n.width,height:n.height})},n.onerror=function(){b.error("getImageInfo","img path error"),t({width:0,height:0})})})}function c(e){return b.info("getVideoInfo"),new E.default(function(t,r){var n=document.createElement("video");"ios"===window.CLIENTCONFIG.PLATFORM?n.setAttribute("src","/local-filesystem"+e):n.setAttribute("src",e),n.complete?(b.info("getVideoInfo","width",n.videoWidth,"height",n.videoHeight),t({width:n.videoWidth,height:n.videoHeight})):(n.onloadedmetadata=function(){b.info("getVideoInfo","width",n.videoWidth,"height",n.videoHeight),t({width:n.videoWidth,height:n.videoHeight})},n.onerror=function(){b.error("getVideoInfo","video path error"),t({width:0,height:0})})})}function l(e){return b.info("getAudioInfo"),new E.default(function(t,r){var n=document.createElement("audio");"ios"===window.CLIENTCONFIG.PLATFORM?n.setAttribute("src","/local-filesystem"+e):n.setAttribute("src",e),n.complete?(b.info("getAudioInfo","duration",n.duration),t({duration:parseInt(n.duration)})):(n.onloadedmetadata=function(){b.info("getAudioInfo","duration",n.duration),t({duration:parseInt(n.duration)})},n.onerror=function(){b.error("getAudioInfo","audio path error"),t({duration:0})})})}function d(e){try{var t=e?new Date(e):new Date,r="screenshot_"+t.format("yyyyMMddhhmmssS");return b.info("createImageName 截图名: "+r),r}catch(e){b.error("createImageName",e.toString())}}function f(e){return e.is_quote===constant.IS_QUOTE.YES}function p(){return/((https?):\/\/|www\.)[-a-zA-Z0-9@:%_+.~#?&\/=\\'`!$*(&amp;)]+/gi}function g(){return/(file:\/\/|\\\\)(((?:(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))\.){3}(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d))))|([a-zA-Z]))[^<\s]*/gi}function _(){return/((notes|telnet|ftp):\/\/)[-a-zA-Z0-9@:;%_+.~#?&\/=\\']+/gi}function h(){return/(mailto:)?(\w)+(\.\w+)*([@:%_+.~#?&\/=\\'<>])*@(\w)+((\.\w{2,3}){1,3})/gi}function v(e,t){var r=e.substring(0,t);return r.lastIndexOf("<")>r.lastIndexOf(">")}function m(e){var t=e,r=h();return new RegExp(r.source).test(t)}function M(e){var t=e,r=p(),n=g(),a=_(),o=[new RegExp(r.source,"i"),new RegExp(n.source,"i"),new RegExp(a.source,"i")];return o[0].test(t)||o[1].test(t)||o[2].test(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.isGroupNotifyMessage=t.formatPcNormalMessage=t.isCustomChat=t.isBelongToCurrentRecent=t.formatImgUrl=t.isAtMessage=t.getRecentOwnerByMessage=t.hasScreenShot=t.getBubbleRenderType=t.checkClientChatId=t.resolveFileInfoByContent=t.getFileMediaType=t.getMediaType=t.getImType=t.isGroup=t.isErrorQuote=t.isErrorMessage=t.isUseUmFile=t.isShowMessageRelay=t.isMessageToolTipsShow=void 0;var y=r(3),E=n(y);t.isQuoteMessage=a,t.isNewFileMessage=i,t.formatMobileNormalMessage=s,t.getImageInfo=u,t.getVideoInfo=c,t.getAudioInfo=l,t.createImageName=d,t.isQuoteFile=f;var w=r(827),S=n(w),I=r(583),T=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(I),b=window.Logger("service")("IM/messageUtil"),L=(t.isMessageToolTipsShow=function(e){var t=e.media_type,r=e.quote;return t===constant.MEDIA_TYPE.FILE||t===constant.MEDIA_TYPE.AUDIO||t===constant.MEDIA_TYPE.VIDEO?L():!!(isNullOrEmpty(r)||(t=e.quote.media_type)!==constant.MEDIA_TYPE.FILE&&t!==constant.MEDIA_TYPE.AUDIO&&t!==constant.MEDIA_TYPE.VIDEO)||L()},t.isShowMessageRelay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.media_type;return t!==constant.MEDIA_TYPE.FILE&&t!==constant.MEDIA_TYPE.AUDIO&&t!==constant.MEDIA_TYPE.VIDEO||L()},t.isUseUmFile=function(){return $getState().setting.isUseUM}),O=(t.isErrorMessage=function(e){return e.show_html===constant.DEAL_ERROR?(b.error("消息格式异常！show_html"),b.debug("消息格式异常！show_html",e),!0):!(e.media_type!==constant.MEDIA_TYPE.FILE&&e.media_type!==constant.MEDIA_TYPE.AUDIO&&e.media_type!==constant.MEDIA_TYPE.VIDEO&&e.media_type!==constant.MEDIA_TYPE.PHOTO&&e.media_type!==constant.MEDIA_TYPE.SCREEN_SHOT||!isNullOrEmpty(e.file_list))&&(b.error("消息格式异常！file_list为空"),b.debug("消息格式异常！file_list为空",e),!0)},t.isErrorQuote=function(e){if(!isNullOrEmpty(e.quote)){if(e.quote.show_html===constant.DEAL_ERROR)return b.error("消息格式异常！quote.show_html"),b.debug("消息格式异常！quote.show_html",e),!0;if((e.quote.media_type===constant.MEDIA_TYPE.FILE||e.quote.media_type===constant.MEDIA_TYPE.AUDIO||e.quote.media_type===constant.MEDIA_TYPE.VIDEO||e.quote.media_type===constant.MEDIA_TYPE.PHOTO||e.quote.media_type===constant.MEDIA_TYPE.SCREEN_SHOT)&&isNullOrEmpty(e.quote.file_list))return b.error("消息格式异常！quote.file_list为空"),b.debug("消息格式异常！quote.file_list为空",e),!0}return!1},t.isGroup=function(e){return e===constant.CHAT_TYPE.GROUP_CHAT||e===constant.CHAT_TYPE.GROUP_CHAT_TEMPORARY||e===constant.CHAT_TYPE.DISCUSSION_GROUP});t.getImType=function(e){switch(e.chat_type){case constant.CHAT_TYPE.SINGLE_CHAT:case constant.CHAT_TYPE.SINGLE_CHAT_TEMPORARY:return constant.IM_TYPE.SINGLE;case constant.CHAT_TYPE.GROUP_CHAT:case constant.CHAT_TYPE.GROUP_CHAT_TEMPORARY:case constant.CHAT_TYPE.DISCUSSION_GROUP:return constant.IM_TYPE.GROUP;case constant.CHAT_TYPE.SYSTEM_NOTIFICATION:case constant.CHAT_TYPE.SYSTEM_ADVERTISING:return constant.IM_TYPE.SYSTEM_ANNOUNCEMENT;case constant.CHAT_TYPE.FILE_TRANSFER_NOTIFICATION:case constant.CHAT_TYPE.SERVICE_ONLINE:case constant.CHAT_TYPE.REMINDER:case constant.CHAT_TYPE.FUSION_MEETING_NOTIFICATION:case constant.CHAT_TYPE.IM_NOTIFICATION_MESSAGE:case constant.CHAT_TYPE.AUTO_REPLY:default:return constant.IM_TYPE.OTHER}},t.getMediaType=function(e){var t=getSuffix(e);return-1!=["mp4","mpeg4","ogg"].indexOf(t.toLowerCase())?constant.MEDIA_TYPE.VIDEO:-1!=["wav"].indexOf(t.toLowerCase())&&window.CLIENTCONFIG.ISMOBILE?constant.MEDIA_TYPE.AUDIO:-1!=["png","jpg","jpeg","bmp","gif"].indexOf(t.toLowerCase())?constant.MEDIA_TYPE.PHOTO:constant.MEDIA_TYPE.FILE},t.getFileMediaType=function(e){var t=getSuffix(e);return-1!=["mp4","mpeg4","ogg"].indexOf(t.toLowerCase())?constant.FILE_MEDIA_TYPE.VIDEO:-1!=["wav","mp3"].indexOf(t.toLowerCase())&&window.CLIENTCONFIG.ISMOBILE?constant.FILE_MEDIA_TYPE.AUDIO:-1!=["png","jpg","jpeg","bmp","gif"].indexOf(t.toLowerCase())?constant.FILE_MEDIA_TYPE.Img:constant.FILE_MEDIA_TYPE.FILE},t.resolveFileInfoByContent=function(e){try{b.debug("resolveFileInfoByContent");var t=new RegExp("\\||;|{|}"),r=e.split(t);return{um_url:r[1],file_type:r[2],file_size:r[3],file_name:r[4],duration:r[5],width:r[6],height:r[7],um_plain_access_code:r[8]}}catch(e){b.error("resolveFileInfoByContent 文件信息解析失败",e.toString())}},t.checkClientChatId=function(e){return e>2},t.getBubbleRenderType=function(e){try{var t=e.media_type,r=e.status,n=e.file_list,a=e.card_type;b.debug("getBubbleRenderType",{media_type:t,status:r,file_list:n,card_type:a});switch(t){case constant.MEDIA_TYPE.AUTO_REPLY:case constant.MEDIA_TYPE.TEXT:case constant.MEDIA_TYPE.PHOTO_TEXT:case constant.MEDIA_TYPE.CALL_RECORD_NOTIFY:return constant.BUBBLE_TYPE.NORMAL;case constant.MEDIA_TYPE.SCREEN_SHOT:case constant.MEDIA_TYPE.PHOTO:return constant.BUBBLE_TYPE.PHOTO;case constant.MEDIA_TYPE.LIKE:return constant.BUBBLE_TYPE.LIKE;case constant.MEDIA_TYPE.AUDIO:return constant.BUBBLE_TYPE.AUDIO;case constant.MEDIA_TYPE.VIDEO:return constant.BUBBLE_TYPE.VIDEO;case constant.MEDIA_TYPE.FILE:return constant.BUBBLE_TYPE.FILE;case constant.MEDIA_TYPE.SHARE:return o(a);case constant.MEDIA_TYPE.DANGEROUS:return constant.BUBBLE_TYPE.DANGEROUS;default:return constant.BUBBLE_TYPE.UNDEFINED}}catch(e){b.error("getBubbleRenderType",e.toString())}},t.hasScreenShot=function(e){return e===constant.MEDIA_TYPE.SCREEN_SHOT||e===constant.MEDIA_TYPE.PHOTO_TEXT},t.getRecentOwnerByMessage=function(e){try{return O(e.chat_type)?e.group_id:e.origin===coreAccount.getLoginModel().account?e.target:e.origin}catch(t){return b.error("getRecentOwnerByMessage",t.toString()),e.origin}},t.isAtMessage=function(e){try{var t=coreAccount.getLoginModel().account,r=e.show_html,n=e.media_type,a=e.at_user_list;if(b.info("show at_user_list ,length : ",a&&a.length),!isNullOrEmpty(a)){var o=!1;return-1!==a.findIndex(function(e){return e.account===t})&&(o=!0),b.info("isAtMessage",{isAt:o}),o}if(n!==constant.MEDIA_TYPE.TEXT||n!==constant.MEDIA_TYPE.PHOTO_TEXT||isNullOrEmpty(r))return b.info("isAtMessage, does not meet type requirements",{show_html:r,media_type:n}),!1;var i=T.String2HTML(r);if(!isNullOrEmpty(i)&&i.querySelectorAll){var s=i.querySelectorAll("[role-at]"),u=!1;return isNullOrEmpty(s)||s.forEach(function(e){e.getAttribute("data-account")===coreAccount.getLoginModel().account&&(u=!0)}),b.info("isAtMessage",u),u}return!1}catch(e){return b.error("isAtMessage",e.toString()),!1}},t.formatImgUrl=function(e){try{var t=decodeURI(e);return t.startsWith("http://")||t.startsWith("https://")||t.startsWith("ftp://")?(b.info("formatImgUrl NG"),!1):(t=t.replace("file:///",""),b.info("formatImgUrl OK"),t)}catch(e){return b.error("formatImgUrl",e.toString()),!1}},t.isBelongToCurrentRecent=function(e){var t=$getState(),r=t.recent,n=r.currentRecentInfo,a=n.owner;return e.recent_owner===a},t.isCustomChat=function(e){return e===constant.CHAT_TYPE.CUSTOM_CHAT},t.formatPcNormalMessage=function(e,t,r){var n=(0,S.default)(e);return n=function(e){return M(e)&&(e=e.replace(p(),function(t){var r=arguments[arguments.length-2];if(v(e,r))return t;var n=/(https|http):\/\//gi,a=t;return n.test(t)||(a="http://"+t),'<a href="javascript:;" onClick="appService.openUrl(\''+a+"')\">"+t+"</a>"}),e=e.replace(g(),function(t){var r=arguments[arguments.length-2];return v(e,r)?t:'<a href="javascript:;" onClick="appService.openUrl(\'file:'+t.replace("file:","").replace(/\\/g,"/").replace(/([^\/]+)\/+/g,"$1/")+"')\">"+t+"</a>"}),e=e.replace(_(),function(t){var r=arguments[arguments.length-2];return v(e,r)?t:"<a>"+t+"</a>"})),e}(n),n=function(e){return m(e)&&(e=e.replace(h(),function(t){var r=arguments[arguments.length-2];if(v(e,r))return t;var n=/mailto:/gi,a=t;return n.test(t)||(a="mailto:"+t.toLocaleLowerCase()),'<a href="javascript:;" onClick="appService.openUrl(\''+a+"')\">"+t+"</a>"})),e}(n),n=function(e,t,r){if(t){var n=null;""!==r&&(n=new RegExp(r,"gi"),e=e.replace(n,function(e){return'<span style="color:#04cfef !important">'+e+"</span>"}))}return e}(n,t,r),-1!==n.indexOf("\n")&&(n=n.replaceAll("\n","<br/>")),n=n.replace(/<img[^>]+>/g,function(e){if(-1!==e.indexOf(window.EMOTION_PATH)){var t=e.lastIndexOf(".");return e.slice(0,t)+".png"+e.slice(t+4,e.length)}return e})},t.isGroupNotifyMessage=function(e){return e===constant.MEDIA_TYPE.GROUP_MEMBERCHG_NOTIFY||e===constant.MEDIA_TYPE.APPLY_JOIN_FIXED_GROUP_NOTIFY||e===constant.MEDIA_TYPE.UPGRADE_TO_FIXED_GROUP_NOTIFY||e===constant.MEDIA_TYPE.CHANGE_JOIN_GROUP_VERIFY||e===constant.MEDIA_TYPE.GROUP_NAME_CHANGE}},136:function(e,t,r){e.exports=r(0)(397)},143:function(e,t,r){r(144),e.exports=r(8).Object.getPrototypeOf},144:function(e,t,r){var n=r(111),a=r(145);r(120)("getPrototypeOf",function(){return function(e){return a(n(e))}})},145:function(e,t,r){e.exports=r(0)(389)},149:function(e,t,r){r(23),r(150),e.exports=r(8).Array.from},150:function(e,t,r){"use strict";var n=r(11),a=r(10),o=r(111),i=r(33),s=r(34),u=r(28),c=r(151),l=r(27);a(a.S+a.F*!r(35)(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,a,d,f=o(e),p="function"==typeof this?this:Array,g=arguments.length,_=g>1?arguments[1]:void 0,h=void 0!==_,v=0,m=l(f);if(h&&(_=n(_,g>2?arguments[2]:void 0,2)),void 0==m||p==Array&&s(m))for(t=u(f.length),r=new p(t);t>v;v++)c(r,v,h?_(f[v],v):f[v]);else for(d=m.call(f),r=new p;!(a=d.next()).done;v++)c(r,v,h?i(d,_,[a.value,v],!0):a.value);return r.length=v,r}})},151:function(e,t,r){"use strict";var n=r(26),a=r(152);e.exports=function(e,t,r){t in e?n.f(e,t,a(0,r)):e[t]=r}},152:function(e,t,r){e.exports=r(0)(63)},153:function(e,t,r){e.exports=r(0)(64)},156:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(){$dispatch(coreUi.initLoadMore())}function o(e){$dispatch(coreUi.addNewMessage(e))}function i(e){$getState().recent.currentRecentInfo.owner===e.recent_owner&&$dispatch(coreUi.updateMessageList(e))}function s(e){$dispatch(coreUi.updateMessageListByClientId(e))}function u(e,t){$dispatch(coreUi.updateProgressMap(e,t))}function c(e){$dispatch(coreUi.deleteProgressMap(e))}function l(e,t,r){$dispatch(coreUi.updateCurrentRecentImgList(e,t,r))}function d(e){$dispatch(coreUi.setCurrentImg(e))}function f(e){$dispatch(coreUi.deleteOpenFileMessageMap(e))}function p(e){$dispatch(coreUi.deleteSaveAsFileMessageMap(e))}function g(){$dispatch(coreUi.setBackwardLoadMessage())}function _(){$dispatch(coreUi.setLoadMore())}function h(){$dispatch(coreUi.setHistoryMessageLoading())}function v(e){if($dispatch(coreUi.loadHistoryMessage(e)),!isNullOrEmpty(e)){var t=b.dealCurrentRecentLastMessageInfo(e[e.length-1]);coreDb.saveRecent(t),b.updateRecent(t)}}function m(){$dispatch(coreUi.setHistoryMessageNotLoading())}function M(){$dispatch(coreUi.haveMoreLocalMessage())}function y(){$dispatch(coreUi.haveMoreServerMessage())}function E(){L.info("userClick  clearScreen"),I.setUnreadNewMessageNum(0),$dispatch(coreUi.clearScreen())}function w(e){$dispatch(coreUi.updateNowPlayingAudio(e))}Object.defineProperty(t,"__esModule",{value:!0}),t.optionBtn=void 0,t.initLoadMore=a,t.addNewMessage=o,t.updateMessageList=i,t.updateMessageListByClientId=s,t.updateProgressMap=u,t.deleteProgressMap=c,t.updateCurrentRecentImgList=l,t.setCurrentImg=d,t.deleteOpenFileMessageMap=f,t.deleteSaveAsFileMessageMap=p,t.setBackwardLoadMessage=g,t.setLoadMore=_,t.setHistoryMessageLoading=h,t.loadHistoryMessage=v,t.setHistoryMessageNotLoading=m,t.haveMoreLocalMessage=M,t.haveMoreServerMessage=y,t.clearScreen=E,t.updateNowPlayingAudio=w;var S=r(485),I=n(S),T=r(187),b=n(T),L=window.Logger("logic")("IM/dataUpdate");t.optionBtn=function(e){$dispatch(coreUi.updateOptionBtn(e))}},159:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";window.Logger("model")("IMService").info(e+" initService"),I(),T(),O(),S(),R(),b(),L(),N(),A(),C()}Object.defineProperty(t,"__esModule",{value:!0}),t.getSendPhotoType=t.setSendPhotoType=t.initSendPhotoType=t.getOfflineFileConfig=t.setOfflineFileConfig=t.initOfflineFileConfig=t.deleteMessageWithdrawServerId=t.getMessageWithdrawServerIdList=t.getMessageWithdrawServerId=t.setMessageWithdrawServerId=t.initMessageWithdrawServerIdList=t.addDownloadScreenShotFunc=t.addUploadScreenShotFunc=t.queueDealFuncClass=t.deleteUnDownloadedPhoto=t.getUnDownloadedPhotoMap=t.getUnDownloadedPhoto=t.setUnDownloadedPhoto=t.initUnDownloadedPhotoMap=t.deleteGroupFileByHandle=t.getGroupFileByHandle=t.setGroupFileByHandle=t.initGroupFileHandleMap=t.deleteFileByHandleList=t.deleteFileByHandle=t.getFileHandleMap=t.getFileByHandle=t.setFileByHandle=t.initFileHandleMap=t.initUmServerFlag=t.getUmServerFlag=t.setUmServerFlag=t.getIsReceiveMessageQueueDealing=t.setIsReceiveMessageQueueDealing=t.getFirstReceiveMessageQueue=t.setReceiveMessageQueueList=t.setReceiveMessageQueue=t.initReceiveMessageQueue=t.deleteReceivingMessage=t.queryReceivingMessageMap=t.getReceivingMessage=t.setReceivingMessage=t.initReceivingMessageMap=t.deleteSendingMessage=t.querySendingMessageMap=t.getSendingMessage=t.setSendingMessage=t.initSendingMessageMap=t.setPosition=t.getPosition=t.setRecentListReady=t.getRecentListReady=t.getUnDealMessageList=t.setUnDealMessage=t.initUnDealMessageList=t.setUnReadMessage=t.getAllUnReadMessageList=t.initUnReadMessageList=t.deleteUnReadFileMessageList=t.initUnReadFileMessageList=t.getUnReadFileMessageList=t.setUnReadFileMessage=void 0,t.initImModelService=a;var o=r(1147),i=n(o),s=r(1148),u=n(s),c=r(1149),l=n(c),d=r(1150),f=n(d),p=r(1151),g=n(p),_=r(1152),h=n(_),v=r(1153),m=n(v),M=r(1154),y=n(M),E=r(870),w=n(E),S=(t.setUnReadFileMessage=i.default.setUnReadFileMessage,t.getUnReadFileMessageList=i.default.getUnReadFileMessageList,t.initUnReadFileMessageList=i.default.initUnReadFileMessageList),I=(t.deleteUnReadFileMessageList=i.default.deleteUnReadFileMessageList,t.initUnReadMessageList=i.default.initUnReadMessageList),T=(t.getAllUnReadMessageList=i.default.getAllUnReadMessageList,t.setUnReadMessage=i.default.setUnReadMessage,t.initUnDealMessageList=i.default.initUnDealMessageList),b=(t.setUnDealMessage=i.default.setUnDealMessage,t.getUnDealMessageList=i.default.getUnDealMessageList,t.getRecentListReady=i.default.getRecentListReady,t.setRecentListReady=i.default.setRecentListReady,t.getPosition=i.default.getPosition,t.setPosition=i.default.setPosition,t.initSendingMessageMap=i.default.initSendingMessageMap,t.setSendingMessage=i.default.setSendingMessage,t.getSendingMessage=i.default.getSendingMessage,t.querySendingMessageMap=i.default.querySendingMessageMap,t.deleteSendingMessage=i.default.deleteSendingMessage,t.initReceivingMessageMap=i.default.initReceivingMessageMap,t.setReceivingMessage=i.default.setReceivingMessage,t.getReceivingMessage=i.default.getReceivingMessage,t.queryReceivingMessageMap=i.default.queryReceivingMessageMap,t.deleteReceivingMessage=i.default.deleteReceivingMessage,t.initReceiveMessageQueue=i.default.initReceiveMessageQueue),L=(t.setReceiveMessageQueue=i.default.setReceiveMessageQueue,t.setReceiveMessageQueueList=i.default.setReceiveMessageQueueList,t.getFirstReceiveMessageQueue=i.default.getFirstReceiveMessageQueue,t.setIsReceiveMessageQueueDealing=i.default.setIsReceiveMessageQueueDealing,t.getIsReceiveMessageQueueDealing=i.default.getIsReceiveMessageQueueDealing,t.setUmServerFlag=i.default.setUmServerFlag,t.getUmServerFlag=i.default.getUmServerFlag,t.initUmServerFlag=i.default.initUmServerFlag),O=t.initFileHandleMap=u.default.initFileHandleMap,R=(t.setFileByHandle=u.default.setFileByHandle,t.getFileByHandle=u.default.getFileByHandle,t.getFileHandleMap=u.default.getFileHandleMap,t.deleteFileByHandle=u.default.deleteFileByHandle,t.deleteFileByHandleList=u.default.deleteFileByHandleList,t.initGroupFileHandleMap=u.default.initGroupFileHandleMap),N=(t.setGroupFileByHandle=u.default.setGroupFileByHandle,t.getGroupFileByHandle=u.default.getGroupFileByHandle,t.deleteGroupFileByHandle=u.default.deleteGroupFileByHandle,t.initUnDownloadedPhotoMap=l.default.initUnDownloadedPhotoMap,t.setUnDownloadedPhoto=l.default.setUnDownloadedPhoto,t.getUnDownloadedPhoto=l.default.getUnDownloadedPhoto,t.getUnDownloadedPhotoMap=l.default.getUnDownloadedPhotoMap,t.deleteUnDownloadedPhoto=l.default.deleteUnDownloadedPhoto,t.queueDealFuncClass=w.default,t.addUploadScreenShotFunc=f.default.addUploadScreenShotFunc,t.addDownloadScreenShotFunc=g.default.addDownloadScreenShotFunc,t.initMessageWithdrawServerIdList=h.default.initMessageWithdrawServerIdList),A=(t.setMessageWithdrawServerId=h.default.setMessageWithdrawServerId,t.getMessageWithdrawServerId=h.default.getMessageWithdrawServerId,t.getMessageWithdrawServerIdList=h.default.getMessageWithdrawServerIdList,t.deleteMessageWithdrawServerId=h.default.deleteMessageWithdrawServerId,t.initOfflineFileConfig=m.default.initOfflineFileConfig),C=(t.setOfflineFileConfig=m.default.setOfflineFileConfig,t.getOfflineFileConfig=m.default.getOfflineFileConfig,t.initSendPhotoType=y.default.initSendPhotoType);t.setSendPhotoType=y.default.setSendPhotoType,t.getSendPhotoType=y.default.getSendPhotoType},160:function(e,t,r){r(25),r(23),e.exports=r(161)},161:function(e,t,r){var n=r(9),a=r(27);e.exports=r(8).getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},162:function(e,t,r){r(163),e.exports=r(8).Object.keys},163:function(e,t,r){var n=r(111),a=r(153);r(120)("keys",function(){return function(e){return a(n(e))}})},164:function(e,t,r){"use strict";var n=r(26).f,a=r(176),o=r(30),i=r(11),s=r(29),u=r(24),c=r(177),l=r(178),d=r(38),f=r(31),p=r(136).fastKey,g=r(134),_=f?"_s":"size",h=function(e,t){var r,n=p(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function(e,t,r,c){var l=e(function(e,n){s(e,l,t,"_i"),e._t=t,e._i=a(null),e._f=void 0,e._l=void 0,e[_]=0,void 0!=n&&u(n,r,e[c],e)});return o(l.prototype,{clear:function(){for(var e=g(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[_]=0},delete:function(e){var r=g(this,t),n=h(r,e);if(n){var a=n.n,o=n.p;delete r._i[n.i],n.r=!0,o&&(o.n=a),a&&(a.p=o),r._f==n&&(r._f=a),r._l==n&&(r._l=o),r[_]--}return!!n},forEach:function(e){g(this,t);for(var r,n=i(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!h(g(this,t),e)}}),f&&n(l.prototype,"size",{get:function(){return g(this,t)[_]}}),l},def:function(e,t,r){var n,a,o=h(e,t);return o?o.v=r:(e._l=o={i:a=p(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=o),n&&(n.n=o),e[_]++,"F"!==a&&(e._i[a]=o)),e},getEntry:h,setStrong:function(e,t,r){c(e,t,function(e,r){this._t=g(e,t),this._k=r,this._l=void 0},function(){for(var e=this,t=e._k,r=e._l;r&&r.r;)r=r.p;return e._t&&(e._l=r=r?r.n:e._t._f)?"keys"==t?l(0,r.k):"values"==t?l(0,r.v):l(0,[r.k,r.v]):(e._t=void 0,l(1))},r?"entries":"values",!r,!0),d(t)}}},165:function(e,t,r){"use strict";var n=r(7),a=r(10),o=r(136),i=r(121),s=r(36),u=r(30),c=r(24),l=r(29),d=r(15),f=r(37),p=r(26).f,g=r(179)(0),_=r(31);e.exports=function(e,t,r,h,v,m){var M=n[e],y=M,E=v?"set":"add",w=y&&y.prototype,S={};return _&&"function"==typeof y&&(m||w.forEach&&!i(function(){(new y).entries().next()}))?(y=t(function(t,r){l(t,y,e,"_c"),t._c=new M,void 0!=r&&c(r,v,t[E],t)}),g("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in w&&(!m||"clear"!=e)&&s(y.prototype,e,function(r,n){if(l(this,y,e),!t&&m&&!d(r))return"get"==e&&void 0;var a=this._c[e](0===r?0:r,n);return t?this:a})}),m||p(y.prototype,"size",{get:function(){return this._c.size}})):(y=h.getConstructor(t,e,v,E),u(y.prototype,r),o.NEED=!0),f(y,e),S[e]=y,a(a.G+a.W+a.F,S),m||h.setStrong(y,e,v),y}},166:function(e,t,r){var n=r(17),a=r(184);e.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return a(this)}}},167:function(e,t,r){"use strict";var n=r(10);e.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},168:function(e,t,r){"use strict";var n=r(10),a=r(12),o=r(11),i=r(24);e.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,s,u=arguments[1];return a(this),t=void 0!==u,t&&a(u),void 0==e?new this:(r=[],t?(n=0,s=o(u,arguments[2],2),i(e,!1,function(e){r.push(s(e,n++))})):i(e,!1,r.push,r),new this(r))}})}},176:function(e,t,r){e.exports=r(0)(116)},177:function(e,t,r){e.exports=r(0)(193)},178:function(e,t,r){e.exports=r(0)(393)},1785:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(103),a=function(e){return e&&e.__esModule?e:{default:e}}(n);window.Logger("model")("recentService/recentList");t.default=function(){var e={},t={},r={},n=function(){};return n.prototype={initAtMap:function(){e={}},updateAtMap:function(t,r){if(Object.type(t)===Object.type.ARRAY)for(var n=0;n<t.length;n++)e[t[n]]=r[n];else e[t]=r;return(0,a.default)({},e)},deleteAtMap:function(t){return delete e[t],(0,a.default)({},e)},getAtMap:function(){return(0,a.default)({},e)},initUnReadNumMap:function(){t={}},updateUnReadNumMap:function(e,r){if(Object.type(e)===Object.type.ARRAY)for(var n=0;n<e.length;n++)t[e[n]]=r[n];else t[e]=r;return(0,a.default)({},t)},deleteUnReadNumMap:function(e){return delete t[e],(0,a.default)({},t)},getUnReadNumMap:function(){return(0,a.default)({},t)},initUnReadApplyGroupNotifyNumMap:function(){r={}},updateUnReadApplyGroupNotifyNumMap:function(e,t){if(Object.type(e)===Object.type.ARRAY)for(var n=0;n<e.length;n++)r[e[n]]=t[n];else r[e]=t;return(0,a.default)({},r)},deleteUnReadApplyGroupNotifyNumMap:function(e){return delete r[e],(0,a.default)({},r)},getUnReadApplyGroupNotifyNumMap:function(){return(0,a.default)({},r)}},new n}()},1786:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(973),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=window.Logger("recent")("recentUpdateSubscribe");t.default=function(){var e={},t=function(){};return t.prototype={initRecentUpdateSubscribeMap:function(){o.info("initRecentUpdateSubscribeMap"),e={}},subscribeRecentUpdate:function(t){var r=t.describe,n=t.callback;if(o.info("subscribeRecentUpdate",r),isNullOrEmpty(r)||isNullOrEmpty(n))return void o.info("subscribeRecentUpdate args is wrong",r,isNullOrEmpty(n));e[r]?o.info("subscribeRecentUpdate describe is already exist",r):e[r]=n},unSubscribeRecentUpdate:function(t){var r=t.describe;if(o.info("unSubscribeRecentUpdate",r),isNullOrEmpty(r))return void o.info("unSubscribeRecentUpdate args is wrong",r);delete e[r]},getAllSubscribeRecentUpdate:function(){return isNullOrEmpty(e)?(o.info("getAllSubscribeRecentUpdate there is not this group's subscribe "),[]):(0,a.default)(e)}},new t}()},1787:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),a=function(e){return e&&e.__esModule?e:{default:e}}(n);t.default=function(){var e=0,t=0,r=0,n=null,o=function(){};return o.prototype.getLocalTime=function(){return Date.now()+e},o.prototype.getMergeTime=function(){return e},o.prototype.initLocalTimeService=function(){clearTimeout(n),e=0,t=0},o.prototype.startLocalTimeService=function(){var o=this;return window.isEserverOnline?(new coreTup.HWTupIM).then(function(e){return t=Date.now(),e.getServiceUtcTime()}).then(function(i){if(clearTimeout(n),isNullOrEmpty(i))r++;else{var s=i.result,u=i.param,c=Math.floor((Date.now()+t)/2);s===constant.ERROR_CODE.Success&&1===u.result?e=u.utc_time-c:(e=0,r++)}return r>=3?o.initLocalTimeService():n=setTimeout(function(){!window.isOffline&&o.startLocalTimeService()},59e3),a.default.resolve()}):(n=setTimeout(function(){o.startLocalTimeService()},59e3),a.default.resolve())},new o}()},1788:function(e,t,r){"use strict";function n(e){o.info("tipTouchStartListen"),(0,a.setTipPosition)({showTips:!1,obj:0,message:0,havCopy:!1,havWithdraw:!1})}Object.defineProperty(t,"__esModule",{value:!0}),t.tipLiten=void 0;var a=r(573),o=window.Logger("logic")("IM/recentChatKeyboard");t.tipLiten=function(){window.addEventListener("touchstart",n)}},1789:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dealCopy=void 0;var n=r(1187),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n),o=window.Logger("logic")("IM/dealCopy");t.dealCopy=function(e){o.info("dealCopy 执行复制操作"),appService.doCopy(null,e.show_text),document.execCommand("Copy"),a.setTipPosition({showTips:!1,obj:0,message:0,havCopy:!1,havWithdraw:!1})}},179:function(e,t,r){var n=r(11),a=r(180),o=r(111),i=r(28),s=r(181);e.exports=function(e,t){var r=1==e,u=2==e,c=3==e,l=4==e,d=6==e,f=5==e||d,p=t||s;return function(t,s,g){for(var _,h,v=o(t),m=a(v),M=n(s,g,3),y=i(m.length),E=0,w=r?p(t,y):u?p(t,0):void 0;y>E;E++)if((f||E in m)&&(_=m[E],h=M(_,E,v),e))if(r)w[E]=h;else if(h)switch(e){case 3:return!0;case 5:return _;case 6:return E;case 2:w.push(_)}else if(l)return!1;return d?-1:c||l?l:w}}},1790:function(e,t,r){"use strict"},1791:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.addAvatarDownloadAckFunc=t.addAvatarDownloadFunc=t.clearModalFocusFunc=t.getModalFocusFunc=t.setModalFocusFunc=void 0;var a=r(1198),o=n(a),i=r(1196),s=n(i),u=r(1197),c=n(u);t.setModalFocusFunc=o.default.setModalFocusFunc,t.getModalFocusFunc=o.default.getModalFocusFunc,t.clearModalFocusFunc=o.default.clearModalFocusFunc,t.addAvatarDownloadFunc=s.default.addAvatarDownloadFunc,t.addAvatarDownloadAckFunc=c.default.addAvatarDownloadAckFunc},1792:function(e,t,r){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.reLoginToeServer=t.loginToeServer=t.eserverLogout=t.registerEvent=t.switchToNexteServer=void 0;var a=r(3),o=n(a),i=r(103),s=n(i),u=r(104),c=n(u),l=r(98),d=n(l),f=r(127),p=n(f),g=r(1),_=n(g),h=r(2),v=n(h),m=t.switchToNexteServer=function(){var e=(0,v.default)(_.default.mark(function e(t){var r,n,a,o,i,s,u,c,l,d,f,g,h,v=t.errorCode,M=t.account,w=t.password,S=t.socketMode,I=t.accessAddress,b=t.isResume;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=coreAccount.getLoginModel(),n=void 0,n=r.isBuildStgSuc?r.eserverStgUri.split(";"):S===constant.IM_STG_MODE.USE_TLS?r.maaProxyUrlAll.split(";"):r.eServerAddressAll.split(";"),a=r.httpsProxyAll.split(";"),o=r.currentNum,y.info("switchToNexteServer index:"+o+",errorCode:"+v+",entity.isBuildStgSuc:"+r.isBuildStgSuc),y.info("eserverUriList.length: "+n.length+", httpsProxyList.length: "+a.length+", entity.mainSiteSum: "+r.mainSiteSum),(107===v||28===v)&&o<r.mainSiteSum?o=r.mainSiteSum:o+=1,!(o<n.length&&o>0)){e.next=31;break}if(i=n[o],!isNullOrEmpty(i)){e.next=22;break}return s=r.eServerAddress,u=r.eServerPort,y.info("isNullOrEmpty, continue to next"),r.currentNum=o,r.eServerAddress=s,r.eServerPort=u,e.next=19,m({errorCode:v,account:M,password:w,socketMode:S,accessAddress:I,isResume:b});case 19:return e.abrupt("return",e.sent);case 22:return c=i.split(":"),l=(0,p.default)(c,2),d=l[0],f=l[1],g=d,h=parseInt(f),r.currentNum=o,r.eServerAddress=g,r.eServerPort=h,e.abrupt("return",E({account:M,password:w,eServerAddress:g,eServerPort:h,socketMode:S,accessAddress:I,isResume:b}));case 29:e.next=39;break;case 31:if(coreAccount.EErrorCode.IM_E_LOGING_RESULT_TIMEOUT!==v){e.next=37;break}return y.info("switchToNexteServer fail 11"),window.isEserverOnline=!1,e.abrupt("return",T({errorCode:coreAccount.EErrorCode.IM_E_LOGING_RESULT_TIMEOUT,isResume:b}));case 37:return y.info("switchToNexteServer fail else"),e.abrupt("return",T({errorCode:v,isResume:b}));case 39:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),M=(t.loginToeServer=function(){var e=(0,v.default)(_.default.mark(function e(){var t,r,n,a,o,i,s,u,c,l,d,f,g,h,v,m,S;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return coreUt.utEventStart(constant.EVENT_ID.UT_LOGIN,constant.UT_LOGIN_SERVER_NAME.UT_ESERVER_SERVER,[constant.UT_LOGIN_SERVER_NAME.UT_ESERVER_SERVER]),t=coreAccount.getLoginModel(),r=t.eServerAddress,n=t.eServerPort,a=t.socketMode,o=t.maaProxyAddress,i=t.maaProxyPort,s=t.account,u=t.sipUri,c=t.isResume,y.info("[ loginToeServer ]",handlePhoneNumber(s)),e.next=5,coreSecurity.PasswordManager.getPassword("password");case 5:return l=e.sent,y.info("[ loginToeServer ] eserverLogin socketMode : "+a+"; 0.no stg; 1.stg; 2.tls"),d="",f="",isNullOrEmpty(u)||(g=u.split(";"),!isNullOrEmpty(g)&&g.length>0&&(h=g[0].split(":"),v=(0,p.default)(h,2),d=v[0],f=v[1])),a===constant.IM_STG_MODE.USE_TLS&&(r=o,n=i),e.next=12,E({account:s,password:l,eServerAddress:r,eServerPort:n,socketMode:a,accessAddress:d,isResume:c});case 12:if(m=e.sent,y.info("[ loginToeServer ] eserverRet.result: "+m.result),!m.result){e.next=21;break}return e.next=17,w();case 17:if(S=e.sent){e.next=20;break}return e.abrupt("return",T({errorCode:"LOGIN_LOCALIP_GET_FAILED",isResume:c}));case 20:(0,M.umserverLogin)(s);case 21:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.reLoginToeServer=function(){var e=(0,v.default)(_.default.mark(function e(){var t,r,n,a,o,i,s,u,c,l,d,f,g,h,v,m;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=coreAccount.getLoginModel(),r=t.eServerAddress,n=t.eServerPort,a=t.socketMode,o=t.maaProxyAddress,i=t.maaProxyPort,s=t.account,u=t.sipUri,y.info("[ reLoginToeServer ]",handlePhoneNumber(s)),e.next=4,coreSecurity.PasswordManager.getPassword("password");case 4:return c=e.sent,y.info("[ reLoginToeServer ] eserverLogin socketMode : "+a+"; 0.no stg; 1.stg; 2.tls"),l="",d="",isNullOrEmpty(u)||(f=u.split(";"),!isNullOrEmpty(f)&&f.length>0&&(g=f[0].split(":"),h=(0,p.default)(g,2),l=h[0],d=h[1])),a===constant.IM_STG_MODE.USE_TLS&&(r=o,n=i),e.next=11,E({account:s,password:c,eServerAddress:r,eServerPort:n,socketMode:a,accessAddress:l,isResume:!0});case 11:if(v=e.sent,y.info("[ reLoginToeServer ] eserverRet.result: "+v.result),!v.result){e.next=20;break}return e.next=16,w();case 16:if(m=e.sent){e.next=19;break}return e.abrupt("return",T({errorCode:"LOGIN_LOCALIP_GET_FAILED",isResume:!0}));case 19:(0,M.umserverLogin)(s);case 20:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),r(1200)),y=window.Logger("logic")("login/eserver"),E=function(){var t=(0,v.default)(_.default.mark(function t(r){var n,a,o,i,s,u,c,l=r.account,d=r.password,f=r.eServerAddress,p=r.eServerPort,g=r.socketMode,h=r.accessAddress,v=r.isResume;return _.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new coreTup.HWTupIM;case 2:if(n=t.sent,a=window.SERVERCONFIG,!1!==v){t.next=7;break}return t.next=7,n.setlogparam({log_path:window.LOG_PATH+"\\",log_level:1,max_size_kb:5120,file_count:3});case 7:if(window.CLIENTCONFIG.ISMOBILE&&v){t.next=12;break}return t.next=10,n.init();case 10:return t.next=12,n.setdispatchmessage(0);case 12:return y.info("[ loginToeServer ] eserverLogin eServerAddress="+f+", eServerPort="+p+", socketMode="+g+"(0.no stg; 1.stg; 2.tls),isResume="+v),t.next=15,n.activateP2PPort(!1);case 15:if(1!==g){t.next=20;break}return t.next=18,n.setNetAccessMode(0);case 18:return t.next=20,n.setserveraddress(f,1*p);case 20:return t.next=22,n.setNetAccessMode(g);case 22:if(g!==constant.IM_STG_MODE.USE_TLS){t.next=25;break}return t.next=25,n.setTlsParam({tls_verision:4,tls_verify_mode:$getState().login.isSupportCACertCheck?0:1,root_cert_path:window.EXEC_PATH,client_cert_path:"",client_key_path:"",client_privkey_pwd:""});case 25:return t.next=27,n.setserveraddress(f,1*p);case 27:return o=constant.LOGIN_TYPE.BASE===a.HWUC?"":d,i=constant.LOGIN_TYPE.BASE===a.HWUC?4:1,s={account:l,password:o,version:"3.1.0.200",auth_type:i,language:"zh-cn",client_desc:window.CLIENTCONFIG.ISMOBILE?constant.CLIENT_DESC.MOBILE:constant.CLIENT_DESC.PC,client_type:window.CLIENTCONFIG.ISMOBILE?constant.CLIENT_TYPE.MOBILE:constant.CLIENT_TYPE.PC,ticket:"",token:new e(coreAccount.getLoginModel().authToken,"base64").toString(),access_address:h,support_batch_notifygroup:!0},window.CLIENTCONFIG.ISMOBILE&&window.device&&window.device.uuid&&(s.device_id=window.device.uuid),t.next=33,n.login(s);case 33:if(u=t.sent){t.next=41;break}return y.info("222 eserverLogin"),t.next=38,m({errorCode:coreAccount.EErrorCode.IM_E_LOGING_RESULT_TIMEOUT,account:l,password:d,socketMode:g,accessAddress:h,isResume:v});case 38:return t.abrupt("return",t.sent);case 41:if(0!==u.result&&4!==u.result){t.next=50;break}return y.info("login-eserver-result: ",u.result),window.isEserverOnline=!0,window.CLIENTCONFIG.ISMOBILE&&(u.param.terminal_login_info&&u.param.terminal_login_info.length>0?(c=u.param.terminal_login_info.findIndex(function(e){return 0===e.client_type}),c>=0?coreAccount.refreshIsMultiDeviceLogined(!0):coreAccount.refreshIsMultiDeviceLogined(!1)):coreAccount.refreshIsMultiDeviceLogined(!1)),coreUt.utEventFinish(constant.EVENT_ID.UT_LOGIN,constant.UT_LOGIN_SERVER_NAME.UT_ESERVER_SERVER,[1],!0),coreUt.utHandleMobileSystemBroken(),t.abrupt("return",{result:!0});case 50:if(y.error("eserverLogin errorCode = "+u.param.reason),window.isEserverOnline=!1,107!==u.param.reason&&28!==u.param.reason){t.next=59;break}return y.error("eserverLogin switchToNexteServer"),t.next=56,m({errorCode:u.param.reason,account:l,password:d,socketMode:g,accessAddress:h,isResume:v});case 56:return t.abrupt("return",t.sent);case 59:return y.error("eserverLogin LoginError"),coreUt.utEventFinish(constant.EVENT_ID.UT_LOGIN,constant.UT_LOGIN_SERVER_NAME.UT_ESERVER_SERVER,[0,u.param.reason]),t.abrupt("return",T({errorCode:u.param.reason,isResume:v}));case 62:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),w=function(){var e=(0,v.default)(_.default.mark(function e(){var t,r,n,a,o,i,s,u,c,l,d;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y.info("getserviceprofile"),t=coreAccount.getLoginModel(),window.localIp){e.next=4;break}return e.abrupt("return",!1);case 4:return e.next=6,new coreTup.HWTupIM;case 6:return r=e.sent,e.next=9,r.getserviceprofile({is_sync_all:1,need_icon:0,is_vpn_access:0,time_stamp:"19000000000000",local_ip:window.localIp});case 9:if(n=e.sent,a=n.param,o=a.func_id_list,i=void 0===o?[]:o,coreSetting.dealFuncIdList(i),s=a.sip_server.split(":"),u=(0,p.default)(s,2),c=u[0],l=u[1],d={},d=1===window.SERVERCONFIG.HWUC?{sipUri:a.sip_server,sipImpi:a.sip_account,sipAccount:a.sip_account,sipPasswordType:0,sipOutgoingAccCode:a.sip_outgoing_acc_code,sipServerAddress:c,sipServerPort:parseInt(l),umHttpServerUri:a.um_server_http_list,umHttpsServerUri:a.um_server_https_list}:{sipOutgoingAccCode:a.sip_outgoing_acc_code,umHttpServerUri:a.um_server_http_list,umHttpsServerUri:a.um_server_https_list},t.set(d),e.t0=a.sip_password,!e.t0){e.next=21;break}return e.next=21,coreSecurity.PasswordManager.setPassword("sipPassword",a.sip_password);case 21:return e.abrupt("return",!0);case 22:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),S=function(){window.CLIENTCONFIG.ISMOBILE||win.isFocused()||win.flashFrame(!0)},I=function(){var e=(0,v.default)(_.default.mark(function e(t){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreAccount.changeAutoLogin();case 2:window.goRoute(t);case 3:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),T=(t.registerEvent=function(){var e=(0,v.default)(_.default.mark(function e(){var t,r;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,y.info("registerEvent"),e.next=4,new coreTup.HWTupIM;case 4:return t=e.sent,window.imService=t,e.next=8,new coreTup.HWTupOfflineFile;case 8:if(r=e.sent,window.SERVERCONFIG.HWUC){e.next=12;break}return e.next=12,coreIm.localTimeService.startLocalTimeService();case 12:return e.next=14,t.setBasicImEvent({onHeartBeat:function(e){y.debug("onHeartBeat",e),window.dispatchEvent((0,d.default)(new Event("heartBeart"),{data:e}))},onKickOut:function(e){y.info("onKickOut"),coreAccount.clearResumeService(),coreAccount.stopResume(),coreAccount.checkAndEndCall().then(function(){coreAccount.setOffline(!1,!1,!1),window.endCallPromise&&(window.endCallPromise=null)}).then(function(){var t=this;if(!window.CLIENTCONFIG.ISBIGWIN){window.CLIENTCONFIG.ISMOBILE||(appService.showMainWindow(!0),window.setMainSize());var r=coreAccount.getLoginModel().isRememberPassword,n=window.CLIENTCONFIG.ISMOBILE?"loginCtn":"login";switch(e.param.exit_flag){case 0:r?window.CLIENTCONFIG.ISMOBILE?window.confirm(language.LOGIN_LOGGEDON_ANOTHER,{rightButton:""+language.LOG_IN_AGAIN}).then(function(e){e.ret?coreAccount.doLogin():I(n)}):alert(language.LOGIN_LOGGEDON_ANOTHER).then(function(){I(n)}):alert(language.LOGIN_LOGGEDON_ANOTHER).then(function(){var e=(0,v.default)(_.default.mark(function e(r){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r.ret&&I(n);case 1:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}());break;case 2:alert(language.LOGIN_LOGGEDON_PAUSEOFFLINE).then(function(){var e=(0,v.default)(_.default.mark(function e(r){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r.ret&&I(n);case 1:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}());break;default:alert(language.LOGIN_LOGGEDON_OVERDUEOFFLINE).then(function(){var e=(0,v.default)(_.default.mark(function e(r){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r.ret&&I(n);case 1:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}())}}})},onMultiDevice:function(e){y.debug("onMultiDevice",e),coreAccount.handleMultiDeviceMsg(e)},onGeneral:function(e){y.debug("onGeneral",e),e.param&&2===e.param.flag&&window.dispatchEvent(new Event("sessionTimeout"))},onTlsStateChange:function(){y.debug("onTlsStateChange"),window.dispatchEvent(new Event("tlsStateChange"))},onAddFriend:function(e){y.debug("onAddFriend",e)},onUserStatusList:(window.CLIENTCONFIG.ISMOBILE,function(e){var t={},r=e.param.userstatus_list;r&&r.forEach(function(e){(0,d.default)(t,(0,c.default)({},e.origin,{status:e.status,desc:e.desc,client_type:e.client_type}))}),$dispatch(coreUi.updataContactStatusMap(t)),y.debug("onUserStatusList",e)}),onUserInfoChange:function(e){y.debug("onUserInfoChange",e),coreContact.dealUserInfoChange(e)},onCodeChat:function(){var e=(0,v.default)(_.default.mark(function e(t){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:S(),y.debug("onCodeChat",t),coreIm.dealCodeChat(t);case 3:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),onChatList:function(e){S(),y.debug("onChatList",(0,s.default)({},e)),coreIm.dealChatList(e)},onMsgSendAck:function(e){y.debug("onMsgSendAck",e),coreIm.dealSendMessageAck(e)},onUnDeliver:function(e){y.debug("onUnDeliver 消息未送达",e)},onMsgRead:function(e){y.debug("onMsgRead",e),coreIm.dealMsgRead(e)},onWithdrawNotify:function(e){y.debug("onWithdrawNotify",e),coreIm.dealWithdrawMessageNotify(e)},onWithdrawAck:function(e){y.debug("onWithdrawAck",e),coreIm.dealWithdrawMessageAck(e)}});case 14:return e.next=16,t.setGroupImEvent({onApplyJoinFixedGroupResult:function(e){y.debug("onApplyJoinFixedGroupResult 群成员收到管理员审批加入固定群通知的响应",e),coreGroup.dealApplyJoinFixedGroupResult(e)},onFixedGroupLeaveResult:function(e){y.debug("onFixedGroupLeaveResult 用户主动离开固定群通知",(0,s.default)({},e)),coreGroup.dealFixedGroupLeaveResult(e)},onFixedGroupMemberAdd:function(e){y.debug("onFixedGroupMemberAdd 固定群添加成员通知",e),coreGroup.dealFixedGroupMemberAdd(e)},onFixedGroupWasAddedToGroup:function(e){y.debug("onFixedGroupWasAddedToGroup 被添加到固定群通知",e),coreGroup.dealFixedGroupWasAddedToGroup(e)},onDiscussGroupAddMember:function(e){y.debug("onDiscussGroupAddMember 讨论组成员列表添加成员变更消息",e),coreGroup.dealDiscussGroupAddMember(e)},onDiscussGroupWasAddToGroup:function(e){y.debug("onDiscussGroupWasAddToGroup 被添加到讨论组通知",e),coreGroup.dealDiscussGroupWasAddToGroup(e)},onFixedGroupMemberDel:function(e){y.debug("onFixedGroupMemberDel 群组中删除成员通知",e),coreGroup.dealFixedGroupMemberDel(e)},onFixedGroupKickout:function(e){y.debug("onFixedGroupKickout 管理员收到用户被踢出固定群结果通知",e),coreGroup.dealFixedGroupKickout(e)},onFixedGroupInfoChg:function(e){y.debug("onFixedGroupInfoChg 固定群信息修改通知",e),coreGroup.dealFixedGroupInfoChg(e)},onDiscussGroupInfoChg:function(e){y.debug("onDiscussGroupInfoChg 讨论组信息更新",e),coreGroup.dealDiscussGroupInfoChg(e)},onFixedGroupOwnerChg:function(e){y.debug("onFixedGroupOwnerChg 群组管理员变更通知",e),coreGroup.dealFixedGroupOwnerChg(e)},onDiscussGroupOwnerChange:function(e){y.debug("onDiscussGroupOwnerChange 讨论组管理员变更",e),coreGroup.dealDiscussGroupOwnerChange(e)},onFixedGroupDismiss:function(e){y.debug("onFixedGroupDismiss 固定群解散通知",e),coreGroup.dealFixedGroupDismiss(e)},onDiscussGroupDismiss:function(e){y.debug("onDiscussGroupDismiss 讨论组解散通知",e),coreGroup.dealDiscussGroupDismiss(e)},onReceiveInviteToFixedGroup:function(e){y.debug("onReceiveInviteToFixedGroup 用户收到管理员邀请通知",e),coreGroup.dealReceiveInviteToFixedGroup(e)},onReceiveInviteJoinFixedGroup:function(e){y.debug("onReceiveInviteJoinFixedGroup 管理员收到用户申请加入群组通知",e),coreGroup.dealReceiveInviteJoinFixedGroup(e)},onFixedGroupOwnerInviteResult:function(e){y.debug("onFixedGroupOwnerInviteResult 管理员收到用户对邀请加入固定群审批结果",e),coreGroup.dealFixedGroupOwnerInviteResult(e)},onDiscussGroupDelMember:function(e){y.debug("onDiscussGroupDelMember 讨论组其他成员会收到删除成员通知",e),coreGroup.dealDiscussGroupDelMember(e)},onDiscussGroupBroadcast:function(e){y.debug("onDiscussGroupBroadcast",e),coreGroup.dealDiscussGroupBroadcast(e)}});case 16:return e.next=18,r.setOfflineFileNotifyEvent({onOffLineRspNotify:function(e){window.CLIENTCONFIG.ISMOBILE||win.setProgressBar(-1),y.debug("onOffLineRspNotify",e),coreIm.dealOffLineRspNotify(e)},onOffLineProgNotify:function(e){y.debug("onOffLineProgNotify",e),coreIm.dealOffLineProgressNotify(e)}});case 18:return e.next=20,t.setdispatchmessage(1);case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),y.error("registerEvent",e.t0.toString());case 25:case"end":return e.stop()}},e,void 0,[[0,22]])}));return function(){return e.apply(this,arguments)}}(),t.eserverLogout=function(){var e=(0,v.default)(_.default.mark(function e(){var t,r;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new coreTup.HWTupIM;case 2:return t=e.sent,r=PromiseObject(),e.next=6,t.logout(null,r.resolve());case 6:return window.isEserverOnline=!1,e.abrupt("return",r);case 8:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),function(e){var t=e.isResume,r=e.errorCode,n=function(e){return y.error((t?"Resume eServerLoginError":"eServerLoginError")+": ["+e+"]")},a=void 0;switch(r){case"LOGIN_ADDRESS_OR_PORT_EMPTY":a=language.LOGIN_ADDRESS_OR_PORT_EMPTY,n("LOGIN_ADDRESS_OR_PORT_EMPTY");break;case"LOGIN_ACCOUNT_OR_PASSWORD_EMPTY":a=language.LOGIN_ACCOUNT_OR_PASSWORD_EMPTY,n("LOGIN_ACCOUNT_OR_PASSWORD_EMPTY");break;case"LOGIN_LOCALIP_GET_FAILED":a=language.LOGIN_LOCALIP_GET_FAILED,n("LOGIN_LOCALIP_GET_FAILED");break;case constant.ESERVER_LOGIN_ERROR.IM_E_LOGING_RESULT_TIMEOUT:a=language.LOGIN_ERR_NETWORK_ERROR,n("LOGIN_ERR_NETWORK_ERROR");break;case constant.ESERVER_LOGIN_ERROR.IM_E_LOGING_RESULT_PASSWORD_ERROR:n("IM_E_LOGING_RESULT_PASSWORD_ERROR"),a=language.LOGIN_USERPWD_ERROR;break;case constant.ESERVER_LOGIN_ERROR.IM_E_LOGING_RESULT_FAILED:n("IM_E_LOGING_RESULT_FAILED"),a=language.LOGIN_USERPWD_ERROR;break;case constant.ESERVER_LOGIN_ERROR.IM_E_LOGING_RESULT_ACCOUNT_NOT_EXIST:n("IM_E_LOGING_RESULT_ACCOUNT_NOT_EXIST"),a=language.LOGIN_USERPWD_ERROR;break;case constant.ESERVER_LOGIN_ERROR.IM_E_LOGING_RESULT_NEED_NEW_VERSION:n("IM_E_LOGING_RESULT_NEED_NEW_VERSION"),a=language.LOGIN_NEED_NEW_VERSION;break;case constant.ESERVER_LOGIN_ERROR.IM_E_LOGING_RESULT_NOT_ACTIVE:n("IM_E_LOGING_RESULT_NOT_ACTIVE"),a=language.LOGIN_ACCOUNT_ERROR;break;case constant.ESERVER_LOGIN_ERROR.IM_E_LOGING_RESULT_ACCOUNT_SUSPEND:n("IM_E_LOGING_RESULT_ACCOUNT_SUSPEND"),a=language.LOGIN_ACCOUNT_ERROR;break;case constant.ESERVER_LOGIN_ERROR.IM_E_LOGING_RESULT_ACCOUNT_LOCKED:n("IM_E_LOGING_RESULT_ACCOUNT_LOCKED"),a=language.LOGIN_ACCOUNT_ERROR;break;case constant.ESERVER_LOGIN_ERROR.IM_E_LOGING_RESULT_ACCOUNT_EXPIRE:n("IM_E_LOGING_RESULT_ACCOUNT_EXPIRE"),a=language.LOGIN_ACCOUNT_ERROR;break;default:a=language.LOGIN_FAILED,n(" Unhandle errorCode:"+r+" ")}return o.default.reject({errorCode:"LOGIN_LOCALIP_GET_FAILED",errorMessage:a,isResume:t})})}).call(t,r(116).Buffer)},1793:function(e,t,r){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.umserverLogout=t.loginUmServer=t.umserverLogin=void 0;var a=r(1),o=n(a),i=r(127),s=n(i),u=r(2),c=n(u),l=window.Logger("logic")("login/umserver"),d=(t.umserverLogin=function(){var t=(0,c.default)(o.default.mark(function t(){var r,n,a,i,u,c,f,p,g,_,h,v,m,M,y,E,w,S,I,T,b,L,O,R,N,A,C,x,P,D,F,U,k,G,H,B,Y,j,$=arguments.length>0&&void 0!==arguments[0]?arguments[0]:coreAccount.getLoginModel().account;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return l.info("umserverLogin"),r=coreAccount.getLoginModel(),t.next=4,coreSecurity.PasswordManager.getPassword("password");case 4:return n=t.sent,a=r.authToken,i=r.umHttpServerUri,u=r.umHttpsServerUri,c=r.httpsProxy,f=r.user_ticket,p=new e(a,"base64").toString(),g=window.SERVERCONFIG,_=0===g.HWUC?p:n,h=0===g.HWUC?"4":"1",v=0===g.HWUC?2:1,m=N?2:1,M=0,y="",E=1,w="",S="",c&&(I=c.split(":"),T=(0,s.default)(I,2),w=T[0],S=T[1],l.info("http reverse proxy ip = "+handlePhoneNumber(w)+" port: "+S)),b={reverse_proxy_ip:w,reverse_proxy_port:S?parseInt(S):0},L={server_url:i.map(function(e){return e.um_server_addr?{ui_host_port:0,host_ip:e.um_server_addr.split("://")[1].split(":")[0],pc_url:e.um_server_addr}:(l.error("umserverLogin umHttpServerUri is empty"),{ui_host_port:0,host_ip:e.um_server_addr,pc_url:e.um_server_addr})})||[],ul_cnt:1},O={server_url:u.map(function(e){return e.um_server_addr?{ui_host_port:0,host_ip:e.um_server_addr.split("://")[1].split(":")[0],pc_url:e.um_server_addr}:(l.error("umserverLogin umHttpsServerUri is empty"),{ui_host_port:0,host_ip:e.um_server_addr,pc_url:e.um_server_addr})})||[],ul_cnt:1},R=coreAccount.getLoginModel(),N=R.isSupportCACertCheck,A=R.isSupportProxy,C=R.proxyAddress,x=R.proxyPort,P=R.proxyAccount,t.next=22,coreSecurity.PasswordManager.getPassword("proxyPassword");case 22:D=t.sent,F=window.EXEC_PATH,l.info("caPath is:  "+F),U={proxy_ip:"",proxy_port:0,proxy_auth_mode:0,proxy_user_name:"",proxy_password:""},A&&(U.proxy_ip=C||"",U.proxy_port=parseInt(x)||0,U.proxy_auth_mode=1,U.proxy_user_name=P||"",U.proxy_password=D||""),k=coreIm.getOfflineFileConfig(),G="espace",H=void 0,B="",!1===k?(l.info("umserverLogin uportal未下发云盘参数"),r.isOAuth&&(coreIm.setUmServerFlag(!1),v=1,h="4",M=1,y=f||"")):(v=1,h="4",M=1,y=p,coreIm.setUmServerFlag(!1),l.info("umserverLogin uportal下发云盘参数，使用该参数登录云盘"),G=k.onebox_app_id,H=k.onebox_server_addr,B="CloudEC",L={server_url:[{ui_host_port:0,host_ip:H,pc_url:"http://"+H}],ul_cnt:1},O={server_url:[{ui_host_port:0,host_ip:H,pc_url:"https://"+H}],ul_cnt:1},E=0),Y="",t.t0=window.CLIENTCONFIG.PLATFORM,t.next="win"===t.t0?34:"mac"===t.t0?34:"android"===t.t0?36:"ios"===t.t0?38:40;break;case 34:return Y="pc",t.abrupt("break",41);case 36:return Y="android",t.abrupt("break",41);case 38:return Y="ios",t.abrupt("break",41);case 40:return t.abrupt("break",41);case 41:return j={login_name:$,device_type:Y,kia_disabled:1,device_os:navigator.platform,device_sn:coreCommon.zip(window.CLIENTCONFIG.PLATFORM+window.localIp+navigator.platform),app_name:G,pass_word:_,access_token:y,login_type:h,en_server_mode:v,local_ip:window.localIp,ca_cert_path:F,server_domain:B,en_tls_mode:m,is_sso_login:M,http_ser_list:L,https_ser_list:O,reverse_proxy:b,proxy:U,part_trans:E},t.abrupt("return",d(j,0));case 43:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),t.loginUmServer=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a,i;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.info("loginUmServer tryCount:"+r),e.next=3,new coreTup.HWTupOfflineFile;case 3:return n=e.sent,a={en_level:3,log_file_size:3,pcfile_path:window.LOG_PATH},n.openlog(a),e.next=8,n.login(t);case 8:if(i=e.sent,0!==i.result){e.next=14;break}return l.info("loginUmServer success ",{result:i.result,loginInfo:{login_type:t.login_type,en_server_mode:t.en_server_mode}}),e.abrupt("return",{result:!0});case 14:if(!(r<=6)){e.next=21;break}return r++,e.next=18,sleep(3e3);case 18:return e.abrupt("return",d(t,r));case 21:return l.error("loginUmServer failed ",{result:i.result,loginInfo:{login_type:t.login_type,en_server_mode:t.en_server_mode}}),e.abrupt("return",{result:!1});case 23:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}());t.umserverLogout=function(){var e=(0,c.default)(o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new coreTup.HWTupOfflineFile;case 2:return t=e.sent,e.next=5,t.logout();case 5:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}()}).call(t,r(116).Buffer)},1794:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var a=r(1),o=n(a),i=r(2),s=n(i),u=function(){var e=(0,s.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.code){e.next=12;break}e.t0=t.event,e.next="uportal"===e.t0?4:"detectFirewall"===e.t0?6:"buildStg"===e.t0?7:"total"===e.t0?8:9;break;case 4:return(0,c.loadLocalRecentList)(),e.abrupt("break",10);case 6:case 7:case 8:case 9:return e.abrupt("break",10);case 10:e.next=12;break;case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),c=(r(1199),r(983));window.Logger("logic")("im/moduleMessenger");coreCommon.registeModuleListener("login",u)},1795:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ImImpl=t.getImApi=void 0;var a=r(95),o=n(a),i=r(4),s=n(i),u=r(93),c=n(u),l=r(94),d=n(l),f=r(1796),p=n(f),g=r(1201),_=(window.Logger("Im")("logic"),void 0),h=(t.getImApi=function(){return isNullOrEmpty(_)&&(_=new h),_},t.ImImpl=function(e){function t(){var e,r,n,a;(0,s.default)(this,t);for(var i=arguments.length,u=Array(i),l=0;l<i;l++)u[l]=arguments[l];return r=n=(0,c.default)(this,(e=t.__proto__||(0,o.default)(t)).call.apply(e,[this].concat(u))),n.startRecord=function(e,t,r){return(0,g.startRecord)(e,t,r)},n.stopRecord=function(e,t,r){return(0,g.stopRecord)(e,t,r)},a=r,(0,c.default)(n,a)}return(0,d.default)(t,e),t}(p.default))},1796:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(95),o=n(a),i=r(4),s=n(i),u=r(93),c=n(u),l=r(94),d=n(l),f=(r(1201),function(e){function t(){var e,r,n,a;(0,s.default)(this,t);for(var i=arguments.length,u=Array(i),l=0;l<i;l++)u[l]=arguments[l];return r=n=(0,c.default)(this,(e=t.__proto__||(0,o.default)(t)).call.apply(e,[this].concat(u))),n.startRecord=function(e,t,r){},n.stopRecord=function(e,t,r){},a=r,(0,c.default)(n,a)}return(0,d.default)(t,e),t}(coreCommon.Interface));t.default=f},1797:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=window.Logger("im/logic")("record/recordMediaManage");t.startRecord=function(e,t,r){try{if(n.info("startRecord",e),"ios"===window.CLIENTCONFIG.PLATFORM)window.startRecordAudio(filePath,t,r);else if("android"===window.CLIENTCONFIG.PLATFORM){var a={filePath:e};window.audiorecord.start(a,t,r)}}catch(e){return n.error("startRecord has error",e,"so deal data init"),""}},t.stopRecord=function(e,t,r){n.info("stopRecord"),"ios"===window.CLIENTCONFIG.PLATFORM?window.stopRecordAudio(e):"android"===window.CLIENTCONFIG.PLATFORM&&window.audiorecord.stop(t,r)}},180:function(e,t,r){e.exports=r(0)(154)},181:function(e,t,r){var n=r(182);e.exports=function(e,t){return new(n(e))(t)}},182:function(e,t,r){var n=r(15),a=r(183),o=r(6)("species");e.exports=function(e){var t;return a(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!a(t.prototype)||(t=void 0),n(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},183:function(e,t,r){e.exports=r(0)(399)},184:function(e,t,r){var n=r(24);e.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},187:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.setIsTwoToThree=t.showCurrentRecentDetail=t.changeHintsShow=t.refreshPhoneRecent=t.markRecentAsRead=t.updateRecent=t.dealRecentByAddGroup=t.hasRecentFixedToTop=t.fixGroupToTop=t.hasGroupFixedToTop=t.fixRecentToTop=t.onTabClick=t.updateMessageToRecent=t.refreshRecentList=t.refreshRecentIsMute=t.selectRecentItem=t.deleteUnReadApplyGroupNotifyNumMap=t.updateUnReadApplyGroupNotifyNumMap=t.deleteUnReadNumMap=t.updateUnReadNumMap=t.deleteAtMap=t.updateAtMap=t.setMessageNotifyClose=t.initNewConversationUI=t.openRecentConversation=t.toggleRecent=t.dealRecentByDeleteGroup=t.deleteRecent=t.dealServerRecentList=t.getImExtendInfo=t.getLocalRecent=t.dealUnreadMessageNum=t.dealRecentLastContactName=t.dealCurrentRecentLastMessageInfo=t.dealRecentLastMessageInfo=t.createOrGetRecentByMessage=t.createOrUpdateRecent=void 0;var a=r(800),o=n(a),i=r(1194),s=n(i);t.createOrUpdateRecent=o.createOrUpdateRecent,t.createOrGetRecentByMessage=o.createOrGetRecentByMessage,t.dealRecentLastMessageInfo=o.dealRecentLastMessageInfo,t.dealCurrentRecentLastMessageInfo=o.dealCurrentRecentLastMessageInfo,t.dealRecentLastContactName=o.dealRecentLastContactName,t.dealUnreadMessageNum=o.dealUnreadMessageNum,t.getLocalRecent=o.getLocalRecent,t.getImExtendInfo=o.getImExtendInfo,t.dealServerRecentList=o.dealServerRecentList,t.deleteRecent=o.deleteRecent,t.dealRecentByDeleteGroup=o.dealRecentByDeleteGroup,t.toggleRecent=o.toggleRecent,t.openRecentConversation=o.openRecentConversation,t.initNewConversationUI=o.initNewConversationUI,t.setMessageNotifyClose=o.setMessageNotifyClose,t.updateAtMap=o.updateAtMap,t.deleteAtMap=o.deleteAtMap,t.updateUnReadNumMap=o.updateUnReadNumMap,t.deleteUnReadNumMap=o.deleteUnReadNumMap,t.updateUnReadApplyGroupNotifyNumMap=o.updateUnReadApplyGroupNotifyNumMap,t.deleteUnReadApplyGroupNotifyNumMap=o.deleteUnReadApplyGroupNotifyNumMap,t.selectRecentItem=o.selectRecentItem,t.refreshRecentIsMute=o.refreshRecentIsMute,t.refreshRecentList=o.refreshRecentList,t.updateMessageToRecent=o.updateMessageToRecent,t.onTabClick=o.onTabClick,t.fixRecentToTop=o.fixRecentToTop,t.hasGroupFixedToTop=o.hasGroupFixedToTop,t.fixGroupToTop=o.fixGroupToTop,t.hasRecentFixedToTop=o.hasRecentFixedToTop,t.dealRecentByAddGroup=o.dealRecentByAddGroup,t.updateRecent=o.updateRecent,t.markRecentAsRead=o.markRecentAsRead,t.refreshPhoneRecent=o.refreshPhoneRecent,t.changeHintsShow=o.changeHintsShow,t.showCurrentRecentDetail=s.showCurrentRecentDetail,t.setIsTwoToThree=s.setIsTwoToThree},193:function(e,t,r){e.exports={default:r(194),__esModule:!0}},194:function(e,t,r){r(25),r(23),e.exports=r(195)},195:function(e,t,r){var n=r(17),a=r(6)("iterator"),o=r(18);e.exports=r(8).isIterable=function(e){var t=Object(e);return void 0!==t[a]||"@@iterator"in t||o.hasOwnProperty(n(t))}},197:function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},213:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.groupFileQuery=t.groupFileReportDeleteResult=t.groupFilePreDelete=t.groupFileReportUploadResult=t.groupFilePreUpload=t.withdrawIm=t.registerPush=t.clientRepot=t.queryHistoryMessage=t.sendImMessage=void 0;var o=r(3),i=a(o),s=r(1),u=a(s),c=r(98),l=a(c),d=r(2),f=a(d),p=r(156),g=r(159),_=n(g),h=r(572),v=r(135),m=n(v),M=r(187),y=window.Logger("logic")("IM/Tup参数规范层");t.sendImMessage=function(){var e=(0,f.default)(u.default.mark(function e(t){var r,n,a,o,i,s;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,y.info("sendImMessage"),r=new Blob([t.content],{type:"text/plain"}),!(r.size>1024*parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.limitBody"]))){e.next=8;break}y.error("sendImMessage",language.CHECK_IM_MESSAGE_CONTENT_SIZE+window.CLIENTCONFIG["Device.ComCfg.IM.limitBody"]+"KB"),window.alert(language.CHECK_IM_MESSAGE_CONTENT_SIZE+window.CLIENTCONFIG["Device.ComCfg.IM.limitBody"]+"KB"),e.next=32;break;case 8:return n=["chat_type","client_chat_id","content","content_type","group_id","media_type","origin","source_flag","target","display_name","utc_stamp","at_user_list"],e.next=11,new coreTup.HWTupIM;case 11:return a=e.sent,o=(0,l.default)({},t,{source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT}),i={},n.forEach(function(e){if("display_name"===e)return i[e]=o.name;i[e]=o[e]}),_.setSendingMessage(o.client_chat_id,o),e.next=18,a.sendim(i);case 18:if(!(s=e.sent)||s.result!==constant.ERROR_CODE.Success){e.next=24;break}o.send_status=constant.SEND_STATUS.success,_.setSendingMessage(o.client_chat_id,o),e.next=32;break;case 24:return s&&y.error("sendImMessage error",s.result),o.send_status=constant.SEND_STATUS.error,o.utc_time=h.localTimeService.getLocalTime(),e.next=29,coreDb.saveMessage(o);case 29:o=e.sent,m.isBelongToCurrentRecent(o)&&((0,p.initLoadMore)(),(0,p.updateMessageList)(o)),(0,M.updateMessageToRecent)(o);case 32:e.next=37;break;case 34:e.prev=34,e.t0=e.catch(0),y.error("sendImMessage",e.t0.toString());case 37:case"end":return e.stop()}},e,void 0,[[0,34]])}));return function(t){return e.apply(this,arguments)}}(),t.queryHistoryMessage=function(e){try{return y.info("queryHistoryMessage"),(new coreTup.HWTupIM).then(function(t){return t.queryhistorymessage({operation_type:e.operation_type,msg_type:e.message_type,sender:e.sender,msg_id:0,str_msgid:e.server_chat_id_str||"0",count:e.count||(window.CLIENTCONFIG.ISMOBILE?window.CLIENTCONFIG.MOBILE_MESSAGE_LIST_PAGE_SIZE:window.CLIENTCONFIG.MESSAGE_LIST_PAGE_SIZE)})}).then(function(e){if(e){var t=e.param;if(e.result===constant.ERROR_CODE.Success){var r=t.chat_info_list;return i.default.resolve(r||[])}}return i.default.resolve([])})}catch(e){return y.error("queryHistoryMessage",e.toString()),i.default.resolve([])}},t.clientRepot=function(){var e=(0,f.default)(u.default.mark(function e(t){var r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new coreTup.HWTupIM;case 2:return r=e.sent,e.next=5,r.clientReport(t);case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.registerPush=function(){var e=(0,f.default)(u.default.mark(function e(t){var r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new coreTup.HWTupIM;case 2:return r=e.sent,e.next=5,r.registerPush(t);case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.withdrawIm=function(){var e=(0,f.default)(u.default.mark(function e(t){var r,n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,y.info("withdrawIm"),e.next=4,new coreTup.HWTupIM;case 4:return r=e.sent,e.next=7,r.withdrawIm(t);case 7:n=e.sent,a=n?n.result:"",a!==constant.ERROR_WITHDRAW_CODE.SUCCESS&&(window.CLIENTCONFIG.ISMOBILE?window.Toast(language.WITHDRAW_ERROR,2,!1):window.Toast(language.WITHDRAW_ERROR,2,!1,"WhiteWarning"),y.error("withdrawIm 消息撤回失败",a)),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),y.error("withdrawIm",e.t0.toString());case 15:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t){return e.apply(this,arguments)}}(),t.groupFilePreUpload=function(e){try{return y.info("groupFilePreUpload"),(new coreTup.HWTupIM).then(function(t){return t.groupFilePreUpload({group_id:e.group_id,file_name:e.file_name,file_size:e.file_size})}).then(function(e){if(e){var t=e.param,r=e.result;if(r===constant.ERROR_CODE.Success){var n=t.pre_file_id;return i.default.resolve(n||"")}y.error("groupFilePreUpload 预上传群共享文件失败",r.toString())}return i.default.resolve("")})}catch(e){return y.error("groupFilePreUpload",e.toString()),i.default.resolve("")}},t.groupFileReportUploadResult=function(e){try{return y.info("groupFileReportUploadResult"),(new coreTup.HWTupIM).then(function(t){return t.groupFileReportUploadResult({prefile_id:e.prefile_id,group_id:e.group_id,upload_user_account:e.upload_user_account,file_name:e.file_name,file_size:e.file_size,file_url:e.file_url,result:e.result})}).then(function(e){if(e){var t=e.param,r=e.result;if(r===constant.ERROR_CODE.Success)return i.default.resolve(t||"");y.error("groupFileReportUploadResult 通知服务器群共享上传文件的结果失败",r.toString())}return i.default.resolve({})})}catch(e){return y.error("groupFileReportUploadResult",e.toString()),i.default.resolve({})}},t.groupFilePreDelete=function(e){try{return y.info("groupFilePreDelete"),(new coreTup.HWTupIM).then(function(t){return t.groupFilePreDelete({file_id:e.file_id,group_id:e.group_id})}).then(function(e){if(e){var t=e.param;return i.default.resolve(t||{})}return i.default.resolve({})})}catch(e){return y.error("groupFilePreDelete",e.toString()),i.default.resolve({})}},t.groupFileReportDeleteResult=function(e){try{return y.info("groupFileReportDeleteResult"),(new coreTup.HWTupIM).then(function(t){return t.groupFileReportDeleteResult({file_id:e.file_id,group_id:e.group_id})}).then(function(e){if(e){var t=e.param;return i.default.resolve(t||{})}return i.default.resolve({})})}catch(e){return y.error("groupFileReportDeleteResult",e.toString()),i.default.resolve({})}},t.groupFileQuery=function(e){try{return y.info("groupFileQuery"),(new coreTup.HWTupIM).then(function(t){return t.groupFileQuery({group_id:e.group_id,query_key:e.query_key,query_type:e.query_type,offset:e.offset,count:e.count})}).then(function(e){if(e){var t=e.param;return i.default.resolve(t||{})}return i.default.resolve({})})}catch(e){return y.error("groupFileQuery",e.toString()),i.default.resolve({})}}},215:function(e,t,r){"use strict";function n(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function a(e){var t=n(e),r=t[0],a=t[1];return 3*(r+a)/4-a}function o(e,t,r){return 3*(t+r)/4-r}function i(e){for(var t,r=n(e),a=r[0],i=r[1],s=new f(o(e,a,i)),u=0,c=i>0?a-4:a,l=0;l<c;l+=4)t=d[e.charCodeAt(l)]<<18|d[e.charCodeAt(l+1)]<<12|d[e.charCodeAt(l+2)]<<6|d[e.charCodeAt(l+3)],s[u++]=t>>16&255,s[u++]=t>>8&255,s[u++]=255&t;return 2===i&&(t=d[e.charCodeAt(l)]<<2|d[e.charCodeAt(l+1)]>>4,s[u++]=255&t),1===i&&(t=d[e.charCodeAt(l)]<<10|d[e.charCodeAt(l+1)]<<4|d[e.charCodeAt(l+2)]>>2,s[u++]=t>>8&255,s[u++]=255&t),s}function s(e){return l[e>>18&63]+l[e>>12&63]+l[e>>6&63]+l[63&e]}function u(e,t,r){for(var n,a=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(s(n));return a.join("")}function c(e){for(var t,r=e.length,n=r%3,a=[],o=0,i=r-n;o<i;o+=16383)a.push(u(e,o,o+16383>i?i:o+16383));return 1===n?(t=e[r-1],a.push(l[t>>2]+l[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],a.push(l[t>>10]+l[t>>4&63]+l[t<<2&63]+"=")),a.join("")}t.byteLength=a,t.toByteArray=i,t.fromByteArray=c;for(var l=[],d=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=0,_=p.length;g<_;++g)l[g]=p[g],d[p.charCodeAt(g)]=g;d["-".charCodeAt(0)]=62,d["_".charCodeAt(0)]=63},216:function(e,t){t.read=function(e,t,r,n,a){var o,i,s=8*a-n-1,u=(1<<s)-1,c=u>>1,l=-7,d=r?a-1:0,f=r?-1:1,p=e[t+d];for(d+=f,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+e[t+d],d+=f,l-=8);for(i=o&(1<<-l)-1,o>>=-l,l+=n;l>0;i=256*i+e[t+d],d+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return i?NaN:1/0*(p?-1:1);i+=Math.pow(2,n),o-=c}return(p?-1:1)*i*Math.pow(2,o-n)},t.write=function(e,t,r,n,a,o){var i,s,u,c=8*o-a-1,l=(1<<c)-1,d=l>>1,f=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,g=n?1:-1,_=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,i=l):(i=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-i))<1&&(i--,u*=2),t+=i+d>=1?f/u:f*Math.pow(2,1-d),t*u>=2&&(i++,u/=2),i+d>=l?(s=0,i=l):i+d>=1?(s=(t*u-1)*Math.pow(2,a),i+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,a),i=0));a>=8;e[r+p]=255&s,p+=g,s/=256,a-=8);for(i=i<<a|s,c+=a;c>0;e[r+p]=255&i,p+=g,i/=256,c-=8);e[r+p-g]|=128*_}},217:function(e,t,r){e.exports={default:r(391),__esModule:!0}},232:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={indexOf:function(e,t){var r=void 0,n=void 0;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var n=void 0,a=void 0;if(Array.prototype.forEach)return e.forEach(t,r);for(n=0,a=e.length;n<a;n++)t.call(r,e[n],n,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,r=t.exec(e);return r?r.index:-1},isNull:function(e){return void 0===e||null===e}}},391:function(e,t,r){r(32),r(23),r(25),r(392),r(393),r(394),r(395),e.exports=r(8).Map},392:function(e,t,r){"use strict";var n=r(164),a=r(134);e.exports=r(165)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=n.getEntry(a(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(a(this,"Map"),0===e?0:e,t)}},n,!0)},393:function(e,t,r){var n=r(10);n(n.P+n.R,"Map",{toJSON:r(166)("Map")})},394:function(e,t,r){r(167)("Map")},395:function(e,t,r){r(168)("Map")},417:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getGroupSpaceUrl=t.getCloudSpaceUrl=t.deleteFile=t.releaseFile=t.downloadFile=t.uploadFile=void 0;var a=r(1),o=n(a),i=r(2),s=n(i),u=r(873),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(u),l=window.Logger("logic")("IM/offlineFileTup参数规范层"),d=(t.uploadFile=function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l.info("uploadFile"),e.next=4,new coreTup.HWTupOfflineFile;case 4:if(r=e.sent,t.group_id=t.group_id||"",t.file_type=t.file_type||"",t.file_name=t.file_name||"",t.file_path=t.file_path||"",t.operation_token=t.operation_token||"",""!==t.file_type&&t.file_type!==constant.UPLOAD_FILE_TYPE.NORMAL){e.next=14;break}t.group_id="",e.next=17;break;case 14:if(""!==t.group_id&&""!==t.operation_token){e.next=17;break}return l.error("uploadFile 上传群文件参数错误group_id:"+t.group_id),e.abrupt("return",!1);case 17:return e.next=19,r.uploadfile(t);case 19:return n=e.sent,e.abrupt("return",c.checkOfflineFileRequest(n));case 23:return e.prev=23,e.t0=e.catch(0),l.error("uploadFile",e.t0.toString()),e.abrupt("return",!1);case 27:case"end":return e.stop()}},e,void 0,[[0,23]])}));return function(t){return e.apply(this,arguments)}}(),t.downloadFile=function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n,a,i,s,u,f,p;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l.info("downloadFile isThumbnail",t.isThumbnail),e.next=4,new coreTup.HWTupOfflineFile;case 4:return r=e.sent,n={},a="",a=(window.CLIENTCONFIG.ISMOBILE,isNullOrEmpty(t.isThumbnail)||!t.isThumbnail?"":"thumbnail"),""===a?n={access_code:t.access_code,url:t.url,path:t.path,pctype:"",pcheight:"",pcwidth:""}:window.CLIENTCONFIG.ISBIGWIN||window.CLIENTCONFIG.ISWIN||window.CLIENTCONFIG.ISMAC?(i=d(t.path),s=i?"":"260",a=i?"":"thumbnail",n={access_code:t.access_code,url:t.url,path:t.path,pctype:a,pcheight:s,pcwidth:s}):(u=d(t.path),f=u?"":"260",a=u?"":"thumbnail",n={access_code:t.access_code,url:t.url,path:t.path,pctype:a,pcheight:f,pcwidth:f}),e.next=11,r.downloadfile(n);case 11:return p=e.sent,e.abrupt("return",c.checkOfflineFileRequest(p));case 15:e.prev=15,e.t0=e.catch(0),l.error("downloadFile",e.t0.toString());case 18:case"end":return e.stop()}},e,void 0,[[0,15]])}));return function(t){return e.apply(this,arguments)}}(),function(e){if(isNullOrEmpty(e))return!1;var t=e.split(".");return/(gif|GIF)$/.test(t[t.length-1].toUpperCase())});t.releaseFile=function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l.info("releaseFile"),e.next=4,new coreTup.HWTupOfflineFile;case 4:return r=e.sent,e.next=7,r.release({file_handle:t.file_handle});case 7:return n=e.sent,e.abrupt("return",c.checkOfflineFileRequest(n));case 11:e.prev=11,e.t0=e.catch(0),l.error("releaseFile",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),t.deleteFile=function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l.info("deleteFile"),e.next=4,new coreTup.HWTupOfflineFile;case 4:return r=e.sent,e.next=7,r.deletefile({url:t.url});case 7:return n=e.sent,e.abrupt("return",c.checkOfflineFileRequest(n));case 11:e.prev=11,e.t0=e.catch(0),l.error("deleteFile",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),t.getCloudSpaceUrl=function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l.info("getCloudSpaceUrl"),e.next=4,new coreTup.HWTupOfflineFile;case 4:return r=e.sent,e.next=7,r.getCloudSpaceUrl({token:t,page:1,parent:0});case 7:return n=e.sent,e.abrupt("return",c.checkOfflineFileRequest(n));case 11:e.prev=11,e.t0=e.catch(0),l.error("getCloudSpaceUrl",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),t.getGroupSpaceUrl=function(){var e=(0,s.default)(o.default.mark(function e(t,r,n){var a,i;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l.info("getGroupSpaceUrl"),e.next=4,new coreTup.HWTupOfflineFile;case 4:return a=e.sent,e.next=7,a.getGroupSpaceUrl({token:t,teamspaceId:r,groupId:n});case 7:return i=e.sent,e.abrupt("return",c.checkOfflineFileRequest(i));case 11:e.prev=11,e.t0=e.catch(0),l.error("getGroupSpaceUrl",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t,r,n){return e.apply(this,arguments)}}()},484:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.transformGroupNotifyMessage=t.transformHtmlLike=t.transformHtmlEmotion=t.transformMessageContentEmotion=t.createVideoMessageContent=t.createLikeMessage=t.createMobileLikeMessage=t.createCallRecordMessage=t.createGroupMemberChgMessage=t.createGroupNotifyMessage=t.createFileMessageContent=t.formatSendImgInfo=t.createQuotePhotoTextMessageContent=t.createPhotoTextMessageContent=t.createFileMessage=t.createPhotoTextMessage=t.createMobileTextMessage=t.createNormalMessage=void 0;var a=r(985),o=n(a),i=r(1159),s=n(i);t.createNormalMessage=s.createNormalMessage,t.createMobileTextMessage=s.createMobileTextMessage,t.createPhotoTextMessage=s.createPhotoTextMessage,t.createFileMessage=s.createFileMessage,t.createPhotoTextMessageContent=s.createPhotoTextMessageContent,t.createQuotePhotoTextMessageContent=s.createQuotePhotoTextMessageContent,t.formatSendImgInfo=s.formatSendImgInfo,t.createFileMessageContent=s.createFileMessageContent,t.createGroupNotifyMessage=s.createGroupNotifyMessage,t.createGroupMemberChgMessage=s.createGroupMemberChgMessage,t.createCallRecordMessage=s.createCallRecordMessage,t.createMobileLikeMessage=s.createMobileLikeMessage,t.createLikeMessage=s.createLikeMessage,t.createVideoMessageContent=s.createVideoMessageContent,t.transformMessageContentEmotion=o.transformMessageContentEmotion,t.transformHtmlEmotion=o.transformHtmlEmotion,t.transformHtmlLike=o.transformHtmlLike,t.transformGroupNotifyMessage=o.transformGroupNotifyMessage},485:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.copyFile=t.rightMenuRelayMessage=t.clearNewMessageFromMessageList=t.addNewMessageIntoMessageList=t.setAndroidNotifyNewMessageNum=t.setUnreadNewMessageNum=t.showMessageToast=t.hideMessageToast=void 0;var a=r(156),o=n(a),i=r(871),s=n(i),u=window.Logger("logic")("IM/uiController"),c=null;window.isAppInBackground=!1,window.updateAppBackgourndMode=function(e){window.isAppInBackground!==e&&(window.isAppInBackground=e,u.info("updateAppBackgourndMode isAppInBackground: "+e),e?u.info("switch to background"):(u.info("switch to foreground"),appService.getStatusBarHeight(),appService.getScreenSize(),appService.getMobileInfo(),u.info("window.socketReadyState: ",window.socketReadyState),window.CLIENTCONFIG.ENABLE_IT_MEETING||window.isPluginEnv||(0!==coreCall.getCallCount()||coreConf.isInConf())&&(coreCommon.isSupportNativeProtocol()||"OPEN"!==window.socketReadyState)||coreAccount.doSipResumeAndEserverDetect("switch to foreground do sipResume"),f(0)))};var l=t.hideMessageToast=function(){$dispatch(coreUi.hideMessageToast()),c=null,delegate.UmFocus()},d=(t.showMessageToast=function(e){$dispatch(coreUi.showMessageToast(e)),c=setTimeout(l,window.CLIENTCONFIG.MESSAGE_TOAST_TIMEOUT)},t.setUnreadNewMessageNum=function(e){return $dispatch(coreUi.setUnreadNewMessageNum(e))}),f=t.setAndroidNotifyNewMessageNum=function(e){return $dispatch(coreUi.setAndroidNotifyNewMessageNum(e))};t.addNewMessageIntoMessageList=function(e){var t=$getState(),r=t.recent.isLoadMore;if(window.isAppInBackground){var n=t.IM.androidNotifyNewMessageNum;n++,f(n)}else f(0);if(r){u.info("addNewMessageIntoMessageList 显示新消息数量");var a=t.IM.unReadNewMessageNum;a++,d(a),o.setBackwardLoadMessage()}else u.info("addNewMessageIntoMessageList 加载新消息"),o.addNewMessage(e)},t.clearNewMessageFromMessageList=function(){d(0),s.loadHistoryMessageList()},t.rightMenuRelayMessage=function(e,t){return function(){try{u.info("userClick  IM rightclick relay"),u.info("relayMessage"),coreUi.initShowSelectBox(t)}catch(e){u.error("relayMessage",e.toString())}}},t.copyFile=function(e){return function(){try{u.info("userClick  IM rightclick copy file");var t=e.replace(/\\/g,"/"),r=clipBoard(t),n=r===e;u.info("Copy file/audio/video:",{result:n})}catch(e){u.error("copyFile",e.toString())}}}},486:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.downloadPhoto=t.groupFilePreUpload=t.downloadUMOriginPicture=t.dealOfflineFileSendFail=t.clearFileHandle=t.dealDownloadVideoImageSuccess=t.dealDownloadSuccess=t.dealUploadSuccess=t.dealScreenShotSendFailed=t.dealDownloadFileFailed=t.dealDownloadScreenShotFailed=t.dealVideoSendFailed=t.dealFileSendFailed=t.chooseUploadFile=t.openFolder=t.openFile=t.cancelSendFile=t.downloadMobileFile=t.saveAsImg=t.saveAsFile=t.rejectFile=t.receiveQuoteFile=t.receiveFile=t.reSendScreenShot=t.reSendFile=t.sendMobileVideos=t.sendAudio=t.sendMobilePhoto=t.sendMyVoice=t.sendFiles=void 0;var a=r(1164),o=n(a),i=r(994),s=n(i),u=r(995),c=n(u),l=r(1165),d=n(l),f=r(1166),p=n(f),g=r(1167),_=n(g),h=r(1168),v=n(h),m=r(513),M=n(m),y=r(874),E=n(y),w=r(1169),S=n(w);t.sendFiles=o.sendFiles,t.sendMyVoice=o.sendMyVoice,t.sendMobilePhoto=o.sendMobilePhoto,t.sendAudio=o.sendAudio,t.sendMobileVideos=o.sendMobileVideos,t.reSendFile=d.reSendFile,t.reSendScreenShot=d.reSendScreenShot,t.receiveFile=s.receiveFile,t.receiveQuoteFile=s.receiveQuoteFile,t.rejectFile=s.rejectFile,t.saveAsFile=s.saveAsFile,t.saveAsImg=s.saveAsImg,t.downloadMobileFile=c.downloadMobileFile,t.cancelSendFile=p.cancelSendFile,t.openFile=_.openFile,t.openFolder=_.openFolder,t.chooseUploadFile=v.chooseUploadFile,t.dealFileSendFailed=M.dealFileSendFailed,t.dealVideoSendFailed=M.dealVideoSendFailed,t.dealDownloadScreenShotFailed=M.dealDownloadScreenShotFailed,t.dealDownloadFileFailed=M.dealDownloadFileFailed,t.dealScreenShotSendFailed=M.dealScreenShotSendFailed,t.dealUploadSuccess=M.dealUploadSuccess,t.dealDownloadSuccess=M.dealDownloadSuccess,t.dealDownloadVideoImageSuccess=M.dealDownloadVideoImageSuccess,t.clearFileHandle=M.clearFileHandle,t.dealOfflineFileSendFail=M.dealOfflineFileSendFail,t.downloadUMOriginPicture=c.downloadUMOriginPicture,t.groupFilePreUpload=E.groupFilePreUpload,t.downloadPhoto=S.downloadPhoto},503:function(e,t,r){e.exports=r(0)(37)},513:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(){try{P.info("dealOfflineFileSendFail 处理离线后文件上传失败");var e=O.querySendingMessageMap();!isNullOrEmpty(e)&&(0,v.default)(e).forEach(function(t){var r=e[t],n=r.file_list[0];return coreDb.saveFile(n),O.deleteSendingMessage(r.client_chat_id),r.send_status=constant.SEND_STATUS.error,r.status=constant.MEDIA_STATUS.CANCEL_SEND,b(r,[n])})}catch(e){P.error("dealOfflineFileSendFail 处理离线后文件上传失败",e.toString())}}function i(e,t){try{P.info("dealDownloadFileFailed 处理文件下载失败"),O.deleteFileByHandleList([e.file_handle,t.client_chat_id]),p(e),coreDb.saveFile(e);var r=[],n=[];return C.isQuoteFile(e)?r.push(e):n.push(e),l(t,n,r)}catch(e){P.error("dealDownloadFileFailed 处理文件下载失败",e.toString())}}function s(e,t){try{if(P.info("dealDownloadScreenShotFailed 处理截图下载失败 message:"+Object.type(t)),isNullOrEmpty(t))return void P.error("dealDownloadScreenShotFailed 不存在此消息，忽略");O.deleteFileByHandleList([e.file_handle,t.client_chat_id]),p(e),coreDb.saveScreenShot(e);var r=[],n=[];return C.isQuoteFile(e)?r.push(e):n.push(e),l(t,n,r)}catch(e){P.error("dealDownloadScreenShotFailed 处理截图下载失败",e.toString())}}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return P.info("dealDownloadSuccess 下载成功后处理"),T(e,t,r,e.status)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return P.info("dealDownloadSuccess 下载成功后处理"),T(e,t,r,constant.MEDIA_STATUS.RECEIVE_SUCCESS)}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return P.info("dealDownloadFailed 下载失败后处理"),e.media_type===constant.MEDIA_TYPE.FILE&&window.ToastNew(language.PC_DOWNLOAD_FAILED),T(e,t,r,constant.MEDIA_STATUS.RECEIVE_ERROR)}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return P.info("dealUploadSuccess 上传成功后处理"),O.deleteFileByHandleList([t[0].file_handle,e.client_chat_id]),p(t[0]),e.send_status=constant.SEND_STATUS.success,e.status=constant.MEDIA_STATUS.SEND_SUCCESS,f(e,t)}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return P.info("dealUpload 上传后处理"),e.file_list=t,N.updateMessageList(e),e}function p(e){P.info("clearFileHandle 清理文件handle和进度handle"),O.deleteFileByHandle(e.file_handle),N.deleteProgressMap(e.file_handle),delete e.file_handle}Object.defineProperty(t,"__esModule",{value:!0}),t.checkFileTransferInCurrentRecent=t.dealUploadFailed=t.dealScreenShotSendFailed=t.dealOfflineFileSendOrReceiveFail=t.dealVideoSendFailed=t.dealFileSendFailed=void 0;var g=r(112),_=a(g),h=r(110),v=a(h),m=r(1),M=a(m),y=r(103),E=a(y),w=r(2),S=a(w),I=(t.dealFileSendFailed=function(){var e=(0,S.default)(M.default.mark(function e(t,r){return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,P.info("dealFileSendFailed 处理文件上传失败"),r.media_type!==constant.MEDIA_TYPE.PHOTO){e.next=8;break}return e.next=5,coreDb.saveScreenShot((0,E.default)({},t));case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,coreDb.saveFile((0,E.default)({},t));case 10:e.t0=e.sent;case 11:return t=e.t0,r.send_status=constant.SEND_STATUS.error,r.status=constant.MEDIA_STATUS.SEND_ERROR,e.abrupt("return",b(r,[t]));case 17:e.prev=17,e.t1=e.catch(0),P.error("dealFileSendFailed 处理文件上传失败",e.t1.toString());case 20:case"end":return e.stop()}},e,this,[[0,17]])}));return function(t,r){return e.apply(this,arguments)}}(),t.dealVideoSendFailed=function(){var e=(0,S.default)(M.default.mark(function e(t,r){var n;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,P.info("dealVideoSendFailed  处理视频上传失败"),n=t.file_list,!/\.png$/.test(r.file_real_save_name.toLocaleLowerCase())){e.next=9;break}return e.next=6,coreDb.saveScreenShot(r);case 6:n[1]=e.sent,e.next=12;break;case 9:return e.next=11,coreDb.saveFile(r);case 11:n[0]=e.sent;case 12:return O.deleteSendingMessage(t.client_chat_id),t.send_status=constant.SEND_STATUS.error,t.status=constant.MEDIA_STATUS.SEND_ERROR,e.abrupt("return",b(t,n));case 18:e.prev=18,e.t0=e.catch(0),P.error("dealVideoSendFailed  处理视频上传失败",e.t0.toString());case 21:case"end":return e.stop()}},e,this,[[0,18]])}));return function(t,r){return e.apply(this,arguments)}}(),t.dealOfflineFileSendOrReceiveFail=function(){var e=(0,S.default)(M.default.mark(function e(){return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o(),I();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),function(){var e=(0,S.default)(M.default.mark(function e(){var t,r,n,a,o,u,c,l,d,f;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,P.info("dealOfflineFileDownloadFail 处理离线后文件下载失败"),t=O.getFileHandleMap,!isNullOrEmpty(t)){e.next=5;break}return e.abrupt("return");case 5:r=(0,v.default)(t),n=!0,a=!1,o=void 0,e.prev=9,u=(0,_.default)(r);case 11:if(n=(c=u.next()).done){e.next=23;break}if(l=c.value,d=t[l],d.file_deal_type!==constant.FILE_DEAL_TYPE.DOWNLOAD&&d.file_deal_type!==constant.FILE_DEAL_TYPE.RE_DOWNLOAD){e.next=20;break}return e.next=17,coreDb.queryMessage({server_chat_id_str:d.message_server_chat_id_str});case 17:f=e.sent,O.deleteReceivingMessage(d.um_url),f.media_type===constant.MEDIA_TYPE.PHOTO_TEXT?s((0,E.default)({},d),f):i(f);case 20:n=!0,e.next=11;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(9),a=!0,o=e.t0;case 29:e.prev=29,e.prev=30,!n&&u.return&&u.return();case 32:if(e.prev=32,!a){e.next=35;break}throw o;case 35:return e.finish(32);case 36:return e.finish(29);case 37:e.next=42;break;case 39:e.prev=39,e.t1=e.catch(0),P.error("dealOfflineFileDownloadFail 处理离线后文件下载失败",e.t1.toString());case 42:case"end":return e.stop()}},e,this,[[0,39],[9,25,29,37],[30,,32,36]])}));return function(){return e.apply(this,arguments)}}()),T=(t.dealScreenShotSendFailed=function(){var e=(0,S.default)(M.default.mark(function e(t){var r,n,a,o,i,s,u;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(P.info("dealScreenShotSendFailed 处理截图上传失败"),r=t.file_list,n=!0,a=!1,o=void 0,e.prev=5,i=(0,_.default)(r);!(n=(s=i.next()).done);n=!0)u=s.value,O.deleteFileByHandle(u.file_handle),p(r[0]);e.next=13;break;case 9:e.prev=9,e.t0=e.catch(5),a=!0,o=e.t0;case 13:e.prev=13,e.prev=14,!n&&i.return&&i.return();case 16:if(e.prev=16,!a){e.next=19;break}throw o;case 19:return e.finish(16);case 20:return e.finish(13);case 21:return t.send_status=constant.SEND_STATUS.error,t.status=constant.MEDIA_STATUS.SEND_ERROR,e.next=25,coreDb.saveMessage(t);case 25:t=e.sent,(0,x.updateMessageToRecent)(t),N.updateMessageList(t);case 28:case"end":return e.stop()}},e,this,[[5,9,13,21],[14,,16,20]])}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,S.default)(M.default.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:constant.MEDIA_STATUS.RECEIVE_SUCCESS;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.info("dealDownload 下载后处理"),isNullOrEmpty(a)||(r=(0,E.default)({},t.quote),r.file_list=a,r.status=o,t.quote=r,coreDb.saveMessage(t.quote)),t.status=o,e.next=5,coreDb.saveMessage(t);case 5:t=e.sent,t.file_list=n,N.updateMessageList(t);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),b=t.dealUploadFailed=function(){var e=(0,S.default)(M.default.mark(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.info("dealUploadFailed 上传失败后处理"),r.forEach(function(e){O.deleteFileByHandleList([e.file_handle,t.client_chat_id]),p(e)}),e.next=4,coreDb.saveMessage(t);case 4:return t=e.sent,(0,x.updateMessageToRecent)(t),e.abrupt("return",f(t,r));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();t.checkFileTransferInCurrentRecent=function(){var e=(0,S.default)(M.default.mark(function e(t){var r,n,a,o,i,s,u,c,l,d,f,p,g,h,m,y,E,w,S;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O.querySendingMessageMap(),isNullOrEmpty(r)){e.next=30;break}n=(0,v.default)(r),a=!0,o=!1,i=void 0,e.prev=6,s=(0,_.default)(n);case 8:if(a=(u=s.next()).done){e.next=16;break}if(c=u.value,l=r[c],l.recent_owner!==t){e.next=13;break}return e.abrupt("return",!0);case 13:a=!0,e.next=8;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(6),o=!0,i=e.t0;case 22:e.prev=22,e.prev=23,!a&&s.return&&s.return();case 25:if(e.prev=25,!o){e.next=28;break}throw i;case 28:return e.finish(25);case 29:return e.finish(22);case 30:if(d=O.getFileHandleMap(),!isNullOrEmpty(d)){e.next=33;break}return e.abrupt("return",!1);case 33:f=(0,v.default)(d),p=!0,g=!1,h=void 0,e.prev=37,m=(0,_.default)(f);case 39:if(p=(y=m.next()).done){e.next=51;break}if(E=y.value,w=d[E],w.file_deal_type!==constant.FILE_DEAL_TYPE.DOWNLOAD&&w.file_deal_type!==constant.FILE_DEAL_TYPE.RE_DOWNLOAD){e.next=48;break}return e.next=45,coreDb.queryMessage({server_chat_id_str:w.message_server_chat_id_str});case 45:if(S=e.sent,S.recent_owner!==t){e.next=48;break}return e.abrupt("return",!0);case 48:p=!0,e.next=39;break;case 51:e.next=57;break;case 53:e.prev=53,e.t1=e.catch(37),g=!0,h=e.t1;case 57:e.prev=57,e.prev=58,!p&&m.return&&m.return();case 60:if(e.prev=60,!g){e.next=63;break}throw h;case 63:return e.finish(60);case 64:return e.finish(57);case 65:return e.abrupt("return",!1);case 66:case"end":return e.stop()}},e,this,[[6,18,22,30],[23,,25,29],[37,53,57,65],[58,,60,64]])}));return function(t){return e.apply(this,arguments)}}();t.dealOfflineFileSendFail=o,t.dealDownloadFileFailed=i,t.dealDownloadScreenShotFailed=s,t.dealDownloadVideoImageSuccess=u,t.dealDownloadSuccess=c,t.dealDownloadFailed=l,t.dealUploadSuccess=d,t.dealUpload=f,t.clearFileHandle=p;var L=r(159),O=n(L),R=r(156),N=n(R),A=r(135),C=n(A),x=r(187),P=(r(875),window.Logger("logic")("IM/file/libs"));window.offlineFail=o},538:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultCSSWhiteList=t.CSSFilter=void 0,t.default=function(e,t){return new a.default(t).process(e)};var n=r(830),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=r(539),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(o);t.CSSFilter=a.default,t.getDefaultCSSWhiteList=i.getDefaultCssWhiteList},539:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=t.getDefaultCssWhiteList=function(){var e={};return e.background=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e.border=!0,e["border-bottom"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-left"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-top"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-width"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e.clear=!0,e.color=!0,e.display=!0,e.font=!0,e["font-family"]=!0,e["font-size"]=!0,e["font-style"]=!0,e["font-weight"]=!0,e.height=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["max-height"]=!0,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e["text-decoration"]=!0,e["text-overflow"]=!0,e["text-wrap"]=!0,e.width=!0,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e},a=(t.onCssAttr=function(e,t,r){},t.onIgnoreCssAttr=function(e,t,r){},/javascript\s*:/gim);t.safeCssAttrValue=function(e,t){return a.test(t)?"":t},t.whiteList=n()},540:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.whiteList=t.stripBlankChar=t.stripCommentTag=t.StripTagBody=t.onIgnoreTagStripAll=t.escapeAttrValue=t.friendlyAttrValue=t.clearNonPrintableCharacter=t.escapeDangerHtml5Entities=t.escapeHtmlEntities=t.unescapeQuote=t.escapeQuote=t.safeAttrValue=t.escapeHtml=t.onDefaultIgnoreTagAttr=t.onDefaultTagAttr=t.onDefaultIgnoreTag=t.onDefaultTag=t.getDefaultWhiteList=void 0;var n=r(538),a=r(232),o=function(e){return e&&e.__esModule?e:{default:e}}(a),i=window.Logger("service/util")("XSS/defaultConfig");i.debug=Noop;var s=t.getDefaultWhiteList=function(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]}},u=new n.CSSFilter,c=(t.onDefaultTag=function(e,t,r){i.debug("onDefaultTag",e,t)},t.onDefaultIgnoreTag=function(e,t,r){i.debug("onDefaultIgnoreTag",e,t)},t.onDefaultTagAttr=function(e,t,r){i.debug("onDefaultTagAttr",e,t,r)},t.onDefaultIgnoreTagAttr=function(e,t,r){i.debug("onDefaultIgnoreTagAttr",e,t,r)},t.escapeHtml=function(e){return e.replace(l,"&lt;").replace(d,"&gt;")}),l=(t.safeAttrValue=function(e,t,r,n){if(r=T(r),"href"===t||"src"===t){if("#"===(r=o.default.trim(r)))return"#";if("http://"!==r.substr(0,7)&&"https://"!==r.substr(0,8)&&"mailto:"!==r.substr(0,7)&&"tel:"!==r.substr(0,4)&&"#"!==r[0]&&"/"!==r[0])return""}else if("background"===t){if(v.lastIndex=0,v.test(r))return""}else if("style"===t){if(m.lastIndex=0,m.test(r))return"";if(M.lastIndex=0,M.test(r)&&(v.lastIndex=0,v.test(r)))return"";!1!==n&&(n=n||u,r=n.process(r))}return r=b(r)},/</g),d=/>/g,f=/"/g,p=/&quot;/g,g=/&#([a-zA-Z0-9]*);?/gim,_=/&colon;?/gim,h=/&newline;?/gim,v=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,m=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,M=/u\s*r\s*l\s*\(.*/gi,y=t.escapeQuote=function(e){return e.replace(f,"&quot;")},E=t.unescapeQuote=function(e){return e.replace(p,'"')},w=t.escapeHtmlEntities=function(e){return e.replace(g,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})},S=t.escapeDangerHtml5Entities=function(e){return e.replace(_,":").replace(h," ")},I=t.clearNonPrintableCharacter=function(e){for(var t="",r=0,n=e.length;r<n;r++)t+=e.charCodeAt(r)<32?" ":e.charAt(r);return o.default.trim(t)},T=t.friendlyAttrValue=function(e){return e=E(e),e=w(e),e=S(e),e=I(e)},b=t.escapeAttrValue=function(e){return e=y(e),e=c(e)},L=(t.onIgnoreTagStripAll=function(){return""},t.StripTagBody=function(e,t){"function"!=typeof t&&(t=function(){});var r=!Array.isArray(e),n=function(t){return!!r||-1!==o.default.indexOf(e,t)},a=[],i=!1;return{onIgnoreTag:function(e,r,o){if(n(e)){if(o.isClosing){var s="[/removed]",u=o.position+s.length;return a.push([!1!==i?i:o.position,u]),i=!1,s}return i||(i=o.position),"[removed]"}return t(e,r,o)},remove:function(e){var t="",r=0;return o.default.forEach(a,function(n){t+=e.slice(r,n[0]),r=n[1]}),t+=e.slice(r)}}},t.stripCommentTag=function(e){return e.replace(L,"")},/<!--[\s\S]*?-->/g);t.stripBlankChar=function(e){var t=e.split("");return t=t.filter(function(e){var t=e.charCodeAt(0);return 127!==t&&(!(t<=31)||(10===t||13===t))}),t.join("")},t.whiteList=s()},571:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.changeShowRecentInfo=t.updateRecent=t.refreshRecentList=t.refreshRecentIsMute=t.selectRecentItem=t.deleteUnReadApplyGroupNotifyNumMap=t.updateUnReadApplyGroupNotifyNumMap=t.deleteUnReadNumMap=t.updateUnReadNumMap=t.deleteAtMap=t.updateAtMap=void 0;var a=r(1),o=n(a),i=r(103),s=n(i),u=r(2),c=n(u),l=r(981),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(l),f=window.Logger("logic")("recent/list"),p={key:[],val:[]},g=null,_={key:[],val:[]},h=null,v={key:[],val:[]},m=null;t.updateAtMap=function(e,t){clearTimeout(g),p.key.push(e),p.val.push(t),g=setTimeout(function(){d.updateAtMap(p.key,p.val),$dispatch(coreUi.updateRecent([])),p={key:[],val:[]}},50)},t.deleteAtMap=function(e){d.deleteAtMap(e),$dispatch(coreUi.updateRecent([]))},t.updateUnReadNumMap=function(e,t){clearTimeout(h),_.key.push(e),_.val.push(t),d.updateUnReadNumMap(_.key,_.val),_={key:[],val:[]},h=setTimeout(function(){$dispatch(coreUi.updateRecent([]))},50)},t.deleteUnReadNumMap=function(e){d.deleteUnReadNumMap(e),$dispatch(coreUi.updateRecent([]))},t.updateUnReadApplyGroupNotifyNumMap=function(e,t){clearTimeout(m),v.key.push(e),v.val.push(t),d.updateUnReadApplyGroupNotifyNumMap(v.key,v.val),v={key:[],val:[]},m=setTimeout(function(){$dispatch(coreUi.updateRecent([]))},50)},t.deleteUnReadApplyGroupNotifyNumMap=function(e){d.deleteUnReadApplyGroupNotifyNumMap(e),$dispatch(coreUi.updateRecent([]))},t.selectRecentItem=function(e){if(!isNullOrEmpty(e)){e.unread_num=0,e.set_unread_num=0,e.is_at=!1,f.debug("selectRecentItem 清除选中会话的未读消息以及at信息"),d.deleteUnReadNumMap(e.owner),d.deleteAtMap(e.owner);var t=$getState().recent.atMessageList,r=[];t.map(function(t){t.recent_owner!==e.owner&&r.push(t)}),$dispatch(coreUi.setAtMessageList(r))}$dispatch(coreUi.selectRecentItem(e))},t.refreshRecentIsMute=function(){var e=(0,c.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=$getState().recent.recentList,r.forEach(function(e){e.group_id===t&&(e.isMute=!e.isMute,$dispatch(coreUi.updateRecent((0,s.default)({},e))))});case 2:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.refreshRecentList=function(e){var t=$getState().recent.recentList;if(Object.type(e)===Object.type.ARRAY){var r=[],n=[];e.forEach(function(e){if(e.is_delete!==constant.IS_DELETE.YES){-1!==t.findIndex(function(t){return t.owner===e.owner})?n.push(e):r.push(e)}}),0!==n.length&&$dispatch(coreUi.updateRecent(n)),0!==r.length&&$dispatch(coreUi.addRecent(r))}else{if(e.is_delete===constant.IS_DELETE.YES)return;var a=t.findIndex(function(t){return t.owner===e.owner});-1!==a?(f.info("updateRecent",a),$dispatch(coreUi.updateRecent(e,a))):(f.info("addRecent"),$dispatch(coreUi.addRecent(e)))}},t.updateRecent=function(e){$dispatch(coreUi.updateRecent(e))},t.changeShowRecentInfo=function(){var e=$getState().recent.showRecentInfo;f.info("userClick changeShowRecentInfo",e),$dispatch(coreUi.changeShowRecentInfo(!e))}},572:function(e,t,r){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";window.Logger("model")("localTimeService").info(e+" initService"),o.default.initLocalTimeService()}Object.defineProperty(t,"__esModule",{value:!0}),t.localTimeService=void 0,t.initLocalTimeService=n;var a=r(1787),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.localTimeService=o.default},573:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.subscribeRecentList=t.subscribeUserStatusByAccounts=t.subscribeUserStatusByAccount=t.correctStatusDesc=t.randomLikeImg=t.sendLike=t.sendMobileLike=t.sendMobileVideoClick=t.sendPhotoClick=t.dealCopy=t.getCurrentStatus=t.createVideo=t.setTipPosition=t.removeEventListenerDealKeyBoardByNative=t.addEventListenerDealKeyBoardByNative=t.updateMessageList=t.updateMessageListByClientId=t.optionBtn=t.clearScreen=t.addNewMessage=t.deleteAtMessage=t.addAtMessage=t.tipLiten=t.clientRepot=t.registerPush=t.searchHistoryMessage=t.changeIndexOpt=t.downLoadOrginImageLogic=t.previewOption=t.checkEditorBeforeLogout=t.checkEditor=t.checkFileTransFer=t.copyFile=t.rightMenuRelayMessage=t.setUnreadNewMessageNum=t.clearNewMessageFromMessageList=t.hideMessageToast=t.showMessageToast=t.dealGroupNotify=t.removeUnReadMessageFlash=t.dealUnDealMessageList=t.dealMsgRead=t.dealChatList=t.dealCodeChat=t.dealSendMessageAck=t.dealOffLineRspNotify=t.dealOffLineProgressNotify=t.getImgList=t.backwardQueryMessage=t.forwardQueryMessage=t.loadHistoryMessageList=t.sendMobileVideos=t.dealOfflineFileSendFail=t.reSendScreenShot=t.downloadMobileFile=t.chooseUploadFile=t.openFolder=t.openFile=t.saveAsImg=t.saveAsFile=t.rejectFile=t.receiveQuoteFile=t.receiveFile=t.reSendFile=t.cancelSendFile=t.sendMyVoice=t.sendMobilePhoto=t.sendFiles=t.downloadUMOriginPicture=t.transformGroupNotifyMessage=t.dealWithdrawMessageNotify=t.dealWithdrawMessageAck=t.withdrawMessage=t.goToConversationMessage=t.goToMessage=t.createCallRecordMessage=t.createGroupMemberChgMessage=t.createGroupNotifyMessage=t.getMessageShowText=t.getMessageShowHtml=t.dealRecentLastMessageList=t.deleteMessage=t.relayMessage=t.reSendMessage=t.sendScreenShots=t.sendMobileTextMessage=t.sendNormalMessage=void 0;var a=r(1156),o=n(a),i=r(1179),s=n(i),u=r(574),c=n(u),l=r(871),d=n(l),f=r(486),p=n(f),g=r(485),_=n(g),h=r(873),v=n(h),m=r(1182),M=n(m),y=r(1183),E=n(y),w=r(213),S=n(w),I=r(1184),T=n(I),b=r(1185),L=(n(b),r(868)),O=n(L),R=r(156),N=n(R),A=r(1186),C=n(A),x=r(1188),P=n(x),D=r(1190),F=n(D);t.sendNormalMessage=c.sendNormalMessage,t.sendMobileTextMessage=c.sendMobileTextMessage,t.sendScreenShots=c.sendScreenShots,t.reSendMessage=c.reSendMessage,t.relayMessage=c.relayMessage,t.deleteMessage=c.deleteMessage,t.dealRecentLastMessageList=c.dealRecentLastMessageList,t.getMessageShowHtml=c.getMessageShowHtml,t.getMessageShowText=c.getMessageShowText,t.createGroupNotifyMessage=c.createGroupNotifyMessage,t.createGroupMemberChgMessage=c.createGroupMemberChgMessage,t.createCallRecordMessage=c.createCallRecordMessage,t.goToMessage=c.goToMessage,t.goToConversationMessage=c.goToConversationMessage,t.withdrawMessage=c.withdrawMessage,t.dealWithdrawMessageAck=c.dealWithdrawMessageAck,t.dealWithdrawMessageNotify=c.dealWithdrawMessageNotify,t.transformGroupNotifyMessage=c.transformGroupNotifyMessage,t.downloadUMOriginPicture=p.downloadUMOriginPicture,t.sendFiles=p.sendFiles,t.sendMobilePhoto=p.sendMobilePhoto,t.sendMyVoice=p.sendMyVoice,t.cancelSendFile=p.cancelSendFile,t.reSendFile=p.reSendFile,t.receiveFile=p.receiveFile,t.receiveQuoteFile=p.receiveQuoteFile,t.rejectFile=p.rejectFile,t.saveAsFile=p.saveAsFile,t.saveAsImg=p.saveAsImg,t.openFile=p.openFile,t.openFolder=p.openFolder,t.chooseUploadFile=p.chooseUploadFile,t.downloadMobileFile=p.downloadMobileFile,t.reSendScreenShot=p.reSendScreenShot,t.dealOfflineFileSendFail=p.dealOfflineFileSendFail,t.sendMobileVideos=p.sendMobileVideos,t.loadHistoryMessageList=d.loadHistoryMessageList,t.forwardQueryMessage=d.forwardQueryMessage,t.backwardQueryMessage=d.backwardQueryMessage,t.getImgList=d.getImgList,t.dealOffLineProgressNotify=o.dealOffLineProgressNotify,t.dealOffLineRspNotify=o.dealOffLineRspNotify,t.dealSendMessageAck=s.dealSendMessageAck,t.dealCodeChat=s.dealCodeChat,t.dealChatList=s.dealChatList,t.dealMsgRead=s.dealMsgRead,t.dealUnDealMessageList=s.dealUnDealMessageList,t.removeUnReadMessageFlash=s.removeUnReadMessageFlash,t.dealGroupNotify=s.dealGroupNotify,t.showMessageToast=_.showMessageToast,t.hideMessageToast=_.hideMessageToast,t.clearNewMessageFromMessageList=_.clearNewMessageFromMessageList,t.setUnreadNewMessageNum=_.setUnreadNewMessageNum,t.rightMenuRelayMessage=_.rightMenuRelayMessage,t.copyFile=_.copyFile,t.checkFileTransFer=v.checkFileTransFer,t.checkEditor=v.checkEditor,t.checkEditorBeforeLogout=v.checkEditorBeforeLogout,t.previewOption=M.previewOption,t.downLoadOrginImageLogic=M.downLoadOrginImageLogic,t.changeIndexOpt=M.changeIndexOpt,t.searchHistoryMessage=E.searchHistoryMessage,t.registerPush=S.registerPush,t.clientRepot=S.clientRepot,t.tipLiten=T.tipLiten,t.addAtMessage=O.addAtMessage,t.deleteAtMessage=O.deleteAtMessage,t.addNewMessage=N.addNewMessage,t.clearScreen=N.clearScreen,t.optionBtn=N.optionBtn,t.updateMessageListByClientId=N.updateMessageListByClientId,t.updateMessageList=N.updateMessageList,t.addEventListenerDealKeyBoardByNative=C.addEventListenerDealKeyBoardByNative,t.removeEventListenerDealKeyBoardByNative=C.removeEventListenerDealKeyBoardByNative,t.setTipPosition=C.setTipPosition,t.createVideo=C.createVideo,t.getCurrentStatus=C.getCurrentStatus,t.dealCopy=C.dealCopy,t.sendPhotoClick=C.sendPhotoClick,t.sendMobileVideoClick=C.sendMobileVideoClick,t.sendMobileLike=P.sendMobileLike,t.sendLike=P.sendLike,t.randomLikeImg=P.randomLikeImg,t.correctStatusDesc=F.correctStatusDesc,t.subscribeUserStatusByAccount=F.subscribeUserStatusByAccount,t.subscribeUserStatusByAccounts=F.subscribeUserStatusByAccounts,t.subscribeRecentList=F.subscribeRecentList},574:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.dealWithdrawMessageNotify=t.dealWithdrawMessageAck=t.withdrawMessage=t.goToConversationMessage=t.goToMessage=t.transformGroupNotifyMessage=t.createVideoMessageContent=t.createFileMessage=t.createQuotePhotoTextMessageContent=t.createFileMessageContent=t.createPhotoTextMessageContent=t.formatSendImgInfo=t.createCallRecordMessage=t.createGroupMemberChgMessage=t.createGroupNotifyMessage=t.deleteMessage=t.relayMessage=t.reSendMessage=t.dealRecentLastMessageList=t.dealHistoryMessageList=t.dealReceiveMessage=t.getMessageShowText=t.getMessageShowHtml=t.reSendScreenShots=t.sendScreenShots=t.sendMobileTextMessage=t.sendNormalMessage=void 0;var a=r(1157),o=n(a),i=r(1170),s=n(i),u=r(1174),c=n(u),l=r(1175),d=n(l),f=r(1176),p=n(f),g=r(484),_=n(g),h=r(1177),v=n(h),m=r(1178),M=n(m);t.sendNormalMessage=o.sendNormalMessage,t.sendMobileTextMessage=o.sendMobileTextMessage,t.sendScreenShots=o.sendScreenShots,t.reSendScreenShots=o.reSendScreenShots,t.getMessageShowHtml=s.getMessageShowHtml,t.getMessageShowText=s.getMessageShowText,t.dealReceiveMessage=s.dealReceiveMessage,t.dealHistoryMessageList=s.dealHistoryMessageList,t.dealRecentLastMessageList=s.dealRecentLastMessageList,t.reSendMessage=c.reSendMessage,t.relayMessage=d.relayMessage,t.deleteMessage=p.deleteMessage,t.createGroupNotifyMessage=_.createGroupNotifyMessage,t.createGroupMemberChgMessage=_.createGroupMemberChgMessage,t.createCallRecordMessage=_.createCallRecordMessage,t.formatSendImgInfo=_.formatSendImgInfo,t.createPhotoTextMessageContent=_.createPhotoTextMessageContent,t.createFileMessageContent=_.createFileMessageContent,t.createQuotePhotoTextMessageContent=_.createQuotePhotoTextMessageContent,t.createFileMessage=_.createFileMessage,t.createVideoMessageContent=_.createVideoMessageContent,t.transformGroupNotifyMessage=_.transformGroupNotifyMessage,t.goToMessage=v.goToMessage,t.goToConversationMessage=v.goToConversationMessage,t.withdrawMessage=M.withdrawMessage,t.dealWithdrawMessageAck=M.dealWithdrawMessageAck,t.dealWithdrawMessageNotify=M.dealWithdrawMessageNotify},583:function(e,t,r){"use strict";function n(e){if(Object.type(e)!==Object.type.XMLDOCUMENT||Object.type(e)!==Object.type.DOCUMENT)return!1;for(var t=a(e),r=0;r<t.length;r++)if(t[r]!==Object.type.TEXT)return!0;return!1}function a(e){function t(e){0===e.childNodes.length?r.push(Object.type(e)):e.childNodes.forEach(t)}var r=[];return Object.type(e)!==Object.type.XMLDOCUMENT&&Object.type(e)!==Object.type.DOCUMENT||t(e),r}Object.defineProperty(t,"__esModule",{value:!0}),t.checkXML=n;t.String2MessageXML=function(e){var t=/<r>[\s\S]*<\/r>/g.exec(e),r=isNullOrEmpty(t)?"":t[0],n=(new DOMParser).parseFromString(r,"text/xml");return isNullOrEmpty(n.querySelector("parsererror"))||n.querySelector("parsererror").remove(),n},t.String2XML=function(e){var t=/<imbody>[\s\S]*<\/imbody>/g.exec(e),r=isNullOrEmpty(t)?"":t[0],n=(new DOMParser).parseFromString(r,"text/xml");return isNullOrEmpty(n.querySelector("parsererror"))||n.querySelector("parsererror").remove(),n},t.XML2String=function(e){return(new XMLSerializer).serializeToString(e).replace(' xmlns="http://www.w3.org/1999/xhtml"',"")},t.String2HTML=function(e){if(-1!==e.indexOf("<!DOCTYPE"))return document.createTextNode(language.UNDER_ATTACK);if(""===e)return document.createTextNode(e);var t=(new DOMParser).parseFromString(e,"text/html");return""===e.replace(/\s/g,"")&&(t.querySelector("body").innerHTML=e),t.querySelector("body").childNodes.length>1?t.querySelector("body"):t.querySelector("body").childNodes[0]}},800:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.updateMessageToRecent=t.showGroupAddContact=t.onTabClick=t.markRecentAsRead=t.hasGroupFixedToTop=t.fixGroupToTop=t.hasRecentFixedToTop=t.fixRecentToTop=t.updateRecent=t.refreshRecentList=t.refreshRecentIsMute=t.selectRecentItem=t.deleteUnReadApplyGroupNotifyNumMap=t.updateUnReadApplyGroupNotifyNumMap=t.deleteUnReadNumMap=t.updateUnReadNumMap=t.deleteAtMap=t.updateAtMap=t.setMessageNotifyClose=t.initNewConversationUI=t.openRecentConversation=t.changeHintsShow=t.toggleRecent=t.dealRecentByAddGroup=t.dealRecentByDeleteGroup=t.deleteRecent=t.dealServerRecentList=t.getImExtendInfo=t.refreshPhoneRecent=t.getLocalRecent=t.dealRecentLastContactName=t.dealUnreadMessageNum=t.dealCurrentRecentLastMessageInfo=t.dealRecentLastMessageInfo=t.createOrGetRecentByMessage=t.createOrUpdateRecent=void 0;var o=r(1),i=a(o),s=r(2),u=a(s),c=r(801),l=n(c),d=r(1145),f=n(d),p=r(983),g=n(p),_=r(1155),h=n(_),v=r(571),m=n(v),M=r(1191),y=(n(M),r(1192)),E=n(y),w=r(1193),S=n(w),I=r(135),T=n(I),b=(window.Logger("logic")("recent/list"),t.createOrUpdateRecent=l.createOrUpdateRecent,t.createOrGetRecentByMessage=l.createOrGetRecentByMessage,t.dealRecentLastMessageInfo=l.dealRecentLastMessageInfo),L=(t.dealCurrentRecentLastMessageInfo=l.dealCurrentRecentLastMessageInfo,t.dealUnreadMessageNum=l.dealUnreadMessageNum,t.dealRecentLastContactName=l.dealRecentLastContactName,t.getLocalRecent=l.getLocalRecent),O=(t.refreshPhoneRecent=l.refreshPhoneRecent,t.getImExtendInfo=l.getImExtendInfo,t.dealServerRecentList=g.dealServerRecentList,t.deleteRecent=f.deleteRecent,t.dealRecentByDeleteGroup=f.dealRecentByDeleteGroup,t.dealRecentByAddGroup=f.dealRecentByAddGroup,t.toggleRecent=h.toggleRecent,t.changeHintsShow=h.changeHintsShow,t.openRecentConversation=h.openRecentConversation,t.initNewConversationUI=h.initNewConversationUI,t.setMessageNotifyClose=h.setMessageNotifyClose,t.updateAtMap=m.updateAtMap,t.deleteAtMap=m.deleteAtMap,t.updateUnReadNumMap=m.updateUnReadNumMap,t.deleteUnReadNumMap=m.deleteUnReadNumMap,t.updateUnReadApplyGroupNotifyNumMap=m.updateUnReadApplyGroupNotifyNumMap,t.deleteUnReadApplyGroupNotifyNumMap=m.deleteUnReadApplyGroupNotifyNumMap,t.selectRecentItem=m.selectRecentItem,t.refreshRecentIsMute=m.refreshRecentIsMute,t.refreshRecentList=m.refreshRecentList),R=(t.updateRecent=m.updateRecent,t.fixRecentToTop=E.fixRecentToTop,t.hasRecentFixedToTop=E.hasRecentFixedToTop,t.fixGroupToTop=E.fixGroupToTop,t.hasGroupFixedToTop=E.hasGroupFixedToTop,t.markRecentAsRead=S.markRecentAsRead,t.onTabClick=function(e){var t=$getState().recent,r=t.selectedTagList,n=t.searchVal,a=r.length;"history"!==e?0!==a||null!==n&&""!==n||coreUi.clickToolbar("",!1):$dispatch(coreUi.onHistoryMenu()),$dispatch(coreUi.tabClick(e))},t.showGroupAddContact=function(){var e=(0,u.default)(i.default.mark(function e(t){var r,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments[2];return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:window.CLIENTCONFIG.ISMOBILE?(coreUi.selectContactModalSearchMenu(!1),coreUi.setRemoveSelectedListLogic(),r=t.props.type||constant.CONTACT_SELECT_DIALOG_TYPE.CONTACT_SELECT_DIALOG_DISCUSSGROUP,$dispatch(coreUi.updateType(r)),window.goRoute("mSelectBox"),setTimeout(function(){return R(t,a)},10)):(R(t,a),$dispatch(coreUi.showModal(t,n))),coreUi.saveSearchText("",!1);case 2:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.updateMessageToRecent=function(){var e=(0,u.default)(i.default.mark(function e(t){var r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=$getState().recent.currentRecentInfo,e.next=3,L({owner:t.recent_owner});case 3:return n=e.sent,n=b(n,t),e.next=7,coreDb.saveRecent(n);case 7:n=e.sent,O(n),r.owner===t.recent_owner&&coreUi.showRecentIntoView(n.owner);case 10:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,u.default)(i.default.mark(function e(t,r){var n,a,o,s,u,c,l,d;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=$getState(),a=n.common.selectContactModal_contactList,o=[],a.forEach(function(e){o.push(e.groupList)}),s=t.props.type||constant.CONTACT_SELECT_DIALOG_TYPE.CONTACT_SELECT_DIALOG_DISCUSSGROUP,!r){e.next=17;break}if(u=n.recent.currentRecentInfo,c=u.chat_type,T.isGroup(c)){e.next=13;break}return e.next=11,coreUi.initSelectPageLogic(s,u.contact);case 11:e.next=15;break;case 13:return e.next=15,coreUi.initSelectPageLogic(s);case 15:e.next=19;break;case 17:return e.next=19,coreUi.initSelectPageLogic(s);case 19:s===constant.CONTACT_SELECT_DIALOG_TYPE.CONTACT_SELECT_DIALOG_ADD_CONTACT&&(n=$getState(),l=n,d=l.contactGroups.mGroupInfoNew.group_id,$dispatch(coreUi.deliverGroupId(d)));case 20:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}())},801:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.dealRecentLastContactName=t.refreshPhoneRecent=t.getLocalRecent=t.dealUnreadMessageNum=t.dealCurrentRecentLastMessageInfo=t.dealRecentLastMessageInfo=t.createOrGetRecentByMessage=t.openGroupConversationByConf=t.openGroupConversation=t.createGroupConversation=t.createOrUpdateRecent=t.getImExtendInfo=void 0;var o=r(3),i=a(o),s=r(103),u=a(s),c=r(1),l=a(c),d=r(2),f=a(d),p=r(571),g=n(p),_=r(135),h=n(_),v=r(982),m=n(v),M=r(800),y=r(572),E=r(187),w=n(E),S=r(868),I=n(S),T=window.Logger("logic")("recent/list/最近会话相关处理"),b=(t.getImExtendInfo=function(){var e=(0,f.default)(l.default.mark(function e(t){var r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,T.info("getImExtendInfo 获取右推信息",handlePhoneNumber(t.owner)),!h.isGroup(t.chat_type)){e.next=8;break}return e.next=5,coreDb.queryGroupMemberList({group_id:t.owner,owner:t.group.owner});case 5:return r=e.sent,T.debug("getImExtendInfo",r),e.abrupt("return",r);case 8:return e.abrupt("return",[]);case 11:return e.prev=11,e.t0=e.catch(0),T.error("getImExtendInfo",e.t0.toString()),e.abrupt("return",[]);case 15:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),t.createOrUpdateRecent=function(){var e=(0,f.default)(l.default.mark(function e(){var t,r,n,a,o,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{contact:null,group:null},s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,T.info("createOrUpdateRecent",c,d),t=$getState().recent.recentList,r=void 0,n=i.contact,a=i.group,!isNullOrEmpty(a)){e.next=17;break}if(!isNullOrEmpty(n)){e.next=10;break}return e.abrupt("return",{});case 10:return coreDb.saveContact((0,u.default)({},n)),e.next=13,O({owner:n.account});case 13:r=e.sent,isNullOrEmpty(r)&&(r={chat_type:constant.CHAT_TYPE.SINGLE_CHAT,owner:n.account,account:n.account,time_stamp:y.localTimeService.getLocalTime(),contact:n,stick_on_top:0,is_delete:constant.IS_DELETE.NO});case 15:e.next=21;break;case 17:return e.next=19,O({owner:a.group_id});case 19:r=e.sent,isNullOrEmpty(r)&&(r={chat_type:m.getChatTypeByGroup(a),owner:a.group_id,group_id:a.group_id,time_stamp:y.localTimeService.getLocalTime(),stick_on_top:0,is_delete:constant.IS_DELETE.NO,group:a,unread_group_notify_num:0});case 21:if(r.is_delete=constant.IS_DELETE.NO,c&&((0,M.deleteUnReadNumMap)(r.owner),r.unread_num=0),isNullOrEmpty(r.last_message)?(r.last_message={},r.time_stamp=y.localTimeService.getLocalTime()):d&&(T.info("force to update timestamp by out"),r.time_stamp=y.localTimeService.getLocalTime()),isNullOrEmpty(s)||(r.id=s),""!==r.owner){e.next=27;break}return e.abrupt("return");case 27:return e.next=29,coreDb.saveRecent(r);case 29:return r=e.sent,o=t.find(function(e){return e.owner===r.owner}),o&&(r.last_message=o.last_message),e.abrupt("return",r);case 35:return e.prev=35,e.t0=e.catch(0),T.error("createOrUpdateRecent",c,d,e.t0.toString()),e.abrupt("return",{});case 39:case"end":return e.stop()}},e,void 0,[[0,35]])}));return function(){return e.apply(this,arguments)}}(),t.createGroupConversation=function(){var e=(0,f.default)(l.default.mark(function e(t){var r,n,a,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.group_id,e.next=4,coreGroup.getGroupById(r);case 4:return n=e.sent,e.next=7,coreIm.createOrUpdateRecent({group:n},null,o,i);case 7:return a=e.sent,T.info("createGroupConversation"),e.abrupt("return",{recent:a,group:n});case 12:e.prev=12,e.t0=e.catch(0),T.error("createGroupConversation",e.t0);case 15:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t){return e.apply(this,arguments)}}(),t.openGroupConversation=function(){var e=(0,f.default)(l.default.mark(function e(t){var r,n,a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,coreIm.createGroupConversation(t);case 3:if(r=e.sent,n=r.recent,a=r.group,!a.id&&!a.group_id){e.next=11;break}if(window.CLIENTCONFIG.ISMOBILE){e.next=10;break}return e.next=10,coreCommon.switchNav("recent");case 10:coreIm.openRecentConversation(n);case 11:T.info("打开群组会话"),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),T.error("openGroupConversation",e.t0);case 17:case"end":return e.stop()}},e,void 0,[[0,14]])}));return function(t){return e.apply(this,arguments)}}(),t.openGroupConversationByConf=function(){var e=(0,f.default)(l.default.mark(function e(t){var r,n,a,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,coreIm.createGroupConversation(t,!0);case 3:if(r=e.sent,n=r.recent,a=r.group,!a.id||!n){e.next=12;break}if(!i||window.CLIENTCONFIG.ISMOBILE){e.next=10;break}return e.next=10,coreCommon.switchNav("recent");case 10:coreIm.toggleRecent(n,o),T.info("openGroupConversationByConf");case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),T.error("openGroupConversationByConf",e.t0);case 17:case"end":return e.stop()}},e,void 0,[[0,14]])}));return function(t){return e.apply(this,arguments)}}(),t.createOrGetRecentByMessage=function(){var e=(0,f.default)(l.default.mark(function e(t,r){var n,a,o,s,u,c,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,T.info("createOrGetRecentByMessage",d),n=void 0,a=void 0,o=!1,coreCommon.isSelfAccount(t.origin)&&(o=!0),!h.isGroup(t.chat_type)){e.next=15;break}return e.next=7,i.default.all([O({owner:t.group_id}),coreGroup.getGroupById(void 0===t?"":t.group_id)]);case 7:s=e.sent,n=s[0],a=s[1],isNullOrEmpty(n)&&(n={chat_type:t.chat_type,owner:t.group_id,time_stamp:t.utc_stamp,last_message:t,group:a,stick_on_top:0,is_delete:constant.IS_DELETE.NO}),u=$getState().recent.currentRecentInfo,u&&u.owner===n.owner||h.isAtMessage(t)&&(n.is_at=!0,w.updateAtMap(n.owner,!0),I.addAtMessage(t)),e.next=24;break;case 15:return c=o?t.target:t.origin,e.next=18,O({owner:c});case 18:if(n=e.sent,!isNullOrEmpty(n)){e.next=24;break}return e.next=22,coreContact.getContactByAccount(c,!0);case 22:r=e.sent,n={chat_type:t.chat_type,owner:r.account,time_stamp:t.utc_stamp,last_message:t,contact:r,stick_on_top:0,is_delete:constant.IS_DELETE.NO};case 24:return o||(n.unread_num=L(n,d)),n.is_delete=constant.IS_DELETE.NO,e.abrupt("return",n);case 29:e.prev=29,e.t0=e.catch(0),T.error("createOrGetRecentByMessage",d,e.t0.toString());case 32:case"end":return e.stop()}},e,void 0,[[0,29]])}));return function(t,r){return e.apply(this,arguments)}}(),t.dealRecentLastMessageInfo=function(e,t){try{if(T.info("dealRecentLastMessageInfo 刷新会话最后一条消息"),isNullOrEmpty(e.time_stamp)||isNullOrEmpty(e.last_message)||e.time_stamp<=t.utc_stamp){if(t.show_html===constant.DEAL_ERROR)return T.error("dealRecentLastMessageInfo 消息处理出错，忽略"),e;e.time_stamp=t.utc_stamp}return e.last_message=t,e.last_message_server_chat_id_str=t.server_chat_id_str,e}catch(t){return T.error("dealRecentLastMessageInfo",t.toString()),e}}),L=(t.dealCurrentRecentLastMessageInfo=function(e){try{T.info("dealCurrentRecentLastMessageInfo 刷新当前会话最后一条消息");var t=$getState().recent.currentRecentInfo;return b(t,e)}catch(e){return T.error("dealCurrentRecentLastMessageInfo",e.toString()),recent}},t.dealUnreadMessageNum=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;try{T.info("dealUnreadMessageNum",t);var r=$getState().recent.currentRecentInfo;if(T.info("dealUnreadMessageNum recentId 匹配当前会话",r.owner===e.owner),r.owner!==e.owner){if(-1!==t)return(0,M.updateUnReadNumMap)(e.owner,t),T.info("dealUnreadMessageNum 指定更新数量",t),t;var n=e.unread_num;return isNullOrEmpty(n)?((0,M.updateUnReadNumMap)(e.owner,1),T.info("dealUnreadMessageNum 1"),1):(T.info("dealUnreadMessageNum 正常加一",n+1),(0,M.updateUnReadNumMap)(e.owner,n+1),n+1)}return(0,M.deleteUnReadNumMap)(e.owner),0}catch(r){return T.error("dealUnreadMessageNum 错误",t,r.toString()),(0,M.deleteUnReadNumMap)(e.owner),0}}),O=t.getLocalRecent=function(e){try{T.info("getLocalRecent");var t=$getState().recent.recentList,r=t.query(e);if(!isNullOrEmpty(r))return i.default.resolve(r);var n=PromiseObject();return coreDb.queryRecent(e).then(function(e){isNullOrEmpty(e)?n.resolve({}):n.resolve((0,u.default)({},e))}),n}catch(e){return T.error("getLocalRecent 错误",e.toString()),i.default.resolve({})}},R=(t.refreshPhoneRecent=function(){var e=(0,f.default)(l.default.mark(function e(t){var r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O({owner:t.num});case 2:r=e.sent,isNullOrEmpty(r)?r=R(t):r.time_stamp<t.time_stamp&&(r.time_stamp=t.time_stamp,coreDb.saveRecent(r)),g.refreshRecentList(r);case 5:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,f.default)(l.default.mark(function e(t){var r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={chat_type:constant.CHAT_TYPE.CUSTOM_CHAT,owner:t.num,time_stamp:t.time_stamp},coreDb.saveRecent(r),e.abrupt("return",r);case 3:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}());t.dealRecentLastContactName=function(e){return coreAccount.getLoginModel().account===e.origin?e.origin:getContactNameByMessage(e)}},802:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.checkOnlyLoadLocalMessage=t.updateMessageQueryInfo=t.loadDbMessage=t.loadServerMessage=t.initAddMoreHistoryMessage=t.initLoadHistoryMessage=void 0;var o=r(1),i=a(o),s=r(2),u=a(s),c=r(156),l=n(c),d=r(574),f=n(d),p=r(986),g=window.Logger("logic")("IM/historyMessageDeal"),_=(t.initLoadHistoryMessage=function(){g.info("initLoadHistoryMessage 初始化Load历史消息"),$dispatch(coreUi.initLoadHistoryMessage())},t.initAddMoreHistoryMessage=function(){g.info("initAddMoreHistoryMessage 初始化AddMore历史消息"),$dispatch(coreUi.initAddMoreHistoryMessage())},t.loadServerMessage=function(){var e=(0,u.default)(i.default.mark(function e(t,r,n){var a,o,s,u;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,g.info("loadServerMessage（处理服务器消息）","historyMessageList count:"+t.length+",isPre:"+n),a=$getState(),o=a.recent.currentRecentInfo,o.owner===r.recent_owner){e.next=7;break}return g.info("loadServerMessage 不在当前会话"),e.abrupt("return");case 7:return g.info("loadServerMessage（处理服务器消息） 处理漫游消息"),e.next=10,f.dealHistoryMessageList(t,o);case 10:return g.info("loadServerMessage 查询本地消息"),e.next=13,coreDb.limitMessageList(r,n);case 13:return s=e.sent,isNullOrEmpty(s)&&(g.info("loadServerMessage(处理服务器消息) 没有本地消息"),$dispatch(coreUi.haveNoMoreLocalMessage())),u=!1,9999999999999!==r.utc_stamp&&(u=!0),e.next=19,_(r.recent_owner,s,u);case 19:g.info("loadServerMessage(处理服务器消息) 加载完成消息"),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),g.error("loadServerMessage（处理服务器消息）isPre:"+n,e.t0.toString());case 25:case"end":return e.stop()}},e,void 0,[[0,22]])}));return function(t,r,n){return e.apply(this,arguments)}}(),t.loadDbMessage=function(){var e=(0,u.default)(i.default.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,g.info("loadDbMessage",n.length),isNullOrEmpty(n)||(n=n.filter(function(e,t,r){return!isNullOrEmpty(e.media_type)&&!isNullOrEmpty(e.show_text)})),(0,p.modifyMessageListStatus)(n),r=$getState().recent.currentRecentInfo,r.owner===t){e.next=8;break}return g.info("loadDbMessage 不在当前会话"),e.abrupt("return");case 8:if(r=$getState().recent.currentRecentInfo,g.info("loadDbMessage(加载本地消息) 是否还在同一会话"),r.owner===t){e.next=13;break}return g.info("loadDbMessage 不在当前会话"),e.abrupt("return");case 13:a?o?$dispatch(coreUi.addBackwardMessage(n,!1)):$dispatch(coreUi.addHistoryMessage(n,!1)):l.loadHistoryMessage(n,!1),h(),g.info("loadDbMessage(加载本地消息) 加载完成消息"),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),g.error("loadDbMessage(加载本地消息) 加载完成消息",e.t0.toString());case 21:case"end":return e.stop()}},e,void 0,[[0,18]])}));return function(t){return e.apply(this,arguments)}}()),h=t.updateMessageQueryInfo=function(){try{var e=$getState().recent.messageList;if(!e||0===e.length)return void g.info("updateMessageQueryInfo 没有消息");var t={smallQueryMessageServerId:e[0].server_chat_id_str,smallQueryMessageUtcStamp:e[0].utc_stamp,bigQueryMessageServerId:e[e.length-1].server_chat_id_str,bigQueryMessageUtcStamp:e[e.length-1].utc_stamp};g.info("updateMessageQueryInfo 设置消息查询信息"),$dispatch(coreUi.setHistoryMessageQueryInfo(t))}catch(e){g.error("updateMessageQueryInfo 设置消息查询信息",e.toString())}};t.checkOnlyLoadLocalMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{if(window.isOffline)return g.info("checkOnlyLoadLocalMessage 当前处于离线状态，只加载本地消息"),!0;if(e.is_disable)return g.info("checkOnlyLoadLocalMessage 会话不可用，只加载本地消息"),!0;var r=$getState().recent.moreSeverMessage;return t&&!r?(g.info("checkOnlyLoadLocalMessage 没有更多漫游消息"),!0):(g.info("checkOnlyLoadLocalMessage 同步服务器消息"),!1)}catch(e){return g.error("checkOnlyLoadLocalMessage 异常，只加载本地消息",e.toString()),!0}}},803:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),o=n(a),i=r(2),s=n(i),u=r(4),c=n(u),l=r(5),d=n(l),f=r(989),p=n(f),g=r(804),_=n(g),h=r(990),v=n(h),m=window.Logger("usertrack")("UTInfo"),M="||",y="|||",E=function(){function e(t,r){var n=this;(0,c.default)(this,e),this.toUTString=(0,s.default)(o.default.mark(function e(){var t,r,a,i,s,u,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.netInfo.refreshNetInfo();case 2:for(t="",r=0;r<n.args.length;r++)a=n.args[r],t+=n.decodeElement(a),r!==n.args.length-1&&(t+=M);return i=""+n.decodeElement(n.apiVersion)+M+n.decodeElement(n.version)+M+n.decodeElement(n.deviceInfo.deviceId)+M+n.decodeElement(n.deviceInfo.brand)+M+n.decodeElement(n.deviceInfo.deviceModel)+M+n.decodeElement(n.deviceInfo.cpu)+M+n.decodeElement(n.deviceInfo.resolution)+M,s=n.decodeElement(n.deviceInfo.language)+M+n.decodeElement(n.deviceInfo.osName)+M+n.decodeElement(n.deviceInfo.osVersion)+M+n.decodeElement(n.netInfo.carrier)+M+n.decodeElement(n.netInfo.access)+M+n.decodeElement(n.netInfo.accessSubtype)+M+n.decodeElement(n.timeStamp)+M+n.decodeElement(n.cloudusgIP)+M+n.decodeElement(n.sbcIP)+y+n.decodeElement(n.eventId)+(t.length>0?M+t:""),u=i+n.decodeElement(n.userInfo.account)+M+s,c=i+"****"+M+s,m.info("[UT] generate a utinfo:",c),e.abrupt("return",u);case 10:case"end":return e.stop()}},e,n)})),this.apiVersion="1.0",this.version=window.CLIENTCONFIG.ACS_SOFTWAREVERSION_VALUE,this.deviceInfo=p.default.getInstance(),this.netInfo=new v.default,this.userInfo=_.default.getInstance(),this.timeStamp=this.localUTCTime(),this.eventId=t,this.args=r,this.cloudusgIP=coreAccount.getLoginModel().serverUportalAddress,this.sbcIP=this.getSBCIP()}return(0,d.default)(e,[{key:"getSBCIP",value:function(){var e=coreAccount.getLoginModel(),t=e.sipServerAddress;return 0===t.length?t=e.sipServerBackup1:0<e.sipServerBackup1.length&&(t=t+","+e.sipServerBackup1),t}},{key:"decodeElement",value:function(e){return isNullOrEmpty(e)?"-":e}},{key:"localUTCTime",value:function(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),a=e.getHours(),o=e.getMinutes(),i=e.getSeconds(),s=e.getMilliseconds(),u=e.getTimezoneOffset(),c=-u/60,l="";return l=c>0?c<10?"+0"+c+"00":"+"+c+"00":c>-10?"-0"+-c+"00":c+"00",t+"-"+this.formatDoubleNeedsValue(r)+"-"+this.formatDoubleNeedsValue(n)+" "+this.formatDoubleNeedsValue(a)+":"+this.formatDoubleNeedsValue(o)+":"+this.formatDoubleNeedsValue(i)+this.formatMillSecValue(s)+" "+l}},{key:"formatDoubleNeedsValue",value:function(e){return e<10?"0"+e:e}},{key:"formatMillSecValue",value:function(e){if(0!==e){return(""+e/1e3).slice(1)}return".000"}}]),e}();t.default=E},804:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(4),o=n(a),i=r(5),s=n(i),u=function(){function e(){(0,o.default)(this,e),this.instance=null,this.account=""}return(0,s.default)(e,[{key:"clean",value:function(){this.account=""}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}]),e}();t.default=u},805:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.saveMessageListInfo=t.getMessageShowHtml=t.getMessageShowText=t.dealPcRecentListLastMessageInfo=t.dealPcMessageList=t.dealPcMessageInfo=void 0;var o=r(3),i=a(o),s=r(106),u=a(s),c=r(1),l=a(c),d=r(103),f=a(d),p=r(2),g=a(p),_=r(484),h=n(_),v=r(135),m=n(v),M=r(159),y=n(M),E=window.Logger("logic")("IM/message/receive"),w=(t.dealPcMessageInfo=function(){var e=(0,g.default)(l.default.mark(function e(t,r,n){var a,o;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,E.debug("dealPcMessageInfo"),a=y.getMessageWithdrawServerId({server_chat_id_str:t.server_chat_id_str}),!1!==(o=T(t))){e.next=9;break}return E.error("dealPcMessageInfo 消息格式不正确，不解析",t.server_chat_id_str),e.abrupt("return",{});case 9:isNullOrEmpty(a)||E.error("dealPcMessageInfo 该消息已撤回，不显示",t.server_chat_id_str);case 10:return t=N(t,r,n),t=b(t,o),t=P(t,o),e.next=15,O((0,f.default)({},t),o);case 15:return t.quote=e.sent,e.abrupt("return",t);case 19:e.prev=19,e.t0=e.catch(0),E.error("dealPcMessageInfo",e.t0.toString());case 22:case"end":return e.stop()}},e,void 0,[[0,19]])}));return function(t,r,n){return e.apply(this,arguments)}}(),t.dealPcMessageList=function(){var e=(0,g.default)(l.default.mark(function e(t,r){var n,a,o,i,s,u,c;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,E.debug("dealPcMessageList"),n=[],a=[],o=[],i=0;i<t.length;i++)s=y.getMessageWithdrawServerId({server_chat_id_str:t[i].server_chat_id_str}),u=T(t[i]),isNullOrEmpty(s)?!1===u?E.error("dealPcMessageList 消息格式不正确，不解析",t[i].server_chat_id_str):(n.push(t[i].origin),a.push(t[i]),o.push(u)):E.error("dealPcMessageList 该消息已撤回，不显示",t[i].server_chat_id_str);return showDealTime("  1.1 开始批量查询联系人信息"),e.next=9,coreContact.getContactListByAccountList(n);case 9:return c=e.sent,showDealTime("  1.2 开始批量处理消息基本信息"),a=A(a,r,c),showDealTime("  1.3 开始处理消息文件信息"),a=L(a,o),showDealTime("  1.4 开始处理消息展示信息"),a=D(a,o),showDealTime("  1.5 开始处理消息引用信息"),e.next=19,R(a,o);case 19:return a=e.sent,e.abrupt("return",a);case 23:return e.prev=23,e.t0=e.catch(0),E.error("dealPcMessageList",e.t0.toString()),e.abrupt("return",t);case 27:case"end":return e.stop()}},e,void 0,[[0,23]])}));return function(t,r){return e.apply(this,arguments)}}(),t.dealPcRecentListLastMessageInfo=function(){var e=(0,g.default)(l.default.mark(function e(t,r){var n,a,o,i,s,u,c;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,E.debug("dealPcRecentListLastMessageInfo"),n=[],a=[],o=[],i=[],s=0;s<t.length;s++)u=T(t[s]),!1===u?E.error("dealPcRecentListLastMessageInfo 消息格式不正确，不解析",t[s].server_chat_id_str):(n.push(t[s].origin),a.push((0,f.default)({},t[s])),o.push((0,f.default)({},r[s])),i.push(u));return e.next=9,coreContact.getContactListByAccountList(n);case 9:return c=e.sent,a=A(a,o,c),a=L(a,i),a=D(a,i,!1),e.next=15,R(a,i);case 15:return a=e.sent,e.abrupt("return",{messageList:a,recentList:o});case 19:return e.prev=19,e.t0=e.catch(0),E.error("dealPcRecentListLastMessageInfo",e.t0.toString()),e.abrupt("return",{messageList:t,recentList:r});case 23:case"end":return e.stop()}},e,void 0,[[0,19]])}));return function(t,r){return e.apply(this,arguments)}}(),t.getMessageShowText=function(e,t){try{E.debug("getMessageShowText");var r=void 0,n=void 0;switch(e.media_type){case constant.MEDIA_TYPE.TEXT:case constant.MEDIA_TYPE.LIKE:case constant.MEDIA_TYPE.AUTO_REPLY:if(isNullOrEmpty(t)&&!1===(t=T(e)))return E.error("getMessageShowText 处理消息体失败，直接返回空"),"";if((n=t.querySelector("content"))&&n.textContent)return n.textContent||"";if(r=I(e),r.includes("<content>")){var a=r.split("<content>")[1].split("</content>")[0];return E.debug("getMessageShowText 特殊处理无法解析XML的消息"),a}return E.debug("getMessageShowText 未解析内容"),"";case constant.MEDIA_TYPE.PHOTO:case constant.MEDIA_TYPE.SCREEN_SHOT:case constant.MEDIA_TYPE.PHOTO_TEXT:return"["+language.PHOTO+"]";case constant.MEDIA_TYPE.VIDEO:return"["+language.MSG_TYPE_VIDEO+"]";case constant.MEDIA_TYPE.AUDIO:return"["+language.MSG_TYPE_AUDIO+"]";case constant.MEDIA_TYPE.SHARE:var o=coreCommon.String2MessageXML(e.content),i=JSON.parse(o.querySelector("c").textContent.split("<![CDATA[")[1].split("]]>")[0]),s=i.title,u=i.cardContext;return isNullOrEmpty(s)||isNullOrEmpty(u)||isNullOrEmpty(u.sourceUrl)||!isNullOrEmpty(u.customSubCardType)?"["+language.UN_SUPPORT_MESSAGE+"]":"["+language.MSG_TYPE_SHARE+"]"+s;case constant.MEDIA_TYPE.FILE:return isNullOrEmpty(e.file_list)?isNullOrEmpty(t)&&!1===(t=T(e))?(E.error("getMessageShowText 处理消息体失败，直接返回空"),""):(n=t.querySelector("content"),n&&e.media_type===constant.MEDIA_TYPE.FILE?"["+language.FILE+"]"+coreIm.resolveFileInfoByContent(n.textContent).file_name:"["+language.FILE+"]"):"["+language.FILE+"]"+(e.file_list[0].file_real_save_name||e.file_list[0].file_name);case constant.MEDIA_TYPE.FILE_TRANSFER_NOTIFICATION:return"[ 未接收文件已转离线 ]";case constant.MEDIA_TYPE.GROUP_MEMBERCHG_NOTIFY:case constant.MEDIA_TYPE.GROUP_NAME_CHANGE:case constant.MEDIA_TYPE.APPLY_JOIN_FIXED_GROUP_NOTIFY:case constant.MEDIA_TYPE.UPGRADE_TO_FIXED_GROUP_NOTIFY:case constant.MEDIA_TYPE.WITHDRAW_NOTIFY:return e.show_text;case constant.MEDIA_TYPE.CARD:return"["+language.UN_SUPPORT_MESSAGE+"]";default:return E.error("message is null"),""}}catch(e){E.error("getMessageShowText",e.toString())}}),S=t.getMessageShowHtml=function(e,t){try{if(isNullOrEmpty(t)&&!1===(t=T(e)))return E.error("getMessageShowHtml 处理消息体失败，直接返回空"),"";var r="",n=t.querySelector("html");if(n&&n.childNodes[0])r=n.childNodes[0].nodeValue;else{var a=I(e);a.includes("CDATA")&&(r=a.split("<![CDATA[")[1].split("]]>")[0])}r=V(r);var o=coreCommon.String2HTML(r);if(!isNullOrEmpty(o)&&("FONT"===o.nodeName||"font"===o.nodeName)){var i=o.getAttribute("face"),s=o.getAttribute("style");isNullOrEmpty(i)||(isNullOrEmpty(s)?s="font-family:"+i:s+=";font-family:"+i),o.setAttribute("style",s);var u=$getState().login.account;return coreCommon.XML2String(o).replaceAll(constant.SERVER_PUBLIC_PATH.IMAGE_PATH,appService.getScreenShotPath(u)).replaceAll('onmouseup="ShowImageMenu(this)"','onload="delegate.onImageLoad(this)" data-query-id="'+e.server_chat_id_str+'" onerror="delegate.onImageError(this)"').replaceAll("onmouseup=ShowImageMenu(this)",'onload="delegate.onImageLoad(this)" data-query-id="'+e.server_chat_id_str+'" onerror="delegate.onImageError(this)"')}""===r?(r=h.transformHtmlEmotion(e.show_text),constant.MEDIA_TYPE.LIKE===e.media_type&&(r=h.transformHtmlLike(e.show_text))):e.show_text.includes("]]>")&&r&&(r=h.transformHtmlEmotion(r),constant.MEDIA_TYPE.LIKE===e.media_type&&(r=h.transformHtmlLike(r)));var c=$getState().login.account;return r.replaceAll(constant.SERVER_PUBLIC_PATH.IMAGE_PATH,appService.getScreenShotPath(c)).replaceAll('onmouseup="ShowImageMenu(this)"','onload="delegate.onImageLoad(this)" data-query-id="'+e.server_chat_id_str+'" onerror="delegate.onImageError(this)"').replaceAll("onmouseup=ShowImageMenu(this)",'onload="delegate.onImageLoad(this)" data-query-id="'+e.server_chat_id_str+'" onerror="delegate.onImageError(this)"')}catch(e){return E.error("getMessageShowHtml",e.toString()),constant.DEAL_ERROR}},I=(t.saveMessageListInfo=function(){var e=(0,g.default)(l.default.mark(function e(t){var r,n,a,o,s;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,E.debug("saveMessageListInfo 批量保存消息及相关数据"),r=[],n=[],a=[],o=0;case 4:if(!(o<t.length)){e.next=14;break}if(s=(0,f.default)({},t[o]),!isNullOrEmpty(s)){e.next=8;break}return e.abrupt("continue",11);case 8:isNullOrEmpty(s.quote)||(r.push(s.quote),isNullOrEmpty(s.quote.file_list)||(m.hasScreenShot(s.quote.media_type)?a.push.apply(a,(0,u.default)(s.quote.file_list)):n.push.apply(n,(0,u.default)(s.quote.file_list)))),isNullOrEmpty(s.file_list)||(m.hasScreenShot(s.media_type)?a.push.apply(a,(0,u.default)(s.file_list)):n.push.apply(n,(0,u.default)(s.file_list))),r.push(s);case 11:o++,e.next=4;break;case 14:return e.next=16,i.default.all([coreDb.bulkPutMessage([].concat(r)),coreDb.bulkPutFile(n),coreDb.bulkPutScreenShot(a)]);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),E.error("saveMessageListInfo",e.t0.toString());case 21:case"end":return e.stop()}},e,void 0,[[0,18]])}));return function(t){return e.apply(this,arguments)}}(),function(e){try{var t=e.content,r=/content.*\[CDATA\[.*content/g,n=void 0,a=void 0,o=coreCommon.String2MessageXML(t);return"1"===o.querySelector("g").textContent?(a=o.querySelector("c").textContent,n=coreCommon.unZip(a)):n=o.querySelector("c").textContent,r.test(n)&&(n=n.split("<![CDATA[").join(""),n=n.split("]]>").join("")),n}catch(e){return E.error("getMessageContentC 消息格式异常",e.toString()),constant.DEAL_ERROR}}),T=function(e){try{return coreCommon.String2HTML(I(e))}catch(e){return E.error("getMessageContentCXML 格式异常",e.toString()),!1}},b=function(e,t){try{switch(E.debug("getMessageFileInfo"),e.media_type){case constant.MEDIA_TYPE.PHOTO:case constant.MEDIA_TYPE.PHOTO_TEXT:case constant.MEDIA_TYPE.SCREEN_SHOT:e.file_list=U(e,t),e.file_list.length>1&&(e.media_type=constant.MEDIA_TYPE.PHOTO_TEXT);break;case constant.MEDIA_TYPE.VIDEO:e.file_list=F(e,t),e.file_list=e.file_list.concat(k(e,t));break;case constant.MEDIA_TYPE.AUDIO:case constant.MEDIA_TYPE.FILE:e.status=constant.MEDIA_STATUS.RECEIVE,coreCommon.isSelfAccount(e.origin)&&(e.status=constant.MEDIA_STATUS.SEND_SUCCESS),e.file_list=F(e,t)}return e}catch(t){return E.error("getMessageFileInfo",t.toString()),e}},L=function(e,t){try{return E.debug("getMessageListFileInfo"),e.map(function(e,r){return b(e,t[r])}),e}catch(t){return E.error("getMessageListFileInfo",t.toString()),e}},O=function(){var e=(0,g.default)(l.default.mark(function e(t,r){var n,a,o,i,s,u,c;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,E.debug("getQuote"),n={},a=r.querySelector("quote"),isNullOrEmpty(a)){e.next=26;break}for(E.info("getQuote 有引用消息"),o=$getState(),i=o.myInfo,s=coreCommon.unZip(a.textContent);coreCommon.isZipStr(s);)s=coreCommon.unZip(s);if(n={origin:a.getAttribute("origin"),media_type:parseInt(a.getAttribute("mediatype")),content:s,client_chat_id:getClientId(),utc_stamp:t.utc_stamp},n.server_chat_id_str=n.client_chat_id.toString(),E.debug("getQuote 引用消息"),u=i,n.origin===u.account){e.next=18;break}return e.next=17,coreContact.getContactByAccount(n.origin);case 17:u=e.sent;case 18:if(!1!==(c=T(n))){e.next=22;break}return E.error("getQuote 引用消息的格式不正确，不解析"),e.abrupt("return",{});case 22:n=C(n,u),n=B(n,c,t),n.show_text=w(n,c),n=P(n,c);case 26:return e.abrupt("return",n);case 29:return e.prev=29,e.t0=e.catch(0),E.error("getQuote",e.t0.toString()),e.abrupt("return",t);case 33:case"end":return e.stop()}},e,void 0,[[0,29]])}));return function(t,r){return e.apply(this,arguments)}}(),R=function(){var e=(0,g.default)(l.default.mark(function e(t,r){var n,a,o,i,s,u,c,d,f,p,g,_,h;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=[],a=[],o=[],i=[],s=[],u=0;case 7:if(!(u<t.length)){e.next=24;break}if(c=t[u],d=r[u],f={},p=d.querySelector("quote"),!isNullOrEmpty(p)){e.next=14;break}return e.abrupt("continue",21);case 14:for(E.info("getMessageListQuote 有引用消息"),g=coreCommon.unZip(p.textContent);coreCommon.isZipStr(g);)g=coreCommon.unZip(g);f={origin:p.getAttribute("origin"),media_type:parseInt(p.getAttribute("mediatype")),content:g,client_chat_id:getClientId(),utc_stamp:p.getAttribute("time")||""},f.server_chat_id_str=f.client_chat_id.toString(),_=T(f),!1===_?E.error("getMessageListQuote 引用消息的格式不正确，不解析"):(a.push(_),o.push(f.origin),i.push(u),s.push(c),n.push(f));case 21:u++,e.next=7;break;case 24:return showDealTime("    1.5.1 批量获取引用消息联系人"),e.next=27,coreContact.getContactListByAccountList(o);case 27:return h=e.sent,showDealTime("    1.5.2 处理引用基本信息"),n=x(n,h),showDealTime("    1.5.3 处理引用文件信息"),n=Y(n,a,s),showDealTime("    1.5.4 处理引用显示信息"),n=D(n,a),i.forEach(function(e,r){t[e].quote=n[r]}),showDealTime("处理引用消息完成"),e.abrupt("return",t);case 39:return e.prev=39,e.t0=e.catch(0),E.error("getMessageListQuote",e.t0.toString()),e.abrupt("return",t);case 43:case"end":return e.stop()}},e,void 0,[[0,39]])}));return function(t,r){return e.apply(this,arguments)}}(),N=function(e,t,r){try{return E.debug("getMessageInfo 处理消息基本信息"),e.recent_owner=t.owner,e.recent_id=t.id,e.native_name=r.native_name,e.name=r.name,e.is_delete=constant.IS_DELETE.NO,e.is_read=1,e.is_auto_reply=!1,e.chat_type===constant.CHAT_TYPE.FILE_TRANSFER_NOTIFICATION&&(e.media_type=constant.MEDIA_TYPE.FILE),m.checkClientChatId(e.client_chat_id)||(E.error("dealMessageList 错误的client",e.server_chat_id_str),e.client_chat_id=getClientId()),e.chat_type===constant.CHAT_TYPE.AUTO_REPLY&&(e.chat_type=constant.CHAT_TYPE.SINGLE_CHAT,e.is_auto_reply=!0),coreCommon.isSelfAccount(e.origin)&&(e.send_status=constant.SEND_STATUS.success),e}catch(t){return E.error("getMessageInfo",t.toString()),e}},A=function(e,t,r){try{var n=Object.type(t)===Object.type.ARRAY;return e.map(function(e,a){return n?N(e,t[a],r[a]):N(e,t,r[a])}),e}catch(t){return E.error("getMessageListInfo",t.toString()),e}},C=function(e,t){try{return E.debug("getQuoteInfo"),e.native_name=t.native_name,e.name=t.name,e}catch(t){return E.error("getQuoteInfo",t.toString()),e}},x=function(e,t){try{return e.map(function(e,r){return isNullOrEmpty(e)?e:C(e,t[r])}),e}catch(t){return E.error("getQuoteListInfo",t.toString()),e}},P=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];try{if(E.debug("getShowInfo isDealShowHtml",r),coreIm.isGroupNotifyMessage(e.media_type)||(e.show_text=w(e,t)),!r||e.media_type!==constant.MEDIA_TYPE.TEXT&&e.media_type!==constant.MEDIA_TYPE.PHOTO_TEXT&&e.media_type!==constant.MEDIA_TYPE.LIKE||(e.show_html=S(e,t)),r&&e.media_type===constant.MEDIA_TYPE.SHARE){var n=G(e,t);n.includes("CDATA")&&(n=n.split("[CDATA[")[1].split("]]")[0]);var a=JSON.parse(n),o=a.cardType,i=a.title;if(isNullOrEmpty(a.cardContext)||isNullOrEmpty(i))o=constant.CARD_TYPE.UNDEFINED;else{var s=a.cardContext.sourceUrl,u=a.cardContext.isPCDisplay,c=a.cardContext.customSubCardType;!isNullOrEmpty(s)&&0!==u&&isNullOrEmpty(c)||(o=constant.CARD_TYPE.UNDEFINED)}e.show_html=n,e.card_type=o}return e}catch(t){return E.error("getShowInfo",t.toString()),e}},D=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];try{return e.map(function(e,n){return P(e,t[n],r)}),e}catch(t){return E.error("getMessageListShowInfo",t.toString()),e}},F=function(e,t){try{E.debug("getFileInfo");var r={};try{var n=t.querySelector("content").textContent;if(isNullOrEmpty(n))return E.error("getFileInfo 没有文件信息"),[];r=m.resolveFileInfoByContent(n)}catch(t){E.info("getFileInfo JSON格式的文件消息");var a=JSON.parse(e.content);r.um_plain_access_code=a.plain_access_code,r.um_url=a.url,r.file_size=a.file_size,r.file_name=a.file_name}if(isNullOrEmpty(r.um_url)||isNullOrEmpty(r.um_plain_access_code)||isNullOrEmpty(r.file_name))return E.error("getFileInfo 文件信息不正确"),[];var o=$getState().login.account;return r.file_real_save_path=appService.getReceiveFilesPath(o)+r.file_name,(r.file_real_save_name=r.file_name,r.is_downloaded=constant.IS_DOWNLOADED.NO,r.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,Z(r))?null:(r=X(r,e),[r])}catch(e){return E.error("getFileInfo 没有文件信息",e.toString()),[]}},U=function(e,t){try{E.debug("getImageInfoList");var r=t.querySelectorAll("photo-item"),n=[],a=$getState().myInfo.account;if(isNullOrEmpty(r)){var o=q(t,e,a);isNullOrEmpty(o)||(n=[o])}else for(var i=0;i<r.length;i++){var s=r[i],u=W(s,e,a);isNullOrEmpty(u)||n.push(u)}return n}catch(e){return E.error("getImageInfoList",e.toString()),null}},k=function(e,t){var r=t.querySelectorAll("photo-item")[0],n=$getState().myInfo.account;return r?[W(r,e,n)]:[]},G=function(e,t){try{return E.debug("dealGroupSpaceFileInfo"),t.querySelector("content").childNodes[0].nodeValue}catch(e){return E.error("dealGroupSpaceFileinfo 没有文件信息",e.toString()),[]}},H=function(e,t){try{E.debug("getQuoteImageInfoList");var r=e.querySelectorAll("photo-item"),n=[],a=$getState().myInfo.account;if(isNullOrEmpty(r)){var o=Q(e,a,t);isNullOrEmpty(o)||(n=[o])}else for(var i=0;i<r.length;i++){var s=r[i],u=z(s,a,t);isNullOrEmpty(u)||n.push(u)}return n}catch(e){return E.error("getQuoteImageInfoList",e.toString()),null}},B=function(e,t,r){try{switch(E.debug("getQuoteFileInfo"),e.media_type){case constant.MEDIA_TYPE.PHOTO:case constant.MEDIA_TYPE.PHOTO_TEXT:case constant.MEDIA_TYPE.SCREEN_SHOT:e.file_list=H(t,r),e.file_list.length>1&&(e.media_type=constant.MEDIA_TYPE.PHOTO_TEXT);break;case constant.MEDIA_TYPE.VIDEO:case constant.MEDIA_TYPE.AUDIO:case constant.MEDIA_TYPE.FILE:e.status=constant.MEDIA_STATUS.RECEIVE,coreCommon.isSelfAccount(r.origin)&&(e.status=constant.MEDIA_STATUS.SEND_SUCCESS),e.file_list=j(t,r);break;case constant.MEDIA_TYPE.SHARE:e.file_list=$(t,r)}return e}catch(t){return E.error("getQuoteFileInfo",t.toString()),e}},Y=function(e,t,r){try{return E.debug("getQuoteListFileInfo"),e.map(function(e,n){var a=t[n],o=r[n];return B(e,a,o)}),e}catch(t){return E.error("getQuoteListFileInfo",t.toString()),e}},j=function(e,t){try{E.debug("getQuoteFileInfoList");var r={};try{var n=e.querySelector("content").textContent;if(isNullOrEmpty(n))return E.error("getQuoteFileInfoList 没有文件信息"),[];r=m.resolveFileInfoByContent(n)}catch(e){return E.error("getQuoteFileInfoList 异常信息"),[]}if(isNullOrEmpty(r.um_url)||isNullOrEmpty(r.um_plain_access_code)||isNullOrEmpty(r.file_name))return E.error("getQuoteFileInfoList 文件信息不正确"),[];var a=$getState().login.account;return r.file_real_save_path=appService.getReceiveFilesPath(a)+r.file_name,r.file_real_save_name=r.file_name,r.is_downloaded=constant.IS_DOWNLOADED.NO,r.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,r=K(r,t),[r]}catch(e){return E.error("getQuoteFileInfoList 没有文件信息",e.toString()),[]}},$=function(e,t){try{E.debug("getQuoteGroupSpaceFileInfo");var r={},n=JSON.parse(e.querySelector("content").childNodes[0].nodeValue);return r.um_url=n.cardContext.sourceUrl,(r.file_size=n.cardContext.fileSize,r.file_name=n.title,isNullOrEmpty(r.um_url)||isNullOrEmpty(r.file_name))?(E.error("getQuoteGroupSpaceFileInfo 没有文件信息"),[]):(r.is_downloaded=constant.IS_DOWNLOADED.NO,r.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,r=K(r,t),[r])}catch(e){return E.error("getQuoteGroupSpaceFileInfo 没有文件信息",e.toString()),[]}},V=function(e){try{var t=e;if(e&&-1!==e.indexOf(constant.SERVER_PUBLIC_PATH.EMOTION_PATH)){var r=e.split(constant.SERVER_PUBLIC_PATH.EMOTION_PATH);t=r[0];for(var n=1;n<r.length;n++){var a=r[n].indexOf(".");t=t+window.EMOTION_PATH+r[n].slice(0,a)+".png"+r[n].slice(a+4,r[n].length)}}return t}catch(e){E.error("dealEmotion",e.toString())}},q=function(e,t,r){try{E.debug("getImageInfoByContent");var n=e.querySelector("content").textContent,a=m.resolveFileInfoByContent(n);return a.is_downloaded=constant.IS_DOWNLOADED.NO,a.file_real_save_path=appService.getScreenShotPath(r)+a.file_name,a.file_path=appService.getOriginFilesPath(r)+a.file_name,a.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,a.file_real_save_name=a.file_name,Z(a)?null:X(a,t)}catch(e){E.error("getImageInfoByContent",e.toString())}},W=function(e,t,r){try{E.debug("getImageInfoByPhotoItem");var n={file_name:e.getAttribute("name"),file_size:e.getAttribute("size"),height:e.getAttribute("height"),width:e.getAttribute("width"),um_url:e.getAttribute("url"),um_plain_access_code:e.getAttribute("plain-access-code")};return n.is_downloaded=constant.IS_DOWNLOADED.NO,n.file_real_save_path=appService.getScreenShotPath(r)+n.file_name,n.file_path=appService.getOriginFilesPath(r)+n.file_name,n.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,n.file_real_save_name=n.file_name,Z(n)?null:X(n,t)}catch(e){E.error("getImageInfoByPhotoItem",e.toString())}},Q=function(e,t,r){try{E.debug("getQuoteImageInfoByContent");var n=e.querySelector("content").textContent,a=m.resolveFileInfoByContent(n);return a.is_downloaded=constant.IS_DOWNLOADED.NO,a.file_real_save_path=appService.getScreenShotPath(t)+a.file_name,a.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,a.file_real_save_name=a.file_name,K(a,r)}catch(e){E.error("getQuoteImageInfoByContent",e.toString())}},z=function(e,t,r){try{E.debug("getQuoteImageInfoByPhotoItem");var n={file_name:e.getAttribute("name"),file_size:e.getAttribute("size"),height:e.getAttribute("height"),width:e.getAttribute("width"),um_url:e.getAttribute("url"),um_plain_access_code:e.getAttribute("plain-access-code")};return n.is_downloaded=constant.IS_DOWNLOADED.NO,n.file_real_save_path=appService.getScreenShotPath(t)+n.file_name,n.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,n.file_real_save_name=n.file_name,K(n,r)}catch(e){E.error("getQuoteImageInfoByPhotoItem",e.toString())}},X=function(e,t){try{return E.debug("bindMessageInfoToFile"),e.recent_id=t.recent_id,e.recent_owner=t.recent_owner,e.message_id=t.id,e.message_server_chat_id_str=t.server_chat_id_str,e.time_stamp=t.utc_stamp,e.is_quote=constant.IS_QUOTE.NO,e}catch(e){return E.error("bindMessageInfoToFile",e.toString()),null}},K=function(e,t){if(!Z(e))return e.recent_id=t.recent_id,e.recent_owner=t.recent_owner,e.message_id=t.id,e.message_server_chat_id_str=t.server_chat_id_str,e.time_stamp=t.utc_stamp,e.is_quote=constant.IS_QUOTE.YES,e},Z=function(e){return!!(isNullOrEmpty(e.um_url)||isNullOrEmpty(e.um_plain_access_code)||isNullOrEmpty(e.file_name))&&(E.error("checkFileInfoError"),!0)}},827:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return i.process(e)};var n=r(828),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=r(833),i=new a.default({whiteList:o.whiteList,stripIgnoreTag:o.stripIgnoreTag,stripIgnoreTagBody:o.stripIgnoreTagBody,allowCommentTag:o.allowCommentTag,stripBlankChar:o.stripBlankChar,onTag:o.onTag,onTagAttr:o.onTagAttr,onIgnoreTag:o.onIgnoreTag,onIgnoreTagAttr:o.onIgnoreTagAttr,css:{whiteList:o.cssWhiteList}})},828:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(829),a=function(e){return e&&e.__esModule?e:{default:e}}(n);t.default=a.default},829:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(98),o=n(a),i=r(538),s=r(540),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(s),c=r(832),l=n(c),d=r(232),f=n(d);window.Logger("service/util")("XSS").debug=Noop;var p=function(e){var t=f.default.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};e=f.default.trim(e.slice(t+1,-1));var r="/"===e[e.length-1];return r&&(e=f.default.trim(e.slice(0,-1))),{html:e,closing:r}},g=function(e){e=(0,o.default)({},e||{}),e.stripIgnoreTag&&(e.onIgnoreTag,e.onIgnoreTag=u.onIgnoreTagStripAll),e.whiteList=e.whiteList||u.whiteList,e.onTag=e.onTag||u.onDefaultTag,e.onTagAttr=e.onTagAttr||u.onDefaultTagAttr,e.onIgnoreTag=e.onIgnoreTag||u.onDefaultIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||u.onDefaultIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||u.safeAttrValue,e.escapeHtml=e.escapeHtml||u.escapeHtml,this.options=e,!1===e.css?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new i.CSSFilter(e.css))};g.prototype.process=function(e){if(e=e||"",!(e=e.toString()))return"";var t=this,r=t.options,n=r.whiteList,a=r.onTag,o=r.onIgnoreTag,i=r.onTagAttr,s=r.onIgnoreTagAttr,c=r.safeAttrValue,d=r.escapeHtml,g=t.cssFilter;r.stripBlankChar&&(e=u.stripBlankChar(e)),r.allowCommentTag||(e=u.stripCommentTag(e));var _=!1;r.stripIgnoreTagBody&&(_=u.StripTagBody(r.stripIgnoreTagBody,o),o=_.onIgnoreTag);var h=l.default.parseTag(e,function(e,t,r,u,_){var h={sourcePosition:e,position:t,isClosing:_,isWhite:n.hasOwnProperty(r)},v=a(r,u,h);if(!f.default.isNull(v))return v;if(h.isWhite){if(h.isClosing)return"</"+r+">";var m=p(u),M=n[r],y=l.default.parseAttr(m.html,function(e,t){var n=-1!==f.default.indexOf(M,e),a=i(r,e,t,n,g);if(!f.default.isNull(a))return a;if(n)return t=c(r,e,t,g),t?e+'="'+t+'"':e;var o=s(r,e,t,n);return f.default.isNull(o)?void 0:o}),E="<"+r;return y&&(E+=" "+y),m.closing&&(E+=" /"),E+=">"}var w=o(r,u,h);return f.default.isNull(w)?d(u):w},d);return _&&(h=_.remove(h)),h},t.default=g},830:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(98),o=n(a),i=r(539),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(i),u=r(831),c=n(u),l=r(232),d=n(l),f=function(e){e=(0,o.default)({},e||{}),e.whiteList=e.whiteList||s.whiteList,e.onCssAttr=e.onCssAttr||s.onCssAttr,e.onIgnoreCssAttr=e.onIgnoreCssAttr||s.onIgnoreCssAttr,e.safeCssAttrValue=e.safeCssAttrValue||s.safeCssAttrValue,this.options=e};f.prototype.process=function(e){if(e=e||"",!(e=e.toString()))return"";var t=this,r=t.options,n=r.whiteList,a=r.onCssAttr,o=r.onIgnoreCssAttr,i=r.safeCssAttrValue;return(0,c.default)(e,function(e,t,r,s,u){var c=n[r],l=!1;if(!0===c?l=c:"function"==typeof c?l=c(s):c instanceof RegExp&&(l=c.test(s)),!0!==l&&(l=!1),s=i(r,s)){var f={position:t,sourcePosition:e,source:u,isWhite:l};if(l){var p=a(r,s,f);return d.default.isNull(p)?r+":"+s:p}var g=o(r,s,f);return d.default.isNull(g)?void 0:g}})},t.default=f},831:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e=a.default.trimRight(e),";"!==e[e.length-1]&&(e+=";");for(var r=e.length,n=!1,o=0,i=0,s="",u=function(){if(!n){var r=a.default.trim(e.slice(o,i)),u=r.indexOf(":");if(-1!==u){var c=a.default.trim(r.slice(0,u)),l=a.default.trim(r.slice(u+1));if(c){var d=t(o,s.length,c,l,r);d&&(s+=d+"; ")}}}o=i+1};i<r;i++){var c=e[i];if("/"===c&&"*"===e[i+1]){var l=e.indexOf("*/",i+2);if(-1===l)break;i=l+1,o=i+1,n=!1}else"("===c?n=!0:")"===c?n=!1:";"===c?n||u():"\n"===c&&u()}return a.default.trim(s)};var n=r(232),a=function(e){return e&&e.__esModule?e:{default:e}}(n)},832:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(232),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=function(e){var t=a.default.spaceIndex(e),r=void 0;return r=-1===t?e.slice(1,-1):e.slice(1,t+1),r=a.default.trim(r).toLowerCase(),"/"===r.slice(0,1)&&(r=r.slice(1)),"/"===r.slice(-1)&&(r=r.slice(0,-1)),r},i=function(e){return"</"===e.slice(0,2)},s=function(e,t,r){var n="",a=0,s=!1,u=!1,c=0,l=e.length,d="",f="";for(c=0;c<l;c++){var p=e.charAt(c);if(!1===s)"<"===p&&(s=c);else if(!1===u){if("<"===p){n+=r(e.slice(a,c)),s=c,a=c;continue}if(">"===p){n+=r(e.slice(a,s)),f=e.slice(s,c+1),d=o(f),n+=t(s,n.length,d,f,i(f)),a=c+1,s=!1;continue}'"'!==p&&"'"!==p||"="!==e.charAt(c-1)||(u=p)}else p===u&&(u=!1)}return a<e.length&&(n+=r(e.substr(a))),n},u=/[^a-zA-Z0-9_:\.\-]/gim,c=function(e,t){function r(e,r){if(e=a.default.trim(e),e=e.replace(u,"").toLowerCase(),!(e.length<1)){var n=t(e,r||"");n&&o.push(n)}}for(var n=0,o=[],i=!1,s=e.length,c=0;c<s;c++){var f=e.charAt(c),g=void 0,_=void 0;if(!1!==i||"="!==f)if(!1===i||c!==n||'"'!==f&&"'"!==f||"="!==e.charAt(c-1))/\s|\n|\t/.test(f)&&(e=e.replace(/\s|\n|\t/g," "),!1===i?(_=l(e,c),-1===_?(g=a.default.trim(e.slice(n,c)),r(g),i=!1,n=c+1):c=_-1):-1===(_=d(e,c-1))&&(g=a.default.trim(e.slice(n,c)),g=p(g),r(i,g),i=!1,n=c+1));else{if(-1===(_=e.indexOf(f,c+1)))break;g=a.default.trim(e.slice(n+1,_)),r(i,g),i=!1,c=_,n=c+1}else i=e.slice(n,c),n=c+1}return n<e.length&&(!1===i?r(e.slice(n)):r(i,p(a.default.trim(e.slice(n))))),a.default.trim(o.join(" "))},l=function(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"="===r?t:-1}},d=function(e,t){for(;t>0;t--){var r=e[t];if(" "!==r)return"="===r?t:-1}},f=function(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]},p=function(e){return f(e)?e.substr(1,e.length-2):e};t.default={parseTag:s,parseAttr:c}},833:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onIgnoreTagAttr=t.onIgnoreTag=t.onTagAttr=t.onTag=t.stripBlankChar=t.allowCommentTag=t.stripIgnoreTagBody=t.stripIgnoreTag=t.cssWhiteList=t.whiteList=void 0;var n=r(540),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n),o=window.Logger("service/util")("XSS/config");o.debug=Noop;t.whiteList={a:[],b:[],br:[],code:[],div:[],em:[],font:["color","size","face","style"],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","alt","title"],p:[],pre:[],span:[],strong:[],u:[]},t.cssWhiteList={color:!0,font:!0,"font-family":!0,"font-size":!0,"font-style":!0,"font-weight":!0,"text-decoration":!0},t.stripIgnoreTag=!0,t.stripIgnoreTagBody=["script","style","head-area"],t.allowCommentTag=!1,t.stripBlankChar=!0,t.onTag=function(e,t,r){o.debug("onTag",e,t)},t.onTagAttr=function(e,t,r,n){if(o.debug("onTagAttr",e,t,r,n),n&&"img"===e&&"src"===t&&r&&0!==r.indexOf("http"))return t+'="'+a.escapeAttrValue(r)+'"'},t.onIgnoreTag=function(e,t,r){o.debug("onIgnoreTag",e,t)},t.onIgnoreTagAttr=function(e,t,r){if(o.debug("onIgnoreTagAttr",e,t,r),"img"===e){if("data-img-id"===t||"data-query-id"===t)return t+'="'+a.escapeAttrValue(r)+'"';if(("width"===t||"height"===t)&&r===constant.editorEmojiSize)return t+'="'+a.escapeAttrValue(r)+'"';if("onload"===t)return t+'="delegate.onImageLoad(this)"';if("onerror"===t)return t+'="delegate.onImageError(this)"';if("ondblclick"===t)return t+'="ShowImage(this)"';if("onmouseup"===t)return t+'="ShowImageMenu(this)"'}}},84:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.HwImSdk=void 0;var o=r(98),i=a(o),s=r(4),u=a(s),c=r(867),l=n(c),d=r(868),f=n(d),p=r(1180),g=n(p),_=r(156),h=n(_),v=r(1184),m=n(v),M=r(1166),y=n(M),E=r(995),w=n(E),S=r(874),I=n(S),T=r(486),b=n(T),L=r(513),O=n(L),R=r(1167),N=n(R),A=r(994),C=n(A),x=r(1165),P=n(x),D=r(1168),F=n(D),U=r(1162),k=n(U),G=r(1161),H=n(G),B=r(872),Y=n(B),j=r(1160),$=n(j),V=r(987),q=n(V),W=r(871),Q=n(W),z=r(802),X=n(z),K=r(1179),Z=n(K),J=r(573),ee=n(J),te=r(1188),re=n(te),ne=r(1189),ae=n(ne),oe=r(1185),ie=n(oe),se=r(1176),ue=n(se),ce=r(574),le=n(ce),de=r(1177),fe=n(de),pe=r(1172),ge=n(pe),_e=r(1170),he=n(_e),ve=r(805),me=n(ve),Me=r(1171),ye=n(Me),Ee=r(1173),we=n(Ee),Se=r(1175),Ie=n(Se),Te=r(1174),be=n(Te),Le=r(1157),Oe=n(Le),Re=r(1158),Ne=n(Re),Ae=r(1163),Ce=n(Ae),xe=r(484),Pe=n(xe),De=r(985),Fe=n(De),Ue=r(1159),ke=n(Ue),Ge=r(1178),He=n(Ge),Be=r(1186),Ye=n(Be),je=r(1156),$e=n(je),Ve=r(417),qe=n(Ve),We=r(1182),Qe=n(We),ze=r(1181),Xe=n(ze),Ke=r(1183),Ze=n(Ke),Je=r(873),et=n(Je),tt=r(213),rt=n(tt),nt=r(485),at=n(nt),ot=r(1190),it=n(ot),st=r(1194),ut=n(st),ct=r(1195),lt=n(ct),dt=r(187),ft=n(dt),pt=r(571),gt=n(pt),_t=r(801),ht=n(_t),vt=r(1192),mt=n(vt),Mt=r(800),yt=n(Mt),Et=r(1191),wt=n(Et),St=r(1193),It=n(St),Tt=r(1145),bt=n(Tt),Lt=r(983),Ot=n(Lt),Rt=r(1155),Nt=n(Rt),At=r(1146),Ct=n(At),xt=r(1148),Pt=n(xt),Dt=r(159),Ft=n(Dt),Ut=r(984),kt=n(Ut),Gt=r(869),Ht=n(Gt),Bt=r(1147),Yt=n(Bt),jt=r(1790),$t=n(jt),Vt=r(1152),qt=n(Vt),Wt=r(1154),Qt=n(Wt),zt=r(1153),Xt=n(zt),Kt=r(1149),Zt=n(Kt),Jt=r(870),er=n(Jt),tr=r(1151),rr=n(tr),nr=r(1150),ar=n(nr),or=r(572),ir=n(or),sr=r(1196),ur=n(sr),cr=r(1197),lr=n(cr),dr=r(1791),fr=n(dr),pr=r(1198),gr=n(pr),_r=r(981),hr=n(_r),vr=r(135),mr=n(vr),Mr=r(982),yr=n(Mr),Er=r(1199),wr=n(Er),Sr=r(1200),Ir=n(Sr),Tr=r(1794),br=n(Tr),Lr=r(1795);t.HwImSdk=function e(){(0,u.default)(this,e),(0,i.default)(this,l),(0,i.default)(this,f),(0,i.default)(this,g),(0,i.default)(this,h),(0,i.default)(this,m),(0,i.default)(this,y),(0,i.default)(this,w),(0,i.default)(this,I),(0,i.default)(this,b),(0,i.default)(this,O),(0,i.default)(this,N),(0,i.default)(this,C),(0,i.default)(this,P),(0,i.default)(this,F),(0,i.default)(this,k),(0,i.default)(this,H),(0,i.default)(this,Y),(0,i.default)(this,$),(0,i.default)(this,q),(0,i.default)(this,Q),(0,i.default)(this,X),(0,i.default)(this,Z),(0,i.default)(this,ee),(0,i.default)(this,re),(0,i.default)(this,ae),(0,i.default)(this,ie),(0,i.default)(this,ue),(0,i.default)(this,le),(0,i.default)(this,fe),(0,i.default)(this,ge),(0,i.default)(this,he),(0,i.default)(this,me),(0,i.default)(this,ye),(0,i.default)(this,we),(0,i.default)(this,Ie),(0,i.default)(this,be),(0,i.default)(this,Oe),(0,i.default)(this,Ne),(0,i.default)(this,Ce),(0,i.default)(this,Pe),(0,i.default)(this,Fe),(0,i.default)(this,ke),(0,i.default)(this,He),(0,i.default)(this,Ye),(0,i.default)(this,$e),(0,i.default)(this,qe),(0,i.default)(this,Qe),(0,i.default)(this,Xe),(0,i.default)(this,Ze),(0,i.default)(this,et),(0,i.default)(this,rt),(0,i.default)(this,at),(0,i.default)(this,it),(0,i.default)(this,ut),(0,i.default)(this,lt),(0,i.default)(this,ft),(0,i.default)(this,gt),(0,i.default)(this,ht),(0,i.default)(this,mt),(0,i.default)(this,yt),(0,i.default)(this,wt),(0,i.default)(this,It),(0,i.default)(this,bt),(0,i.default)(this,Ot),(0,i.default)(this,Nt),(0,i.default)(this,Ct),(0,i.default)(this,Pt),(0,i.default)(this,Ft),(0,i.default)(this,kt),(0,i.default)(this,Ht),(0,i.default)(this,Yt),(0,i.default)(this,$t),(0,i.default)(this,qt),(0,i.default)(this,Qt),(0,i.default)(this,Xt),(0,i.default)(this,Zt),(0,i.default)(this,er),(0,i.default)(this,rr),(0,i.default)(this,ar),(0,i.default)(this,ir),(0,i.default)(this,ur),(0,i.default)(this,lr),(0,i.default)(this,fr),(0,i.default)(this,gr),(0,i.default)(this,hr),(0,i.default)(this,mr),(0,i.default)(this,yr),(0,i.default)(this,wr),(0,i.default)(this,Ir),(0,i.default)(this,br),(0,i.default)(this,(0,Lr.getImApi)().getApiList())}},867:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getSearchFilesResult=t.getSearchPureTextResult=t.addMoreSearchMessageList=t.searchHistoryMessage=t.deleteTagClick=t.addTagCLick=t.deleteSearchTag=t.messageSearchClose=t.setSearchVal=void 0;var a=r(1),o=n(a),i=r(2),s=n(i),u=r(187),c=r(135),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(c),d=window.Logger("logic")("history/chatHistory"),f=(t.setSearchVal=function(e){return $dispatch(coreUi.setSearchVal(e))},t.messageSearchClose=function(){$dispatch(coreUi.messageSearchClose())},t.deleteSearchTag=function(e){$dispatch(coreUi.deleteSearchTag(e))},t.addTagCLick=function(){var e=(0,s.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=$getState().recent.searchMessageType,t.type!==constant.SEARCH_MESSAGE_TYPE_VALUE.PICTURE){e.next=16;break}e.prev=2,e.t0=r,e.next=e.t0===constant.SEARCH_MESSAGE_TYPE.SEARCH_PICTURE?6:e.t0===constant.SEARCH_MESSAGE_TYPE.SEARCH_FILE_PICTURE?6:8;break;case 6:return d.info("不重复执行",t),e.abrupt("return");case 8:return e.abrupt("break",9);case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(2),d.error("不重复执行",e.t1);case 14:e.next=29;break;case 16:if(t.type!==constant.SEARCH_MESSAGE_TYPE_VALUE.FILE){e.next=29;break}e.prev=17,e.t2=r,e.next=e.t2===constant.SEARCH_MESSAGE_TYPE.SEARCH_FILE?21:e.t2===constant.SEARCH_MESSAGE_TYPE.SEARCH_FILE_PICTURE?21:23;break;case 21:return d.info("不重复执行",t),e.abrupt("return");case 23:return e.abrupt("break",24);case 24:e.next=29;break;case 26:e.prev=26,e.t3=e.catch(17),d.error("不重复执行",e.t3);case 29:return(0,u.onTabClick)("history"),e.next=32,$dispatch(coreUi.addSelectedTag(t));case 32:throttle(f(),100);case 33:case"end":return e.stop()}},e,void 0,[[2,11],[17,26]])}));return function(t){return e.apply(this,arguments)}}(),t.deleteTagClick=function(){var e=(0,s.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$dispatch(coreUi.deleteSearchTag(t));case 3:throttle(f(),100),d.info("deleteTag",t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),d.error("deleteTag",e.t0);case 10:case"end":return e.stop()}},e,void 0,[[0,7]])}));return function(t){return e.apply(this,arguments)}}(),t.searchHistoryMessage=function(){var e=(0,s.default)(o.default.mark(function e(){var t,r,n,a,i,s,u,c,l,f,h,v,m,M,y;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=$getState().recent,r=t.currentRecentInfo,n=t.selectedTagList,a=t.searchMessageType,i=t.searchVal,d.info("searchHistoryMessage",r,n,a,i),s=[],u=function(e,t){return e.utc_stamp-t.utc_stamp},isNullOrEmpty(i)){e.next=63;break}e.prev=5,c=void 0,l=void 0,f=[],e.t0=a,e.next=e.t0===constant.SEARCH_MESSAGE_TYPE.SEARCH_TEXT?10:e.t0===constant.SEARCH_MESSAGE_TYPE.SEARCH_FILE?19:e.t0===constant.SEARCH_MESSAGE_TYPE.SEARCH_PICTURE?31:e.t0===constant.SEARCH_MESSAGE_TYPE.SEARCH_FILE_PICTURE?43:55;break;case 10:return e.next=12,coreDb.queryMessageList({searchtext:i,recent_owner:r.owner});case 12:return c=e.sent,e.next=15,p(c);case 15:return s=e.sent,$dispatch(coreUi.loadHistoryMessageList(s,i)),d.info("查找纯文本",s),e.abrupt("break",56);case 19:return e.next=21,coreDb.queryFileList({recent_owner:r.owner,searchtext:i,utc_stamp:9999999999999,limitcount:window.CLIENTCONFIG.ISMOBILE?window.CLIENTCONFIG.MOBILE_MESSAGE_LIST_PAGE_SIZE:window.CLIENTCONFIG.MESSAGE_LIST_PAGE_SIZE});case 21:return l=e.sent,l.forEach(function(e){isNullOrEmpty(f.query({message_server_chat_id_str:e.message_server_chat_id_str}))&&f.push(e)}),e.next=25,g(f,1);case 25:return s=e.sent,s.sort(u),$dispatch(coreUi.loadHistoryMessageList(s,i)),isNullOrEmpty(s)||$dispatch(coreUi.setHistoryMessageSearchInfo(s[0].utc_stamp)),d.info("查找文件+关键字",s),e.abrupt("break",56);case 31:return e.next=33,coreDb.queryFileList({recent_owner:r.owner,searchtext:i,utc_stamp:9999999999999,limitcount:1e4});case 33:return l=e.sent,l.forEach(function(e){isNullOrEmpty(f.query({message_server_chat_id_str:e.message_server_chat_id_str}))&&f.push(e)}),e.next=37,g(f,2);case 37:return s=e.sent,s.sort(u),$dispatch(coreUi.loadHistoryMessageList(s,i)),isNullOrEmpty(s)||$dispatch(coreUi.setHistoryMessageSearchInfo(s[0].utc_stamp)),d.info("查找图片+关键字",s),e.abrupt("break",56);case 43:return e.next=45,coreDb.queryFileList({recent_owner:r.owner,searchtext:i,utc_stamp:9999999999999,limitcount:1e4});case 45:return l=e.sent,l.forEach(function(e){isNullOrEmpty(f.query({message_server_chat_id_str:e.message_server_chat_id_str}))&&f.push(e)}),e.next=49,g(f,3);case 49:return s=e.sent,s.sort(u),$dispatch(coreUi.loadHistoryMessageList(s,i)),isNullOrEmpty(s)||$dispatch(coreUi.setHistoryMessageSearchInfo(s[0].utc_stamp)),d.info("查找图文+关键字",s),e.abrupt("break",56);case 55:return e.abrupt("break",56);case 56:e.next=61;break;case 58:e.prev=58,e.t1=e.catch(5),d.error("精确消息查找fail",{searchVal:i,error:e.t1});case 61:e.next=124;break;case 63:e.prev=63,h=void 0,v=[],m=void 0,M=void 0,y=void 0,e.t2=a,e.next=e.t2===constant.SEARCH_MESSAGE_TYPE.SEARCH_FILE?68:e.t2===constant.SEARCH_MESSAGE_TYPE.SEARCH_PICTURE?80:e.t2===constant.SEARCH_MESSAGE_TYPE.SEARCH_FILE_PICTURE?99:118;break;case 68:return e.next=70,coreDb.queryFileList({recent_owner:r.owner,searchtext:"",utc_stamp:9999999999999,limitcount:window.CLIENTCONFIG.ISMOBILE?window.CLIENTCONFIG.MOBILE_MESSAGE_LIST_PAGE_SIZE:window.CLIENTCONFIG.MESSAGE_LIST_PAGE_SIZE});case 70:return h=e.sent,h.forEach(function(e){isNullOrEmpty(v.query({message_server_chat_id_str:e.message_server_chat_id_str}))&&v.push(e)}),e.next=74,g(v,1);case 74:return s=e.sent,s.sort(u),$dispatch(coreUi.loadHistoryMessageList(s,i)),isNullOrEmpty(s)||$dispatch(coreUi.setHistoryMessageSearchInfo(s[0].utc_stamp)),d.info("查找文件",s),e.abrupt("break",119);case 80:return e.next=82,coreDb.queryFileList({recent_owner:r.owner,searchtext:"",utc_stamp:9999999999999,limitcount:1e4});case 82:return h=e.sent,h.forEach(function(e){isNullOrEmpty(v.query({message_server_chat_id_str:e.message_server_chat_id_str}))&&v.push(e)}),e.next=86,g(v,2);case 86:return m=e.sent,e.next=89,coreDb.queryScreenShotList({recent_owner:r.owner});case 89:return M=e.sent,e.next=92,_(M);case 92:return y=e.sent,s=m.concat(y),s.sort(u),$dispatch(coreUi.loadHistoryMessageList(s,i)),isNullOrEmpty(s)||$dispatch(coreUi.setHistoryMessageSearchInfo(s[0].utc_stamp)),d.info("查找图片",s),e.abrupt("break",119);case 99:return e.next=101,coreDb.queryFileList({recent_owner:r.owner,searchtext:"",utc_stamp:9999999999999,limitcount:1e4});case 101:return h=e.sent,h.forEach(function(e){isNullOrEmpty(v.query({message_server_chat_id_str:e.message_server_chat_id_str}))&&v.push(e)}),e.next=105,g(v,3);case 105:return m=e.sent,e.next=108,coreDb.queryScreenShotList({recent_owner:r.owner});case 108:return M=e.sent,e.next=111,_(M);case 111:return y=e.sent,s=m.concat(y),s.sort(u),$dispatch(coreUi.loadHistoryMessageList(s,i)),isNullOrEmpty(s)||$dispatch(coreUi.setHistoryMessageSearchInfo(s[0].utc_stamp)),d.info("查找图文",s),e.abrupt("break",119);case 118:return e.abrupt("break",119);case 119:e.next=124;break;case 121:e.prev=121,e.t3=e.catch(63),d.error("模糊消息查找fail",e.t3.toJSON());case 124:case"end":return e.stop()}},e,void 0,[[5,58],[63,121]])}));return function(){return e.apply(this,arguments)}}()),p=(t.addMoreSearchMessageList=function(){var e=(0,s.default)(o.default.mark(function e(){var t,r,n,a,i,s,u,c,l,f,p,_;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=$getState().recent,r=t.currentRecentInfo,n=t.selectedTagList,a=t.searchMessageType,i=t.searchVal,s=t.currentLastSearchMessageUtcStamp,d.info("addMoreHistoryMessage",r,n,a,i),u=[],c=function(e,t){return e.utc_stamp-t.utc_stamp},isNullOrEmpty(i)){e.next=30;break}e.prev=5,l=void 0,f=[],e.t0=a,e.next=e.t0===constant.SEARCH_MESSAGE_TYPE.SEARCH_FILE?10:22;break;case 10:return e.next=12,coreDb.queryFileList({recent_owner:r.owner,searchtext:i,utc_stamp:s,limitcount:window.CLIENTCONFIG.ISMOBILE?window.CLIENTCONFIG.MOBILE_MESSAGE_LIST_PAGE_SIZE:window.CLIENTCONFIG.MESSAGE_LIST_PAGE_SIZE});case 12:return l=e.sent,l.forEach(function(e){isNullOrEmpty(f.query({message_server_chat_id_str:e.message_server_chat_id_str}))&&f.push(e)}),e.next=16,g(f,1);case 16:return u=e.sent,u.sort(c),$dispatch(coreUi.addSearchMessage(u)),isNullOrEmpty(u)||$dispatch(coreUi.setHistoryMessageSearchInfo(u[0].utc_stamp)),d.info("加载更多[文件+关键字]",u),e.abrupt("break",23);case 22:return e.abrupt("break",23);case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(5),d.error("加载精确消息查找fail",{searchVal:i,error:e.t1});case 28:e.next=53;break;case 30:e.prev=30,p=void 0,_=[],e.t2=a,e.next=e.t2===constant.SEARCH_MESSAGE_TYPE.SEARCH_FILE?35:47;break;case 35:return e.next=37,coreDb.queryFileList({recent_owner:r.owner,searchtext:"",utc_stamp:s,limitcount:window.CLIENTCONFIG.ISMOBILE?window.CLIENTCONFIG.MOBILE_MESSAGE_LIST_PAGE_SIZE:window.CLIENTCONFIG.MESSAGE_LIST_PAGE_SIZE});case 37:return p=e.sent,p.forEach(function(e){isNullOrEmpty(_.query({message_server_chat_id_str:e.message_server_chat_id_str}))&&_.push(e)}),e.next=41,g(_,1);case 41:return u=e.sent,u.sort(c),$dispatch(coreUi.addSearchMessage(u)),isNullOrEmpty(u)||$dispatch(coreUi.setHistoryMessageSearchInfo(u[0].utc_stamp)),d.info("加载更多文件",u),e.abrupt("break",48);case 47:return e.abrupt("break",48);case 48:e.next=53;break;case 50:e.prev=50,e.t3=e.catch(30),d.error("加载模糊消息查找fail",e.t3);case 53:case"end":return e.stop()}},e,void 0,[[5,25],[30,50]])}));return function(){return e.apply(this,arguments)}}(),t.getSearchPureTextResult=function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n,a,i;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],n=0;n<t.length;n++)a=t[n],(i=t[n].media_type)===constant.MEDIA_TYPE.TEXT&&r.push(a);return e.abrupt("return",r);case 3:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()),g=t.getSearchFilesResult=function(){var e=(0,s.default)(o.default.mark(function e(t,r){var n,a,i,s,u;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],a=0;case 2:if(!(a<t.length)){e.next=12;break}return i=t[a].file_name,e.next=6,coreDb.queryMessage({server_chat_id_str:t[a].message_server_chat_id_str});case 6:s=e.sent,u=s.media_type,u!==constant.MEDIA_TYPE.FILE&&u!==constant.MEDIA_TYPE.AUDIO&&u!==constant.MEDIA_TYPE.VIDEO||(1===r?l.getMediaType(i)!==constant.MEDIA_TYPE.PHOTO&&n.push(s):2===r?l.getMediaType(i)===constant.MEDIA_TYPE.PHOTO&&n.push(s):3===r&&n.push(s));case 9:a++,e.next=2;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}(),_=function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n,a,i;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=0;case 2:if(!(n<t.length)){e.next=11;break}return e.next=5,coreDb.queryMessage({server_chat_id_str:t[n].message_server_chat_id_str});case 5:a=e.sent,i=a.media_type,i!==constant.MEDIA_TYPE.SCREEN_SHOT&&i!==constant.MEDIA_TYPE.PHOTO||r.push(a);case 8:n++,e.next=2;break;case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()},868:function(e,t,r){"use strict";function n(e){$dispatch(coreUi.addAtMessage(e))}function a(e){$dispatch(coreUi.deleteAtMessage(e))}Object.defineProperty(t,"__esModule",{value:!0}),t.addAtMessage=n,t.deleteAtMessage=a},869:function(e,t,r){"use strict";function n(){var e={};this.__proto__={init:function(){e={}},set:function(t,r){e[t]=r},get:function(t){return e[t]},getAll:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return isNullOrEmpty(t)?e:Object.queryAll(e,t)},delete:function(t){delete e[t]}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},870:function(e,t,r){"use strict";function n(){function e(){if(!n&&(n=window.Logger("model")("IMService/screenShotUploadNotify")),0===t.length)return n.debug("dealPromiseQueue function's queue deal over"),r=!1,o.default.resolve(!0);var a=t.shift();n.debug("dealPromiseQueue function's queue is dealing"),a().then(e)}var t=[],r=!1,n=void 0;this.__proto__={addQueueFunc:function(e){t.push(e)},runQueueFunc:function(){r||(r=!0,e())}}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(3),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default=n},871:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.getImgList=t.updateMessageQueryInfo=t.backwardQueryMessage=t.forwardQueryMessage=t.loadHistoryMessageList=void 0;var a=r(1160),o=n(a),i=r(1161),s=n(i),u=r(1162),c=n(u),l=r(872),d=(n(l),r(802)),f=n(d),p=r(987),g=n(p);t.loadHistoryMessageList=o.loadHistoryMessageList,t.forwardQueryMessage=s.forwardQueryMessage,t.backwardQueryMessage=c.backwardQueryMessage,t.updateMessageQueryInfo=f.updateMessageQueryInfo,t.getImgList=g.getImgList},872:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r,n,a){for(var o=t;o<r;o++){if(n.smallTime>a[o].smallTime){if(f.debug("dealSmallSign 符合区间判断条件"),o===t){f.debug("dealSmallSign 只涉及一个区间");var i=g(a[t],n);e.splice.apply(e,[t,1].concat((0,c.default)(i)))}else{f.debug("dealSmallSign 涉及多个区间");var s=g(a[t],n),u=g(s[s.length-1],a[o]);s.splice.apply(s,[s.length-1,1].concat((0,c.default)(u))),e.splice.apply(e,[t,o-t+1].concat((0,c.default)(s))),f.debug("dealSmallSign 区间跳跃",t+" => "+o)}t=o;break}if(o===r-1){f.debug("dealSmallSign 直到最后一条都不符合区间判断条件");var l=g(a[t],n);e.splice.apply(e,[t,1].concat((0,c.default)(l))),t=o;break}}return{retMsgSignArr:e,newI:t}}function o(e,t,r,n,a){for(var o=t;o<r;o++){if(n.smallTime>a[o].smallTime){if(f.debug("mergeAndDealMessageSign 符合区间判断条件"),o===t){f.debug("mergeAndDealMessageSign 只涉及一个区间");var i=g(n,a[t]);e.splice.apply(e,[t,1].concat((0,c.default)(i)))}else{f.debug("mergeAndDealMessageSign 涉及多个区间");var s=g(n,a[o]);e.splice.apply(e,[t,o-t+1].concat((0,c.default)(s))),f.debug("mergeAndDealMessageSign 区间跳跃",t+" => "+o)}t=o;break}if(o===r-1){f.debug("mergeAndDealMessageSign 直到最后一条都不符合区间判断条件"),e.splice(t,1,n),t=o;break}}return{retMsgSignArr:e,newI:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.isLocalHas=t.dealMessageSign=void 0;var i=r(103),s=n(i),u=r(106),c=n(u),l=r(187),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(l),f=window.Logger("logic")("IM/historyMessageDeal"),p=(t.dealMessageSign=function(e,t){try{f.debug("dealMessageSign");var r=t.messageSign,n=[];return n=isNullOrEmpty(r)?[e]:p(e,t),t.messageSign=n,coreDb.saveRecent(t),d.refreshRecentList(t),n}catch(e){f.error("dealMessageSign",e.toString())}},t.isLocalHas=function(e,t){var r=t.messageSign;if(f.info("isLocalMessage 获取记录信息"),isNullOrEmpty(r))return!1;for(var n=!1,a=0;a<r.length;a++)if((r[a].queryTime>=e.queryTime||r[a].bigTime>=e.bigTime)&&r[a].smallTime<=e.smallTime){f.info("isLocalMessage 在范围内，不需额外处理"),n=!0;break}return n},function(e,t){f.debug("mergeAndDealMessageSign");for(var r=t.messageSign,n=[],i=r.length,s=0;s<i;s++)if(e.queryTime<=r[s].queryTime)if(f.debug("mergeAndDealMessageSign 新区间小于当前区间"),s===i-1){var u;f.debug("mergeAndDealMessageSign 当前处于最后一条");var l=g(r[s],e);(u=n).splice.apply(u,[s,1].concat((0,c.default)(l)))}else{f.debug("mergeAndDealMessageSign 循环判断，寻找区间");var d=a(n,s,i,e,r);n=d.retMsgSignArr,s=d.newI}else if(f.debug("mergeAndDealMessageSign 新区间大于当前区间"),0===s)if(f.debug("mergeAndDealMessageSign 当前处于第一条"),e.smallTime>=r[s].smallTime){var p,_=g(e,r[s]);(p=n).splice.apply(p,[s,1].concat((0,c.default)(_)))}else{f.debug("mergeAndDealMessageSign 循环判断，寻找区间");var h=o(n,s,i,e,r);n=h.retMsgSignArr,s=h.newI}else f.debug("mergeAndDealMessageSign 当前不处于第一条"),n.push(r[s]);return n}),g=function(e,t){try{var r=[];if(f.debug("dealTwoSign"),t.bigTime>=e.smallTime||t.queryTime>=e.smallTime)if(t.smallTime>=e.smallTime)f.debug("dealTwoSign 大区域包含小区域"),r=[(0,s.default)({},e)];else{f.debug("dealTwoSign 小区域与大区域有交叉");var n=(0,s.default)({},e);n.smallTime=t.smallTime,r=[n]}else f.debug("dealTwoSign 小区域与大区域无交叉"),r=[e,t];return r}catch(r){return f.error("dealTwoSign 不合并标记",r.toString()),[e,t]}}},873:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.checkFileTransFerInRecent=t.checkFileTransFer=t.checkEditorBeforeLogout=t.checkEditor=t.checkOffLineRspNotify=t.checkOfflineFileRequest=void 0;var a=r(1),o=n(a),i=r(2),s=n(i),u=r(3),c=n(u),l=r(159),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(l),f=(r(486),r(513)),p=window.Logger("logic")("IM/异常检查处理"),g=(t.checkOfflineFileRequest=function(e){try{return p.info("checkOfflineFileRequest"),!1===e?e:g(e.result)===constant.OffLineErrorCode.OK?(p.debug("checkOfflineFileRequest 结果正常"),e):(p.error("checkOfflineFileRequest 结果不正常",e.result,constant.ErrorLogInfo[e.result]),!1)}catch(e){return p.error("checkOfflineFileRequest 结果不正常",e.toString()),!1}},t.checkOffLineRspNotify=function(e){try{return p.info("checkOffLineRspNotify"),g(e.param.code)===constant.OffLineErrorCode.OK?200===e.param.filersp.status_code||(p.error("checkOffLineRspNotify 结果不正常",e.param.filersp.status_code,e.param.filersp.code_msg),!1):(p.error("checkOffLineRspNotify 结果不正常",e.param.code,constant.ErrorLogInfo[e.param.code]),!1)}catch(e){return p.error("checkOffLineRspNotify 结果不正常",e.toString()),!1}},function(e){return e>constant.ERR_START?e-constant.ERR_START:e});t.checkEditor=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"COMMON_ALERT",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];try{if(p.info("checkEditor"),coreCommon.hasEditorContent()){var n=window.confirm(e,t,r);return c.default.resolve(n.ret)}return c.default.resolve(!0)}catch(e){return p.error("checkEditor check异常，强制通过",e.toString()),c.default.resolve(!0)}},t.checkEditorBeforeLogout=function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"COMMON_ALERT",a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,p.info("checkEditorBeforeLogout"),!coreCommon.hasEditorContent()){e.next=8;break}return e.next=5,window.confirm(t,n,a);case 5:return r=e.sent,r.ret&&(delegate.$getUmEditor=null),e.abrupt("return",r.ret);case 8:return e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(0),p.error("checkEditor check异常，强制通过",e.t0.toString()),e.abrupt("return",!0);case 15:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),t.checkFileTransFer=function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"COMMON_ALERT",i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,p.info("checkFileTransFer"),r=d.getFileHandleMap(),!isNullOrEmpty(r)){e.next=6;break}return p.info("checkFileTransFer 没有正在传输的文件"),e.abrupt("return",!0);case 6:if(p.debug("checkFileTransFer",r),n=void 0,!s){e.next=14;break}return e.next=11,window.confirm(t,a,i);case 11:n=e.sent,e.next=15;break;case 14:n={ret:!0};case 15:return n.ret&&d.initFileHandleMap(),e.abrupt("return",n);case 19:return e.prev=19,e.t0=e.catch(0),p.error("checkFileTransFer  check异常，强制通过",e.t0.toString()),d.initFileHandleMap(),e.abrupt("return",!0);case 24:case"end":return e.stop()}},e,void 0,[[0,19]])}));return function(t){return e.apply(this,arguments)}}(),t.checkFileTransFerInRecent=function(){var e=(0,s.default)(o.default.mark(function e(t,r){var n,a,i,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,f.checkFileTransferInCurrentRecent)(t);case 3:if(n=e.sent,a={ret:!0},i="COMMON_ALERT",s=!0,!n){e.next=11;break}return e.next=10,window.confirm(r,i,s);case 10:a=e.sent;case 11:return e.abrupt("return",a);case 14:return e.prev=14,e.t0=e.catch(0),p.error("checkFileTransFerInRecent  check异常，强制通过",e.t0.toString()),e.abrupt("return",{ret:!0});case 18:case"end":return e.stop()}},e,void 0,[[0,14]])}));return function(t,r){return e.apply(this,arguments)}}()},874:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e,t){try{return d.info("groupFilePreUpload"),u.groupFilePreUpload({group_id:t.group_id,file_name:e.file_name,file_size:e.file_size}).then(function(r){return""!==r?l.setGroupFileByHandle(t.group_id+e.file_real_save_path,{pre_file_id:r}):d.error("groupFilePreUpload im预上传失败"),i.default.resolve(r)})}catch(e){return d.error("groupFilePreUpload",e.toString()),i.default.resolve("")}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),i=function(e){return e&&e.__esModule?e:{default:e}}(o);t.groupFilePreUpload=a;var s=r(213),u=n(s),c=r(159),l=n(c),d=window.Logger("logic")("IM/groupFile")},875:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UTImpl=t.getUtApi=void 0;var a=r(217),o=n(a),i=r(1),s=n(i),u=r(2),c=n(u),l=r(95),d=n(l),f=r(4),p=n(f),g=r(93),_=n(g),h=r(94),v=n(h),m=r(988),M=n(m),y=r(803),E=n(y),w=r(991),S=n(w),I=r(992),T=n(I),b=r(993),L=n(b),O=r(804),R=n(O),N=window.Logger("UT")("logic/usertrack"),A=void 0,C=(t.getUtApi=function(){return isNullOrEmpty(A)&&(A=new C),A},t.UTImpl=function(e){function t(){var e=this;(0,p.default)(this,t);var r=(0,_.default)(this,(t.__proto__||(0,d.default)(t)).call(this));return r.utConfigAccountInfo=function(e){isNullOrEmpty(e)||(R.default.getInstance().account=e)},r.utPageAppear=function(){var t=(0,c.default)(s.default.mark(function t(n){var a,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&0!==n.length){e.next=3;break}return N.warn("[UT]pageName is empty!"),e.abrupt("return");case 3:a=r.utPageInfo.pageTreeIndexByPageName(n),o=new E.default(constant.EVENT_ID.UT_PAGE,[a,n,constant.UT_PAGE_ACTION.UT_PAGE_APPEAR]),r.utManager.addTrackerData(o);case 6:case"end":return e.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}(),r.utPageDisappear=function(){var t=(0,c.default)(s.default.mark(function t(n,a){var o,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&0!==n.length){e.next=3;break}return N.warn("[UT]pageName is empty!"),e.abrupt("return");case 3:o=r.utPageInfo.pageTreeIndexByPageName(n),i=new E.default(constant.EVENT_ID.UT_PAGE,[o,n,constant.UT_PAGE_ACTION.UT_PAGE_DISAPPEAR,a]),r.utManager.addTrackerData(i);case 6:case"end":return e.stop()}},t,e)}));return function(e,r){return t.apply(this,arguments)}}(),r.utPageLoad=function(){var t=(0,c.default)(s.default.mark(function t(n,a){var o,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&0!==n.length){e.next=3;break}return N.warn("[UT]pageName is empty!"),e.abrupt("return");case 3:o=r.utPageInfo.pageTreeIndexByPageName(n),i=new E.default(constant.EVENT_ID.UT_PAGE,[o,n,constant.UT_PAGE_ACTION.UT_PAGE_LOAD_TIMES,a]),r.utManager.addTrackerData(i);case 6:case"end":return e.stop()}},t,e)}));return function(e,r){return t.apply(this,arguments)}}(),r.utConfOperate=function(){var t=(0,c.default)(s.default.mark(function t(n,a){var o,i,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return N.warn("[UT]eventId is empty!"),e.abrupt("return");case 3:o=new Array,i=coreConf.getCurrentConfId(),i&&o.push(i),a instanceof Array&&a.length>0&&(o=o.concat(a)),u=new E.default(n,o),r.utManager.addTrackerData(u);case 9:case"end":return e.stop()}},t,e)}));return function(e,r){return t.apply(this,arguments)}}(),r.utCustomEvent=function(){var t=(0,c.default)(s.default.mark(function t(n,a){var o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return N.warn("[UT]eventId is empty!"),e.abrupt("return");case 3:o=new E.default(n,a),r.utManager.addTrackerData(o);case 5:case"end":return e.stop()}},t,e)}));return function(e,r){return t.apply(this,arguments)}}(),r.utHandleNativeCrashInfoScan=(0,c.default)(s.default.mark(function t(){var n,a,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,appService.nativeCrashInfoFetch();case 2:if(!((n=e.sent)instanceof Array&&n.length>0)){e.next=13;break}a=0;case 5:if(!(a<n.length)){e.next=12;break}return o=new E.default(constant.EVENT_ID.UT_CRASH,[n[a]]),e.next=9,r.utManager.addTrackerData(o);case 9:a++,e.next=5;break;case 12:appService.nativeCrashTrackedDeal(n);case 13:case"end":return e.stop()}},t,e)})),r.utEventStart=function(e,t,n){if(!e)return void N.warn("[UT]eventId is empty!");var a=e;isNullOrEmpty(t)||(a=e+t);var o=new L.default(n);r.actionResponseUTInfos.set(a,o)},r.utEventFinish=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e)return void N.warn("[UT]eventId is empty!");var o=e;isNullOrEmpty(t)||(o=e+t);var i=r.actionResponseUTInfos.get(o);if(!i)return void N.warn("[UT]actionResponseInfo for key"+o+" is not found in actionResponseUTInfos");var s=new Array;if(i.params.length>0&&(s=s.concat(i.params)),n.length>0&&(s=s.concat(n)),a){var u=Date.now()-i.actionTime;u<0&&(N.warn("[UT]action response time cost less than 0!"),u=0),s.push(u)}var c=new E.default(e,s);r.utManager.addTrackerData(c),r.actionResponseUTInfos.delete(o)},r.utHandleFileTransfer=function(){var t=(0,c.default)(s.default.mark(function t(n,a,o,i,u){var c,l,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!isNullOrEmpty(n)){e.next=3;break}return N.warn("[UT]sendAccount is empty!"),e.abrupt("return");case 3:if(!isNullOrEmpty(a)){e.next=6;break}return N.warn("[UT]recvAccount is empty!"),e.abrupt("return");case 6:if(!isNullOrEmpty(o)){e.next=9;break}return N.warn("[UT] ipAddress is empty!"),e.abrupt("return");case 9:if(!isNullOrEmpty(i)){e.next=12;break}return N.warn("[UT]fileName is empty!"),e.abrupt("return");case 12:if(!isNullOrEmpty(u)){e.next=15;break}return N.warn("[UT]fileSize is empty!"),e.abrupt("return");case 15:c=[n,a,o,i,u],isNullOrEmpty(d)||c.push(d),l=new E.default(constant.EVENT_ID.UT_FILE_TRANSFER,c),r.utManager.addTrackerData(l);case 19:case"end":return e.stop()}},t,e)}));return function(e,r,n,a,o){return t.apply(this,arguments)}}(),r.utHandleMobileSystemBroken=(0,c.default)(s.default.mark(function t(){var n,a,o,i,u,c;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("mac"!==(n=window.CLIENTCONFIG.PLATFORM)&&"win"!==n){e.next=4;break}return N.info("[UT]utHandleMobileSystemBroken ignore desktop client!"),e.abrupt("return");case 4:return e.next=6,appService.isSystemBroken();case 6:if(a=e.sent,N.info("[UT]utHandleMobileSystemBroken isSystem broken:",a),!a){e.next=19;break}if(o=R.default.getInstance().account,!isNullOrEmpty(o)){e.next=13;break}return N.warn("[UT]utHandleMobileSystemBroken acount is empty!"),e.abrupt("return");case 13:return i=appService.getReceiveFilesPath(o),e.next=16,appService.fileCountInPath(i);case 16:u=e.sent,c=new E.default(constant.EVENT_ID.UT_FILE_TRANSFER,[u]),r.utManager.addTrackerData(c);case 19:case"end":return e.stop()}},t,e)})),r.instance=null,r.utManager=S.default.getInstance(),r.utPageInfo=new T.default,r.actionResponseUTInfos=new o.default,r.utHandleNativeCrashInfoScan(),r}return(0,v.default)(t,e),t}(M.default))},93:function(e,t,r){e.exports=r(0)(45)},94:function(e,t,r){e.exports=r(0)(47)},95:function(e,t,r){e.exports={default:r(143),__esModule:!0}},973:function(e,t,r){e.exports={default:r(974),__esModule:!0}},974:function(e,t,r){r(975),e.exports=r(8).Object.values},975:function(e,t,r){var n=r(10),a=r(976)(!1);n(n.S,"Object",{values:function(e){return a(e)}})},976:function(e,t,r){var n=r(153),a=r(503),o=r(977).f;e.exports=function(e){return function(t){for(var r,i=a(t),s=n(i),u=s.length,c=0,l=[];u>c;)o.call(i,r=s[c++])&&l.push(e?[r,i[r]]:i[r]);return l}}},977:function(e,t,r){e.exports=r(0)(67)},98:function(e,t,r){e.exports=r(0)(276)},981:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";window.Logger("model")("recentService").info(e+" initService"),c(),l(),d(),u.default.initRecentUpdateSubscribeMap()}Object.defineProperty(t,"__esModule",{value:!0}),t.getUnReadApplyGroupNotifyNumMap=t.deleteUnReadApplyGroupNotifyNumMap=t.updateUnReadApplyGroupNotifyNumMap=t.initUnReadApplyGroupNotifyNumMap=t.getUnReadNumMap=t.deleteUnReadNumMap=t.updateUnReadNumMap=t.initUnReadNumMap=t.deleteAtMap=t.getAtMap=t.updateAtMap=t.initAtMap=t.recentUpdateSubscribe=void 0,t.initRecentService=a;var o=r(1785),i=n(o),s=r(1786),u=n(s);t.recentUpdateSubscribe=u.default;var c=t.initAtMap=i.default.initAtMap,l=(t.updateAtMap=i.default.updateAtMap,t.getAtMap=i.default.getAtMap,t.deleteAtMap=i.default.deleteAtMap,t.initUnReadNumMap=i.default.initUnReadNumMap),d=(t.updateUnReadNumMap=i.default.updateUnReadNumMap,t.deleteUnReadNumMap=i.default.deleteUnReadNumMap,t.getUnReadNumMap=i.default.getUnReadNumMap,t.initUnReadApplyGroupNotifyNumMap=i.default.initUnReadApplyGroupNotifyNumMap);t.updateUnReadApplyGroupNotifyNumMap=i.default.updateUnReadApplyGroupNotifyNumMap,t.deleteUnReadApplyGroupNotifyNumMap=i.default.deleteUnReadApplyGroupNotifyNumMap,t.getUnReadApplyGroupNotifyNumMap=i.default.getUnReadApplyGroupNotifyNumMap;window.recentListService=i.default},982:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=window.Logger("service")("IM/recentUtil");t.getRecentOwner=function(e){try{return isNullOrEmpty(e.owner)?coreIm.isGroup(e.chat_type)?e.group.group_id:e.contact.account:e.owner}catch(e){return n.error("getRecentOwner",e.toString()),null}},t.isShowRecent=function(e){var t=e.is_delete,r=e.contact,n=e.group,a=e.chat_type,o=e.last_message;if(t===constant.IS_DELETE.YES)return!1;if(coreIm.isGroup(a)){if(isNullOrEmpty(n)&&isNullOrEmpty(o))return!1}else if(isNullOrEmpty(r)&&isNullOrEmpty(o))return!1;return!0},t.getChatTypeByGroup=function(e){return e.group_type===constant.GROUP_TYPE.FIXED_GROUP?constant.CHAT_TYPE.GROUP_CHAT:constant.CHAT_TYPE.DISCUSSION_GROUP}},983:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.dealServerRecentList=t.loadLocalRecentList=void 0;var o=r(106),i=a(o),s=r(110),u=a(s),c=r(103),l=a(c),d=r(1),f=a(d),p=r(2),g=a(p),_=r(1146),h=n(_),v=r(135),m=n(v),M=r(159),y=n(M),E=window.Logger("logic")("recent/list"),w=(t.loadLocalRecentList=function(){var e=(0,g.default)(f.default.mark(function e(){var t;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.CLIENTCONFIG.ENABLE_IT_MEETING){e.next=3;break}return E.info("loadLocalRecentList ENABLE_IT_MEETING return"),e.abrupt("return");case 3:return E.info("loadLocalRecentList queryAllRecent Pre"),showDealTime("loadLocalRecentList queryAllRecent Pre"),e.next=7,coreDb.queryAllRecent();case 7:t=e.sent,E.info("loadLocalRecentList render all local recent count:"+t.length),T(t);case 10:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),t.dealServerRecentList=function(){var e=(0,g.default)(f.default.mark(function e(){var t;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,E.info("dealServerRecentList"),!window.CLIENTCONFIG.ENABLE_IT_MEETING){e.next=5;break}return E.info("dealServerRecentList ENABLE_IT_MEETING return"),e.abrupt("return");case 5:if(coreUi.addDefaultQuickReplyList(),y.setRecentListReady(!1),window.isEserverOnline){e.next=11;break}return E.error("dealServerRecentList isEserverOnline ",window.isEserverOnline),coreIm.dealUnDealMessageList(),e.abrupt("return");case 11:return e.next=13,h.getRecentConversation();case 13:if(t=e.sent,!isNullOrEmpty(t)){e.next=18;break}return E.error("dealServerRecentList serverRecentList is empty"),coreIm.dealUnDealMessageList(),e.abrupt("return");case 18:w(t.map(function(e){return b(e)})),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(0),E.error("dealServerRecentList",e.t0),coreIm.dealUnDealMessageList();case 25:case"end":return e.stop()}},e,void 0,[[0,21]])}));return function(){return e.apply(this,arguments)}}(),function(){var e=(0,g.default)(f.default.mark(function e(t){var r;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,E.info("saveNewRecentList count","server:"+t.length),coreIm.subscribeRecentList(t),e.next=5,coreDb.queryAllRecent();case 5:return r=e.sent,e.next=8,S(t,r);case 8:return t=e.sent,e.next=11,I(t);case 11:t=e.sent,$dispatch(coreUi.updateRecent(t)),coreIm.dealUnDealMessageList(),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),E.error("saveNewRecentList",e.t0);case 19:case"end":return e.stop()}},e,void 0,[[0,16]])}));return function(t){return e.apply(this,arguments)}}()),S=function(){var e=(0,g.default)(f.default.mark(function e(t,r){var n,a,o,i,s,c,d;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,E.info("dealRecentContactOrGroupInfo"),n=[],a={},o=[],i={},t=t.map(function(e){if(isNullOrEmpty(e.owner))return E.error("saveNewRecentList serverRecent has no owner，no deal"),e;var t=r.query({owner:e.owner});if(!isNullOrEmpty(t)){var s=(0,l.default)({},t);return(t.time_stamp<e.time_stamp||isNullOrEmpty(t.owner))&&(s.time_stamp=e.time_stamp,s.last_message=e.last_message),m.isGroup(s.chat_type)?isNullOrEmpty(s.group)&&(n.push(s.owner),a[s.owner]=s):isNullOrEmpty(s.contact)&&(o.push(s.owner),i[s.owner]=s),s}return m.isGroup(e.chat_type)?(n.push(e.owner),a[e.owner]=e):(o.push(e.owner),i[e.owner]=e),e}),e.next=7,coreContact.getContactListByAccountList(o,!0);case 7:return s=e.sent,s.forEach(function(e){if(!isNullOrEmpty(e)){var r=i[e.account];r.contact=(0,l.default)({},e),delete i[e.account],t=t.update(["owner"],r)}}),e.next=11,coreDb.queryGroupListByIdList(n.join(","));case 11:return c=e.sent,c.forEach(function(e){var r=a[e.group_id];r.group=(0,l.default)({},e),delete a[e.group_id],t=t.update(["owner"],r)}),d=(0,u.default)(a),d.forEach(function(e){return coreGroup.getGroupInfo(e)}),e.abrupt("return",t);case 18:return e.prev=18,e.t0=e.catch(0),E.error("dealRecentContactOrGroupInfo",e.t0),e.abrupt("return",t);case 22:case"end":return e.stop()}},e,void 0,[[0,18]])}));return function(t,r){return e.apply(this,arguments)}}(),I=function(){var e=(0,g.default)(f.default.mark(function e(t){var r,n,a,o;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,E.info("dealLastMessage"),r=[],n=[],a=0;a<t.length;a++)t[a].last_message&&(r.push(t[a].last_message),n.push(t[a]));return e.next=7,coreIm.dealRecentLastMessageList(r,n);case 7:return o=e.sent,t=t.update(["owner"],o),e.abrupt("return",t);case 12:e.prev=12,e.t0=e.catch(0),E.error("dealLastMessage",e.t0);case 15:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t){return e.apply(this,arguments)}}(),T=function(e){try{E.info("loadHistoryRecentList");var t=[].concat((0,i.default)(e));t.map(function(e){return m.isGroup(e.chat_type)?"":e.owner}).splitByNum(20).forEach(function(e){coreUi.getContactListAvatar(e)}),$dispatch(coreUi.loadRecentList(t)),coreIm.subscribeRecentList(t)}catch(e){E.error("loadHistoryRecentList",e)}},b=function(e){var t={chat_type:e.type,owner:e.account,time_stamp:e.utc_time,last_message:e.chat_info,stick_on_top:0,is_delete:constant.IS_DELETE.NO};return m.isGroup(t.chat_type)?(t.group_id=t.owner,t.group={}):(t.account=t.owner,t.contact={}),t}},984:function(e,t,r){"use strict";function n(){var e=[];this.__proto__={init:function(){e=[]},set:function(t,r){e.update(t,r)},get:function(t){return e.query(t)},getList:function(t){return e.queryList(t)},getAll:function(){return[].concat((0,o.default)(e))},delete:function(t){e=e.delete(t)}}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(106),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default=n},985:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transformGroupNotifyMessage=t.transformMessageContentEmotion=t.createOldImageItem=t.createPhotoList=t.createFileRootElem=t.createMobileQuoteRootElem=t.createQuoteRootElem=t.createMobileRootElem=t.createRootElem=t.transformHtmlLike=t.transformHtmlEmotion=t.createFileContentText=t.createVideoContentText=t.createPhotoTextContentText=void 0;var n=r(135),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n),o=window.Logger("logic")("IM/message/transform"),i=function(){var e=["address","blockquote","center","dir","div","dl","fieldset","form","h1","h2","h3","h4","h5","h6","hr","isindex","menu","noframes","ol","p","pre","table","ul"],t={};return e.forEach(function(e){t[e]=1,t[e.toLocaleUpperCase()]=1}),t}(),s={img:1,IMG:1},u=function(e){return e.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<([^>]+)>/g,function(e,t,r){var n="/"===t[0],a=t.split(/\s/)[0];return n&&(a=a.substr(1)),s[a]?e:n&&i[a]?"\n":""})},c=(t.createPhotoTextContentText=function(e,t,r){var n={};return t.forEach(function(e){n[e.file_name]=e}),r=r.replace(/\&nbsp;/g," "),u(r).replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/gi,function(e,t,r,a){var o=getFileName(t),i=n[o];if(i)return"/:um_begin{"+i.um_url+"|Img|0|"+i.file_name+"|0|"+(i.width||"auto")+";"+(i.height||"auto")+";"+i.um_plain_access_code+"}/:um_end";var s=constant.emotion[o];return s?s.character:""})},t.createVideoContentText=function(e){return"/:um_begin{"+e.um_url+"|Video|"+(e.size||0)+"|"+e.file_name+"|"+e.duration+"|"+(e.width||"auto")+";"+(e.height||"auto")+";"+e.um_plain_access_code+"}/:um_end"},t.createFileContentText=function(e){var t=0,r="",n="",o=a.getFileMediaType(e.file_name);return isNullOrEmpty(e.duration)||(t=e.duration),isNullOrEmpty(e.width)||(r=e.width),isNullOrEmpty(e.height)||(n=e.height),"/:um_begin{"+e.um_url+"|"+o+"|"+e.file_size+"|"+e.file_name+"|"+t+"|"+r+";"+n+";"+e.um_plain_access_code+"}/:um_end"}),l=(t.transformHtmlEmotion=function(e){var t=/\u2060\/[\S]{2}/g;if(t.test(e)){e.match(t).map(function(t){if(constant.emojiData[t]){var r=window.EMOTION_PATH+constant.emojiData[t].file,n=constant.emojiData[t].ZH_CH,a="<img inline src='"+r+"' alt='"+n+"'/>";e=e.replace(t,a)}})}return e},t.transformHtmlLike=function(e){var t=/\u2061\/[\S]{2}/g,r=window.LIKE_PATH+e.split("_")[0];return t.test(e)&&(r=window.LIKE_PATH+"like-"+r.split(":")[1]+".svg"),"<img inline src='"+r+"' alt='"+language.EDITOR_TOOLS_TITLE_LIKE+"'/>"},t.createRootElem=function(e){o.debug("createRootElem");var t=e.isGZip,r=e.imageList,n=e.html,a=e.content,i=f();isNullOrEmpty(t)&&(t=1),isNullOrEmpty(n)&&(n=""),isNullOrEmpty(a)&&(a="");var s=void 0;return isNullOrEmpty(r)?(window.CLIENTCONFIG.ISMOBILE,s="<imbody><imagelist></imagelist><html><![CDATA["+n+"]]></html><content>"+a+"</content></imbody>"):(window.CLIENTCONFIG.ISMOBILE,s="<imbody><imagelist>"+d(r[0])+l(r)+"</imagelist><html><![CDATA["+n+"]]></html><content>"+a+"</content></imbody>"),o.debug("createRootElem imBody"),1===t?(s=coreCommon.zip(s),"<r><n>"+i+"</n><g>1</g><c>"+s+"</c></r>"):"<r><n>"+i+"</n><g>0</g><c>"+s+"</c></r>"},t.createMobileRootElem=function(e){o.debug("createMobileRootElem");var t=e.isGZip,r=e.content,n=f();isNullOrEmpty(t)&&(t=1),isNullOrEmpty(r)&&(r="");var a=void 0;return a="<imbody><imagelist></imagelist><html></html><content>"+r+"</content></imbody>",o.debug("createRootElem imBody"),1===t?(a=coreCommon.zip(a),"<r><n>"+n+"</n><g>1</g><c>"+a+"</c></r>"):"<r><n>"+n+"</n><g>0</g><c>"+a+"</c></r>"},t.createQuoteRootElem=function(e){o.debug("createRootElem");var t=e.isGZip,r=e.imageList,n=e.html,a=e.content,i=e.quote,s=f();isNullOrEmpty(t)&&(t=1),isNullOrEmpty(n)&&(n=""),isNullOrEmpty(a)&&(a="");var u=void 0;return u=isNullOrEmpty(r)?'<imbody><imagelist></imagelist><quote origin="'+i.origin+'" mediatype="'+i.media_type+'" time="'+i.utc_stamp+'">'+coreCommon.zip(i.content)+"</quote><html><![CDATA["+n+"]]></html><content>"+a+"</content></imbody>":"<imbody><imagelist>"+d(r[0])+l(r)+'</imagelist><quote origin="'+i.origin+'" mediatype="'+i.media_type+'"  time="'+i.utc_stamp+'">'+coreCommon.zip(i.content)+"</quote><html><![CDATA["+n+"]]></html><content>"+a+"</content></imbody>",o.debug("createRootElem imBody"),1===t?(u=coreCommon.zip(u),"<r><n>"+s+"</n><g>1</g><c>"+u+"</c></r>"):"<r><n>"+s+"</n><g>0</g><c>"+u+"</c></r>"},t.createMobileQuoteRootElem=function(e){o.debug("createRootElem");var t=e.isGZip,r=e.content,n=e.quote,a=f();isNullOrEmpty(t)&&(t=1),isNullOrEmpty(r)&&(r="");var i=void 0;return i='<imbody><imagelist></imagelist><quote origin="'+n.origin+'" mediatype="'+n.media_type+'" time="'+n.utc_stamp+'">'+coreCommon.zip(n.content)+"</quote><html></html><content>"+r+"</content></imbody>",o.debug("createRootElem imBody"),1===t?(i=coreCommon.zip(i),"<r><n>"+a+"</n><g>1</g><c>"+i+"</c></r>"):"<r><n>"+a+"</n><g>0</g><c>"+i+"</c></r>"},t.createFileRootElem=function(e){return"<r><n>"+f()+"</n><g>0</g><c><![CDATA[<imbody><content>"+c(e)+"</content></imbody>]]></c></r>"},t.createPhotoList=function(e){var t="";return e.forEach(function(e){t+='<photo-item name="'+e.file_name+'" size="'+e.file_size+'" height="'+e.height+'" width="'+e.width+'" url="'+e.um_url+'" plain-access-code="'+e.um_plain_access_code+'"></photo-item>'}),t}),d=t.createOldImageItem=function(e){return"<img><imgname>"+e.file_name+'</imgname><imgdata __type__="url">'+e.um_url+"</imgdata></img>"},f=(t.transformMessageContentEmotion=function(e){try{return e=e.replaceAll('src="'+window.EMOTION_PATH,'src="'+constant.SERVER_PUBLIC_PATH.EMOTION_PATH)}catch(e){o.error("transformMessageContentEmotion",e.toString())}},function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890=-",r=t.length,n="",a=0;a<e;a++)n+=t.charAt(Math.floor(Math.random()*r));return n});t.transformGroupNotifyMessage=function(e){try{var t="",r=JSON.parse(e),n=r.contacts||[],a=r.languageKey;if(isNullOrEmpty(n))return language[a];if(-1!==language[a].indexOf("{1}")){var i=n.shift().name,s=n.getKeyArr("name").join(",");t=language[a].format(i,s)}else t=language[a].format(n.getKeyArr("name").join(","));return t}catch(e){return o.error("transformGroupNotifyMessage error:",e),""}}},986:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.modifyMessageListStatus=void 0;var n=r(110),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=window.Logger("logic")("IM/mergeCacheToMessageList"),i=(t.modifyMessageListStatus=function(e){if(!isNullOrEmpty(e)){var t=$getState().recent.currentRecentInfo,r=t.chat_type,n=t.account,o=t.group_id,s=coreIm.isGroup(r),u=s?o:n,c=coreIm.querySendingMessageMap({recent_owner:u}),l=coreIm.queryReceivingMessageMap({recent_owner:u});!isNullOrEmpty(c)&&(0,a.default)(c).forEach(function(t){var r=i(e,c[t]);-1!==r&&(e[r].status=constant.MEDIA_STATUS.SENDING,delete e[r].send_status)}),!isNullOrEmpty(l)&&(0,a.default)(l).forEach(function(t){var r=i(e,l[t]);-1!==r&&(e[r].status=constant.MEDIA_STATUS.RECEIVING,delete e[r].send_status)})}},function(e,t){try{var r=-1;return o.debug("queryMessageListIndex"),isNullOrEmpty(t)?(o.debug("queryMessageListIndex1"),r):isNullOrEmpty(t.server_chat_id_str)?!isNullOrEmpty(t.client_chat_id)&&t.client_chat_id>0?(r=e.findIndex(function(e){return e.client_chat_id===t.client_chat_id}),o.debug("queryMessageListIndex3"),r):(r=e.findIndex(function(e){return e.id===t.id}),o.debug("queryMessageListIndex4"),r):(r=e.findIndex(function(e){return e.server_chat_id_str===t.server_chat_id_str}),o.debug("queryMessageListIndex2"),r)}catch(e){o.error("queryMessageListIndex5",{message:t,e:e.toJSON()})}})},987:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getImgList=void 0;var a=r(1),o=n(a),i=r(98),s=n(i),u=r(2),c=n(u),l=r(135),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(l),f=window.Logger("logic")("IM/historyMessageDeal/imgList"),p=(t.getImgList=function(){var e=(0,c.default)(o.default.mark(function e(){var t,r,n,a,i,u,c,l,g,_,h,v,m,M,y,E,w;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f.info("getImgList 请求本会话中所有图片地址"),t=$getState().recent.currentRecentInfo,e.next=4,coreDb.queryScreenShotList({recent_owner:t.owner});case 4:for(r=e.sent,n=[],a=0;a<r.length;a++)0===r[a].is_quote&&n.push(r[a]);for(i=(0,s.default)(n),u=0;u<i.length;u++)i[u].type="origin",i[u].is_downloaded=0;return e.next=11,coreDb.queryFileList({recent_owner:t.owner});case 11:for(c=e.sent,l=[],g=0;g<c.length;g++)0===c[g].is_quote&&l.push(c[g]);for(_=[],h=0;h<l.length;h++)constant.MEDIA_TYPE.PHOTO===d.getMediaType(l[h].file_name)&&_.push(l[h]);for(v=(0,s.default)(_),m=0;m<v.length;m++)v[m].type="origin",v[m].is_downloaded=0;M=n.concat(_),y=i.concat(v),E=function(e){return function(t,r){var n=t[e],a=r[e];return n<a?-1:n>a?1:0}},M=M&&M.sort(E("time_stamp")),y=y&&y.sort(E("time_stamp")),w=[],w.push(p(M)),w.push(p(y)),$dispatch(coreUi.setCurrentRecentImgList(w));case 27:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],n=0;n<t.length;n++)0===t[n].is_quote&&r.push(t[n]);return e.abrupt("return",r);case 3:case"end":return e.stop()}},e,void 0)}))}(),function(e){for(var t={},r=[],n=0;n<e.length;n++)t[e[n].um_plain_access_code]||(r.push(e[n]),t[e[n].um_plain_access_code]=1);return r})},988:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),o=n(a),i=r(2),s=n(i),u=r(95),c=n(u),l=r(4),d=n(l),f=r(93),p=n(f),g=r(94),_=n(g),h=function(e){function t(){var e,r,n,a,i=this;(0,d.default)(this,t);for(var u=arguments.length,l=Array(u),f=0;f<u;f++)l[f]=arguments[f];return r=n=(0,p.default)(this,(e=t.__proto__||(0,c.default)(t)).call.apply(e,[this].concat(l))),n.utConfigAccountInfo=function(e){},n.utPageAppear=function(){var e=(0,s.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,i)}));return function(t){return e.apply(this,arguments)}}(),n.utPageDisappear=function(){var e=(0,s.default)(o.default.mark(function e(t,r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,i)}));return function(t,r){return e.apply(this,arguments)}}(),n.utPageLoad=function(){var e=(0,s.default)(o.default.mark(function e(t,r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,i)}));return function(t,r){return e.apply(this,arguments)}}(),n.utConfOperate=function(){var e=(0,s.default)(o.default.mark(function e(t,r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,i)}));return function(t,r){return e.apply(this,arguments)}}(),n.utCustomEvent=function(){var e=(0,s.default)(o.default.mark(function e(t,r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,i)}));return function(t,r){return e.apply(this,arguments)}}(),n.utHandleNativeCrashInfoScan=(0,s.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,i)})),n.utEventStart=function(e,t,r){},n.utEventFinish=function(e,t,r){arguments.length>3&&void 0!==arguments[3]&&arguments[3]},n.utHandleFileTransfer=function(){var e=(0,s.default)(o.default.mark(function e(t,r,n,a){arguments.length>4&&void 0!==arguments[4]&&arguments[4];return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,i)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),n.utHandleMobileSystemBroken=(0,s.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,i)})),a=r,(0,p.default)(n,a)}return(0,_.default)(t,e),t}(coreCommon.Interface);t.default=h},989:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),o=n(a),i=r(2),s=n(i),u=r(4),c=n(u),l=r(5),d=n(l),f=window.Logger("UT")("usertrack"),p=function(){function e(){(0,c.default)(this,e),this.instance=null,this.deviceId="",this.brand="",this.deviceModel="",this.cpu="",this.resolution="",this.language="",this.osName="",this.osVersion="",this.init()}return(0,d.default)(e,[{key:"init",value:function(){var e=window.CLIENTCONFIG.PLATFORM;"mac"===e||"win"===e?this.instanceDesktopDeviceInfo():this.instanceMobileDeveceInfo()}},{key:"instanceDesktopDeviceInfo",value:function(){this.cpu=this.desktopCpuDesc(),this.resolution=window.screen.width*window.devicePixelRatio+"*"+window.screen.height*window.devicePixelRatio,this.language=this.clientLanguageDescription(),this.osName=appService.osName(),this.osVersion=appService.osVersion()}},{key:"instanceMobileDeveceInfo",value:function(){var e=this;document.addEventListener("deviceready",(0,s.default)(o.default.mark(function t(){var r,n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=window.CLIENTCONFIG.PLATFORM,n="android"===r,e.brand=window.device.manufacturer,t.next=5,appService.deviceModel();case 5:if(e.deviceModel=t.sent,!n){t.next=11;break}return t.next=9,appService.cpuDesc();case 9:e.cpu=t.sent,f.info("[UT]cpu info is:",e.cpu);case 11:return e.resolution=window.screen.width*window.devicePixelRatio+"*"+window.screen.height*window.devicePixelRatio,e.language=e.clientLanguageDescription(),t.next=15,appService.osName();case 15:return e.osName=t.sent,t.next=18,appService.osVersion();case 18:e.osVersion=t.sent;case 19:case"end":return t.stop()}},t,e)})),!1)}},{key:"clientLanguageDescription",value:function(){var e="EN";switch(window.langcode){case"1036":e="FR";break;case"1033":e="EN";break;case"2052":e="CN"}return e}},{key:"desktopCpuDesc",value:function(){var e=window.require("os"),t=e.cpus();if(t.length>1){return t[0].model}return f.warn("get cpu info error!"),""}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}]),e}();t.default=p},990:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),o=n(a),i=r(2),s=n(i),u=r(4),c=n(u),l=function e(){var t=this;(0,c.default)(this,e),this.refreshNetInfo=(0,s.default)(o.default.mark(function e(){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("mac"!==(r=window.CLIENTCONFIG.PLATFORM)&&"win"!==r){e.next=6;break}return e.next=4,t.refreshDesktopClientNetInfo();case 4:e.next=8;break;case 6:return e.next=8,t.refreshMobileClientNetInfo();case 8:case"end":return e.stop()}},e,t)})),this.refreshDesktopClientNetInfo=(0,s.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,appService.netInfo();case 2:t.access=e.sent;case 3:case"end":return e.stop()}},e,t)})),this.refreshMobileClientNetInfo=(0,s.default)(o.default.mark(function e(){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,appService.netInfo();case 2:r=e.sent,r instanceof Array&&3===r.length&&(t.carrier=r[0],t.access=r[1],"wifi"===t.access?t.accessSubtype="unknown":t.accessSubtype=r[2]);case 4:case"end":return e.stop()}},e,t)})),this.carrier="",this.access="",this.accessSubtype=""};t.default=l},991:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(100),o=n(a),i=r(1),s=n(i),u=r(2),c=n(u),l=r(4),d=n(l),f=r(5),p=n(f),g=r(803),_=n(g),h=100,v="rest/usg/ops/v1/operations/terminalaction",m=window.Logger("service")("UT"),M=function(){function e(){var t=this;(0,d.default)(this,e),this.initDbUtCount=(0,c.default)(s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==t.dbUtCacheCount){e.next=4;break}return e.next=3,coreDb.queryUserTrackList({alllength:""});case 3:t.dbUtCacheCount=e.sent;case 4:case"end":return e.stop()}},e,t)})),this.addTrackerData=function(){var e=(0,c.default)(s.default.mark(function e(r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r instanceof _.default){e.next=3;break}return m.error("[UT] utInfo require a UTInfo  member, ignore other!"),e.abrupt("return");case 3:if(n=coreAccount.getMyInfo().isAutoCollectLogs){e.next=6;break}return e.abrupt("return");case 6:if(!t.isServerNoSupportUTUpload()){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,r.toUTString();case 10:return a=e.sent,e.next=13,t.saveUTInfoDesc2DB(a);case 13:return e.next=15,t.initDbUtCount();case 15:if(t.dbUtCacheCount++,!t.isInUploading){e.next=19;break}return m.info("[UT] in uploading, ignore."),e.abrupt("return");case 19:m.info("[UT] teacklist count:"+t.dbUtCacheCount+" UT_ONCE_UPLOAD_COUNT"+h),t.dbUtCacheCount>=h&&t.uploadUserTrackData();case 21:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}(),this.uploadUserTrackData=(0,c.default)(s.default.mark(function e(){var r,n,a,o,i,u,c,l,d,f,p,g,_,h;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=coreAccount.getMyInfo().isAutoCollectLogs){e.next=3;break}return e.abrupt("return");case 3:if(n=$getState().conf.isSupportAS){e.next=6;break}return e.abrupt("return");case 6:if(!t.isInUploading){e.next=9;break}return m.info("[UT]in uploading, ignore new upload"),e.abrupt("return");case 9:return t.isInUploading=!0,t.stopUploadTimer(),m.info("[UT] uploadUserTrackData"),a=coreAccount.getLoginModel(),e.next=15,t.getUploadLists();case 15:if(o=e.sent,0!==o.length){e.next=21;break}return m.info("[UT] no date need upload, ignore!"),t.isInUploading=!1,t.startUploadTimer(),e.abrupt("return");case 21:if(i=t.prepareUploadDataBody(o),u="https://"+a.serverUportalAddress+":"+a.serverUportalPort+"/"+v,c=a.authToken,0!==c.length){e.next=28;break}return t.isInUploading=!1,t.startUploadTimer(),e.abrupt("return");case 28:return l={proxyAddress:"",proxyPort:0,proxyAccount:"",proxyPassword:""},e.next=31,coreSecurity.PasswordManager.getPassword("proxyPassword");case 31:return d=e.sent,a.isSupportProxy&&(l.proxyAddress=a.proxyAddress,l.proxyPort=a.proxyPort,l.proxyAccount=a.proxyAccount,l.proxyPassword=d),e.next=35,new coreHttp.hwTupHttpTransSdk;case 35:return f=e.sent,e.next=38,f.sendSyncRequest({url:u,type:constant.REQUEST_TYPE.POST,header:{"Content-Type":"application/json",Authorization:"Basic "+c},body:i,proxyInfo:l,cipherlist:[]});case 38:if(p=e.sent,g=p.param&&p.param.resp_code,_=p.result,m.info("[UT] statusCode:"+g+" retCode:"+_),!g){e.next=53;break}if(200!==(h=parseInt(g))){e.next=50;break}return m.info("[UT] upload info success!"),e.next=48,t.deleteUploadedUTList(o);case 48:e.next=51;break;case 50:m.error("[UT] upload failed, request error, status code: "+g+", result: "+_);case 51:e.next=54;break;case 53:m.error("[UT] upload failed, status code:"+g);case 54:t.isInUploading=!1,t.startUploadTimer();case 56:case"end":return e.stop()}},e,t)})),this.getUploadLists=(0,c.default)(s.default.mark(function e(){var r,n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreDb.queryUserTrackList({alllength:""});case 2:if(r=e.sent,t.dbUtCacheCount=r,n=void 0,!(r>=h)){e.next=11;break}return e.next=8,coreDb.queryUserTrackList({limitcount:h});case 8:n=e.sent,e.next=14;break;case 11:return e.next=13,coreDb.queryUserTrackList();case 13:n=e.sent;case 14:return e.abrupt("return",n);case 15:case"end":return e.stop()}},e,t)})),this.prepareUploadDataBody=function(e){for(var t="",r=0;r<e.length;r++){t+=e[r].content,r!==e.length-1&&(t+="\n")}var n={user:coreAccount.getLoginModel().account,data:t};return(0,o.default)(n)},this.saveUTInfoDesc2DB=function(){var e=(0,c.default)(s.default.mark(function e(r){var n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!isNullOrEmpty(r)){e.next=3;break}return m.warn("[UT] utinfodesc is empty, ignore save to db!"),e.abrupt("return");case 3:return n={id:0,content:r,retryCount:0},e.next=6,coreDb.saveUserTrack(n);case 6:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}(),this.deleteUploadedUTList=function(){var e=(0,c.default)(s.default.mark(function e(r){var n,a,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n="",a=r.length,o=0;o<a;o++)n+=r[o].id,o<a-1&&(n+=",");return e.next=5,coreDb.deleteUserTrack({all:"",idlist:n});case 5:t.dbUtCacheCount-=a;case 6:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}(),this.instance=null,this.localTimer=null,this.uploadTimer=null,this.UTMemoryCache=null,this.isInUploading=!1,this.dbUtCacheCount=-1,this.startUploadTimer()}return(0,p.default)(e,[{key:"startUploadTimer",value:function(){var e=this;this.uploadTimer=setInterval(function(){return e.uploadUserTrackData()},6e5)}},{key:"stopUploadTimer",value:function(){clearInterval(this.uploadTimer)}},{key:"isServerNoSupportUTUpload",value:function(){var e=$getState().conf.isSupportAS,t=coreAccount.getLoginModel().uportalLoginState===constant.UPORTAL_LOGIN_STATE.UPORTAL_LOGIN_SUCCESS;return!(e||!t)}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}]),e}();t.default=M},992:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UT_DESKTOP_PAGE_NAME_INDEX=t.UT_MOBILE_PAGE_NAME_INDEX=void 0;var n=r(4),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=t.UT_MOBILE_PAGE_NAME_INDEX={MLoginCtn:constant.UT_MOBILE_PAGE_INDEX.UT_MOBILE_PAGE_LOGIN,ConferenceHome:constant.UT_MOBILE_PAGE_INDEX.UT_MOBILE_PAGE_MEETING,ContactGroups:constant.UT_MOBILE_PAGE_INDEX.UT_MOBILE_PAGE_CONTACT,MyInfo:constant.UT_MOBILE_PAGE_INDEX.UT_MOBILE_PAGE_ME},i=t.UT_DESKTOP_PAGE_NAME_INDEX={UserLogin:constant.UT_DESKTOP_PAGE_INDEX.UT_DESKTOP_PAGE_LOGIN,CreateConference:constant.UT_DESKTOP_PAGE_INDEX.UT_DESKTOP_PAGE_MEETING_CREATE_CONF,JoinConference:constant.UT_DESKTOP_PAGE_INDEX.UT_DESKTOP_PAGE_MEETING_JOIN_CONF,BookConference:constant.UT_DESKTOP_PAGE_INDEX.UT_DESKTOP_PAGE_MEETING_BOOK_CONF,CloudConferenceRoom:constant.UT_DESKTOP_PAGE_INDEX.UT_DESKTOP_PAGE_MEETING_CLOUD_CONF,MyConferenceList:constant.UT_DESKTOP_PAGE_INDEX.UT_DESKTOP_PAGE_MEETING_MY_CONF,LeftDetail:constant.UT_DESKTOP_PAGE_INDEX.UT_DESKTOP_PAGE_CONTACT,CallRecordList:constant.UT_DESKTOP_PAGE_INDEX.UT_DESKTOP_PAGE_RECENT_CALL},s=function e(){var t=this;(0,a.default)(this,e),this.pageTreeIndexByPageName=function(e){var r=window.CLIENTCONFIG.PLATFORM;return"mac"===r||"win"===r?t._desktopPageTreeIndexByPageName(e):t._mobilePageTreeIndexByPageName(e)},this._desktopPageTreeIndexByPageName=function(e){return e&&0!==e.length?i[e]:constant.UT_DESKTOP_PAGE_INDEX.UT_DESKTOP_PAGE_DEFAULT},this._mobilePageTreeIndexByPageName=function(e){return e&&0!==e.length?o[e]:constant.UT_MOBILE_PAGE_INDEX.UT_MOBILE_PAGE_DEFAULT}};t.default=s},993:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=function e(t){(0,a.default)(this,e),this.params=t,this.actionTime=Date.now(),this.actionResTimeCosts=0};t.default=o},994:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.receiveQuoteFile=t.saveAsImg=t.saveAsFile=t.rejectFile=t.receiveVideoImage=t.receiveFile=void 0;var o=r(103),i=a(o),s=r(1),u=a(s),c=r(2),l=a(c),d=function(){var e=(0,l.default)(u.default.mark(function e(t,r){var n,a,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0,window.CLIENTCONFIG.ISMOBILE?(t.file_real_save_path=t.file_real_save_path.replaceAll("file://",""),t.file_real_save_name=getFileName(t.file_real_save_path)):(t.file_deal_type===constant.FILE_DEAL_TYPE.UPLOAD&&(a=$getState().login.account,t.file_real_save_path=appService.getReceiveFilesPath(a)+t.file_name,t.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,M.info("download the files self send")),n=appService.dealSaveFileName(t.file_real_save_path),t.file_real_save_name=n.name,t.file_real_save_path=n.path),t.file_deal_type!==constant.FILE_DEAL_TYPE.DOWNLOAD&&t.file_deal_type!==constant.FILE_DEAL_TYPE.RE_DOWNLOAD){e.next=15;break}return e.next=5,_.downloadFile({access_code:t.um_plain_access_code,url:t.um_url,path:t.file_real_save_path});case 5:if(!1!==(o=e.sent)){e.next=9;break}return(0,m.dealDownloadFileFailed)(t,r),e.abrupt("return",!1);case 9:return t.file_handle=o.param.pcfile_handle.toString(),e.next=12,coreDb.saveFile((0,i.default)({},t));case 12:return t=e.sent,p.setFileByHandle(t.file_handle,t),e.abrupt("return",t);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),f=r(159),p=n(f),g=r(417),_=n(g),h=r(156),v=n(h),m=r(513),M=window.Logger("logic")("IM/fileReceive"),y=t.receiveFile=function(){var e=(0,l.default)(u.default.mark(function e(t){var r,n,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,M.info("userCLick  点击了接收文件"),!a){e.next=4;break}return e.abrupt("return",E(t));case 4:if(M.info("receiveFile"),r=t.file_list[0],t.status!==constant.MEDIA_STATUS.RECEIVING){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,d(r,t);case 10:if(!1!==(n=e.sent)){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,coreDb.saveMessage(t);case 15:t=e.sent,t.status=constant.MEDIA_STATUS.RECEIVING,p.setReceivingMessage(r.um_url,t),M.info("receiveFile updateProgressMap"),$dispatch(coreUi.updateProgressMap(r.file_handle,0)),$dispatch(coreUi.updateMessageList(t)),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),M.error("receiveFile",e.t0.toString());case 26:case"end":return e.stop()}},e,void 0,[[0,23]])}));return function(t){return e.apply(this,arguments)}}(),E=(t.receiveVideoImage=function(){var e=(0,l.default)(u.default.mark(function e(t){var r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,M.info("下载video首帧图"),(r=t.file_list[1])||!r.downloading){e.next=5;break}return e.abrupt("return");case 5:return r.downloading=!0,e.next=8,_.downloadFile({access_code:r.um_plain_access_code,url:r.um_url,path:r.file_real_save_path});case 8:if(!1!==(n=e.sent)){e.next=12;break}return r.is_downloaded=constant.IS_DOWNLOADED.NO,e.abrupt("return",!1);case 12:r.file_handle=n.param.pcfile_handle.toString(),p.setFileByHandle(r.file_handle,r),$dispatch(coreUi.updateProgressMap(r.file_handle,0)),$dispatch(coreUi.updateMessageList(t)),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),M.error("receiveFile",e.t0.toString());case 21:case"end":return e.stop()}},e,void 0,[[0,18]])}));return function(t){return e.apply(this,arguments)}}(),t.rejectFile=function(){var e=(0,l.default)(u.default.mark(function e(t){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,M.info("rejectFile"),r=t.file_list[0],t.status=constant.MEDIA_STATUS.RECEIVE_ERROR,r.file_deal_type!==constant.FILE_DEAL_TYPE.DOWNLOAD&&r.file_deal_type!==constant.FILE_DEAL_TYPE.RE_DOWNLOAD){e.next=7;break}return e.next=7,_.releaseFile({file_handle:parseInt(r.file_handle)});case 7:return p.deleteFileByHandleList([r.file_handle,t.client_chat_id]),p.deleteReceivingMessage(r.um_url),$dispatch(coreUi.deleteProgressMap(r.file_handle)),delete r.file_handle,e.next=13,coreDb.saveFile(r);case 13:return r=e.sent,t.file_list=[r],e.next=17,coreDb.saveMessage(t);case 17:t=e.sent,$dispatch(coreUi.updateMessageList(t)),t.media_type===constant.MEDIA_TYPE.FILE&&window.ToastNew(language.PC_DOWNLOAD_FAILED),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),M.error("rejectFile",e.t0.toString());case 25:case"end":return e.stop()}},e,void 0,[[0,22]])}));return function(t){return e.apply(this,arguments)}}(),t.saveAsFile=function(e){try{var t=e.file_list,r=e.server_chat_id_str,n=t[0],a=n.file_real_save_path,o=n.is_downloaded,i={};i.defaultPath=a,o===constant.IS_DOWNLOADED.NO?window.electron.remote.dialog.showSaveDialog(i,function(t){isNullOrEmpty(t)||($dispatch(coreUi.updateSaveAsFileMessageMap(r,t)),y(e))}):window.electron.remote.dialog.showSaveDialog(i,function(e){isNullOrEmpty(e)||appService.saveAs(a,e).then(function(){window.alert(language.SAVE_SUCCESS+"!")})})}catch(e){M.error("saveAsFile",e.toString())}},t.saveAsImg=function(e){try{var t={filters:[{name:"Images",extensions:["jpg","png","gif"]}],properties:["openFile","openDirectory","promptToCreate"]};t.defaultPath=e,window.fs.stat(e,function(r,n){if(r)throw r;n&&n.isFile()&&window.electron.remote.dialog.showSaveDialog(t,function(t){isNullOrEmpty(t)||appService.saveAs(e,t).then(function(){window.alert(language.SAVE_SUCCESS+"!")})})})}catch(e){M.error("saveAsImg",e.toString())}},t.receiveQuoteFile=function(){var e=(0,l.default)(u.default.mark(function e(t){var r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,M.info("receiveQuoteFile"),isNullOrEmpty(t.quote.file_list)){e.next=16;break}return r=t.quote.file_list[0],t.quote.status=constant.MEDIA_STATUS.RECEIVING,e.next=7,d(r,t,t);case 7:if(!1!==(n=e.sent)){e.next=10;break}return e.abrupt("return");case 10:return t.quote.file_list=[r],t.quote=(0,i.default)({},t.quote),e.next=14,coreDb.saveMessage(t);case 14:v.updateProgressMap(r.file_handle,0),v.updateMessageList(t);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),M.error("receiveFile",e.t0.toString());case 21:case"end":return e.stop()}},e,void 0,[[0,18]])}));return function(t){return e.apply(this,arguments)}}())},995:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.downloadMobileFile=t.downloadUMOriginPicture=t.isExistOfOriginImage=void 0;var o=r(1),i=a(o),s=r(2),u=a(s),c=r(159),l=n(c),d=r(417),f=n(d),p=r(135),g=n(p),_=r(486),h=window.Logger("logic")("IM/file/downloadMobilePhoto");t.isExistOfOriginImage=function(){var e=(0,u.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,appService.isFileExist(t.file_path);case 2:r=e.sent,t.is_downloaded=r?constant.IS_DOWNLOADED.YES:constant.IS_DOWNLOADED.NO;case 4:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.downloadUMOriginPicture=function(){var e=(0,u.default)(i.default.mark(function e(t){var r,n,a,o;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,h.info("downloadUMOriginPicture 下载原图"),r=$getState().myInfo.account,e.next=5,appService.isPhotoExist(t.file_path);case 5:if(n=e.sent){e.next=24;break}return h.info("downloadUMOriginPicture 截图图片开始下载"),t.is_downloaded=constant.DOWNLOAD_IMAGE_STATE.DOWNLOADING,t.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,e.next=12,f.downloadFile({access_code:t.um_plain_access_code,url:t.um_url,path:t.file_path||appService.getOriginFilesPath(r)+t.file_name,isThumbnail:!1});case 12:if(!1!==(a=e.sent)){e.next=20;break}return e.next=16,coreDb.queryMessage({server_chat_id_str:t.message_server_chat_id_str});case 16:return o=e.sent,e.next=19,(0,_.dealDownloadScreenShotFailed)(t,o);case 19:return e.abrupt("return");case 20:t.file_handle=a.param.pcfile_handle.toString(),l.setFileByHandle(t.file_handle,t),e.next=26;break;case 24:h.debug("downloadUMOriginPicture 截图图片已存在"),t.is_downloaded=constant.DOWNLOAD_IMAGE_STATE.DOWNLOADED;case 26:if(g.getMediaType(t.file_name)!==constant.MEDIA_TYPE.PHOTO){e.next=31;break}return e.next=29,coreDb.saveFile(t);case 29:e.next=33;break;case 31:return e.next=33,coreDb.saveScreenShot(t);case 33:e.next=38;break;case 35:e.prev=35,e.t0=e.catch(0),h.error("downloadUMOriginPicture",e.t0.toString());case 38:case"end":return e.stop()}},e,void 0,[[0,35]])}));return function(t){return e.apply(this,arguments)}}(),t.downloadMobileFile=function(e,t){try{h.info("downloadMobileFile 下载图片");var r=$getState().myInfo.account,n=appService.getOriginFilesPath(r);appService.saveAs("file://"+e,n).then(function(){t()})}catch(e){h.error("downloadMobileFile",e.toString())}}}});